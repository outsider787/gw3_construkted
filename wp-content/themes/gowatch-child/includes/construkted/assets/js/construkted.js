!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("cesium")):"function"==typeof define&&define.amd?define(["cesium"],t):t((e=e||self).Cesium)}(this,(function(e){"use strict";function t(e,t){void 0===t&&(t={});var i=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===i&&n.firstChild?n.insertBefore(o,n.firstChild):n.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}t(".cesium-measure-toolbar {\r\n    width: 40px;\r\n    height: 32px;\r\n    overflow: hidden;\r\n    transition: width 0.8s;\r\n    white-space: nowrap;\r\n    background: #303336;\r\n    border: 1px solid #444;\r\n    color: #edffff;\r\n    stroke: #edffff;\r\n    stroke-width: 2;\r\n    fill: transparent;\r\n}\r\n.cesium-measure-toolbar.expanded {\r\n    width: 423px;\r\n}\r\n.cesium-measure-button {\r\n    vertical-align: top;\r\n    display: inline-block;\r\n    border-right: 1px solid #444;\r\n    cursor: pointer;\r\n    padding: 4px 8px;\r\n    height: 25px;\r\n    width: 25px;\r\n    margin-left: -4px /*removes space between buttons*/\r\n}\r\n.cesium-measure-button:first-child {\r\n    margin-left: 0;\r\n}\r\n.cesium-measure-button:hover {\r\n    background-color: #48b;\r\n}\r\n.cesium-measure-button:last-child {\r\n    border-right: none;\r\n}\r\n\r\n.cesium-measure-button.active {\r\n    background-color: #1a71cc;\r\n    cursor: default;\r\n}\r\n.cesium-measure-button-main {\r\n    stroke-width: 1.3;\r\n}\r\n.cesium-measure-help {\r\n    stroke-width: 0;\r\n    padding: 6px 8px;\r\n    fill: #edffff;\r\n}\r\n.cesium-measure-instructions {\r\n    position: absolute;\r\n    max-height: 500px;\r\n    width: 403px;\r\n    border: 1px solid #444;\r\n    overflow-y: auto;\r\n    border-radius: 0;\r\n    background-color: rgba(48,51,54,0.8);\r\n    color: #edffff;\r\n    padding: 10px;\r\n    stroke: #edffff;\r\n    stroke-width: 2;\r\n}\r\n.cesium-measure-icon {\r\n    margin-right: 10px;\r\n}\r\n.cesium-measure-instructions .bold {\r\n    margin-bottom: 3px;\r\n}\r\n.cesium-measure-instructions > ul {\r\n    padding-left: 20px;\r\n}\r\n");t(".transform-editor-menu {\r\n    position: absolute;\r\n    stroke: none;\r\n    fill: #edffff;\r\n}\r\n\r\n.transform-editor-button {\r\n    padding: 0;\r\n    width: 25px;\r\n    height: 25px;\r\n    border-radius: 13px;\r\n}\r\n\r\n.transform-editor-button > svg {\r\n    margin-top: 2px;\r\n    margin-left: 2px;\r\n}\r\n\r\n.transform-editor-options {\r\n    position: relative;\r\n    left: -16px;\r\n    background-color: #303336;\r\n    color: #edffff;\r\n}\r\n\r\n.transform-editor-button-row > div {\r\n    display: inline-block;\r\n    cursor: pointer;\r\n    padding-top: 4px;\r\n    padding-left: 4px;\r\n    width: 30px;\r\n    height: 30px;\r\n    border: 1px solid #444;\r\n}\r\n\r\n.transform-editor-button-row > div.selected {\r\n    background-color: #1E90FF;\r\n}\r\n\r\n.transform-editor-button-row > div:hover {\r\n    background-color: #48b;\r\n}\r\n");t(".cesium-viewer-measureContainer {\r\n    position: relative;\r\n    display: inline-block;\r\n    margin: 0 3px;\r\n    vertical-align: middle;\r\n}");var i=e.freezeObject({METERS:"METERS",CENTIMETERS:"CENTIMETERS",KILOMETERS:"KILOMETERS",FEET:"FEET",US_SURVEY_FEET:"US_SURVEY_FEET",INCHES:"INCHES",YARDS:"YARDS",MILES:"MILES"}),n=e.freezeObject({SQUARE_METERS:"SQUARE_METERS",SQUARE_CENTIMETERS:"SQUARE_CENTIMETERS",SQUARE_KILOMETERS:"SQUARE_KILOMETERS",SQUARE_FEET:"SQUARE_FEET",SQUARE_INCHES:"SQUARE_INCHES",SQUARE_YARDS:"SQUARE_YARDS",SQUARE_MILES:"SQUARE_MILES",ACRES:"ACRES",HECTARES:"HECTARES"}),o=e.freezeObject({CUBIC_METERS:"CUBIC_METERS",CUBIC_CENTIMETERS:"CUBIC_CENTIMETERS",CUBIC_KILOMETERS:"CUBIC_KILOMETERS",CUBIC_FEET:"CUBIC_FEET",CUBIC_INCHES:"CUBIC_INCHES",CUBIC_YARDS:"CUBIC_YARDS",CUBIC_MILES:"CUBIC_MILES"}),s=e.freezeObject({DEGREES:"DEGREES",RADIANS:"RADIANS",DEGREES_MINUTES_SECONDS:"DEGREES_MINUTES_SECONDS",GRADE:"GRADE",RATIO:"RATIO"});function a(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.distanceUnits=e.defaultValue(t.distanceUnits,i.METERS),this.areaUnits=e.defaultValue(t.areaUnits,n.SQUARE_METERS),this.volumeUnits=e.defaultValue(t.volumeUnits,o.CUBIC_METERS),this.angleUnits=e.defaultValue(t.angleUnits,s.DEGREES),this.slopeUnits=e.defaultValue(t.slopeUnits,s.DEGREES)}a.convertDistance=function(e,t,i){return t===i?e:e*l(t)*(1/l(i))},a.convertArea=function(e,t,i){return t===i?e:e*c(t)*(1/c(i))},a.convertVolume=function(e,t,i){return t===i?e:e*h(t)*(1/h(i))},a.convertAngle=function(t,i,n){return i===n?t:u(function(t,i){if(i===s.RADIANS)return t;if(i===s.DEGREES)return e.Math.toRadians(t);if(i===s.GRADE)return t===Number.POSITIVE_INFINITY?e.Math.PI_OVER_TWO:Math.atan(t/100);if(i===s.RATIO)return Math.atan(t);if(i===s.DEGREES_MINUTES_SECONDS){var n=d.exec(t);if(!e.defined(n))throw new e.RuntimeError("Could not convert angle to radians: "+t);var o=n[1].length>0?-1:1,a=parseInt(n[2]),r=parseInt(n[3]),l=parseFloat(n[4]),c=n[5];1===c.length&&("W"!==(c=c.toUpperCase())&&"S"!==c||(o*=-1));var h=o*(a+r/60+l/3600);return e.Math.toRadians(h)}throw new e.DeveloperError("Invalid angle units: "+i)}(t,i),n)},a.numberToString=function(e,t,i,n){return r(e,t,i,n)},a.distanceToString=function(e,t,n,o,s){return r(a.convertDistance(e,i.METERS,t),n,o,s)+a.getDistanceUnitSpacing(t)+a.getDistanceUnitSymbol(t)},a.areaToString=function(e,t,i,o,s){return r(a.convertArea(e,n.SQUARE_METERS,t),i,o,s)+a.getAreaUnitSpacing(t)+a.getAreaUnitSymbol(t)},a.volumeToString=function(e,t,i,n,s){return r(a.convertVolume(e,o.CUBIC_METERS,t),i,n,s)+a.getVolumeUnitSpacing(t)+a.getVolumeUnitSymbol(t)},a.angleToString=function(t,i,n,o,l){if(i===s.DEGREES||i===s.RADIANS||i===s.GRADE)return r(u(t,i),n,o,l)+a.getAngleUnitSpacing(i)+a.getAngleUnitSymbol(i);if(i===s.DEGREES_MINUTES_SECONDS){var c=e.Math.toDegrees(t),h=c<0?"-":"";c=Math.abs(c);var d=Math.floor(c),p=60*(c-d),_=Math.floor(p),m=60*(p-_);return h+d+"° "+_+"' "+(m=r(m,void 0,o,l))+'"'}return i===s.RATIO?"1:"+r(1/u(t,i),n,o,0):void 0},a.longitudeToString=function(e,t,i,n,o){return a.angleToString(Math.abs(e),t,i,n,o)+" "+(e<0?"W":"E")},a.latitudeToString=function(e,t,i,n,o){return a.angleToString(Math.abs(e),t,i,n,o)+" "+(e<0?"S":"N")},a.getDistanceUnitSymbol=function(t){if(e.Check.typeOf.string("distanceUnits",t),t===i.METERS)return"m";if(t===i.CENTIMETERS)return"cm";if(t===i.KILOMETERS)return"km";if(t===i.FEET||t===i.US_SURVEY_FEET)return"ft";if(t===i.INCHES)return"in";if(t===i.YARDS)return"yd";if(t===i.MILES)return"mi";throw new e.DeveloperError("Invalid distance units: "+t)},a.getDistanceUnitSpacing=function(t){return e.Check.typeOf.string("distanceUnits",t)," "},a.getAreaUnitSymbol=function(t){if(e.Check.typeOf.string("areaUnits",t),t===n.SQUARE_METERS)return"m²";if(t===n.SQUARE_CENTIMETERS)return"cm²";if(t===n.SQUARE_KILOMETERS)return"km²";if(t===n.SQUARE_FEET)return"sq ft";if(t===n.SQUARE_INCHES)return"sq in";if(t===n.SQUARE_YARDS)return"sq yd";if(t===n.SQUARE_MILES)return"sq mi";if(t===n.ACRES)return"ac";if(t===n.HECTARES)return"ha";throw new e.DeveloperError("Invalid area units: "+t)},a.getAreaUnitSpacing=function(t){return e.Check.typeOf.string("areaUnits",t)," "},a.getVolumeUnitSymbol=function(t){if(e.Check.typeOf.string("volumeUnits",t),t===o.CUBIC_METERS)return"m³";if(t===o.CUBIC_CENTIMETERS)return"cm³";if(t===o.CUBIC_KILOMETERS)return"km³";if(t===o.CUBIC_FEET)return"cu ft";if(t===o.CUBIC_INCHES)return"cu in";if(t===o.CUBIC_YARDS)return"cu yd";if(t===o.CUBIC_MILES)return"cu mi";throw new e.DeveloperError("Invalid volume units: "+t)},a.getVolumeUnitSpacing=function(t){return e.Check.typeOf.string("volumeUnits",t)," "},a.getAngleUnitSymbol=function(t){if(e.Check.typeOf.string("angleUnits",t),t===s.DEGREES)return"°";if(t===s.RADIANS)return"rad";if(t===s.GRADE)return"%";throw new e.DeveloperError("Invalid angle units: "+t)},a.getAngleUnitSpacing=function(t){return e.Check.typeOf.string("angleUnits",t),t===s.RADIANS?" ":""};function r(t,i,n,o){n=e.defaultValue(n,2);var s={minimumFractionDigits:o=e.defaultValue(o,n),maximumFractionDigits:n},a=t.toLocaleString(i,s);return a===(-0).toLocaleString(i,s)?(0).toLocaleString(i,s):a}function l(t){if(t===i.METERS)return 1;if(t===i.CENTIMETERS)return.01;if(t===i.KILOMETERS)return 1e3;if(t===i.FEET)return.3048;if(t===i.US_SURVEY_FEET)return 1200/3937;if(t===i.INCHES)return.0254;if(t===i.YARDS)return.9144;if(t===i.MILES)return 1609.344;throw new e.DeveloperError("Invalid distance units:"+t)}function c(t){if(t===n.SQUARE_METERS)return 1;if(t===n.SQUARE_CENTIMETERS)return 1e-4;if(t===n.SQUARE_KILOMETERS)return 1e6;if(t===n.SQUARE_FEET)return.09290304;if(t===n.SQUARE_INCHES)return 64516e-8;if(t===n.SQUARE_YARDS)return.83612736;if(t===n.SQUARE_MILES)return 2589988.110336;if(t===n.ACRES)return 4046.85642232;if(t===n.HECTARES)return 1e4;throw new e.DeveloperError("Invalid area units:"+t)}function h(t){if(t===o.CUBIC_METERS)return 1;if(t===o.CUBIC_CENTIMETERS)return 1e-6;if(t===o.CUBIC_KILOMETERS)return 1e9;if(t===o.CUBIC_FEET)return.09290304*.3048;if(t===o.CUBIC_INCHES)return 16387064e-12;if(t===o.CUBIC_YARDS)return.764554857984;if(t===o.CUBIC_MILES)return 4168181825.44058;throw new e.DeveloperError("Invalid volume units:"+t)}var d=/(-?)(\d+)\s*°\s*(\d+)\s*'\s*([\d.,]+)"\s*([WENS]?)/i;function u(t,i){if(i===s.RADIANS)return t;if(i===s.DEGREES)return e.Math.toDegrees(t);if(i===s.GRADE)return(t=e.Math.clamp(t,0,e.Math.PI_OVER_TWO))===e.Math.PI_OVER_TWO?Number.POSITIVE_INFINITY:100*Math.tan(t);if(i===s.RATIO)return Math.sin(t)/Math.cos(t);throw new e.DeveloperError("Invalid angle units: "+i)}var p=new e.Cartesian3(1,1,1),_=new e.Matrix4,m=new e.Cartesian3;function g(t,i,n){e.Check.defined("transform",t),e.Check.defined("originOffset",i),e.Check.defined("result",n);var o=e.Matrix4.getScale(t,m),s=e.Matrix4.setScale(t,p,_);return e.Matrix4.multiplyByPoint(s,e.Cartesian3.multiplyComponents(i,o,n),n)}function f(t){e.Check.defined("options",t),e.Check.defined("options.positions",t.positions),e.Check.defined("options.color",t.color),this.show=e.defaultValue(t.show,!0),this.id=t.id;var i=t.positions;t.loop&&(i=i.slice()).push(i[0]);var n=e.defaultValue(t.arrow,!1);this._width=e.defined(t.width)?t.width:n?25:8,this._color=t.color,this._depthFailColor=t.color.withAlpha(.3),this._positions=i,this._arrow=n,this._depthFail=e.defaultValue(t.depthFail,!0),this._primitive=void 0,this._boundingSphere=e.BoundingSphere.fromPoints(i),this._transformedBoundingSphere=e.BoundingSphere.clone(this._boundingSphere),this._modelMatrix=e.Matrix4.clone(e.Matrix4.IDENTITY),this._update=!0}e.defineProperties(f.prototype,{modelMatrix:{get:function(){return this._modelMatrix},set:function(t){e.Matrix4.equalsEpsilon(t,this._modelMatrix,e.Math.EPSILON10)||(this._modelMatrix=e.Matrix4.clone(t,this._modelMatrix),this._update=!0)}},positions:{get:function(){return this._positions},set:function(e){this._positions=e,this._update=!0}},color:{get:function(){return this._color}},width:{get:function(){return this._width}},boundingVolume:{get:function(){return this._transformedBoundingSphere}}}),f.prototype.update=function(t){if(this.show){if(this._update){this._update=!1,this._primitive=this._primitive&&this._primitive.destroy();var i,n,o=new e.PolylineGeometry({positions:this._positions,width:this._width,vertexFormat:e.PolylineMaterialAppearance.VERTEX_FORMAT,arcType:e.ArcType.NONE});this._arrow?(i=new e.PolylineMaterialAppearance({material:e.Material.fromType(e.Material.PolylineArrowType,{color:this._color})}),this._depthFail&&(n=new e.PolylineMaterialAppearance({material:e.Material.fromType(e.Material.PolylineArrowType,{color:this._depthFailColor})}))):(i=new e.PolylineColorAppearance({translucent:1!==this._color.alpha}),this._depthFail&&(n=new e.PolylineColorAppearance({translucent:1!==this._depthFailColor.alpha})));var s=this._modelMatrix;this._primitive=new e.Primitive({geometryInstances:new e.GeometryInstance({geometry:o,attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(this._color),depthFailColor:e.ColorGeometryInstanceAttribute.fromColor(this._depthFailColor)},id:this.id,modelMatrix:s}),appearance:i,depthFailAppearance:n,asynchronous:!1}),this._transformedBoundingSphere=e.BoundingSphere.transform(this._boundingSphere,s,this._transformedBoundingSphere)}this._primitive.update(t)}},f.prototype.isDestroyed=function(){return!1},f.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),e.destroyObject(this)};var C={X:"X",Y:"Y",Z:"Z",getValue:function(t){return t===C.X?e.Cartesian3.UNIT_X:t===C.Y?e.Cartesian3.UNIT_Y:e.Cartesian3.UNIT_Z},getColor:function(t){return t===C.X?e.Color.RED:t===C.Y?e.Color.GREEN:e.Color.BLUE}},v=e.freezeObject(C),y=new e.Cartesian3,w=new e.Cartesian2,b=new e.Cartesian3,E=new e.Cartesian3;function x(t,i,n,o,s){var a=function(t,i,n,o,s){var a,r,l=1,c=1;return t.x>0&&(r=t.x*n.x,l=Math.min(r,i.x)/o.x),t.y>0&&(r=t.y*n.y,c=Math.min(r,i.y)/o.y),a=(l+c)/2,e.Cartesian3.fromElements(l,c,a,s)}(t,i,function(t,i,n){var o=t.context,s=t.camera.positionWC,a=e.Cartesian3.distance(i,s),r=o.drawingBufferWidth,l=o.drawingBufferHeight;return t.camera.frustum.getPixelDimensions(r,l,a,t.pixelRatio,n)}(n,e.Matrix4.getTranslation(o,y),w),e.Matrix4.getScale(o,b),E);return e.Matrix4.multiplyByScale(o,a,s)}var S=new e.Cartesian3(1,1,1),T=new e.Cartesian3,M=new e.Cartesian3,P=new e.Cartesian3,k=new e.Matrix4,O=new e.Matrix4,R=new e.Cartesian3,A=new e.Cartesian3,I=new e.Cartesian2,L=new e.Cartesian2,D=new e.HeadingPitchRoll,N=new e.Ray,U=new e.Cartesian3,V=new e.Quaternion,z=new e.Matrix3,F=1/0;function B(t,i,n,o,s){var a=e.Matrix4.inverse(t,O),r=e.Matrix4.multiplyByPoint(a,o,R),l=e.Matrix4.multiplyByPoint(a,s,A);r=e.Cartesian3.subtract(r,i,r),l=e.Cartesian3.subtract(l,i,l);var c=I,h=L;n.x?(c.x=r.y,c.y=r.z,h.x=l.y,h.y=l.z):n.y?(c.x=-r.x,c.y=r.z,h.x=-l.x,h.y=l.z):(c.x=r.x,c.y=r.y,h.x=l.x,h.y=l.y);var d=c.x*h.y-c.y*h.x>=0,u=e.Cartesian2.angleBetween(c,h);return d||(u=-u),u}function j(e,t){return new f({positions:e,color:v.getColor(t),loop:!0,show:!1,id:t})}function H(t){var i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).scene;this._vectorLine1=i.primitives.add(new f({width:5,positions:[new e.Cartesian3,new e.Cartesian3],color:e.Color.YELLOW,show:!1})),this._vectorLine2=i.primitives.add(new f({width:5,positions:[new e.Cartesian3,new e.Cartesian3],color:e.Color.YELLOW,show:!1}));var n=function(){for(var t=[],i=[],n=[],o=0;o<360;o++){var s=e.Math.toRadians(o),a=Math.cos(s),r=Math.sin(s);t.push(new e.Cartesian3(0,a,r)),i.push(new e.Cartesian3(r,0,a)),n.push(new e.Cartesian3(a,r,0))}return{x:t,y:i,z:n}}();this._polylineX=i.primitives.add(j(n.x,v.X)),this._polylineY=i.primitives.add(j(n.y,v.Y)),this._polylineZ=i.primitives.add(j(n.z,v.Z)),this._modelMatrix=e.Matrix4.clone(e.Matrix4.IDENTITY),this.originOffset=t.originOffset,this._scene=i,this._setHPRCallback=t.setHeadingPitchRoll,this._setPositionCallback=t.setPosition,this._transform=t.transform,this._radius=t.radius,this._active=!1,this._dragging=!1,this._startTransform=new e.Matrix4,this._startRotation=new e.Matrix3,this._widgetOrigin=new e.Cartesian3,this._modelOrigin=new e.Cartesian3,this._rotationAxis=void 0,this._rotationPlane=new e.Plane(e.Cartesian3.UNIT_X,0),this._rotationStartPoint=new e.Cartesian3,this._pixelSize=e.defined(t.pixelSize)?new e.Cartesian2(t.pixelSize,t.pixelSize):new e.Cartesian2(100,100),this._maximumSizeInMeters=e.defined(t.maximumSizeInMeters)?new e.Cartesian2(t.maximumSizeInMeters,t.maximumSizeInMeters):new e.Cartesian2(F,F),this.update()}e.defineProperties(H.prototype,{active:{get:function(){return this._active},set:function(e){this._active=e,e?(this._polylineX.show=!0,this._polylineY.show=!0,this._polylineZ.show=!0):(this._polylineX.show=!1,this._polylineY.show=!1,this._polylineZ.show=!1,this._dragging=!1)}},pixelSize:{get:function(){return this._pixelSize.x}},maximumSizeInMeters:{get:function(){return this._maximumSizeInMeters.x}}}),H.prototype.update=function(){var t=this._transform,i=this._modelMatrix;i=e.Matrix4.setScale(t,S,i);var n=g(t,this.originOffset,M);i=e.Matrix4.setTranslation(i,n,i);var o=this._radius*e.Matrix4.getMaximumScale(this._transform)*1.25;i=e.Matrix4.multiplyByUniformScale(i,o,i),this._pixelSize.x>0&&(i=x(this._pixelSize,this._maximumSizeInMeters,this._scene.frameState,i,i)),this._polylineX.modelMatrix=i,this._polylineY.modelMatrix=i,this._polylineZ.modelMatrix=i},H.prototype.handleLeftDown=function(t){for(var i,n=this._scene,o=n.drillPick(t),s=0;s<o.length;s++){var a=o[s];if(e.defined(a.id)&&e.defined(v[a.id])){i=a.id;break}}if(e.defined(i)){var r=v.getValue(i),l=e.Matrix4.setScale(this._transform,S,this._startTransform);this._startRotation=e.Matrix4.getMatrix3(l,this._startRotation);var c=e.Matrix4.getTranslation(l,this._modelOrigin),h=g(this._transform,this.originOffset,this._widgetOrigin),d=e.Matrix4.multiplyByPoint(l,r,P),u=e.Cartesian3.subtract(d,c,d);u=e.Cartesian3.normalize(u,u);var p=e.Plane.fromPointNormal(h,u,this._rotationPlane),_=e.IntersectionTests.rayPlane(n.camera.getPickRay(t,N),p,this._rotationStartPoint);this._dragging=e.defined(_),this._rotationAxis=r,n.screenSpaceCameraController.enableInputs=!1}},H.prototype.handleMouseMove=function(t){if(this._dragging){var i=this._scene,n=i.camera.getPickRay(t,N),o=e.IntersectionTests.rayPlane(n,this._rotationPlane,U);if(e.defined(o)){var s=this._widgetOrigin,a=this._modelOrigin,r=this._rotationStartPoint,l=this._vectorLine1,c=l.positions,h=this._vectorLine2,d=h.positions,u=e.Cartesian3.subtract(r,s,I),p=e.Cartesian3.subtract(o,s,L);p=e.Cartesian3.normalize(p,p),p=e.Cartesian3.multiplyByScalar(p,e.Cartesian3.magnitude(u),p),o=e.Cartesian3.add(s,p,o),c[0]=s,c[1]=r,d[0]=s,d[1]=o,l.positions=c,h.positions=d,l.show=!0,h.show=!0;var _=e.Cartesian3.multiplyComponents(this.originOffset,e.Matrix4.getScale(this._transform,T),T),m=this._rotationAxis,g=B(this._startTransform,_,m,r,o),f=e.Matrix3.fromQuaternion(e.Quaternion.fromAxisAngle(m,g,V),z);f=e.Matrix3.multiply(this._startRotation,f,f);var C=e.Matrix4.fromRotationTranslation(f,a,k);this._setHPRCallback(e.Transforms.fixedFrameToHeadingPitchRoll(C,i.mapProjection.ellipsoid,void 0,D));var v=e.Cartesian3.negate(_,I);v=e.Matrix3.multiplyByVector(f,v,v),a=e.Cartesian3.add(v,s,a),this._setPositionCallback(a)}}},H.prototype.handleLeftUp=function(){this._dragging=!1,this._vectorLine1.show=!1,this._vectorLine2.show=!1,this._scene.screenSpaceCameraController.enableInputs=!0},H.prototype.isDestroyed=function(){return!1},H.prototype.destroy=function(){this.active=!1;var t=this._scene;t.primitives.remove(this._vectorLine1),t.primitives.remove(this._vectorLine2),t.primitives.remove(this._polylineX),t.primitives.remove(this._polylineY),t.primitives.remove(this._polylineZ),e.destroyObject(this)},H._getRotationAngle=B;var Q=new e.Cartesian3,X=new e.Cartesian3,Y=new e.Cartesian3,q=new e.Cartesian3,Z=new e.Cartesian3,K=new e.Cartesian3,J=new e.Cartesian3,G=new e.Ray,W=new e.Cartesian3(1,1,1),ee=new e.Cartesian3,te=1/0;function ie(e){return{position:v.getValue(e),show:!1,color:v.getColor(e),pixelSize:20,disableDepthTestDistance:Number.POSITIVE_INFINITY,id:e}}function ne(t){return new f({positions:[e.Cartesian3.ZERO,v.getValue(t)],color:v.getColor(t),id:t,show:!1})}function oe(t){var i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).scene,n=t.transform,o=i.primitives.add(new e.PointPrimitiveCollection);this.originOffset=t.originOffset,this._points=o,this._pointX=o.add(ie(v.X)),this._pointY=o.add(ie(v.Y)),this._pointZ=o.add(ie(v.Z)),this._polylineX=i.primitives.add(ne(v.X)),this._polylineY=i.primitives.add(ne(v.Y)),this._polylineZ=i.primitives.add(ne(v.Z)),this._scene=i,this._canvas=i.canvas,this._enableNonUniformScaling=t.enableNonUniformScaling,this._setPositionCallback=t.setPosition,this._setScaleCallback=t.setScale,this._modelMatrix=new e.Matrix4,this._pickedAxis=void 0,this._dragAlongVector=void 0,this._offsetVector=new e.Cartesian3,this._pickingPlane=new e.Plane(e.Cartesian3.UNIT_X,0),this._dragging=!1,this._startPosition=new e.Cartesian3,this._startScale=new e.Cartesian3,this._startOffset=new e.Cartesian3,this._startTransform=new e.Matrix4,this._active=!1,this._transform=n,this._lineLength=1.5*t.radius,this._pixelSize=e.defined(t.pixelSize)?new e.Cartesian2(t.pixelSize,t.pixelSize):new e.Cartesian2(100,100),this._maximumSizeInMeters=e.defined(t.maximumSizeInMeters)?new e.Cartesian2(t.maximumSizeInMeters,t.maximumSizeInMeters):new e.Cartesian2(te,te),this.update()}e.defineProperties(oe.prototype,{active:{get:function(){return this._active},set:function(e){this._active=e,e?(this._pointX.show=!0,this._pointY.show=!0,this._pointZ.show=!0,this._polylineX.show=!0,this._polylineY.show=!0,this._polylineZ.show=!0):(this._pointX.show=!1,this._pointY.show=!1,this._pointZ.show=!1,this._polylineX.show=!1,this._polylineY.show=!1,this._polylineZ.show=!1,this._dragging=!1)}},pixelSize:{get:function(){return this._pixelSize.x}},maximumSizeInMeters:{get:function(){return this._maximumSizeInMeters.x}}}),oe.prototype.handleLeftDown=function(t){for(var i,n=this._scene,o=this._transform,s=n.camera,a=n.drillPick(t),r=e.Matrix4.getTranslation(o,X),l=0;l<a.length;l++){var c=a[l];if(e.defined(c.id)&&e.defined(v[c.id])){i=c.id;break}}if(e.defined(i)){var h=v.getValue(i),d=e.Matrix4.multiplyByPointAsVector(this._modelMatrix,h,Y),u=q;u=Math.abs(e.Cartesian3.dot(s.upWC,d))>.7?e.Cartesian3.cross(s.rightWC,d,u):e.Cartesian3.cross(s.upWC,d,u),e.Cartesian3.normalize(u,u);var p=e.Plane.fromPointNormal(r,u,this._pickingPlane),_=e.IntersectionTests.rayPlane(s.getPickRay(t,G),p,this._startPosition);if(e.defined(_)){this._offsetVector=e.Cartesian3.subtract(_,r,this._offsetVector),this._dragging=!0;var m,g=e.Matrix4.getScale(o,this._startScale);m=i===v.X?g.x:i===v.Y?g.y:g.z,this._startValue=m,this._startOffset=e.Cartesian3.multiplyComponents(this.originOffset,g,this._startOffset),this._dragAlongVector=h,this._pickedAxis=i,this._startTransform=e.Matrix4.setScale(o,W,this._startTransform),n.screenSpaceCameraController.enableInputs=!1}}},oe.prototype.handleMouseMove=function(t){if(this._dragging){var i=this._scene.camera,n=e.IntersectionTests.rayPlane(i.getPickRay(t,G),this._pickingPlane,Z);if(e.defined(n)){var o=this._dragAlongVector,s=e.Matrix4.multiplyByPointAsVector(this._modelMatrix,o,Y),a=e.Cartesian3.subtract(n,this._startPosition,K);a=e.Cartesian3.projectVector(a,s,a);var r=e.Cartesian3.magnitude(a);if(e.Cartesian3.dot(a,this._offsetVector)<0&&(r=-r),r/=this._lineLength,!((r+=this._startValue)<=0)){var l=this._pickedAxis,c=this._startScale;this._enableNonUniformScaling()?l===v.X?c.x=r:l===v.Y?c.y=r:c.z=r:(c.x=r,c.y=r,c.z=r);var h=e.Cartesian3.multiplyComponents(this.originOffset,c,J);h=e.Cartesian3.subtract(this._startOffset,h,h),h=e.Matrix4.multiplyByPoint(this._startTransform,h,h),this._setScaleCallback(c),this._setPositionCallback(h)}}}},oe.prototype.handleLeftUp=function(){this._dragging=!1,this._scene.screenSpaceCameraController.enableInputs=!0},oe.prototype.update=function(){var t=this._modelMatrix,i=this._transform,n=g(i,this.originOffset,Q);t=e.Matrix4.multiplyByUniformScale(i,this._lineLength,t),t=e.Matrix4.setTranslation(this._modelMatrix,n,t);var o=0<this._pixelSize.x;o&&(t=x(this._pixelSize,this._maximumSizeInMeters,this._scene.frameState,t,t)),o&&this._enableNonUniformScaling&&((ee=e.Matrix4.getScale(t,ee)).x>=ee.y?(ee.y=ee.x,ee.z=ee.x):ee.y>=ee.x&&(ee.x=ee.y,ee.z=ee.y),t=e.Matrix4.setScale(t,ee,t)),this._polylineX.modelMatrix=t,this._polylineY.modelMatrix=t,this._polylineZ.modelMatrix=t,this._points.modelMatrix=t},oe.prototype.isDestroyed=function(){return!1},oe.prototype.destroy=function(){this.active=!1;var t=this._scene;this._points.removeAll(),t.primitives.remove(this._polylineX),t.primitives.remove(this._polylineY),t.primitives.remove(this._polylineZ),t.primitives.remove(this._points),e.destroyObject(this)};var se=new e.Cartesian3,ae=new e.Cartesian3,re=new e.Cartesian3,le=new e.Cartesian3,ce=new e.Cartesian3,he=new e.Cartesian3,de=new e.Cartesian3,ue=new e.Ray,pe=1/0;function _e(t){return new f({positions:[e.Cartesian3.ZERO,v.getValue(t)],arrow:!0,color:v.getColor(t),id:t,show:!1})}function me(t){var i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).scene;this.originOffset=t.originOffset,this._polylineX=i.primitives.add(_e(v.X)),this._polylineY=i.primitives.add(_e(v.Y)),this._polylineZ=i.primitives.add(_e(v.Z)),this._scene=i,this._canvas=i.canvas,this._setPositionCallback=t.setPosition,this._modelMatrix=new e.Matrix4,this._fixedFrame=new e.Matrix4,this._hpr=new e.HeadingPitchRoll,this._dragAlongVector=void 0,this._offsetVector=new e.Cartesian3,this._pickingPlane=new e.Plane(e.Cartesian3.UNIT_X,0),this._dragging=!1,this._active=!1,this._transform=t.transform,this._radius=t.radius,this._pixelSize=e.defined(t.pixelSize)?new e.Cartesian2(t.pixelSize,t.pixelSize):new e.Cartesian2(100,100),this._maximumSizeInMeters=e.defined(t.maximumSizeInMeters)?new e.Cartesian2(t.maximumSizeInMeters,t.maximumSizeInMeters):new e.Cartesian2(pe,pe),this.update()}e.defineProperties(me.prototype,{active:{get:function(){return this._active},set:function(e){this._active=e,e?(this._polylineX.show=!0,this._polylineY.show=!0,this._polylineZ.show=!0):(this._polylineX.show=!1,this._polylineY.show=!1,this._polylineZ.show=!1,this._dragging=!1)},pixelSize:{get:function(){return this._pixelSize.x}},maximumSizeInMeters:{get:function(){return this._maximumSizeInMeters.x}}}}),me.prototype.update=function(){var t=this._transform,i=this._scene.mapProjection.ellipsoid,n=e.Matrix4.getTranslation(t,ae),o=g(t,this.originOffset,se),s=this._radius*e.Matrix4.getMaximumScale(this._transform)*1.5,a=e.Transforms.fixedFrameToHeadingPitchRoll(this._transform,i,void 0,this._hpr);a.pitch=0,a.roll=0;var r=e.Transforms.headingPitchRollToFixedFrame(n,a,i,void 0,this._fixedFrame);r=e.Matrix4.setTranslation(r,o,r);var l=e.Matrix4.multiplyByUniformScale(r,s,this._modelMatrix);this._pixelSize.x>0&&(l=x(this._pixelSize,this._maximumSizeInMeters,this._scene.frameState,l,l)),this._polylineX.modelMatrix=l,this._polylineY.modelMatrix=l,this._polylineZ.modelMatrix=l},me.prototype.handleLeftDown=function(t){for(var i,n=this._scene,o=n.camera,s=n.drillPick(t),a=0;a<s.length;a++){var r=s[a];if(e.defined(r.id)&&e.defined(v[r.id])){i=r.id;break}}if(e.defined(i)){var l=e.Matrix4.getTranslation(this._transform,ae),c=v.getValue(i),h=e.Matrix4.multiplyByPointAsVector(this._fixedFrame,c,re),d=le;d=Math.abs(e.Cartesian3.dot(o.upWC,h))>.7?e.Cartesian3.cross(o.rightWC,h,d):e.Cartesian3.cross(o.upWC,h,d),e.Cartesian3.normalize(d,d);var u=e.Plane.fromPointNormal(l,d,this._pickingPlane),p=e.IntersectionTests.rayPlane(o.getPickRay(t,ue),u,this._offsetVector);e.defined(p)&&(e.Cartesian3.subtract(p,l,p),this._dragging=!0,this._dragAlongVector=c,n.screenSpaceCameraController.enableInputs=!1)}},me.prototype.handleMouseMove=function(t){if(this._dragging){var i=this._scene.camera,n=e.IntersectionTests.rayPlane(i.getPickRay(t,ue),this._pickingPlane,ce);if(e.defined(n)){var o=this._dragAlongVector,s=e.Matrix4.getTranslation(this._transform,ae),a=e.Matrix4.multiplyByPointAsVector(this._fixedFrame,o,re),r=e.Cartesian3.subtract(n,s,he);r=e.Cartesian3.projectVector(r,a,r);var l=e.Cartesian3.projectVector(this._offsetVector,a,de);r=e.Cartesian3.subtract(r,l,r),s=e.Cartesian3.add(s,r,s),this._setPositionCallback(s)}}},me.prototype.handleLeftUp=function(){this._dragging=!1,this._scene.screenSpaceCameraController.enableInputs=!0},me.prototype.isDestroyed=function(){return!1},me.prototype.destroy=function(){this.active=!1;var t=this._scene;t.primitives.remove(this._polylineX),t.primitives.remove(this._polylineY),t.primitives.remove(this._polylineZ),e.destroyObject(this)};var ge=new e.Cartesian3,fe=new e.Cartesian2,Ce=new e.Cartesian3(1,1,1),ve=new e.Matrix4,ye=new e.Cartesian3,we=new e.Cartesian3,be={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale"},Ee=new e.Quaternion,xe=new e.Quaternion,Se=new e.Cartesian3,Te=new e.Cartesian3,Me=new e.Cartesian3,Pe=new e.Matrix4,ke=new e.Matrix3;function Oe(t,i){e.Check.defined("transform",t),e.Check.defined("headingPitchRoll",i);var n=e.Quaternion.fromHeadingPitchRoll(i,Ee),o=e.Matrix4.getTranslation(t,Se),s=e.Matrix4.getScale(t,Te),a=e.Matrix4.multiplyByPoint(t,e.Cartesian3.ZERO,Me),r=e.Transforms.eastNorthUpToFixedFrame(a,void 0,Pe),l=e.Matrix4.getMatrix3(r,ke),c=e.Quaternion.fromRotationMatrix(l,xe),h=e.Quaternion.multiply(c,n,l);return e.Matrix4.fromTranslationQuaternionRotationScale(o,h,s,t)}function Re(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),e.Check.defined("options.scene",t.scene),e.Check.defined("options.transform",t.transform),e.Check.defined("options.boundingSphere",t.boundingSphere);var i=t.scene,n=t.transform,o=t.boundingSphere.clone(),s=e.defaultValue(t.originOffset,e.Cartesian3.ZERO),a=e.Matrix4.getTranslation(n,new e.Cartesian3),r=e.Transforms.fixedFrameToHeadingPitchRoll(n,i.mapProjection.ellipsoid,void 0,new e.HeadingPitchRoll),l=e.Matrix4.getScale(n,new e.Cartesian3);e.Cartesian3.equalsEpsilon(a,e.Cartesian3.ZERO,e.Math.EPSILON10)&&(a=e.Cartesian3.fromDegrees(0,0,0,i.mapProjection.ellipsoid,a),Oe(n=e.Matrix4.setTranslation(n,a,n),r));var c=!0;e.Math.equalsEpsilon(l.x,l.y,e.Math.EPSILON10)&&e.Math.equalsEpsilon(l.x,l.z,e.Math.EPSILON10)&&(c=!1,l.y=l.x,l.z=l.x);var h=o.radius/e.Cartesian3.maximumComponent(l);this.editorMode=void 0;var d=e.knockout.observable();e.knockout.defineProperty(this,"editorMode",{get:function(){return d()},set:function(t){var i;d(t),e.defined(this._activeEditor)&&(this._activeEditor.active=!1),t===be.ROTATION?i=this._rotationEditor:t===be.TRANSLATION?i=this._translationEditor:t===be.SCALE&&(i=this._scaleEditor),i.update(),i.active=!0,this._activeEditor=i}}),this.enableNonUniformScaling=c;var u=e.knockout.observable(this.enableNonUniformScaling);e.knockout.defineProperty(this,"enableNonUniformScaling",{get:function(){return u()},set:function(t){t!==u()&&(u(t),t||(this.scale=new e.Cartesian3(l.x,l.x,l.x),i.requestRenderMode&&i.requestRender()))}}),this.position=a;var p=e.knockout.observable(this.position);e.knockout.defineProperty(this,"position",{get:function(){return p()},set:function(t){if(!e.Cartesian3.equals(t,this.position)){var n=e.Cartesian3.clone(t,this.position);p(n);var o=this._transform;Oe(o=e.Matrix4.setTranslation(o,n,o),this.headingPitchRoll),i.requestRenderMode&&i.requestRender();var s=Cesium.Cartographic.fromCartesian(t),a=Cesium.Math.toDegrees(s.longitude),r=Cesium.Math.toDegrees(s.latitude);$("#tileset_longitude").val(a),$("#tileset_latitude").val(r),$("#tileset_altitude").val(s.height)}}}),this.headingPitchRoll=r;var _=e.knockout.observable(this.headingPitchRoll);e.knockout.defineProperty(this,"headingPitchRoll",{get:function(){return _()},set:function(t){if(!e.HeadingPitchRoll.equals(t,this.headingPitchRoll)){var n=e.HeadingPitchRoll.clone(t,this.headingPitchRoll);_(n),Oe(this._transform,n),i.requestRenderMode&&i.requestRender()}}}),this.scale=l;var m=e.knockout.observable(this.scale);e.knockout.defineProperty(this,"scale",{get:function(){return m()},set:function(t){if(!e.Cartesian3.equals(t,this.scale)){var n=e.Cartesian3.clone(t,this.scale);m(n),e.Matrix4.setScale(this._transform,n,this._transform),this._translationEditor.update(),this._rotationEditor.update(),i.requestRenderMode&&i.requestRender()}}}),this.menuExpanded=!1,this.left="0",this.top="0",this.active=!1,e.knockout.track(this,["menuExpanded","left","top","active"]);var g=this;this._rotationEditor=new H({scene:i,transform:n,radius:h,originOffset:s,setPosition:function(e){g.position=e},setHeadingPitchRoll:function(e){g.headingPitchRoll=e}}),this._translationEditor=new me({scene:i,transform:n,radius:h,originOffset:s,setPosition:function(e){g.position=e}}),this._scaleEditor=new oe({scene:i,transform:n,enableNonUniformScaling:u,radius:h,originOffset:s,setScale:function(e){g.scale=e},setPosition:function(e){g.position=e}}),this._sseh=new e.ScreenSpaceEventHandler(i.canvas),this._scene=i,this._transform=n,this._boundingSphere=o,this._active=!1,this._activeEditor=void 0,this._originOffset=s,this.position=a,this.headingPitchRoll=r,this.scale=l,this._removePostUpdateEvent=this._scene.preUpdate.addEventListener(Re.prototype._update,this)}function Ae(t){e.Check.typeOf.string("html",t);var i=document.createElement("div");return i.innerHTML=t,1===i.children.length?i.removeChild(i.firstChild):i}function Ie(t){if("string"==typeof t){var i=document.getElementById(t);if(null===i)throw new e.DeveloperError('Element with id "'+t+'" does not exist in the document.');t=i}return t}e.defineProperties(Re.prototype,{originOffset:{get:function(){return this._originOffset},set:function(t){e.Check.defined("value",t),this._originOffset=t,this._translationEditor.originOffset=t,this._rotationEditor.originOffset=t,this._scaleEditor.originOffset=t}}}),Re.prototype.setOriginPosition=function(t){e.Check.defined("position",t);var i=e.Matrix4.setScale(this._transform,Ce,ve),n=e.Matrix4.inverseTransformation(i,i),o=e.Matrix4.multiplyByPoint(n,t,ye),s=e.Cartesian3.divideComponents(o,e.Matrix4.getScale(this._transform,we),o);this.originOffset=s},Re.prototype.activate=function(){var t=this._sseh,i=this._scene;t.setInputAction(this._leftDown.bind(this),e.ScreenSpaceEventType.LEFT_DOWN),t.setInputAction(this._leftUp.bind(this),e.ScreenSpaceEventType.LEFT_UP),t.setInputAction(this._mouseMove.bind(this),e.ScreenSpaceEventType.MOUSE_MOVE),this.active=!0,e.defined(this._activeEditor)?this._activeEditor.active=!0:this.setModeTranslation(),i.requestRenderMode&&i.requestRender()},Re.prototype.deactivate=function(){var t=this._sseh,i=this._scene;t.removeInputAction(this._leftDown.bind(this),e.ScreenSpaceEventType.LEFT_DOWN),t.removeInputAction(this._leftUp.bind(this),e.ScreenSpaceEventType.LEFT_UP),t.removeInputAction(this._mouseMove.bind(this),e.ScreenSpaceEventType.MOUSE_MOVE),this.active=!1,e.defined(this._activeEditor)&&(this._activeEditor.active=!1),i.requestRenderMode&&i.requestRender()},Re.prototype.expandMenu=function(){this.menuExpanded=!0},Re.prototype.setModeTranslation=function(){this.editorMode=be.TRANSLATION,this.menuExpanded=!1},Re.prototype.setModeRotation=function(){this.editorMode=be.ROTATION,this.menuExpanded=!1},Re.prototype.setModeScale=function(){this.editorMode=be.SCALE,this.menuExpanded=!1},Re.prototype.toggleNonUniformScaling=function(){this.enableNonUniformScaling=!this.enableNonUniformScaling},Re.prototype._leftDown=function(e){this._activeEditor.handleLeftDown(e.position);var t=this._scene;t.requestRenderMode&&t.requestRender()},Re.prototype._mouseMove=function(e){this._activeEditor.handleMouseMove(e.endPosition);var t=this._scene;t.requestRenderMode&&t.requestRender()},Re.prototype._leftUp=function(e){this.menuExpanded=!1,this._activeEditor.handleLeftUp(e.position);var t=this._scene;t.requestRenderMode&&t.requestRender()},Re.prototype._update=function(){if(this.active){this._activeEditor.update();var t=this._scene,i=g(this._transform,this._originOffset,ge),n=e.SceneTransforms.wgs84ToWindowCoordinates(t,i,fe);e.defined(n)&&(this.left=Math.floor(n.x-13)+"px",this.top=Math.floor(n.y)+"px")}},Re.prototype.isDestroyed=function(){return!1},Re.prototype.destroy=function(){this.deactivate(),this._sseh.destroy(),this._rotationEditor.destroy(),this._translationEditor.destroy(),this._scaleEditor.destroy(),this._removePostUpdateEvent(),e.destroyObject(this)},Re.EditorMode=be;function Le(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),e.Check.defined("options.container",t.container),e.Check.defined("options.scene",t.scene),e.Check.defined("options.transform",t.transform),e.Check.defined("options.boundingSphere",t.boundingSphere);var i=Ie(t.container),n=Ae('<div class="transform-editor-menu" data-bind="style: {left: left, top: top}, visible: active">        <div class="cesium-button transform-editor-button" data-bind="click: expandMenu, visible: !menuExpanded">            <svg width="20" height="20" viewBox="0 0 20 20">                <g>                    <circle cx="2" cy="10" r="2" />                    <circle cx="10" cy="10" r="2" />                    <circle cx="18" cy="10" r="2" />                </g>            </svg>        </div>        <div class="transform-editor-options" data-bind="visible: menuExpanded">            <div class="transform-editor-button-row">                <div title="Translation" data-bind="click: setModeTranslation, css: {selected: editorMode === \'translation\'}">                    <svg viewBox="0 0 25 25" height="25" width="25">                        <g>                            <circle r="3" cy="22" cx="3" />                            <path d="M 19.543379,4.59439 3.9750205,19.96158 5.3793174,21.3854 20.947676,6.01822 Z"/>                            <path d="m 14.699824,3.80366 10.231411,-3.34922 -3.215586,10.03096 z"/>                        </g>                    </svg>                </div                ><div title="Rotation" data-bind="click: setModeRotation, css: {selected: editorMode === \'rotation\'}">                    <svg viewBox="0 0 25 25" height="25" width="25">                        <g>                            <path d="M 13.033371,10.08295 2.6713568,7.16272 10.931013,0.62527 Z"/>                            <path d="m 13.741358,3.87055 c -0.747592,-0.006 -1.506137,0.0593 -2.263621,0.20287 l 0.484334,2.29127 c 4.712769,-0.89305 9.471467,2.11386 10.414021,6.57912 0.942553,4.46525 -2.229345,8.97402 -6.942115,9.86707 -4.71277,0.89305 -9.4731664,-2.11226 -10.4157205,-6.57752 l -2.4165696,0.45729 c 1.2119755,5.74161 7.2550484,9.55981 13.3149241,8.41149 6.059877,-1.14833 10.089725,-6.87562 8.87775,-12.61723 -1.060479,-5.02391 -5.819851,-8.57436 -11.053003,-8.61436 z"/>                        </g>                    </svg>               </div>            </div>            <div class="transform-editor-button-row">                <div title="Scale" data-bind="click: setModeScale, css: {selected: editorMode === \'scale\'}">                    <svg width="25" height="25" viewBox="0 0 25 25">                        <g>                            <path d="M 19.543379,4.59439 3.9750205,19.96158 5.3793174,21.3854 20.947676,6.01822 Z"/>                            <path d="m 14.699824,3.80366 10.231411,-3.34922 -3.215586,10.03096 z" />                            <path d="M 10.333866,21.9809 0.10245523,25.33012 3.3180412,15.29916 Z" />                        </g>                    </svg>                </div                ><div data-bind="click: toggleNonUniformScaling">                    <div title="Switch to non-uniform scaling" data-bind="visible: !enableNonUniformScaling">                        <svg width="25" height="25" viewBox="0 0 25 25">                            <g>                                <path d="m 0.5,1.38477 h 1.9960938 v -1 H 0.5 c 0,0.33333 0,0.66667 0,1 z m 2.9941406,0 h 1.9980469 v -1 H 3.4941406 Z m 2.9960938,0 h 1.9960937 v -1 H 6.4902344 Z m 2.9960937,0 h 1.9960939 v -1 H 9.4863281 Z m 2.9941409,0 h 1.998047 v -1 h -1.998047 z m 2.996093,0 h 1.996094 v -1 h -1.996094 z m 2.994141,0 h 1.998047 v -1 h -1.998047 z m 2.996094,0 h 1.998047 v -1 h -1.998047 z m 2.535156,-0.5 v 1.95898 H 25 v -1.95898 z M 0,4.0332 h 0.99804688 v -1.99609 H 0 Z m 24.001953,1.80469 H 25 V 3.8418 H 24.001953 Z M 0,7.0293 h 0.99804688 v -1.99805 H 0 Z m 24.001953,1.80468 H 25 v -1.99609 H 24.001953 Z M 0,10.02344 h 0.99804688 v -1.9961 H 0 Z m 24.001953,1.80664 H 25 v -1.99805 H 24.001953 Z M 0,13.01953 h 0.99804688 v -1.99609 H 0 Z m 24.001953,1.80469 H 25 v -1.9961 H 24.001953 Z M 0,16.01562 h 0.99804688 v -1.99804 H 0 Z m 24.001953,1.80469 H 25 v -1.99804 H 24.001953 Z M 0,19.00977 h 0.99804688 v -1.9961 H 0 Z m 24.001953,1.80664 H 25 v -1.99805 H 24.001953 Z M 0,22.00586 h 0.99804688 v -1.99609 H 0 Z m 24.001953,1.80469 H 25 v -1.9961 H 24.001953 Z M 0,24.88672 v 0.49805 h 0.5 0.11523438 v -0.49805 h 0.3828125 v -1.88281 H 0 Z m 1.6132812,0.49805 H 3.609375 v -0.99805 H 1.6132812 Z m 2.9941407,0 h 1.9980469 v -0.99805 H 4.6074219 Z m 2.9960937,0 h 1.9980469 v -0.99805 H 7.6035156 Z m 2.9960934,0 h 1.996094 v -0.99805 h -1.996094 z m 2.994141,0 h 1.998047 v -0.99805 H 13.59375 Z m 2.996094,0 h 1.996094 v -0.99805 h -1.996094 z m 2.996094,0 h 1.996093 v -0.99805 h -1.996093 z m 2.99414,0 H 24.5 25 v -0.49805 -0.0781 h -0.5 v -0.42187 h -1.919922 z" />                                <path d="m 0,10.38477 v 1.02343 13.97657 h 15 v -15 z m 2.0449219,2.04492 H 12.955078 V 23.3418 H 2.0449219 Z"/>                                <g>                                    <path d="m 21.158203,3.81836 0.355469,0.35156 0.351562,-0.35547 -0.353515,-0.35156 z m -0.703125,0.70898 0.355469,0.35157 0.351562,-0.35352 -0.355468,-0.35351 z m -0.705078,0.71094 0.355469,0.35156 0.351562,-0.35546 -0.353515,-0.35157 z m -0.703125,0.70899 0.355469,0.35351 0.351562,-0.35547 -0.355468,-0.35156 z m -0.705078,0.71093 0.355469,0.35157 0.353515,-0.35547 -0.355469,-0.35157 z m -0.703125,0.71094 0.355469,0.35156 0.351562,-0.35547 -0.355469,-0.35156 z m -0.703125,0.70898 0.353515,0.35157 0.353516,-0.35352 -0.355469,-0.35351 z m -0.705078,0.71094 0.355469,0.35156 0.351562,-0.35546 -0.355469,-0.35157 z m -0.703125,0.70899 0.353515,0.35351 0.353516,-0.35547 -0.355469,-0.35351 z m -0.705078,0.71093 0.355468,0.35157 0.351563,-0.35547 -0.355469,-0.35156 z"/>                                    <path d="m 23.382049,1.93037 -1.015775,3.8652 -2.840556,-2.81624 z"/>                                </g>                            </g>                        </svg>                    </div>                    <div title="Switch to uniform scaling" data-bind="visible: enableNonUniformScaling">                        <svg width="25" height="25" viewBox="0 0 25 25">                            <g>                                <path d="M 0.49414062,10.87891 H 0 v 1.95117 h 0.98828125 v -1.45703 H 2.4707031 v -0.98828 H 0.49414062 Z m 2.96289058,0.49414 h 1.9765626 v -0.98828 H 3.4570312 Z m 2.9648438,0 h 1.9765625 v -0.98828 H 6.421875 Z m 2.9628906,0 h 1.9765624 v -0.98828 H 9.3847656 Z m 2.9648434,0 h 1.976563 v -0.98828 h -1.976563 z m 2.964844,0 h 1.974609 v -0.98828 h -1.974609 z m 2.962891,0 h 1.976562 v -0.98828 h -1.976562 z m 2.964844,0 h 1.974609 v -0.98828 h -1.974609 z m 2.96289,-0.49414 h -0.193359 v 1.67578 H 25 v -1.67578 -0.49414 h -0.494141 -0.300781 z m -0.193359,4.63867 H 25 v -1.97461 H 24.011719 Z M 0,15.79297 h 0.98828125 v -1.97461 H 0 Z m 24.011719,2.68945 H 25 v -1.97656 H 24.011719 Z M 0,18.75781 h 0.98828125 v -1.97656 H 0 Z m 24.011719,2.6875 H 25 V 19.4707 H 24.011719 Z M 0,21.7207 h 0.98828125 v -1.97461 H 0 Z m 24.011719,2.68946 H 25 v -1.97657 H 24.011719 Z M 0,24.68555 h 0.98828125 v -1.97657 H 0 Z m 1.2753906,0.69922 h 1.9765625 v -0.98829 H 1.2753906 Z m 2.9648438,0 h 1.9765625 v -0.98829 H 4.2402344 Z m 2.9628906,0 h 1.9765625 v -0.98829 H 7.203125 Z m 2.964844,0 h 1.976562 v -0.98829 h -1.976562 z m 2.96289,0 h 1.976563 v -0.98829 h -1.976563 z m 2.964844,0 h 1.976563 v -0.98829 h -1.976563 z m 2.962891,0 h 1.976562 v -0.98829 h -1.976562 z m 2.964844,0 H 24 v -0.98829 h -1.976562 z"/>                                <path d="m 0,10.38477 v 1.02343 13.97657 h 15 v -15 z m 2.0449219,2.04492 H 12.955078 V 23.3418 H 2.0449219 Z"/>                                <g>                                    <path d="m 22.251953,18.26172 h 0.179688 l -0.0039,-0.5 h -0.179687 z m -1.003906,-0.49024 0.0039,0.5 0.5,-0.004 -0.0039,-0.5 z m -1,0.008 0.0039,0.5 0.5,-0.004 -0.0039,-0.5 z m -1,0.01 0.0039,0.5 0.5,-0.006 -0.0039,-0.5 z m -1,0.008 0.0039,0.5 0.5,-0.004 -0.0039,-0.5 z m -1,0.008 0.0039,0.5 0.5,-0.004 -0.0039,-0.5 z m -1,0.01 0.0039,0.5 0.5,-0.004 -0.0039,-0.5 z m -1,0.008 0.0039,0.5 0.5,-0.004 -0.0039,-0.5 z"/>                                    <path d="m 23.885095,18.00809 -2.030696,1.17348 -0.02037,-2.31243 z"/>                                </g>                            </g>                        </svg>                    </div>                </div>            </div>        </div>    </div>');i.appendChild(n);var o=new Re(t);e.knockout.applyBindings(o,n),this._viewModel=o,this._element=n,this._container=i}function De(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),e.Check.defined("options.scene",t.scene),e.Check.defined("options.units",t.units),e.Check.defined("options.points",t.points),e.Check.defined("options.labels",t.labels),e.Check.defined("options.primitives",t.primitives),this._labelCollection=t.labels,this._pointCollection=t.points,this._primitives=t.primitives,this._selectedUnits=t.units,this._selectedLocale=t.locale,this._scene=t.scene}e.defineProperties(Le.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),Le.prototype.isDestroyed=function(){return!1},Le.prototype.destroy=function(){return e.knockout.cleanNode(this._element),this._container.removeChild(this._element),this._viewModel.destroy(),e.destroyObject(this)},e.defineProperties(De.prototype,{icon:{value:""},thumbnail:{value:""},type:{value:""},instructions:{value:[]},id:{value:""}}),De.prototype.handleDoubleClick=function(){},De.prototype.handleClick=function(e){},De.prototype.handleMouseMove=function(e){},De.prototype.handleLeftDown=function(e){},De.prototype.handleLeftUp=function(e){},De.prototype.reset=e.DeveloperError.throwInstantiationError,De.prototype.isDestroyed=function(){return!1},De.prototype.destroy=e.DeveloperError.throwInstantiationError;var Ne=e.freezeObject({BeforeDraw:0,Drawing:1,AfterDraw:2});function Ue(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.show=e.defaultValue(t.show,!0);var i=e.Color.clone(e.defaultValue(t.color,e.Color.WHITE));this._id=e.createGuid(),this._color=i,this._depthFailColor=i,this._positions=[],this._boundingSphere=new e.BoundingSphere,this._primitive=void 0,this._update=!0}function Ve(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.show=e.defaultValue(t.show,!0),this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this._width=e.defaultValue(t.width,3),this._color=e.Color.clone(e.defaultValue(t.color,e.Color.WHITE)),this._id=e.createGuid(),this._positions=e.defaultValue(t.positions,[]),this._primitive=void 0,this._boundingSphere=new e.BoundingSphere,this._dashed=e.defaultValue(t.dashed,!1),this._loop=e.defaultValue(t.loop,!1),this._update=!0}function ze(){this.states=new e.ManagedArray,this.count=0}e.defineProperties(Ue.prototype,{positions:{get:function(){return this._positions},set:function(e){this._positions=e,this._update=!0}},color:{get:function(){return this._color}},boundingVolume:{get:function(){return this._boundingSphere}}}),Ue.prototype.update=function(t){if(this.show){var i=this._positions;if(i.length<3)this._primitive=this._primitive&&this._primitive.destroy();else{if(this._update){this._update=!1,this._primitive=this._primitive&&this._primitive.destroy();var n=e.CoplanarPolygonGeometry.fromPositions({positions:i,vertexFormat:e.PerInstanceColorAppearance.FLAT_VERTEX_FORMAT});this._primitive=new e.Primitive({geometryInstances:new e.GeometryInstance({geometry:n,attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(this._color),depthFailColor:e.ColorGeometryInstanceAttribute.fromColor(this._depthFailColor)},id:this._id}),appearance:new e.PerInstanceColorAppearance({flat:!0,closed:!1,translucent:this._color.alpha<1}),depthFailAppearance:new e.PerInstanceColorAppearance({flat:!0,closed:!1,translucent:this._depthFailColor.alpha<1}),allowPicking:!1,asynchronous:!1}),this._boundingSphere=e.BoundingSphere.fromPoints(i,this._boundingSphere)}this._primitive.update(t)}}},Ue.prototype.isDestroyed=function(){return!1},Ue.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),e.destroyObject(this)},e.defineProperties(Ve.prototype,{positions:{get:function(){return this._positions},set:function(e){this._positions=e,this._update=!0}},color:{get:function(){return this._color}},boundingVolume:{get:function(){return this._boundingSphere}},width:{get:function(){return this._width}},ellipsoid:{get:function(){return this._ellipsoid}},dashed:{get:function(){return this._dashed}},loop:{get:function(){return this._loop}}}),Ve.prototype.update=function(t){if(this.show){var i=this._positions;if(!e.defined(i)||i.length<2)this._primitive=this._primitive&&this._primitive.destroy();else{if(this._update){this._update=!1,this._id=this.id,this._primitive=this._primitive&&this._primitive.destroy(),this._loop&&(i=i.slice()).push(i[0]);var n,o=new e.PolylineGeometry({positions:i,width:this.width,vertexFormat:e.PolylineMaterialAppearance.VERTEX_FORMAT,ellipsoid:this._ellipsoid,arcType:e.ArcType.NONE});n=this._dashed?new e.PolylineMaterialAppearance({material:e.Material.fromType(e.Material.PolylineDashType,{color:this._color})}):new e.PolylineColorAppearance,this._primitive=new e.Primitive({geometryInstances:new e.GeometryInstance({geometry:o,attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(this._color),depthFailColor:e.ColorGeometryInstanceAttribute.fromColor(this._color)},id:this.id}),appearance:n,depthFailAppearance:n,asynchronous:!1,allowPicking:!1}),this._boundingSphere=e.BoundingSphere.fromPoints(i,this._boundingSphere)}this._primitive.update(t)}}},Ve.prototype.isDestroyed=function(){return!1},Ve.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),e.destroyObject(this)},ze.prototype.hidePrimitiveCollection=function(t){for(var i=t.length,n=0;n<i;++n){var o=t.get(n);o instanceof e.PrimitiveCollection?this.hidePrimitiveCollection(o):(this.states.push(o.show),o instanceof e.Cesium3DTileset||o instanceof e.Model||(o.show=!1))}},ze.prototype.restorePrimitiveCollection=function(t){for(var i=t.length,n=0;n<i;++n){var o=t.get(n);o instanceof e.PrimitiveCollection?this.restorePrimitiveCollection(o):o.show=this.states.get(this.count++)}},ze.prototype.hide=function(e){this.states.length=0,this.hidePrimitiveCollection(e.primitives),this.hidePrimitiveCollection(e.groundPrimitives)},ze.prototype.restore=function(e){this.count=0,this.restorePrimitiveCollection(e.primitives),this.restorePrimitiveCollection(e.groundPrimitives)};var Fe=new e.Cartesian3,Be=new e.Ray,je=new ze;function He(t,i,n){var o;if(e.Check.defined("scene",t),e.Check.defined("mousePosition",i),e.Check.defined("result",n),t.pickPositionSupported){je.hide(t);var s=t.pick(i,1,1);if(je.restore(t),e.defined(s)&&(s instanceof e.Cesium3DTileFeature||s.primitive instanceof e.Cesium3DTileset||s.primitive instanceof e.Model)&&(o=t.pickPosition(i,Fe),e.defined(o)))return e.Cartesian3.clone(o,n)}if(e.defined(t.globe)){var a=t.camera.getPickRay(i,Be);return o=t.globe.pick(a,t,Fe),e.defined(o)?e.Cartesian3.clone(o,n):void 0}}var Qe=new e.Cartesian2,Xe=new e.Cartesian3;function Ye(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),e.Check.defined("options.scene",t.scene);var i=t.scene,n=e.defaultValue(t.primitives,i.primitives),o=!1,s=t.points;e.defined(s)||(s=n.add(new e.PointPrimitiveCollection),o=!0),this._polygon=n.add(new Ue(t.polygonOptions)),this._polyline=n.add(new Ve(e.combine({loop:!0},t.polylineOptions))),this._pointOptions=t.pointOptions,this._pointCollection=s,this._removePoints=o,this._scene=i,this._primitives=n,this._positions=[],this._points=[],this._tempNextPos=new e.Cartesian3,this._mode=Ne.BeforeDraw,this._lastClickPosition=new e.Cartesian2(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this._polygonOptions=t.polygonOptions,this._polylineOptions=t.polylineOptions}Ye.prototype.addPoint=function(e){var t=this._positions;t.push(e),this._polyline.positions=t,this._polygon.positions=t;var i=this._pointCollection.add(this._pointOptions);i.position=e,i.show=!0,this._points.push(i)},Ye.prototype.handleDoubleClick=function(){this._mode=Ne.AfterDraw;var e=this._positions;this._polyline.positions=e,this._polygon.positions=e},Ye.prototype.handleClick=function(t){if(e.Check.defined("clickPosition",t),this._mode!==Ne.AfterDraw){var i=this._lastClickPosition;if(!(e.Cartesian2.magnitude(e.Cartesian2.subtract(i,t,Qe))<10)){var n=Ye._getWorldPosition(this._scene,t,Xe);if(e.defined(n))return this.addPoint(e.Cartesian3.clone(n,new e.Cartesian3)),this._mode=Ne.Drawing,e.Cartesian2.clone(t,i),n}}},Ye.prototype.handleMouseMove=function(t){if(e.Check.defined("mousePosition",t),this._mode===Ne.Drawing){var i=this._scene,n=Ye._getWorldPosition(i,t,Xe);if(e.defined(n)){var o=this._positions.slice();return o.push(e.Cartesian3.clone(n,this._tempNextPos)),this._polyline.positions=o,this._polygon.positions=o,n}}},Ye.prototype.isDestroyed=function(){return!1},Ye.prototype.destroy=function(){var t=this._primitives;if(this._removePoints)t.remove(this._points);else for(var i=this._points,n=this._pointCollection,o=0;o<i.length;o++)n.remove(i[o]);return t.remove(this._polygon),t.remove(this._polyline),e.destroyObject(this)},Ye.prototype.newPolygon=function(){return this._primitives.add(new Ue(this._polygonOptions))},Ye.prototype.newPolyline=function(){return this._primitives.add(new Ve(e.combine({loop:!0},this._polylineOptions)))},Ye._getWorldPosition=He;var qe=new e.Cartesian2(0,-9),Ze={};Ze.color=e.Color.YELLOW,Ze.labelFont="16px Lucida Console",Ze.textColor=e.Color.WHITE,Ze.backgroundColor=new e.Color(.165,.165,.165,.8),Ze.backgroundPadding=new e.Cartesian2(7,5),Ze.getPolylineOptions=function(t){return{show:(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).show,ellipsoid:t.ellipsoid,width:e.defaultValue(t.width,3),color:e.defaultValue(t.color,Ze.color),depthFailColor:e.defaultValue(e.defaultValue(t.depthFailColor,t.color),Ze.color),id:t.id,positions:t.positions,materialType:t.materialType,depthFailMaterialType:t.depthFailMaterialType,loop:t.loop,clampToGround:t.clampToGround,classificationType:t.classificationType,allowPicking:e.defaultValue(t.allowPicking,!1)}},Ze.getPolygonOptions=function(t){return{show:(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).show,ellipsoid:t.ellipsoid,color:e.defaultValue(t.color,Ze.color),depthFailColor:e.defaultValue(e.defaultValue(t.depthFailColor,t.color),Ze.color),id:t.id,positions:t.positions,clampToGround:t.clampToGround,classificationType:t.classificationType,allowPicking:e.defaultValue(t.allowPicking,!1)}},Ze.getPointOptions=function(){return{pixelSize:10,color:Ze.color,position:new e.Cartesian3,disableDepthTestDistance:Number.POSITIVE_INFINITY,show:!1}},Ze.getLabelOptions=function(t){return t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),{show:!1,font:Ze.labelFont,scale:e.defaultValue(t.scale,1),fillColor:e.defaultValue(t.fillColor,Ze.textColor),showBackground:!0,backgroundColor:e.defaultValue(t.backgroundColor,Ze.backgroundColor),backgroundPadding:e.defaultValue(t.backgroundPadding,Ze.backgroundPadding),horizontalOrigin:e.defaultValue(t.horizontalOrigin,e.HorizontalOrigin.CENTER),verticalOrigin:e.defaultValue(t.verticalOrigin,e.VerticalOrigin.BOTTOM),pixelOffset:e.defined(t.pixelOffset)?t.pixelOffset:e.Cartesian2.clone(qe),disableDepthTestDistance:Number.POSITIVE_INFINITY,position:new e.Cartesian3}};var Ke=new e.Cartesian2,Je=new e.Cartesian2,Ge=new e.Cartesian3,We=new e.Cartesian3,$e=new e.Cartesian3,et=new e.Cartesian3,tt=new e.Cartesian3;function it(t,i,n){var o=e.Cartesian3.subtract(t,i,et),s=e.Cartesian3.subtract(n,i,tt),a=e.Cartesian3.cross(o,s,o);return.5*e.Cartesian3.magnitude(a)}function nt(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),e.Check.defined("options.scene",t.scene),e.Check.defined("options.primitives",t.primitives),e.Check.defined("options.units",t.units),e.Check.defined("options.points",t.points),e.Check.defined("options.labels",t.labels),t.polylineOptions=Ze.getPolylineOptions({ellipsoid:t.ellipsoid}),t.pointOptions=Ze.getPointOptions(),t.polygonOptions={color:Ze.color.withAlpha(.8)},Ye.call(this,t);var i=t.labels;this._labelCollection=i,this._label=i.add(Ze.getLabelOptions()),this._selectedUnits=t.units,this._selectedLocale=t.locale,this._area=0;var n=this;this._removeEvent=this._scene.preRender.addEventListener((function(){n.updateLabel()})),this._measurementResult=[]}function ot(e){return'<svg viewBox="0 0 30 30" height="'+e+'px" width="'+e+'px">\n                 <g transform="translate(0,-267)">\n                   <circle r="2.0788691" cy="293.99896" cx="3.8532958"/>\n                   <circle r="2.0788691" cy="282.76791" cx="26.927404"/>\n                   <circle r="2.0788691" cy="270.20621" cx="4.0090437"/>\n                   <path d="m 26.326048,283.77014 -9.394396,5.02295 -9.3943948,5.02295 0.3471933,-10.64726 0.3471933,-10.64726 9.0472022,5.62431 z" transform="matrix(1.1625734,0,0,0.99297729,-4.6787891,1.2180486)"/>\n                 </g>\n               </svg>'}function st(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),De.call(this,t),this._drawing=new nt(t),this._newMeasurement=new e.Event}nt.prototype=Object.create(Ye.prototype),nt.prototype.constructor=nt,e.defineProperties(nt.prototype,{area:{get:function(){return this._area}}}),nt.prototype.updateArea=function(t){var i=e.CoplanarPolygonGeometry.createGeometry(e.CoplanarPolygonGeometry.fromPositions({positions:t,vertexFormat:e.VertexFormat.POSITION_ONLY}));if(e.defined(i)){for(var n=i.attributes.position.values,o=i.indices,s=0,r=0;r<o.length;r+=3){var l=o[r],c=o[r+1],h=o[r+2];s+=it(e.Cartesian3.unpack(n,3*l,Ge),e.Cartesian3.unpack(n,3*c,We),e.Cartesian3.unpack(n,3*h,$e))}this._area=s,this._label.text=a.areaToString(s,this._selectedUnits.areaUnits,this._selectedLocale)}else this._label.text=""},nt.prototype.updateLabel=function(){var t=this._positions;if(!(t.length<2)){for(var i=this._scene,n=t[0],o=e.SceneTransforms.wgs84ToWindowCoordinates(i,n,Ke),s=e.defined(o)?o.y:Number.POSITIVE_INFINITY,a=1;a<t.length;a++){var r=e.SceneTransforms.wgs84ToWindowCoordinates(i,t[a],Je);e.defined(r)&&(r.y<s&&(s=r.y,n=t[a]))}this._label.position=n}},nt.prototype.addPoint=function(e){Ye.prototype.addPoint.call(this,e),this.updateArea(this._positions)},nt.prototype.handleClick=function(t){e.Check.defined("clickPosition",t),this._mode===Ne.AfterDraw&&this.reset();var i=Ye.prototype.handleClick.call(this,t);e.defined(i)&&(this._label.show=!0,this._polygon.show=!0,this._polyline.show=!0)},nt.prototype.handleMouseMove=function(t){e.Check.defined("mousePosition",t);var i=Ye.prototype.handleMouseMove.call(this,t);if(e.defined(i)){var n=this._positions.slice();n.push(i),this.updateArea(n)}},nt.prototype.reset=function(){this._label.show=!1,this._label.text="",this._positions=[],this._polyline.positions=[],this._polygon.positions=[],this._polyline.show=!1,this._polygon.show=!1,this._area=0;for(var e=this._points,t=this._pointCollection,i=0;i<e.length;i++)t.remove(e[i]);e.length=0,this._mode=Ne.BeforeDraw,this._lastClickPosition.x=Number.POSITIVE_INFINITY,this._lastClickPosition.y=Number.POSITIVE_INFINITY},nt.prototype.destroy=function(){this._removeEvent(),this._labelCollection.remove(this._label);for(var e=0;e<this._measurementResult.length;e++)this._labelCollection.remove(this._measurementResult[e].label),this._primitives.remove(this._measurementResult[e].polygon),this._primitives.remove(this._measurementResult[e].polyline);Ye.prototype.destroy.call(this)},nt.prototype._saveCurrentMeasurementAndPrepareNew=function(){this._measurementResult.push({label:this._label,polygon:this._polygon,polyline:this._polyline,points:this._points}),this._label=this._labelCollection.add(Ze.getLabelOptions()),this._polygon=Ye.prototype.newPolygon.call(this),this._polyline=Ye.prototype.newPolyline.call(this),this._points=[]},nt.prototype.handleDoubleClick=function(){Ye.prototype.handleDoubleClick.call(this),this._saveCurrentMeasurementAndPrepareNew()},st.prototype=Object.create(De.prototype),st.prototype.constructor=st,e.defineProperties(st.prototype,{area:{get:function(){return this._drawing.area}},icon:{value:ot(15)},thumbnail:{value:ot(25)},type:{value:"Area"},instructions:{value:["Click to start drawing a polygon","Keep clicking to add more points","Double click to finish drawing"]},id:{value:"areaMeasurement"},measurementResult:{get:function(){return this._drawing._measurementResult}},newMeasurement:{get:function(){return this._newMeasurement}}}),st.prototype.handleDoubleClick=function(){this._drawing.handleDoubleClick(),this._newMeasurement.raiseEvent(this._drawing._measurementResult.length-1)},st.prototype.handleClick=function(e){this._drawing.handleClick(e)},st.prototype.handleMouseMove=function(e){this._drawing.handleMouseMove(e)},st.prototype.reset=function(){this._drawing.reset()},st.prototype.isDestroyed=function(){return!1},st.prototype.destroy=function(){return this._drawing.destroy(),e.destroyObject(this)};var at=0,rt=1,lt=2,ct=new e.Cartesian2,ht=new e.Cartesian2,dt=new e.Cartographic,ut=new e.Cartesian3,pt=new e.Cartesian3,_t=new e.Cartesian3;function mt(e){return'<svg viewBox="0 0 30 30" height="'+e+'px" width="'+e+'px">\n                 <g transform="translate(0,-267)">\n                  <path d="m 4.934989,292.6549 20.67981,-20.80395"/>\n                   <circle r="2.0788691" cy="270.1637" cx="27.025297"/>\n                   <circle r="2.0788691" cy="294.07068" cx="3.1183045"/>\n                 </g>\n               </svg>\n'}function gt(e){return'<svg viewBox="0 0 30 30" height="'+e+'px" width="'+e+'px">\n                 <g transform="translate(0,-267)">\n                   <path d="m 4.934989,292.6549 20.67981,-20.80395" />\n                   <circle r="2.0788691" cy="270.1637" cx="27.025297" />\n                   <circle r="2.0788691" cy="294.07068" cx="3.1183045" />\n                   <path style="stroke-dasharray:2.00314951, 1.00157475;stroke-dashoffset:0;" d="m 3.3194019,292.73274 -0.046996,-22.53109 21.6420984,-0.0266" />\n                 </g>\n               </svg>\n'}function ft(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),De.call(this,t);var i=this,n=this._pointCollection,o=this._labelCollection,s=this._primitives,a=this._scene,r=[new e.Cartesian3,new e.Cartesian3],l=[new e.Cartesian3,new e.Cartesian3,new e.Cartesian3],c=[new e.Cartesian3,new e.Cartesian3,new e.Cartesian3],h=new e.Cartesian2(-9,0),d=new e.Cartesian2(9,0),u=a.frameState.mapProjection.ellipsoid;this._startPoint=n.add(Ze.getPointOptions()),this._endPoint=n.add(Ze.getPointOptions()),this._positions=r,this._polyline=s.add(new Ve(Ze.getPolylineOptions({ellipsoid:u,width:3,show:!1,positions:r}))),this._xyPolylinePositions=l,this._xyPolyline=s.add(new Ve(Ze.getPolylineOptions({ellipsoid:u,width:2,positions:l,materialType:e.Material.PolylineDashType}))),this._xyBoxPositions=c,this._xyBox=s.add(new Ve(Ze.getPolylineOptions({ellipsoid:u,width:1,positions:c}))),this._label=o.add(Ze.getLabelOptions({horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.TOP,pixelOffset:new e.Cartesian2(10,10)})),this._xPixelOffset=d,this._xLabel=o.add(Ze.getLabelOptions({scale:.6})),this._xAngleLabel=o.add(Ze.getLabelOptions({scale:.6,horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.MIDDLE,pixelOffset:d})),this._yPixelOffset=h,this._yLabel=o.add(Ze.getLabelOptions({scale:.6,horizontalOrigin:e.HorizontalOrigin.RIGHT,pixelOffset:h})),this._yAngleLabel=o.add(Ze.getLabelOptions({scale:.6,verticalOrigin:e.VerticalOrigin.TOP,pixelOffset:new e.Cartesian2(0,9)})),this._distance=0,this._xDistance=0,this._yDistance=0,this._xAngle=0,this._yAngle=0,this._mode=at,this._showComponentLines=e.defaultValue(t.showComponentLines,!1),this._removeEvent=a.preRender.addEventListener((function(){i._updateLabelPosition()})),this._measurementResult=[],this._newMeasurement=new e.Event}ft.prototype=Object.create(De.prototype),ft.prototype.constructor=ft,e.defineProperties(ft.prototype,{distance:{get:function(){return this._distance}},horizontalDistance:{get:function(){return this._xDistance}},verticalDistance:{get:function(){return this._yDistance}},angleFromHorizontal:{get:function(){return this._xAngle}},angleFromVertical:{get:function(){return this._yAngle}},icon:{get:function(){return this._showComponentLines?gt(15):mt(15)}},thumbnail:{get:function(){return this._showComponentLines?gt(25):mt(25)}},type:{get:function(){return this._showComponentLines?"Component Distance":"Distance"}},instructions:{value:["Click on the point cloud or the globe to set the start point and end points","To make a new measurement, click to clear the previous measurement"]},id:{get:function(){return this._showComponentLines?"componentDistanceMeasurement":"distanceMeasurement"}},showComponentLines:{get:function(){return this._showComponentLines},set:function(e){this._showComponentLines=e,this._mode!==at&&this._updateComponents()}},measurementResult:{get:function(){return this._measurementResult}},newMeasurement:{get:function(){return this._newMeasurement}}}),ft.prototype._updateComponents=function(){var t=this._showComponentLines,i=this._xLabel,n=this._yLabel,o=this._xAngleLabel,s=this._yAngleLabel,r=this._xyPolyline,l=this._xyBox;if(i.show=!1,n.show=!1,o.show=!1,s.show=!1,r.show=!1,l.show=!1,t){var c,h,d,u,p=this._scene.frameState.mapProjection.ellipsoid,_=this._positions,m=_[0],g=_[1],f=p.cartesianToCartographic(m,dt).height,C=p.cartesianToCartographic(g,dt).height;f<C?(c=m,h=g,d=C,u=f):(c=g,h=m,d=f,u=C);var v=this._xyPolylinePositions;v[0]=e.Cartesian3.clone(c,v[0]),v[2]=e.Cartesian3.clone(h,v[2]);var y=p.geodeticSurfaceNormal(c,ut);y=e.Cartesian3.multiplyByScalar(y,d-u,y);var w=e.Cartesian3.add(c,y,v[1]);if(r.positions=v,!e.Cartesian3.equalsEpsilon(w,h,e.Math.EPSILON10)&&!e.Cartesian3.equalsEpsilon(w,c,e.Math.EPSILON10)){n.show=!0,i.show=!0,s.show=!0,o.show=!0,r.show=!0,l.show=!0;var b=e.Cartesian3.subtract(h,w,ut),E=e.Cartesian3.subtract(c,w,pt),x=Math.min(e.Cartesian3.magnitude(b),e.Cartesian3.magnitude(E)),S=x>15?.15*x:.25*x;b=e.Cartesian3.normalize(b,b),E=e.Cartesian3.normalize(E,E),b=e.Cartesian3.multiplyByScalar(b,S,b),E=e.Cartesian3.multiplyByScalar(E,S,E);var T=this._xyBoxPositions;T[0]=e.Cartesian3.add(w,b,T[0]),T[1]=e.Cartesian3.add(T[0],E,T[1]),T[2]=e.Cartesian3.add(w,E,T[2]),l.positions=T,i.position=e.Cartesian3.midpoint(w,h,ut),n.position=e.Cartesian3.midpoint(c,w,ut),o.position=e.Cartesian3.clone(h,ut),s.position=e.Cartesian3.clone(c,ut);var M=e.Cartesian3.subtract(w,h,pt),P=e.Cartesian3.subtract(w,c,ut),k=e.Cartesian3.subtract(h,c,_t),O=e.Cartesian3.angleBetween(P,k);k=e.Cartesian3.negate(k,k);var R=e.Cartesian3.angleBetween(M,k),A=e.Cartesian3.magnitude(M),I=e.Cartesian3.magnitude(P),L=this._selectedUnits,D=this._selectedLocale;i.text=a.distanceToString(A,L.distanceUnits,D),n.text=a.distanceToString(I,L.distanceUnits,D),o.text=a.angleToString(R,L.slopeUnits,D),s.text=a.angleToString(O,L.slopeUnits,D),this._xDistance=A,this._yDistance=I,this._xAngle=R,this._yAngle=O}}},ft.prototype._updateLabelPosition=function(){var t=this._positions;if(this._mode!==at){var i=this._scene,n=t[0],o=t[1],s=e.SceneTransforms.wgs84ToWindowCoordinates(i,n,ct),a=e.SceneTransforms.wgs84ToWindowCoordinates(i,o,ht);if(e.defined(s)&&e.defined(a)){var r=this._label,l=this._yLabel,c=this._xAngleLabel;(s.y-a.y)/(a.x-s.x)>0?(this._yPixelOffset.x=-9,this._xPixelOffset.x=12,l.pixelOffset=this._yPixelOffset,l.horizontalOrigin=e.HorizontalOrigin.RIGHT,c.pixelOffset=this._xPixelOffset,c.horizontalOrigin=e.HorizontalOrigin.LEFT,r.horizontalOrigin=e.HorizontalOrigin.LEFT):(this._yPixelOffset.x=9,this._xPixelOffset.x=-12,l.pixelOffset=this._yPixelOffset,l.horizontalOrigin=e.HorizontalOrigin.LEFT,c.pixelOffset=this._xPixelOffset,c.horizontalOrigin=e.HorizontalOrigin.RIGHT,r.horizontalOrigin=e.HorizontalOrigin.RIGHT)}}},ft.prototype.handleClick=function(t){e.Check.defined("clickPosition",t);var i=this._scene;this._mode===lt&&this.reset();var n=this._mode,o=this._positions;if(n===at){var s=ft._getWorldPosition(i,t,o[0]);if(!e.defined(s))return;this._polyline.show=!0,o[0]=s.clone(o[0]),o[1]=s.clone(o[1]),this._startPoint.position=s,this._startPoint.show=!0,this._mode=rt,this._polyline.positions=o}else n===rt&&(this._endPoint.position=o[1],this._endPoint.show=!0,this._polyline.positions=o,this._mode=lt,this._saveCurrentMeasurementAndPrepareNew())},ft.prototype.handleMouseMove=function(t){if(e.Check.defined("mousePosition",t),this._mode===rt){var i=this._scene,n=this._positions,o=ft._getWorldPosition(i,t,ut);if(e.defined(o)){var s=n[0],r=e.Cartesian3.clone(o,n[1]),l=e.Cartesian3.subtract(r,s,ut),c=e.Cartesian3.magnitude(l),h=this._label;h.position=e.Cartesian3.midpoint(s,r,ut),h.text=a.distanceToString(c,this._selectedUnits.distanceUnits,this._selectedLocale),h.show=!0,this._distance=c,this._polyline.positions=n,this._updateComponents()}}},ft.prototype.reset=function(){this._polyline.show=!1,this._xyPolyline.show=!1,this._xyBox.show=!1,this._label.show=!1,this._xLabel.show=!1,this._yLabel.show=!1,this._xAngleLabel.show=!1,this._yAngleLabel.show=!1,this._startPoint.show=!1,this._endPoint.show=!1,this._mode=at,this._distance=0,this._xDistance=0,this._yDistance=0,this._xAngle=0,this._yAngle=0},ft.prototype.isDestroyed=function(){return!1},ft.prototype.destroy=function(){this._removeEvent();var t=this._primitives;t.remove(this._polyline),t.remove(this._xyPolyline),t.remove(this._xyBox);var i=this._pointCollection;i.remove(this._startPoint),i.remove(this._endPoint);var n=this._labelCollection;return n.remove(this._label),n.remove(this._xLabel),n.remove(this._yLabel),n.remove(this._xAngleLabel),n.remove(this._yAngleLabel),e.destroyObject(this)},ft.prototype._saveCurrentMeasurementAndPrepareNew=function(){this._measurementResult.push({startPoint:this._startPoint,endPoint:this._endPoint,polyline:this._polyline,xyPolyline:this._xyPolyline,xyBox:this._xyBox,label:this._label,xLabel:this._xLabel,xAngleLabel:this._xAngleLabel,yLabel:this._yLabel,yAngleLabel:this._yAngleLabel}),this._newMeasurement.raiseEvent(this._measurementResult.length-1);var t=this._pointCollection,i=this._labelCollection,n=this._primitives,o=[new e.Cartesian3,new e.Cartesian3,new e.Cartesian3],s=[new e.Cartesian3,new e.Cartesian3,new e.Cartesian3],a=new e.Cartesian2(9,0),r=new e.Cartesian2(-9,0),l=[new e.Cartesian3,new e.Cartesian3],c=this._scene.frameState.mapProjection.ellipsoid;this._startPoint=t.add(Ze.getPointOptions()),this._endPoint=t.add(Ze.getPointOptions()),this._positions=l,this._polyline=n.add(new Ve(Ze.getPolylineOptions({ellipsoid:c,width:3,show:!1,positions:l}))),this._xyPolylinePositions=o,this._xyPolyline=n.add(new Ve(Ze.getPolylineOptions({ellipsoid:c,width:2,positions:o,materialType:e.Material.PolylineDashType}))),this._xyBoxPositions=s,this._xyBox=n.add(new Ve(Ze.getPolylineOptions({ellipsoid:c,width:1,positions:s}))),this._label=i.add(Ze.getLabelOptions({horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.TOP,pixelOffset:new e.Cartesian2(10,10)})),this._xPixelOffset=a,this._xLabel=i.add(Ze.getLabelOptions({scale:.6})),this._xAngleLabel=i.add(Ze.getLabelOptions({scale:.6,horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.MIDDLE,pixelOffset:a})),this._yPixelOffset=r,this._yLabel=i.add(Ze.getLabelOptions({scale:.6,horizontalOrigin:e.HorizontalOrigin.RIGHT,pixelOffset:r})),this._yAngleLabel=i.add(Ze.getLabelOptions({scale:.6,verticalOrigin:e.VerticalOrigin.TOP,pixelOffset:new e.Cartesian2(0,9)}))},ft._getWorldPosition=He;var Ct=new e.Cartesian3,vt=new e.Cartographic;function yt(e){return'<svg viewBox="0 0 30 30" height="'+e+'px" width="'+e+'px">\n             <g transform="translate(0,-267)">\n               <path d="m 15.042838,272.34414 0.01712,19.60575"/>\n               <circle r="2.0788691" cy="270.01154" cx="15.078616"/>\n               <path d="m 0.64901081,296.20687 8.80039389,-6.01044 7.9375003,3.1183 12.347278,-3.34365"/>\n             </g>\n           </svg>'}function wt(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),De.call(this,t);var i=[new e.Cartesian3,new e.Cartesian3],n=this._pointCollection;this._startPoint=n.add(Ze.getPointOptions()),this._endPoint=n.add(Ze.getPointOptions()),this._polyline=this._primitives.add(new Ve(Ze.getPolylineOptions({ellipsoid:this._scene.frameState.mapProjection.ellipsoid,positions:i}))),this._label=this._labelCollection.add(Ze.getLabelOptions({horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.TOP,pixelOffset:new e.Cartesian2(10,10)})),this._positions=i,this._distance=0}wt.prototype=Object.create(De.prototype),wt.prototype.constructor=wt,e.defineProperties(wt.prototype,{distance:{get:function(){return this._distance}},icon:{value:yt(15)},thumbnail:{value:yt(25)},type:{value:"Height from terrain"},instructions:{value:["Click on the point cloud to get a distance from that point to terrain"]},id:{value:"heightMeasurement"}}),wt.prototype.handleClick=function(t){var i=this._scene;this.reset();var n=this._positions,o=wt._getWorldPosition(i,t,n[0]);if(e.defined(o)){var s=i.globe,r=i.frameState.mapProjection.ellipsoid,l=r.cartesianToCartographic(o,vt);e.defined(s)?l.height=e.defaultValue(s.getHeight(l),0):l.height=0;var c=r.cartographicToCartesian(l,n[1]),h=e.Cartesian3.subtract(c,o,Ct),d=e.Cartesian3.magnitude(h),u=this._label;u.position=o,u.show=!0,u.text=a.distanceToString(d,this._selectedUnits.distanceUnits,this._selectedLocale),this._polyline.positions=n,this._polyline.show=!0,this._startPoint.position=o,this._startPoint.show=!0,this._endPoint.position=c,this._endPoint.show=!0,this._distance=d}},wt.prototype.reset=function(){this._polyline.show=!1,this._label.show=!1,this._startPoint.show=!1,this._endPoint.show=!1,this._distance=0},wt.prototype.isDestroyed=function(){return!1},wt.prototype.destroy=function(){this._primitives.remove(this._polyline);var t=this._pointCollection;return t.remove(this._startPoint),t.remove(this._endPoint),this._labelCollection.remove(this._label),e.destroyObject(this)},wt._getWorldPosition=He;var bt=new e.Cartesian2,Et=new e.Cartesian3;function xt(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),e.Check.defined("options.scene",t.scene);var i=t.scene,n=e.defaultValue(t.primitives,i.primitives),o=t.points,s=!1;e.defined(o)||(o=n.add(new e.PointPrimitiveCollection),s=!0),this._scene=i,this._pointCollection=o,this._removePoints=s,this._polyline=n.add(new Ve(t.polylineOptions)),this._primitives=n,this._pointOptions=t.pointOptions,this._positions=[],this._points=[],this._tempNextPos=new e.Cartesian3,this._mode=Ne.BeforeDraw,this._lastClickPosition=new e.Cartesian2(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this._polylineOptions=t.polylineOptions}xt.prototype.addPoint=function(e){var t=this._positions;t.push(e),this._polyline.positions=t;var i=this._pointCollection.add(this._pointOptions);i.position=e,i.show=!0,this._points.push(i)},xt.prototype.handleDoubleClick=function(){this._mode=Ne.AfterDraw,this._polyline.positions=this._positions},xt.prototype.handleClick=function(t){if(e.Check.defined("clickPosition",t),this._mode!==Ne.AfterDraw){var i=this._lastClickPosition;if(!(e.Cartesian2.magnitude(e.Cartesian2.subtract(i,t,bt))<10)){var n=xt._getWorldPosition(this._scene,t,Et);if(e.defined(n))return this.addPoint(e.Cartesian3.clone(n,new e.Cartesian3)),this._mode=Ne.Drawing,e.Cartesian2.clone(t,i),n}}},xt.prototype.handleMouseMove=function(t){if(e.Check.defined("mousePosition",t),this._mode===Ne.Drawing){var i=this._scene,n=xt._getWorldPosition(i,t,Et);if(e.defined(n)){var o=this._positions.slice();return o.push(e.Cartesian3.clone(n,this._tempNextPos)),this._polyline.positions=o,n}}},xt.prototype.isDestroyed=function(){return!1},xt.prototype.destroy=function(){if(this._removePoints)this._primitives.remove(this._points);else for(var t=this._points,i=this._pointCollection,n=0;n<t.length;n++)i.remove(t[n]);return this._primitives.remove(this._polyline),e.destroyObject(this)},xt.prototype.newPolyline=function(){return this._primitives.add(new Ve(this._polylineOptions))},xt._getWorldPosition=He;var St=new e.Cartesian2,Tt=new e.Cartesian3,Mt=new e.Cartesian3,Pt=new e.Cartesian3,kt=new e.Ray,Ot=new e.Cartesian3,Rt=new e.Cartesian3,At=new e.Cartographic;function It(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),e.Check.defined("options.scene",t.scene),xt.call(this,t);var i=e.defaultValue(t.polylineOptions,e.defaultValue.EMPTY_OBJECT),n={color:i.color,ellipsoid:i.ellipsoid,width:2,dashed:!0},o=this._primitives.add(new Ve(n));o.positions=[new e.Cartesian3,new e.Cartesian3],o.show=!1,this._dashLineOptions=n,this._dashedLines=[],this._moveDashLine=o,this._heightPlane=new e.Plane(e.Cartesian3.UNIT_X,0),this._heightPlaneCV=new e.Plane(e.Cartesian3.UNIT_X,0),this._firstMove=!1,this._height=0}It.prototype=Object.create(xt.prototype),It.prototype.constructor=It,It.prototype._setDashLinePositions=function(t,i){var n=this._scene.globe,o=this._scene.frameState.mapProjection.ellipsoid,s=t.positions;s[0]=e.Cartesian3.clone(i,s[0]);var a=o.cartesianToCartographic(i,At);e.defined(n)?a.height=e.defaultValue(n.getHeight(a),0):a.height=0,s[1]=o.cartographicToCartesian(a,s[1]),t.positions=s},It.prototype.addPoint=function(t){xt.prototype.addPoint.call(this,t);var i=this._primitives.add(new Ve(this._dashLineOptions));i.positions=[new e.Cartesian3,new e.Cartesian3],this._dashedLines.push(i),this._setDashLinePositions(i,t)},It.prototype.handleDoubleClick=function(){this._mode=Ne.AfterDraw,this._polyline.positions=this._positions,this._moveDashLine.show=!1},It.prototype.handleClick=function(t){var i;if(e.Check.defined("clickPosition",t),0===this._positions.length){var n=this._scene,o=n.frameState.mapProjection.ellipsoid;if(i=xt.prototype.handleClick.call(this,t),!e.defined(i))return;this._heightPlane=e.Plane.fromPointNormal(i,o.geodeticSurfaceNormal(i,Pt),this._heightPlane);var s=o.cartesianToCartographic(i,At),a=n.mapProjection.project(s,Mt),r=e.Cartesian3.fromElements(a.z,a.x,a.y,a);this._heightPlaneCV=e.Plane.fromPointNormal(r,e.Cartesian3.UNIT_X,this._heightPlaneCV),this._height=o.cartesianToCartographic(i,At).height,this._firstMove=!0}else{var l=this._lastClickPosition;if(e.Cartesian2.magnitude(e.Cartesian2.subtract(l,t,St))<10)return;e.Cartesian2.clone(t,l),i=e.Cartesian3.clone(this._tempNextPos),this.addPoint(i),this._firstMove=!0}return i},It.prototype.handleMouseMove=function(t,i){if(e.Check.defined("mousePosition",t),e.Check.defined("shift",i),this._mode===Ne.Drawing){var n,o=this._scene,s=o.frameState.mapProjection.ellipsoid,a=this._positions,r=o.camera.getPickRay(t,kt);if(o.mode===e.SceneMode.SCENE3D)n=e.IntersectionTests.rayPlane(r,this._heightPlane,Tt);else if(o.mode===e.SceneMode.COLUMBUS_VIEW){n=e.IntersectionTests.rayPlane(r,this._heightPlaneCV,Tt),n=e.Cartesian3.fromElements(n.y,n.z,n.x,n);var l=o.mapProjection.unproject(n,At);n=s.cartographicToCartesian(l,n)}else if(n=o.camera.pickEllipsoid(t,s,Tt),e.defined(n)){var c=s.cartesianToCartographic(n,At);c.height=this._height,n=s.cartographicToCartesian(c,n)}if(e.defined(n)){if(!this._firstMove&&i){var h=a[a.length-1],d=this._tempNextPos,u=e.Cartesian3.subtract(d,h,Ot),p=e.Cartesian3.subtract(n,h,Rt);p=e.Cartesian3.projectVector(p,u,p),n=e.Cartesian3.add(h,p,n)}return(a=a.slice()).push(e.Cartesian3.clone(n,this._tempNextPos)),this._polyline.positions=a,this._firstMove=!1,this._moveDashLine.show=!0,this._setDashLinePositions(this._moveDashLine,n),n}}},It.prototype.isDestroyed=function(){return!1},It.prototype.destroy=function(){for(var e=this._primitives,t=this._dashedLines,i=0;i<t.length;i++)e.remove(t[i]);e.remove(this._moveDashLine),xt.prototype.destroy.call(this)};var Lt=new e.Cartesian3,Dt=new e.Cartesian2,Nt=new e.Cartesian2,Ut=new e.Cartesian2,Vt=new e.Cartesian3;function zt(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),e.Check.defined("options.scene",t.scene),e.Check.defined("options.primitives",t.primitives),e.Check.defined("options.units",t.units),e.Check.defined("options.points",t.points),e.Check.defined("options.labels",t.labels),It.call(this,t);var i=t.labels;this._labelCollection=i,this._label=i.add(Ze.getLabelOptions({horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.BOTTOM,pixelOffset:new e.Cartesian2(10,-10)})),this._segmentLabels=[],this._selectedUnits=t.units,this._selectedLocale=t.locale,this._previousDistance=0,this._distance=0;var n=this;this._removeEvent=this._scene.preRender.addEventListener((function(){n.updateLabels()}))}function Ft(e){return'<svg viewBox="0 0 30 30" height="'+e+'px" width="'+e+'px">\n                 <g transform="translate(0,-267)">\n                   <path d="m 5.5492003,281.78808 18.9375757,0.0497"/>\n                   <circle r="2.0788691" cy="281.63776" cx="3.0514872"/>\n                   <circle r="2.0788691" cy="281.71384" cx="26.985731"/>\n                 </g>\n               </svg>'}function Bt(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),De.call(this,t),this._drawing=new zt(t)}function jt(t){e.Check.defined("scene",t),this.selectedMeasurement=void 0,this._sseh=new e.ScreenSpaceEventHandler(t.canvas),this._scene=t}zt.prototype=Object.create(It.prototype),zt.prototype.constructor=zt,e.defineProperties(zt.prototype,{distance:{get:function(){return this._distance}}}),zt.prototype.updateLabels=function(){var t=this._positions;if(!(t.length<2)){var i=this._scene,n=t[0],o=e.SceneTransforms.wgs84ToWindowCoordinates(i,n,Dt),s=e.defined(o)?e.Cartesian2.clone(o,Ut):e.Cartesian2.fromElements(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Ut),a=s.y,r=this._segmentLabels;r[0].show=this._polyline.positions.length>2;for(var l=1;l<t.length;l++){var c=e.SceneTransforms.wgs84ToWindowCoordinates(i,t[l],Nt);if(e.defined(c)){var h=(s.y-c.y)/(c.x-s.x),d=r[l-1];d.horizontalOrigin=h>0?e.HorizontalOrigin.LEFT:e.HorizontalOrigin.RIGHT,c.y<a&&(a=c.y,n=t[l]),s=e.Cartesian2.clone(c,s)}}this._mode===Ne.AfterDraw&&(this._label.position=n)}},zt.prototype.addPoint=function(t){var i=this._positions;if(i.length>0){this._previousDistance=this._distance;var n=this._labelCollection.add(Ze.getLabelOptions({scale:.8,horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.TOP,pixelOffset:new e.Cartesian2(5,5)})),o=i[i.length-1];n.position=e.Cartesian3.midpoint(o,t,new e.Cartesian3),n.text=a.distanceToString(e.Cartesian3.distance(o,t),this._selectedUnits.distanceUnits,this._selectedLocale),n.show=!0,this._segmentLabels.push(n)}It.prototype.addPoint.call(this,t)},zt.prototype.handleClick=function(t){this._mode===Ne.AfterDraw&&this.reset();var i=It.prototype.handleClick.call(this,t);e.defined(i)&&(this._label.show=!0,this._polyline.show=!0)},zt.prototype.handleMouseMove=function(t,i){e.Check.defined("mousePosition",t),e.Check.defined("shift",i);var n=It.prototype.handleMouseMove.call(this,t,i);if(e.defined(n)){var o=this._positions,s=o[o.length-1],r=e.Cartesian3.subtract(n,s,Vt),l=this._previousDistance+e.Cartesian3.magnitude(r),c=this._label;c.position=e.Cartesian3.midpoint(s,n,Lt),c.text=a.distanceToString(l,this._selectedUnits.distanceUnits,this._selectedLocale),c.show=!0,this._distance=l}},zt.prototype.reset=function(){var e,t=this._primitives,i=this._dashedLines;for(e=0;e<i.length;e++)t.remove(i[e]);this._dashedLines=[],this._polyline.positions=[],this._polyline.show=!1,this._label.show=!1,this._label.text="",this._previousDistance=0,this._distance=0,this._positions=[];var n=this._points,o=this._pointCollection;for(e=0;e<n.length;e++)o.remove(n[e]);n.length=0;var s=this._labelCollection,a=this._segmentLabels;for(e=0;e<a.length;e++)s.remove(a[e]);a.length=0,this._moveDashLine.show=!1,this._mode=Ne.BeforeDraw,this._lastClickPosition.x=Number.POSITIVE_INFINITY,this._lastClickPosition.y=Number.POSITIVE_INFINITY},zt.prototype.destroy=function(){var e;this._removeEvent();var t=this._labelCollection,i=this._segmentLabels;for(e=0;e<i.length;e++)t.remove(i[e]);var n=this._primitives,o=this._dashedLines;for(e=0;e<o.length;e++)n.remove(o[e]);this._labelCollection.remove(this._label),It.prototype.destroy.call(this)},Bt.prototype=Object.create(De.prototype),Bt.prototype.constructor=Bt,e.defineProperties(Bt.prototype,{distance:{get:function(){return this._drawing.distance}},icon:{value:Ft(15)},thumbnail:{value:Ft(25)},type:{value:"Horizontal distance"},instructions:{value:["Click on the point cloud or the globe to set the start point","Move the mouse to drag the line","Press this shift key to clamp the direction of the line","Click again to set the end point","To make a new measurement, click to clear the previous measurement"]},id:{value:"horizontalMeasurement"}}),Bt.prototype.handleDoubleClick=function(){this._drawing.handleDoubleClick()},Bt.prototype.handleClick=function(t){e.Check.defined("clickPosition",t),this._drawing.handleClick(t)},Bt.prototype.handleMouseMove=function(t,i){e.Check.defined("mousePosition",t),e.Check.defined("shift",i),this._drawing.handleMouseMove(t,i)},Bt.prototype.reset=function(){this._drawing.reset()},Bt.prototype.isDestroyed=function(){return!1},Bt.prototype.destroy=function(){return this._drawing.destroy(),e.destroyObject(this)},e.defineProperties(jt.prototype,{scene:{get:function(){return this._scene}}}),jt.prototype.activate=function(){var t=this._sseh;t.setInputAction(this._click.bind(this),e.ScreenSpaceEventType.LEFT_CLICK),t.setInputAction(this._clickShift.bind(this),e.ScreenSpaceEventType.LEFT_CLICK,e.KeyboardEventModifier.SHIFT),t.setInputAction(this._mouseMove.bind(this),e.ScreenSpaceEventType.MOUSE_MOVE),t.setInputAction(this._mouseMoveShift.bind(this),e.ScreenSpaceEventType.MOUSE_MOVE,e.KeyboardEventModifier.SHIFT),t.setInputAction(this._handleLeftDown.bind(this),e.ScreenSpaceEventType.LEFT_DOWN),t.setInputAction(this._handleLeftUp.bind(this),e.ScreenSpaceEventType.LEFT_UP),t.setInputAction(this._handleDoubleClick.bind(this),e.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},jt.prototype.deactivate=function(){var t=this._sseh;t.removeInputAction(e.ScreenSpaceEventType.LEFT_CLICK),t.removeInputAction(e.ScreenSpaceEventType.LEFT_CLICK,e.KeyboardEventModifier.SHIFT),t.removeInputAction(e.ScreenSpaceEventType.MOUSE_MOVE),t.removeInputAction(e.ScreenSpaceEventType.MOUSE_MOVE,e.KeyboardEventModifier.SHIFT),t.removeInputAction(e.ScreenSpaceEventType.LEFT_DOWN),t.removeInputAction(e.ScreenSpaceEventType.LEFT_UP),t.removeInputAction(e.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},jt.prototype._handleDoubleClick=function(e){this.selectedMeasurement.handleDoubleClick(e.position);var t=this._scene;t.requestRenderMode&&t.requestRender()},jt.prototype._handleClick=function(e,t){this.selectedMeasurement.handleClick(e.position,t);var i=this._scene;i.requestRenderMode&&i.requestRender()},jt.prototype._clickShift=function(e){this._handleClick(e,!0)},jt.prototype._click=function(e){this._handleClick(e,!1)},jt.prototype._handleMouseMove=function(e,t){this.selectedMeasurement.handleMouseMove(e.endPosition,t);var i=this._scene;i.requestRenderMode&&i.requestRender()},jt.prototype._mouseMove=function(e){this._handleMouseMove(e,!1)},jt.prototype._mouseMoveShift=function(e){this._handleMouseMove(e,!0)},jt.prototype._handleLeftDown=function(e){this.selectedMeasurement.handleLeftDown(e.position);var t=this._scene;t.requestRenderMode&&t.requestRender()},jt.prototype._handleLeftUp=function(e){this.selectedMeasurement.handleLeftUp(e.position);var t=this._scene;t.requestRenderMode&&t.requestRender()},jt.prototype.isDestroyed=function(){return!1},jt.prototype.destroy=function(){return this.deactivate(),this._sseh.destroy(),e.destroyObject(this)};var Ht=new e.Cartesian3,Qt=new e.Cartesian3,Xt=new e.Cartesian3,Yt=[new e.Cartesian2,new e.Cartesian2,new e.Cartesian2,new e.Cartesian2],qt=[new e.Cartesian3,new e.Cartesian3,new e.Cartesian3,new e.Cartesian3,new e.Cartesian3];function Zt(t,i){e.Check.defined("scene",t),e.Check.defined("windowCoordinates",i);var n=Zt._getWorldPosition(t,i,Ht);if(e.defined(n)){var o=.05,s=t.camera.position,a=e.Cartesian3.distance(n,s);if(!(a>1e4)){var r=qt[0],l=qt[1],c=qt[2],h=qt[3],d=t.frameState.mapProjection.ellipsoid.geodeticSurfaceNormal(n,Qt);d=e.Cartesian3.negate(d,d);var u=e.Cartesian2.clone(i,Yt[0]);u.x-=2,u.y-=2;var p=e.Cartesian2.clone(i,Yt[1]);p.x-=2,p.y+=2;var _=e.Cartesian2.clone(i,Yt[2]);_.x+=2,_.y+=2;var m=e.Cartesian2.clone(i,Yt[3]);m.x+=2,m.y-=2;var g,f,C,v,y=Zt._getWorldPosition(t,u,r),w=Zt._getWorldPosition(t,p,l),b=Zt._getWorldPosition(t,_,c),E=Zt._getWorldPosition(t,m,h);if(e.defined(y)){var x=e.Cartesian3.subtract(y,n,r);g=e.Cartesian3.magnitude(x)/a<=o?e.Cartesian3.normalize(x,r):void 0}if(e.defined(w)){var S=e.Cartesian3.subtract(w,n,l);f=e.Cartesian3.magnitude(S)/a<=o?e.Cartesian3.normalize(S,l):void 0}if(e.defined(b)){var T=e.Cartesian3.subtract(b,n,c);C=e.Cartesian3.magnitude(T)/a<=o?e.Cartesian3.normalize(T,c):void 0}if(e.defined(E)){var M=e.Cartesian3.subtract(E,n,h);v=e.Cartesian3.magnitude(M)/a<=o?e.Cartesian3.normalize(M,h):void 0}var P=e.Cartesian3.clone(e.Cartesian3.ZERO,Xt),k=qt[4];if(e.defined(g)&&e.defined(f)&&(k=e.Cartesian3.normalize(e.Cartesian3.cross(g,f,k),k),P=e.Cartesian3.add(P,k,P)),e.defined(f)&&e.defined(C)&&(k=e.Cartesian3.normalize(e.Cartesian3.cross(f,C,k),k),P=e.Cartesian3.add(P,k,P)),e.defined(C)&&e.defined(v)&&(k=e.Cartesian3.normalize(e.Cartesian3.cross(C,v,k),k),P=e.Cartesian3.add(P,k,P)),e.defined(v)&&e.defined(g)&&(k=e.Cartesian3.normalize(e.Cartesian3.cross(v,g,k),k),P=e.Cartesian3.add(P,k,P)),!P.equals(e.Cartesian3.ZERO))return P=e.Cartesian3.normalize(P,P),e.Math.asinClamped(Math.abs(Math.sin(e.Cartesian3.angleBetween(P,d))))}}}Zt._getWorldPosition=He;var Kt=new e.Cartesian3,Jt=new e.Cartographic;function Gt(e){return'<svg viewBox="0 0 30 30" height="'+e+'px" width="'+e+'px">\n                 <g transform="translate(0,-267)">\n                   <circle r="2.0788691" cy="281.90503" cx="15.212251"/>\n                 </g>\n               </svg>'}function Wt(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),De.call(this,t),this._point=this._pointCollection.add(Ze.getPointOptions()),this._label=this._labelCollection.add(Ze.getLabelOptions({horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.CENTER,pixelOffset:new e.Cartesian2(10,0)})),this._position=new e.Cartesian3,this._height=0,this._slope=0,this._measurementResult=[],this._newMeasurement=new e.Event}Wt.prototype=Object.create(De.prototype),Wt.prototype.constructor=Wt,e.defineProperties(Wt.prototype,{position:{get:function(){return this._position}},height:{get:function(){return this._height}},slope:{get:function(){return this._slope}},icon:{value:Gt(15)},thumbnail:{value:Gt(25)},type:{value:"Point coordinates"},instructions:{value:["Move the mouse to see the longitude, latitude and height of the point"]},id:{value:"pointMeasurement"},measurementResult:{get:function(){return this._measurementResult}},newMeasurement:{get:function(){return this._newMeasurement}}}),Wt.prototype._pickPositionSupported=function(){return this._scene.pickPositionSupported},Wt.prototype._saveCurrentMeasurementAndPrepareNew=function(){this._measurementResult.push({point:this._point,label:this._label}),this._newMeasurement.raiseEvent(this._measurementResult.length-1),this._point=this._pointCollection.add(Ze.getPointOptions()),this._label=this._labelCollection.add(Ze.getLabelOptions({horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.CENTER,pixelOffset:new e.Cartesian2(10,0)}))},Wt.prototype.handleClick=function(t){var i=this._scene;if(i.mode!==e.SceneMode.MORPHING){var n=Wt._getWorldPosition(i,t,Kt);if(e.defined(n)){this._label.show=!1,this._point.show=!1,this._point.position=n;var o,r=i.frameState.mapProjection.ellipsoid.cartesianToCartographic(n,Jt),l=0;e.defined(i.globe)&&(l=e.defaultValue(i.globe.getHeight(r),0)),l=r.height-l,e.Math.equalsEpsilon(l,0,e.Math.EPSILON3)&&(l=0),i.mode!==e.SceneMode.SCENE2D&&(o=Wt._getSlope(i,t,this._primitives)),this._point.show=!0;var c=this._label;c.position=n,c.show=!0,c.text="lon: "+a.angleToString(r.longitude,s.DEGREES_MINUTES_SECONDS,this._selectedLocale)+"\nlat: "+a.angleToString(r.latitude,s.DEGREES_MINUTES_SECONDS,this._selectedLocale),i.mode!==e.SceneMode.SCENE2D&&this._pickPositionSupported()&&(c.text+="\nheight: "+a.distanceToString(l,this._selectedUnits.distanceUnits,this._selectedLocale),e.defined(o)&&(c.text+="\nslope: "+a.angleToString(o,this._selectedUnits.slopeUnits,this._selectedLocale,3))),this._position=e.Cartesian3.clone(n,this._position),this._height=l,this._slope=o,this._saveCurrentMeasurementAndPrepareNew()}}},Wt.prototype.handleMouseMove=function(t){if(null!==this._point){var i=this._scene;if(this._label.show=!1,this._point.show=!1,i.mode!==e.SceneMode.MORPHING){this._point.show=!1;var n=Wt._getWorldPosition(i,t,Kt);if(e.defined(n)){this._point.position=n;var o,r=i.frameState.mapProjection.ellipsoid.cartesianToCartographic(n,Jt),l=0;e.defined(i.globe)&&(l=e.defaultValue(i.globe.getHeight(r),0)),l=r.height-l,e.Math.equalsEpsilon(l,0,e.Math.EPSILON3)&&(l=0),i.mode!==e.SceneMode.SCENE2D&&(o=Wt._getSlope(i,t,this._primitives)),this._point.show=!0;var c=this._label;c.position=n,c.show=!0,c.text="lon: "+a.angleToString(r.longitude,s.DEGREES_MINUTES_SECONDS,this._selectedLocale)+"\nlat: "+a.angleToString(r.latitude,s.DEGREES_MINUTES_SECONDS,this._selectedLocale),i.mode!==e.SceneMode.SCENE2D&&this._pickPositionSupported()&&(c.text+="\nheight: "+a.distanceToString(l,this._selectedUnits.distanceUnits,this._selectedLocale),e.defined(o)&&(c.text+="\nslope: "+a.angleToString(o,this._selectedUnits.slopeUnits,this._selectedLocale,3))),this._position=e.Cartesian3.clone(n,this._position),this._height=l,this._slope=o}}}},Wt.prototype.reset=function(){this._position=e.Cartesian3.clone(e.Cartesian3.ZERO,this._position)},Wt.prototype.isDestroyed=function(){return!1},Wt.prototype.destroy=function(){for(var t=0;t<this._measurementResult;t++)this._pointCollection.remove(this._measurementResult[t].point),this._labelCollection.remove(this._measurementResult[t].label);return e.destroyObject(this)},Wt._getSlope=Zt,Wt._getWorldPosition=He;var $t=new e.Cartesian2,ei=new e.Cartesian2,ti=new e.Cartesian2,ii=new e.Cartesian3;function ni(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),e.Check.defined("options.scene",t.scene),e.Check.defined("options.primitives",t.primitives),e.Check.defined("options.units",t.units),e.Check.defined("options.points",t.points),e.Check.defined("options.labels",t.labels),t.polylineOptions=Ze.getPolylineOptions({ellipsoid:t.ellipsoid}),t.pointOptions=Ze.getPointOptions(),xt.call(this,t);var i=this._scene,n=t.labels;this._labelCollection=n,this._label=n.add(Ze.getLabelOptions()),this._segmentLabels=[],this._selectedUnits=t.units,this._selectedLocale=t.locale,this._previousDistance=0,this._distance=0;var o=this;this._removeEvent=i.preRender.addEventListener((function(){o.updateLabel()})),this._measurementResult=[]}function oi(e){return'<svg viewBox="0 0 30 30" height="'+e+'px" width="'+e+'px">\n                  <g transform="translate(0,-267)">\n                   <circle cx="3.8532958" cy="293.99896" r="2.0788691" />\n                   <circle cx="7.2651663" cy="276.26389" r="2.0788691" />\n                   <circle cx="24.571842" cy="285.56577" r="2.0788691" />\n                   <circle cx="26.916754" cy="270.38345" r="2.0788691" />\n                   <path d="m 3.7523356,294.14823 3.602242,-17.81109 17.3608064,9.35582 2.401494,-15.00934" />\n                 </g>\n               </svg>'}function si(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),De.call(this,t),this._drawing=new ni(t),this._newMeasurement=new e.Event}ni.prototype=Object.create(xt.prototype),ni.prototype.constructor=ni,e.defineProperties(ni.prototype,{distance:{get:function(){return this._distance}}}),ni.prototype.updateLabel=function(){var t=this._positions;if(!(t.length<2||this._segmentLabels.length<1)){var i=this._scene,n=t[0],o=e.SceneTransforms.wgs84ToWindowCoordinates(i,n,$t),s=e.defined(o)?e.Cartesian2.clone(o,ti):e.Cartesian2.fromElements(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,ti),a=s.y,r=this._segmentLabels;r[0].show=this._polyline.positions.length>2;for(var l=1;l<t.length;l++){var c=e.SceneTransforms.wgs84ToWindowCoordinates(i,t[l],ei);if(e.defined(c)){var h=(s.y-c.y)/(c.x-s.x),d=r[l-1];d.horizontalOrigin=h>0?e.HorizontalOrigin.LEFT:e.HorizontalOrigin.RIGHT,c.y<a&&(a=c.y,n=t[l]),s=e.Cartesian2.clone(c,s)}}this._mode===Ne.AfterDraw&&(this._label.position=n)}},ni.prototype.addPoint=function(t){var i=this._positions;if(i.length>0){this._previousDistance=this._distance;var n=this._labelCollection.add(Ze.getLabelOptions({scale:.8,horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.TOP,pixelOffset:new e.Cartesian2(5,5)})),o=i[i.length-1];n.position=e.Cartesian3.midpoint(o,t,new e.Cartesian3),n.text=a.distanceToString(e.Cartesian3.distance(o,t),this._selectedUnits.distanceUnits,this._selectedLocale),n.show=!0,this._segmentLabels.push(n)}xt.prototype.addPoint.call(this,t)},ni.prototype.handleClick=function(t){this._mode===Ne.AfterDraw&&this.reset();var i=xt.prototype.handleClick.call(this,t);e.defined(i)&&(this._label.show=!0,this._polyline.show=!0)},ni.prototype.handleMouseMove=function(t){var i=xt.prototype.handleMouseMove.call(this,t);if(e.defined(i)){var n=this._positions[this._positions.length-1],o=i,s=e.Cartesian3.subtract(o,n,ii),r=this._previousDistance+e.Cartesian3.magnitude(s),l=this._label;l.position=o,l.text=a.distanceToString(r,this._selectedUnits.distanceUnits,this._selectedLocale),l.show=!0,this._distance=r}},ni.prototype.reset=function(){var e;this._label.show=!1,this._label.text="",this._positions=[],this._polyline.positions=[],this._polyline.show=!1,this._previousDistance=0,this._distance=0;var t=this._points,i=this._pointCollection;for(e=0;e<t.length;e++)i.remove(t[e]);t.length=0;var n=this._labelCollection,o=this._segmentLabels;for(e=0;e<o.length;e++)n.remove(o[e]);o.length=0,this._mode=Ne.BeforeDraw,this._lastClickPosition.x=Number.POSITIVE_INFINITY,this._lastClickPosition.y=Number.POSITIVE_INFINITY},ni.prototype.destroy=function(){this._removeEvent();var e=this._labelCollection;e.remove(this._label);for(var t=this._segmentLabels,i=0;i<t.length;i++)e.remove(t[i]);xt.prototype.destroy.call(this)},ni.prototype.handleDoubleClick=function(){xt.prototype.handleDoubleClick.call(this),this._saveCurrentMeasurementAndPrepareNew()},ni.prototype._saveCurrentMeasurementAndPrepareNew=function(){this._measurementResult.push({label:this._label,segmentLabels:this._segmentLabels,polyline:this._polyline,points:this._points}),this._label=this._labelCollection.add(Ze.getLabelOptions()),this._segmentLabels=[],this._polyline=xt.prototype.newPolyline.call(this),this._points=[]},si.prototype=Object.create(De.prototype),si.prototype.constructor=si,e.defineProperties(si.prototype,{distance:{get:function(){return this._drawing.distance}},icon:{value:oi(15)},thumbnail:{value:oi(25)},type:{value:"Polyline Distance"},instructions:{value:["Click to start drawing a polyline","Keep clicking to add more points","Double click to finish drawing"]},id:{value:"polylineMeasurement"},measurementResult:{get:function(){return this._drawing._measurementResult}},newMeasurement:{get:function(){return this._newMeasurement}}}),si.prototype.handleDoubleClick=function(){this._drawing.handleDoubleClick(),this._newMeasurement.raiseEvent(this._drawing._measurementResult.length-1)},si.prototype.handleClick=function(e){this._drawing.handleClick(e)},si.prototype.handleMouseMove=function(e){this._drawing.handleMouseMove(e)},si.prototype.reset=function(){this._drawing.reset()},si.prototype.isDestroyed=function(){return!1},si.prototype.destroy=function(){return this._drawing.destroy(),e.destroyObject(this)};var ai=0,ri=1,li=2,ci=new e.Cartesian3,hi=new e.Cartesian2,di=new e.Cartesian3,ui=new e.Cartesian3,pi=new e.Ray,_i=new e.Cartesian3,mi=new e.Cartographic;function gi(e){return'<svg viewBox="0 0 30 30" height="'+e+'px" width="'+e+'px">\n                 <g transform="translate(0,-267)">\n                   <path d="m 15.042838,272.34414 -0.0497,18.93758"/>\n                   <circle r="2.0788691" cy="270.01154" cx="15.078616"/>\n                   <circle r="2.0788691" cy="293.97095" cx="15.092237"/>\n                 </g>\n               </svg>'}function fi(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),De.call(this,t);var i=this._pointCollection,n=[new e.Cartesian3,new e.Cartesian3];this._startPoint=i.add(Ze.getPointOptions()),this._endPoint=i.add(Ze.getPointOptions()),this._positions=n,this._polyline=this._primitives.add(new Ve(Ze.getPolylineOptions({ellipsoid:this._scene.frameState.mapProjection.ellipsoid,positions:n}))),this._label=this._labelCollection.add(Ze.getLabelOptions({horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.TOP,pixelOffset:new e.Cartesian2(10,10)})),this._mode=ai,this._draggingPlane=new e.Plane(e.Cartesian3.UNIT_X,0),this._surfaceNormal=new e.Cartesian3,this._distance=0}function Ci(t){var i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).scene;e.Check.defined("options.scene",i);var n=e.defined(t.units)?t.units:new a,o=e.defined(t.primitives)?t.primitives:i.primitives.add(new e.PrimitiveCollection),s=o.add(new e.PointPrimitiveCollection),r=o.add(new e.LabelCollection),l=new jt(i),c={scene:i,units:n,locale:t.locale,points:s,labels:r,primitives:o},h=e.clone(c);h.showComponentLines=!0;var d=[new ft(c),new ft(h),new si(c),new Bt(c),new fi(c),new wt(c),new st(c),new Wt(c)];this.expanded=!1,this.instructionsVisible=!1,this.selectedMeasurement=void 0;var u=e.knockout.observable();e.knockout.defineProperty(this,"selectedMeasurement",{get:function(){return u()},set:function(t){var n=u();e.defined(n)&&n.reset(),u(t),l.selectedMeasurement=t,i.requestRenderMode&&i.requestRender()}}),e.knockout.track(this,["expanded","instructionsVisible"]),this._measurements=d,this._units=n,this._mouseHandler=l,this._primitives=o,this._scene=i,this._removeListener=i.morphStart.addEventListener(Ci.prototype.onMorph,this)}fi.prototype=Object.create(De.prototype),fi.prototype.constructor=fi,e.defineProperties(fi.prototype,{distance:{get:function(){return this._distance}},type:{value:"Vertical distance"},icon:{value:gi(15)},thumbnail:{value:gi(25)},instructions:{value:["Click on the point cloud or the globe to set the start point","Move the mouse to drag the line","Click again to set the end point","To make a new measurement, click to clear the previous measurement"]},id:{value:"verticalMeasurement"}}),fi.prototype.handleClick=function(t){e.Check.defined("clickPosition",t);var i=this._scene,n=i.frameState.mapProjection.ellipsoid;this._mode===li&&this.reset();var o=this._mode,s=this._positions;if(o===ai){var a=fi._getWorldPosition(i,t,s[0]);if(!e.defined(a))return;this._polyline.show=!0,s[0]=e.Cartesian3.clone(a,s[0]),s[1]=e.Cartesian3.clone(a,s[1]),this._startPoint.position=a,this._startPoint.show=!0,this._mode=ri,this._polyline.positions=s,this._surfaceNormal=n.geodeticSurfaceNormal(a,this._surfaceNormal)}else o===ri&&(this._endPoint.position=s[1],this._endPoint.show=!0,this._mode=li)},fi.prototype.handleMouseMove=function(t){if(e.Check.defined("mousePosition",t),this._mode===ri){var i=this._label;if(this._scene.mode===e.SceneMode.SCENE2D)return i.position=this._positions[0],i.text=a.distanceToString(0,this._selectedUnits.distanceUnits,this._selectedLocale),i.show=!0,void(this._mode=li);var n=fi._getHeightPosition(this,t);if(e.defined(n)){var o=this._positions,s=o[0],r=o[1],l=e.Cartesian3.subtract(r,s,ci),c=e.Cartesian3.magnitude(l);i.position=e.Cartesian3.midpoint(s,r,_i),i.text=a.distanceToString(c,this._selectedUnits.distanceUnits,this._selectedLocale),i.show=!0,this._polyline.positions=o,this._distance=c}}},fi.prototype.reset=function(){this._polyline.show=!1,this._label.show=!1,this._startPoint.show=!1,this._endPoint.show=!1,this._mode=ai,this._distance=0},fi.prototype.isDestroyed=function(){return!1},fi.prototype.destroy=function(){this._primitives.remove(this._polyline);var t=this._pointCollection;return t.remove(this._startPoint),t.remove(this._endPoint),this._labelCollection.remove(this._label),e.destroyObject(this)},fi._getWorldPosition=He,fi._getHeightPosition=function(t,i){var n=t._positions,o=n[0],s=n[1],a=t._draggingPlane,r=t._surfaceNormal,l=t._scene,c=l.camera,h=c.direction,d=l.frameState.mapProjection.ellipsoid,u=o,p=r;if(l.mode===e.SceneMode.COLUMBUS_VIEW){p=e.Cartesian3.UNIT_X;var _=d.cartesianToCartographic(o,mi);u=l.mapProjection.project(_,ci),e.Cartesian3.fromElements(u.z,u.x,u.y,u)}var m=e.Cartesian3.cross(p,h,di);m=e.Cartesian3.cross(p,m,m),m=e.Cartesian3.normalize(m,m),a=e.Plane.fromPointNormal(u,m,a);var g=c.getPickRay(i,pi);if(s=e.IntersectionTests.rayPlane(g,a,s),e.defined(s)){if(l.mode===e.SceneMode.COLUMBUS_VIEW){s=e.Cartesian3.fromElements(s.y,s.z,s.x,s);var f=l.mapProjection.unproject(s,mi);s=d.cartographicToCartesian(f,s)}return e.SceneTransforms.wgs84ToWindowCoordinates(l,n[0],hi).y<i.y&&(r=e.Cartesian3.negate(r,di)),ui=e.Cartesian3.subtract(s,o,ui),ui=e.Cartesian3.projectVector(ui,r,ui),s=e.Cartesian3.add(o,ui,s)}},e.defineProperties(Ci.prototype,{scene:{get:function(){return this._scene}},measurements:{get:function(){return this._measurements}},units:{get:function(){return this._units}}}),Ci.prototype.toggleActive=function(){var e=this.expanded;e?this._deactivate():this._activate(),this.expanded=!e},Ci.prototype.toggleInstructions=function(){this.instructionsVisible=!this.instructionsVisible},Ci.prototype._activate=function(){this._mouseHandler.activate(),this.selectedMeasurement=this._measurements[0]},Ci.prototype._deactivate=function(){this._mouseHandler.deactivate(),this.selectedMeasurement=void 0,this.reset()},Ci.prototype.onMorph=function(e,t,i,n){this.reset()},Ci.prototype.reset=function(){this.instructionsVisible=!1,this._measurements.forEach((function(e){e.reset()}))},Ci.prototype.isDestroyed=function(){return!1},Ci.prototype.destroy=function(){return this._deactivate(),this._mouseHandler.destroy(),this._measurements.forEach((function(e){e.destroy()})),this._scene.primitives.remove(this._primitives),e.destroyObject(this)};function vi(t){var i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).container;e.Check.defined("options.container",i),e.Check.defined("options.scene",t.scene);var n=Ae('<div class="cesium-measure-toolbar" data-bind="css: {expanded: expanded}">\n                   <div class="cesium-measure-button cesium-measure-button-main" data-bind="click: toggleActive, attr: {title: expanded ? \'Collapse\' : \'Expand\'}">\n                       <svg width="25px" height="25px" viewBox="0 0 30 30">                          <path d="M 14.851122,11.545456 25.578177,0.95157924 29.306163,4.6249483 18.537701,15.246448 M 15.097088,18.640104 4.1531358,29.434698 0.62547531,25.653101 11.515909,14.853004"/>                          <path d="M 22.983411,26.662767 0.8350882,3.9632787 4.2110211,0.77972226 26.222602,23.217308 Z"/>                          <path d="m 23.126668,26.856584 5.906658,2.311965 -2.630951,-5.79394"/>                          <path d="M 3.8120758,6.6472825 7.2277612,3.4338416"/>                          <path d="M 5.2416124,27.76234 3.6377555,26.08552"/>                          <path d="M 7.0148521,26.015847 5.4109952,24.339027"/>                          <path d="M 8.9787697,24.078675 7.3749129,22.401855"/>                          <path d="M 10.974467,22.173284 9.3706099,20.496464"/>                          <path d="m 12.990856,20.120081 -1.603857,-1.67682"/>                          <path d="m 19.676091,13.638423 -1.603857,-1.67682"/>                          <path d="M 21.449331,11.89193 19.845474,10.21511"/>                          <path d="M 23.413248,9.9547586 21.809392,8.2779376"/>                          <path d="M 25.448671,7.9858073 23.805089,6.3725466"/>                          <path d="M 27.425335,5.9961636 25.765864,4.3670131"/>                    </svg>               </div>\n                   \x3c!-- ko foreach: measurements --\x3e\n                   <div class="cesium-measure-button" data-bind="click: function($data) { $parent.selectedMeasurement = $data; }, attr: {title: type}, css: {active: $data === $parent.selectedMeasurement}, html: thumbnail"></div>\n                   \x3c!-- /ko --\x3e\n                   <div class="cesium-measure-button cesium-measure-help" title="Settings and Help" data-bind="click: toggleInstructions, css: {active: instructionsVisible}">\n                       <svg width="20px" height="20px" viewBox="0 0 30 30">                            <g transform="translate(0,-267)">                            <g>                            <path d="M 16.891904,289.31984 H 11.7387 q -0.02021,-1.11147 -0.02021,-1.35398 0,-2.50587 0.828554,-4.12256 0.828555,-1.61669 3.314218,-3.63756 2.485663,-2.02086 2.970671,-2.64733 0.747719,-0.99022 0.747719,-2.18253 0,-1.65711 -1.33377,-2.82921 -1.313562,-1.19231 -3.556721,-1.19231 -2.162325,0 -3.617348,1.23273 -1.4550219,1.23272 -2.0006553,3.7588 l -5.2138301,-0.64667 q 0.2222951,-3.61735 3.0717138,-6.14343 2.8696274,-2.52608 7.5176156,-2.52608 4.890492,0 7.780328,2.5665 2.889836,2.54629 2.889836,5.94134 0,1.8794 -1.071058,3.55672 -1.05085,1.67732 -4.526737,4.56715 -1.798569,1.49544 -2.243159,2.40483 -0.424381,0.90939 -0.383964,3.25359 z m -5.153204,7.63887 v -5.67863 h 5.678629 v 5.67863 z" />                            </g>                            </g>                        </svg>                   </div>\n               </div>\n               <div class="cesium-measure-instructions" data-bind="visible: instructionsVisible">\n                   \x3c!-- ko foreach: measurements --\x3e\n                   <div><div class="cesium-measure-icon" data-bind="html: icon" style="display: inline"></div><span data-bind="text: type"></span></div>\n                   <ul data-bind="foreach: instructions">\n                       <li data-bind="text: $data"></li>\n                   </ul>\n                   <hr>\n                   \x3c!-- /ko --\x3e\n               </div>');n=(i=Ie(i)).appendChild(n);var o=new Ci(t);e.knockout.applyBindings(o,i),this._viewModel=o,this._container=i,this._element=n,this._dropdown=n.getElementsByClassName("cesium-measure-instructions")[0]}function yi(t,i){if(!e.defined(t))throw new e.DeveloperError("viewer is required.");i=e.defaultValue(i,{});var n=t.scene,o=document.createElement("div");o.className="cesium-viewer-measureContainer",t._toolbar.insertBefore(o,t._toolbar.firstChild),(i=e.clone(i)).container=o,i.scene=n;var s=new vi(i),a=n.postUpdate.addEventListener((function(){var e=t._container.clientHeight-125;s._dropdown.style.maxHeight=e+"px"}));t.destroy=e.wrapFunction(t,t.destroy,(function(){a(),s.destroy()})),e.defineProperties(t,{measure:{get:function(){return s}}})}e.defineProperties(vi.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}},tilesetMeasurementSupported:{get:function(){return this._scene.pickPositionSupported}}}),vi.prototype.isDestroyed=function(){return!1},vi.prototype.destroy=function(){return this._viewModel.destroy(),e.knockout.cleanNode(this._container),this._container.removeChild(this._element),e.destroyObject(this)};let wi={};const bi=e=>{const t=e.height/3;e.injectCSS&&(wi[e.cssprefix]||((e=>{const t=document.createElement("style");t.innerHTML=e;let i=document.getElementsByTagName("head")[0];i.insertBefore(t,i.firstChild)})(Si(e,t)),wi[e.cssprefix]=!0));const i=document.createElement("div");return i.innerHTML=((e,t)=>{const i=.8*t;return`<button class="${e}-button">\n          <div class="${e}-title"></div>\n          <div class="${e}-logo" >${Ei(e,i)+xi(e,i)}</div>\n        </button>`})(e.cssprefix,t),i.firstChild},Ei=(e,t)=>`<svg class="${e}-svg" version="1.1" x="0px" y="0px"\n        width="${28/18*t}px" height="${t}px" viewBox="0 0 28 18" xml:space="preserve">\n        <path d="M26.8,1.1C26.1,0.4,25.1,0,24.2,0H3.4c-1,0-1.7,0.4-2.4,1.1C0.3,1.7,0,2.7,0,3.6v10.7\n        c0,1,0.3,1.9,0.9,2.6C1.6,17.6,2.4,18,3.4,18h5c0.7,0,1.3-0.2,1.8-0.5c0.6-0.3,1-0.8,1.3-1.4l\n        1.5-2.6C13.2,13.1,13,13,14,13v0h-0.2 h0c0.3,0,0.7,0.1,0.8,0.5l1.4,2.6c0.3,0.6,0.8,1.1,1.3,\n        1.4c0.6,0.3,1.2,0.5,1.8,0.5h5c1,0,2-0.4,2.7-1.1c0.7-0.7,1.2-1.6,1.2-2.6 V3.6C28,2.7,27.5,\n        1.7,26.8,1.1z M7.4,11.8c-1.6,0-2.8-1.3-2.8-2.8c0-1.6,1.3-2.8,2.8-2.8c1.6,0,2.8,1.3,2.8,2.8\n        C10.2,10.5,8.9,11.8,7.4,11.8z M20.1,11.8c-1.6,0-2.8-1.3-2.8-2.8c0-1.6,1.3-2.8,2.8-2.8C21.7\n        ,6.2,23,7.4,23,9 C23,10.5,21.7,11.8,20.1,11.8z"/>\n    </svg>`,xi=(e,t)=>{let i=28/18;return`<svg class="${e}-svg-error" x="0px" y="0px"\n        width="${i*t}px" height="${i*t}px" viewBox="0 0 28 28" xml:space="preserve">\n        <path d="M17.6,13.4c0-0.2-0.1-0.4-0.1-0.6c0-1.6,1.3-2.8,2.8-2.8s2.8,1.3,2.8,2.8s-1.3,2.8-2.8,2.8\n        c-0.2,0-0.4,0-0.6-0.1l5.9,5.9c0.5-0.2,0.9-0.4,1.3-0.8\n        c0.7-0.7,1.1-1.6,1.1-2.5V7.4c0-1-0.4-1.9-1.1-2.5c-0.7-0.7-1.6-1-2.5-1\n        H8.1 L17.6,13.4z"/>\n        <path d="M10.1,14.2c-0.5,0.9-1.4,1.4-2.4,1.4c-1.6,0-2.8-1.3-2.8-2.8c0-1.1,0.6-2,1.4-2.5\n        L0.9,5.1 C0.3,5.7,0,6.6,0,7.5v10.7c0,1,0.4,1.8,1.1,2.5c0.7,0.7,1.6,1,2.5,1\n        h5c0.7,0,1.3-0.1,1.8-0.5c0.6-0.3,1-0.8,1.3-1.4l1.3-2.6 L10.1,14.2z"/>\n        <path d="M25.5,27.5l-25-25C-0.1,2-0.1,1,0.5,0.4l0,0C1-0.1,2-0.1,2.6,0.4l25,25c0.6,0.6,0.6,1.5\n        ,0,2.1l0,0 C27,28.1,26,28.1,25.5,27.5z"/>\n    </svg>`},Si=(e,t=18)=>{const i=e.height,n=e.background?e.background:e.color,o=e.cssprefix;let s;return s="round"==e.corners?e.height/2:"square"==e.corners?2:e.corners,`\n    @font-face {\n        font-family: 'Karla';\n        font-style: normal;\n        font-weight: 400;\n        src: local('Karla'), local('Karla-Regular'),\n             url(https://fonts.gstatic.com/s/karla/v5/31P4mP32i98D9CEnGyeX9Q.woff2) format('woff2');\n        unicode-range: U+0100-024F, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF;\n    }\n    @font-face {\n        font-family: 'Karla';\n        font-style: normal;\n        font-weight: 400;\n        src: local('Karla'), local('Karla-Regular'),\n             url(https://fonts.gstatic.com/s/karla/v5/Zi_e6rBgGqv33BWF8WTq8g.woff2) format('woff2');\n        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074,\n                       U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;\n    }\n\n    button.${o}-button {\n        font-family: 'Karla', sans-serif;\n\n        border: ${n} 2px solid;\n        border-radius: ${s}px;\n        box-sizing: border-box;\n        background: ${e.background?e.background:"none"};\n\n        height: ${i}px;\n        min-width: ${9.6*t}px;\n        display: inline-block;\n        position: relative;\n\n        cursor: pointer;\n        transition: border 0.5s;\n    }\n\n    button.${o}-button:focus {\n      outline: none;\n    }\n\n    /*\n    * Logo\n    */\n\n    .${o}-logo {\n        width: ${i}px;\n        height: ${i}px;\n        position: absolute;\n        top:0px;\n        left:0px;\n        width: ${i-4}px;\n        height: ${i-4}px;\n    }\n    .${o}-svg {\n        fill: ${e.color};\n        margin-top: ${(i-.8*t)/2-2}px;\n        margin-left: ${i/3}px;\n    }\n    .${o}-svg-error {\n        fill: ${e.color};\n        display:none;\n        margin-top: ${(i-28/18*t*.8)/2-2}px;\n        margin-left: ${i/3}px;\n    }\n\n\n    /*\n    * Title\n    */\n\n    .${o}-title {\n        color: ${e.color};\n        position: relative;\n        font-size: ${t}px;\n        padding-left: ${1.05*i}px;\n        padding-right: ${s-10<5?i/3:s-10}px;\n        transition: color 0.5s;\n    }\n\n    /*\n    * disabled\n    */\n\n    button.${o}-button[disabled=true] {\n        opacity: ${e.disabledOpacity};\n    }\n\n    button.${o}-button[disabled=true] > .${o}-logo > .${o}-svg {\n        display:none;\n    }\n\n    button.${o}-button[disabled=true] > .${o}-logo > .${o}-svg-error {\n        display:initial;\n    }\n\n    /*\n    * error\n    */\n\n    button.${o}-button[error=true] {\n        animation: errorShake 0.4s;\n    }\n\n    @keyframes errorShake {\n      0% { transform: translate(1px, 0) }\n      10% { transform: translate(-2px, 0) }\n      20% { transform: translate(2px, 0) }\n      30% { transform: translate(-2px, 0) }\n      40% { transform: translate(2px, 0) }\n      50% { transform: translate(-2px, 0) }\n      60% { transform: translate(2px, 0) }\n      70% { transform: translate(-2px, 0) }\n      80% { transform: translate(2px, 0) }\n      90% { transform: translate(-1px, 0) }\n      100% { transform: translate(0px, 0) }\n    }\n  `};class Ti{constructor(e){(e=e||{}).color=e.color||"rgb(80,168,252)",e.background=e.background||!1,e.disabledOpacity=e.disabledOpacity||.5,e.height=e.height||55,e.corners=e.corners||"square",e.cssprefix=e.cssprefix||"webvr-ui",e.textEnterXRTitle=e.textEnterXRTitle||"ENTER VR",e.textXRNotFoundTitle=e.textXRNotFoundTitle||"VR NOT FOUND",e.textExitXRTitle=e.textExitXRTitle||"EXIT VR",e.onRequestSession=e.onRequestSession||function(){},e.onEndSession=e.onEndSession||function(){},e.injectCSS=!1!==e.injectCSS,this.options=e,this._enabled=!1,this.session=null,this.domElement=e.domElement||bi(e),this.__defaultDisplayStyle=this.domElement.style.display||"initial",this.domElement.addEventListener("click",(()=>this.__onXRButtonClick())),this.__forceDisabled=!1,this.__setDisabledAttribute(!0),this.setTitle(this.options.textXRNotFoundTitle)}set enabled(e){return this._enabled=e,this.__updateButtonState(),this}get enabled(){return this._enabled}setSession(e){return this.session=e,this.__updateButtonState(),this}setTitle(e){return this.domElement.title=e,Mi(this.domElement,this.options.cssprefix,"title",(t=>{e?(t.innerText=e,t.style.display="initial"):t.style.display="none"})),this}setTooltip(e){return this.domElement.title=e,this}show(){return this.domElement.style.display=this.__defaultDisplayStyle,this}hide(){return this.domElement.style.display="none",this}enable(){return this.__setDisabledAttribute(!1),this.__forceDisabled=!1,this}disable(){return this.__setDisabledAttribute(!0),this.__forceDisabled=!0,this}remove(){this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement)}__setDisabledAttribute(e){e||this.__forceDisabled?this.domElement.setAttribute("disabled","true"):this.domElement.removeAttribute("disabled")}__onXRButtonClick(){if(this.session)this.options.onEndSession(this.session);else if(this._enabled){let e=this.options.onRequestSession();e&&e.catch((e=>{let t=`XRSession creation failed: ${e.message}`;this.setTooltip(t),console.error(t),this.__setDisabledAttribute(!0),this.domElement.setAttribute("error","true"),setTimeout((()=>{this.__setDisabledAttribute(!1),this.domElement.setAttribute("error","false")}),1e3)}))}}__updateButtonState(){this.session?(this.setTitle(this.options.textExitXRTitle),this.setTooltip("Exit XR presentation"),this.__setDisabledAttribute(!1)):this._enabled?(this.setTitle(this.options.textEnterXRTitle),this.setTooltip("Enter XR"),this.__setDisabledAttribute(!1)):(this.setTitle(this.options.textXRNotFoundTitle),this.setTooltip("No XR headset found."),this.__setDisabledAttribute(!0))}}const Mi=(e,t,i,n)=>{const o=e.querySelector("."+t+"-"+i);o&&n(o)},Pi=1e-6;let ki="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function Oi(){let e=new ki(3);return ki!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Ri(e,t,i){let n=new ki(3);return n[0]=e,n[1]=t,n[2]=i,n}function Ai(e,t){let i=t[0],n=t[1],o=t[2],s=i*i+n*n+o*o;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e}function Ii(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Li(e,t,i){let n=t[0],o=t[1],s=t[2],a=i[0],r=i[1],l=i[2];return e[0]=o*l-s*r,e[1]=s*a-n*l,e[2]=n*r-o*a,e}const Di=function(e){let t=e[0],i=e[1],n=e[2];return Math.sqrt(t*t+i*i+n*n)};!function(){let e=Oi()}();!function(){let e=function(){let e=new ki(4);return ki!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}()}();function Ni(){let e=new ki(4);return ki!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Ui(e,t,i){i*=.5;let n=t[0],o=t[1],s=t[2],a=t[3],r=Math.sin(i),l=Math.cos(i);return e[0]=n*l+a*r,e[1]=o*l+s*r,e[2]=s*l-o*r,e[3]=a*l-n*r,e}function Vi(e,t,i){i*=.5;let n=t[0],o=t[1],s=t[2],a=t[3],r=Math.sin(i),l=Math.cos(i);return e[0]=n*l-s*r,e[1]=o*l+a*r,e[2]=s*l+n*r,e[3]=a*l-o*r,e}function zi(e,t,i,n){let o,s,a,r,l,c=t[0],h=t[1],d=t[2],u=t[3],p=i[0],_=i[1],m=i[2],g=i[3];return s=c*p+h*_+d*m+u*g,s<0&&(s=-s,p=-p,_=-_,m=-m,g=-g),1-s>Pi?(o=Math.acos(s),a=Math.sin(o),r=Math.sin((1-n)*o)/a,l=Math.sin(n*o)/a):(r=1-n,l=n),e[0]=r*c+l*p,e[1]=r*h+l*_,e[2]=r*d+l*m,e[3]=r*u+l*g,e}const Fi=function(e,t){let i=t[0],n=t[1],o=t[2],s=t[3],a=i*i+n*n+o*o+s*s;return a>0&&(a=1/Math.sqrt(a),e[0]=i*a,e[1]=n*a,e[2]=o*a,e[3]=s*a),e};(function(){let e=Oi(),t=Ri(1,0,0),i=Ri(0,1,0)})(),function(){let e=Ni(),t=Ni()}(),function(){let e=function(){let e=new ki(9);return ki!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}()}();!function(){let e=function(){let e=new ki(2);return ki!=Float32Array&&(e[0]=0,e[1]=0),e}()}();const Bi=.0025;class ji{constructor(e,t){let i,n,o;this.lookYaw=0,this.lookPitch=0,this.viewerHeight=0,this.canvas=e,this.baseRefSpace=t,this.refSpace=t,this.dirty=!1,e.style.cursor="grab",e.addEventListener("mousemove",(e=>{1&e.buttons&&this.rotateView(e.movementX,e.movementY)})),e.addEventListener("touchstart",(e=>{if(null==i){let t=e.changedTouches[0];i=t.identifier,n=t.pageX,o=t.pageY}})),e.addEventListener("touchend",(e=>{for(let t of e.changedTouches)i==t.identifier&&(i=void 0,this.rotateView(t.pageX-n,t.pageY-o))})),e.addEventListener("touchcancel",(e=>{for(let t of e.changedTouches)i==t.identifier&&(i=void 0)})),e.addEventListener("touchmove",(e=>{for(let t of e.changedTouches)i==t.identifier&&(this.rotateView(t.pageX-n,t.pageY-o),n=t.pageX,o=t.pageY)}))}setHeight(e){this.viewerHeight!=e&&(this.viewerHeight=e),this.dirty=!0}rotateView(e,t){this.lookYaw+=e*Bi,this.lookPitch+=t*Bi,this.lookPitch<.5*-Math.PI&&(this.lookPitch=.5*-Math.PI),this.lookPitch>.5*Math.PI&&(this.lookPitch=.5*Math.PI),this.dirty=!0}reset(){this.lookYaw=0,this.lookPitch=0,this.refSpace=this.baseRefSpace,this.dirty=!1}get referenceSpace(){if(this.dirty){let e=Ni();Ui(e,e,-this.lookPitch),Vi(e,e,-this.lookYaw);let t=new XRRigidTransform({},{x:e[0],y:e[1],z:e[2],w:e[3]});this.refSpace=this.baseRefSpace.getOffsetReferenceSpace(t),t=new XRRigidTransform({y:-this.viewerHeight}),this.refSpace=this.refSpace.getOffsetReferenceSpace(t),this.dirty=!1}return this.refSpace}}let Hi="undefined"!=typeof Float32Array?Float32Array:Array;Math.PI;function Qi(){let e=new Hi(3);return Hi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Xi(e,t,i){let n=new Hi(3);return n[0]=e,n[1]=t,n[2]=i,n}function Yi(e,t){let i=t[0],n=t[1],o=t[2],s=i*i+n*n+o*o;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e}function qi(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Zi(e,t,i){let n=t[0],o=t[1],s=t[2],a=i[0],r=i[1],l=i[2];return e[0]=o*l-s*r,e[1]=s*a-n*l,e[2]=n*r-o*a,e}const Ki=function(e){let t=e[0],i=e[1],n=e[2];return Math.sqrt(t*t+i*i+n*n)};!function(){let e=Qi()}();!function(){let e=function(){let e=new Hi(4);return Hi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}()}();function Ji(){let e=new Hi(4);return Hi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Gi(e,t,i,n){let o,s,a,r,l,c=t[0],h=t[1],d=t[2],u=t[3],p=i[0],_=i[1],m=i[2],g=i[3];return s=c*p+h*_+d*m+u*g,s<0&&(s=-s,p=-p,_=-_,m=-m,g=-g),1-s>1e-6?(o=Math.acos(s),a=Math.sin(o),r=Math.sin((1-n)*o)/a,l=Math.sin(n*o)/a):(r=1-n,l=n),e[0]=r*c+l*p,e[1]=r*h+l*_,e[2]=r*d+l*m,e[3]=r*u+l*g,e}const Wi=function(e,t){let i=t[0],n=t[1],o=t[2],s=t[3],a=i*i+n*n+o*o+s*s;return a>0&&(a=1/Math.sqrt(a),e[0]=i*a,e[1]=n*a,e[2]=o*a,e[3]=s*a),e},$i=(function(){let e=Qi(),t=Xi(1,0,0),i=Xi(0,1,0)}(),function(){let e=Ji(),t=Ji()}(),function(){let e=function(){let e=new Hi(9);return Hi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}()}(),Xi(.155,-.465,-.15),Xi(-.155,-.465,-.15),Xi(0,0,-.25),Xi(0,0,.05),Xi(-.08,.14,.08),180/Math.PI);function en(e,t,i){!function(e,t,i){function n(e,t,i){return e<t?t:e>i?i:e}var o=t[0]*t[0],s=t[1]*t[1],a=t[2]*t[2],r=t[3]*t[3];if("XYZ"===i)e[0]=Math.atan2(2*(t[0]*t[3]-t[1]*t[2]),r-o-s+a),e[1]=Math.asin(n(2*(t[0]*t[2]+t[1]*t[3]),-1,1)),e[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),r+o-s-a);else if("YXZ"===i)e[0]=Math.asin(n(2*(t[0]*t[3]-t[1]*t[2]),-1,1)),e[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),r-o-s+a),e[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),r-o+s-a);else if("ZXY"===i)e[0]=Math.asin(n(2*(t[0]*t[3]+t[1]*t[2]),-1,1)),e[1]=Math.atan2(2*(t[1]*t[3]-t[2]*t[0]),r-o-s+a),e[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),r-o+s-a);else if("ZYX"===i)e[0]=Math.atan2(2*(t[0]*t[3]+t[2]*t[1]),r-o-s+a),e[1]=Math.asin(n(2*(t[1]*t[3]-t[0]*t[2]),-1,1)),e[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),r+o-s-a);else if("YZX"===i)e[0]=Math.atan2(2*(t[0]*t[3]-t[2]*t[1]),r-o+s-a),e[1]=Math.atan2(2*(t[1]*t[3]-t[0]*t[2]),r+o-s-a),e[2]=Math.asin(n(2*(t[0]*t[1]+t[2]*t[3]),-1,1));else{if("XZY"!==i)return void console.log("No order given for quaternion to euler conversion.");e[0]=Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),r-o+s-a),e[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),r+o-s-a),e[2]=Math.asin(n(2*(t[2]*t[3]-t[0]*t[1]),-1,1))}}(e,t,i),e[0]*=$i,e[1]*=$i,e[2]*=$i}function tn(){let e=!1;var t;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e}function nn(e){switch(e.keyCode){case 37:case 39:case 38:case 40:e.preventDefault()}}function on(e){return void 0!==e.asset.extras&&(null===e.asset.extras||!0===e.asset.extras.ion.georeferenced)}function sn(e){let t=document.querySelector(".cesium-viewer-cesium3DTilesInspectorContainer");t.style.display=e?"block":"none"}function an(e,t){let i=e.camera,n={};return n.offsetX=i.position.x-t.boundingSphere.center.x,n.offsetY=i.position.y-t.boundingSphere.center.y,n.offsetZ=i.position.z-t.boundingSphere.center.z,n.heading=Cesium.Math.toDegrees(i.heading),n.pitch=Cesium.Math.toDegrees(i.pitch),n.roll=Cesium.Math.toDegrees(i.roll),JSON.stringify(n)}function rn(e,t){e.scene.globe.show=t,e.scene.skyAtmosphere.show=t,e.scene.skyBox.show=t,e.scene.moon.show=t,e.scene.sun.show=t,e.scene.backgroundColor=t?Cesium.Color.BLACK.clone():Cesium.Color.fromCssColorString(CONSTRUKTED_AJAX.bg_color_css_string)}function ln(e){e.screenSpaceCameraController.enableRotate=!1,e.screenSpaceCameraController.enableTranslate=!1,e.screenSpaceCameraController.enableZoom=!1,e.screenSpaceCameraController.enableTilt=!1,e.screenSpaceCameraController.enableLook=!1}function cn(e){e.screenSpaceCameraController.enableRotate=!0,e.screenSpaceCameraController.enableTranslate=!0,e.screenSpaceCameraController.enableZoom=!0,e.screenSpaceCameraController.enableTilt=!0,e.screenSpaceCameraController.enableLook=!0}function hn(e,t){if(!t.longitude||!t.latitude||!t.height)return console.warn("invalid asset geo location!"),void console.warn(CONSTRUKTED_AJAX.asset_geo_location);t.longitude=parseFloat(t.longitude),t.latitude=parseFloat(t.latitude),t.height=parseFloat(t.height),t.heading=parseFloat(t.heading),t.pitch=parseFloat(t.pitch),t.roll=parseFloat(t.roll);let i=new Cesium.Cartographic(Cesium.Math.toRadians(t.longitude),Cesium.Math.toRadians(t.latitude),t.height);!function(e,t){let i=t.position,n=new Cesium.Cartesian3(i.x,i.y,i.z),o=t.headingPitchRoll,s=new Cesium.HeadingPitchRoll(o.heading,o.pitch,o.roll),a=t.scale,r=new Cesium.Cartesian3(a.x,a.y,a.z),l=Cesium.Transforms.headingPitchRollToFixedFrame(n,s);e.modelMatrix=Cesium.Matrix4.setScale(l,r,new Cesium.Matrix4)}(e,{position:Cesium.Ellipsoid.WGS84.cartographicToCartesian(i),headingPitchRoll:{heading:Cesium.Math.toRadians(t.heading),pitch:Cesium.Math.toRadians(t.pitch),roll:Cesium.Math.toRadians(t.roll)},scale:t.scale})}let dn,un=null;const pn=tn();let _n=null;function mn(e,t){let i=t.session,n=i.isImmersive?_n:dn.referenceSpace,o=t.getViewerPose(n);if(o){let e=CONSTRUKTEDXR.create$1(),t=o.transform.orientation;CONSTRUKTEDXR.eulerFromQuaternionDegree(e,[t.x,t.y,t.z,t.w],"YXZ");new CustomEvent("viewerPoseUpdatedEvent",{detail:{posX:o.transform.position.x,posY:o.transform.position.y,posZ:o.transform.position.z,rotX:-e[1],rotY:e[0],rotZ:e[2]}});pn&&function(e,t,i,n,o,s){const a=window.construktedAssetViewer.fpvController();a&&a.started()&&a.setView(1*e,1*t,1*i,n,o,s)}(o.transform.position.x,o.transform.position.y,o.transform.position.z,-e[1],e[0],e[2])}i.requestAnimationFrame(mn);let s=i.renderState.baseLayer;un.bindFramebuffer(un.FRAMEBUFFER,s.framebuffer)}function gn(e){e.addEventListener("end",vn);const t=window.construktedAssetViewer.fpvController();if(e.isImmersive)if(t.started())jQuery(".ck-view-mobile-selector").hide();else{if(null==t.startFPVPositionMobile())return alert("Please tap on 3d tile to start FPV!"),void t.setAllowStartPositionTap(!0);t.startFPVMobile(),jQuery(".ck-view-mobile-selector").hide()}un=function(e){e=e||{alpha:!1};let t=document.getElementById("xr-canvas"),i=e.webgl2?["webgl2"]:["webgl","experimental-webgl"],n=null;for(let o of i)if(n=t.getContext(o,e),n)break;if(!n){let t=e.webgl2?"WebGL 2":"WebGL";return console.error("This browser does not support "+t+"."),null}return n}({xrCompatible:!0}),e.updateRenderState({baseLayer:new XRWebGLLayer(e,un)});let i=e.isImmersive?"local":"viewer";e.requestReferenceSpace(i).then((t=>{e.isImmersive?_n=t:dn=new CONSTRUKTEDXR.InlineViewerHelper(un.canvas,t),e.requestAnimationFrame(mn)})),jQuery("#overlay-content").addClass("full-overlay")}function fn(){let e=document.getElementById("overlay-content");const t=window.construktedAssetViewer.xrButton();return navigator.xr.requestSession("immersive-ar",{optionalFeatures:["dom-overlay","dom-overlay-for-handheld-ar"],domOverlay:{root:e}}).then((e=>{t.setSession(e),e.isImmersive=!0,gn(e)}))}function Cn(e){e.end(),jQuery(".ck-view-mobile-selector").show(),jQuery("#overlay-content").removeClass("full-overlay")}function vn(e){const t=window.construktedAssetViewer.xrButton();e.session.isImmersive&&t.setSession(null)}function yn(){jQuery(".webvr-ui-button, #xr-canvas").toggle(),jQuery("#overlay-content").toggleClass("full-overlay")}const wn=88;function bn(e){return e>176&&e<272?e=272:e>wn&&e<272&&(e=wn),e}class En{constructor(e){this._isMobile=e.isMobile,this._enabled=!1,this._cesiumViewer=e.cesiumViewer,this._canvas=this._cesiumViewer.canvas,this._camera=this._cesiumViewer.camera,this._speed=1,this._leftButtonPressed=!1,this._cameraHeadingWhenLbuttonPressed=this._camera.heading,this._cameraPitchWhenLbuttonPressed=this._camera.pitch,this._startMousePosition=null,this._screenSpaceEventHandler=new Cesium.ScreenSpaceEventHandler(this._canvas),this._screenSpaceEventHandler.setInputAction(this._onMouseLButtonDoubleClicked.bind(this),Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this._screenSpaceEventHandler.setInputAction(this._onMouseLButtonClicked.bind(this),Cesium.ScreenSpaceEventType.LEFT_DOWN),this._screenSpaceEventHandler.setInputAction(this._onMouseUp.bind(this),Cesium.ScreenSpaceEventType.LEFT_UP)}_onMouseLButtonDoubleClicked(e){}_onMouseLButtonClicked(e){this._isMobile&&(this._lastTapedPosition=e.position),null==this._startFPVPositionMobile&&this._allowStartPositionTap&&(this._startFPVPositionMobile=e.position.clone()),this._leftButtonPressed=!0,this._cameraHeadingWhenLbuttonPressed=this._camera.heading,this._cameraPitchWhenLbuttonPressed=this._camera.pitch,this._startMousePosition=e.position.clone()}_onMouseUp(e){this._leftButtonPressed=!1}_onMouseMove(e){this._leftButtonPressed&&this._changeCameraHeadingPitch(e.endPosition)}_changeCameraHeadingPitch(e){const t=this._canvas.clientWidth,i=this._canvas.clientHeight,n=-60*((e.x-this._startMousePosition.x)/t),o=-35*(-(e.y-this._startMousePosition.y)/i);this._camera.setView({orientation:{heading:this._cameraHeadingWhenLbuttonPressed+Cesium.Math.toRadians(n),pitch:bn(this._cameraPitchWhenLbuttonPressed+Cesium.Math.toRadians(o)),roll:this._camera.roll}})}get speed(){return this._speed}set speed(e){this._speed=e}}const xn=1.65;let Sn,Tn=new Cesium.Cartesian3;class Mn extends En{constructor(e){super(e),this._FPVStarted=new Cesium.Event,this._FPVFinished=new Cesium.Event,this._direction=-1,this._main3dTileset=e.main3dTileset,this._defaultCameraPositionOrientationJson=e.defaultCameraPositionOrientationJson,this._ignoreCollisionDetection=!!Cesium.defined(e.ignoreCollisionDetection)&&e.ignoreCollisionDetection,this._frameMonitor=Cesium.FrameRateMonitor.fromScene(this._cesiumViewer.scene),this._screenSpaceEventHandler=new Cesium.ScreenSpaceEventHandler(this._canvas),this._screenSpaceEventHandler.setInputAction(this._onMouseLButtonDoubleClicked.bind(this),Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this._screenSpaceEventHandler.setInputAction(this._onMouseLButtonClicked.bind(this),Cesium.ScreenSpaceEventType.LEFT_DOWN),this._screenSpaceEventHandler.setInputAction(this._onMouseUp.bind(this),Cesium.ScreenSpaceEventType.LEFT_UP),this._startFPVPositionMobile=null,this._lastTranslationX=0,this._lastTranslationY=0,this._lastTranslationZ=0,this._lastRotationX=0,this._lastRotationY=0,this._lastRotaionZ=0,this._allowStartPositionTap=!1,this._walkingSpeed=.5,this._immersiveArEnabled=e.immersiveArEnabled,this._canStart=!1}setAllowStartPositionTap(e){this._allowStartPositionTap=e}_connectEventHandlers(){const e=this._cesiumViewer.canvas;this._screenSpaceEventHandler.setInputAction(this._onMouseMove.bind(this),Cesium.ScreenSpaceEventType.MOUSE_MOVE),e.setAttribute("tabindex","0"),e.onclick=function(){e.focus()};const t=this;this._onKeyDownCallback=function(e){t._onKeyDown(e)},this._onKeyUpCallback=function(e){t._onKeyUp(e)},document.addEventListener("keydown",this._onKeyDownCallback),document.addEventListener("keyup",this._onKeyUpCallback),this._disconectOnClockTick=this._cesiumViewer.clock.onTick.addEventListener(Mn.prototype._onClockTick,this)}_disconnectEventHandlers(){this._screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),document.removeEventListener("keydown",this._onKeyDownCallback),document.removeEventListener("keyup",this._onKeyUpCallback),this._disconectOnClockTick()}_doStartFPV(e){this._canStart=!1;const t=this._cesiumViewer.scene.globe,i=this;this._camera.flyTo({destination:t.ellipsoid.cartographicToCartesian(e),orientation:{heading:this._camera.heading,pitch:0,roll:0},complete:function(){ln(i._cesiumViewer.scene),i._connectEventHandlers(),i._cameraDirectionAtArStartedMoment=i._camera.direction.clone(),i._cameraRightAtArStartedMoment=i._camera.right.clone(),i._cameraUpAtArStartedMoment=i._camera.up.clone(),i._cameraPositionAtArStartedMoment=i._camera.position.clone(new Cesium.Cartesian3),i._cameraHeadingAtArStartedMoment=i._camera.heading,i._cameraPitchAtArStartedMoment=i._camera.pitch,i._FPVStarted.raiseEvent(),i._enabled=!0}})}exitFPV(){cn(this._cesiumViewer.scene),this._disconnectEventHandlers(),this._startFPVPositionMobile=null,this._allowStartPositionTap=!1,this._FPVFinished.raiseEvent(),this._enabled=!1}_onKeyDown(e){e.shiftKey?this.speed=3:this.speed=1;const t=e.keyCode;switch(this._direction=-1,t){case"W".charCodeAt(0):case 38:return void(this._direction=0);case"S".charCodeAt(0):case 40:return void(this._direction=1);case"D".charCodeAt(0):case 39:return void(this._direction=3);case"A".charCodeAt(0):case 37:return void(this._direction=2);case 90:return void(this._main3dTileset&&(this._main3dTileset.show=!this._main3dTileset.show));default:return}}_onKeyUp(){this._direction=-1}_getPickedCartographic(e){this._isMobile&&(e=this._lastTapedPosition);const t=this._cesiumViewer.scene;let i=t.globe;i.depthTestAgainstTerrain=!0;const n=t.camera.getPickRay(e),o=t.pickFromRay(n);if(!o)return console.warn("pickFromRay failed!"),null;const s=i.ellipsoid.cartesianToCartographic(o.position);if(i.show){const e=i.getHeight(s);if(void 0===e)return console.warn("globe.getHeight(cartographic) failed!"),null;if(Cesium.Math.equalsEpsilon(s.height,e,Cesium.Math.EPSILON4,Cesium.Math.EPSILON1))return console.warn("out of 3d tile!"),null}return s.height<0&&console.warn("height is negative"),s.height=s.height+xn,s}_onMouseLButtonDoubleClicked(e){const t=this._getPickedCartographic(e.position);if(this._enabled){if(!t)return;const e=this._cesiumViewer.scene.globe;this._camera.flyTo({destination:e.ellipsoid.cartographicToCartesian(t),orientation:{heading:this._camera.heading,pitch:0,roll:0}})}else this._canStart&&(t?this._doStartFPV(t):alert("Unfortunately failed to enter FPV!"))}_getCurrentCameraPositionAtCollisionHeight(){const e=this._camera.position,t=Cesium.Cartesian3.magnitude(e),i=(t-xn+.5)/t;return Cesium.Cartesian3.multiplyByScalar(e,i,new Cesium.Cartesian3)}_getRayPosition(){let e=this._camera.position,t=Cesium.Cartesian3.magnitude(e),i=(t-xn+.5)/t,n=new Cesium.Cartesian3;return Cesium.Cartesian3.multiplyByScalar(e,i,n)}_changeCameraPosition(e){0===this._direction?Cesium.Cartesian3.multiplyByScalar(this._camera.direction,1,Tn):1===this._direction?Cesium.Cartesian3.multiplyByScalar(this._camera.direction,-1,Tn):2===this._direction?Cesium.Cartesian3.multiplyByScalar(this._camera.right,-1,Tn):3===this._direction&&Cesium.Cartesian3.multiplyByScalar(this._camera.right,1,Tn);let t=this._fpsConsideredWalkingSpeed()*this.speed*e,i=Cesium.Cartesian3.multiplyByScalar(Tn,t,new Cesium.Cartesian3),n=this._getRayPosition(),o=Cesium.Cartesian3.add(n,i,new Cesium.Cartesian3),s=Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(o,n,new Cesium.Cartesian3),new Cesium.Cartesian3),a=new Cesium.Ray(n,s),r=this._cesiumViewer.scene.pickFromRay(a);if(Cesium.defined(r)){return Cesium.Cartesian3.distanceSquared(n,r.position)>t?void this._setCameraPosition(o):void 0}this._setCameraPosition(o)}_setCameraPosition(e){let t=this._cesiumViewer.scene.globe.ellipsoid,i=t.cartesianToCartographic(e);i.height=0;let n=this._cesiumViewer.scene.sampleHeight(i),o=t.cartesianToCartographic(this._camera.position);void 0!==n?(n<0&&console.warn("sampled height is negative"),n>o.height?i.height=o.height:i.height=n+xn,this._camera.setView({destination:t.cartographicToCartesian(i),orientation:new Cesium.HeadingPitchRoll(this._camera.heading,this._camera.pitch,this._camera.roll),endTransform:Cesium.Matrix4.IDENTITY})):console.warn("sampled height is undefined")}_canMove(e,t,i){if(this._ignoreCollisionDetection)return!0;const n=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3);let o=new Cesium.Ray(e,n);const s=this._cesiumViewer.scene.pickFromRay(o);if(Cesium.defined(s)){return Cesium.Cartesian3.distanceSquared(e,s.position)>=i}return!0}_getRevisedCameraPosition(e){const t=this._cesiumViewer.scene,i=t.globe.ellipsoid,n=i.cartesianToCartographic(e),o=t.sampleHeight(n),s=i.cartesianToCartographic(this._camera.position);return void 0===o?(console.warn("heightAtTargetPosition is undefined"),n.height=s.height,i.cartographicToCartesian(n)):o<0?(console.warn("heightAtTargetPosition is negative"),n.height=s.height,i.cartographicToCartesian(n)):(o>s.height?n.height=s.height:n.height=o+xn,i.cartographicToCartesian(n))}_onClockTick(e){const t=e._clockStep;-1!==this._direction&&this._changeCameraPosition(t)}started(){return this._enabled}getViewData(){const e=this._cesiumViewer.camera,t=this._cesiumViewer.scene.globe.ellipsoid.cartesianToCartographic(e.position),i={};return i.longitude=t.longitude,i.latitude=t.latitude,i.height=t.height,i.heading=e.heading,i.pitch=e.pitch,i.roll=e.roll,JSON.stringify(i)}_fpsConsideredWalkingSpeed(){const e=this._frameMonitor.lastFramesPerSecond,t=this._walkingSpeed;if(void 0===e)return t;return 30*t/e}FPVStarted(){return this._FPVStarted}FPVFinished(){return this._FPVFinished}startFPVMobile(){this._doStartFPV(this._startFPVPositionMobile)}_getModifiedCurrentCameraPositionMobile(){const e=this._cameraPositionAtArStartedMoment,t=Cesium.Cartesian3.magnitude(e),i=(t-xn+.5)/t;return Cesium.Cartesian3.multiplyByScalar(e,i,new Cesium.Cartesian3)}setView(e,t,i,n,o,s){if(e==this._lastTranslationX&&i==this._lastTranslationZ&&n==this._lastRotationX&&o==this._lastRotationY)return;let a;const r=Cesium.Cartesian3.multiplyByScalar(this._cameraRightAtArStartedMoment,e,new Cesium.Cartesian3),l=Cesium.Cartesian3.multiplyByScalar(this._cameraDirectionAtArStartedMoment,-i,new Cesium.Cartesian3);Cesium.Cartesian3.multiplyByScalar(this._cameraUpAtArStartedMoment,t,new Cesium.Cartesian3);let c=Cesium.Cartesian3.add(r,l,new Cesium.Cartesian3);if(c.equals(Cesium.Cartesian3.ZERO))a=this._cameraPositionAtArStartedMoment.clone();else{const e=this._getModifiedCurrentCameraPositionMobile(),t=Cesium.Cartesian3.add(e,c,new Cesium.Cartesian3);this._canMove(e,t,Cesium.Cartesian3.magnitude(c))?a=this._getRevisedCameraPosition(t):(console.warn("collision detected. can not move!"),a=this._cameraPositionAtArStartedMoment.clone())}const h=Cesium.Math.toDegrees(this._cameraHeadingAtArStartedMoment)+n;let d=Cesium.Math.toDegrees(this._cameraPitchAtArStartedMoment)+o;d=bn(d),this._camera.setView({destination:a,orientation:{heading:Cesium.Math.toRadians(h),pitch:Cesium.Math.toRadians(d),roll:this._camera.roll},endTransform:Cesium.Matrix4.IDENTITY}),this._lastTranslationX=e,this._lastTranslationY=t,this._lastTranslationZ=i,this._lastRotationX=n,this._lastRotationY=o,this._lastRotationZ=s}startFPVPositionMobile(){return this._startFPVPositionMobile}setDirectionLeft(){this._direction=2}setDirectionRight(){this._direction=3}setDirectionForward(){this._direction=0}setDirectionBackward(){this._direction=1}setDirectionNone(){this._direction=-1}onDoubleTaped(e){this._onMouseLButtonDoubleClicked(e)}setWorkingSpeed(e){this._walkingSpeed=e}setImmersiveArEnabled(e){this._immersiveArEnabled=e}setCanStart(e){this._canStart=e}}function Pn(e){e.asset.extras&&e.asset.extras.ion.georeferenced?Rn({longitude:0,latitude:0,height:jQuery("#tileset_altitude").val(),heading:0,pitch:0,roll:0,scale:0}):kn()}function kn(){if(transformEditor&&transformEditor.active){On(transformEditor.viewModel.position,transformEditor.viewModel.headingPitchRoll,transformEditor.viewModel.scale)}else{let e=tileset.modelMatrix,t=Cesium.Matrix4.getTranslation(e,new Cesium.Cartesian3),i=viewer.scene;On(t,Cesium.Transforms.fixedFrameToHeadingPitchRoll(e,i.mapProjection.ellipsoid,void 0,new Cesium.HeadingPitchRoll),Cesium.Matrix4.getScale(e,new Cesium.Cartesian3))}}function On(e,t,i){let n=Cesium.Cartographic.fromCartesian(e);Rn({longitude:Cesium.Math.toDegrees(n.longitude).toFixed(8),latitude:Cesium.Math.toDegrees(n.latitude).toFixed(8),height:n.height.toFixed(8),heading:Cesium.Math.toDegrees(t.heading).toFixed(8),pitch:Cesium.Math.toDegrees(t.pitch).toFixed(8),roll:Cesium.Math.toDegrees(t.roll).toFixed(8),scale:i})}function Rn(e){let t=jQuery("#save_tileset_model_matrix_button");t.prop("disabled",!0),jQuery.ajax({url:CONSTRUKTED_AJAX.ajaxurl,type:"post",data:{action:"set_asset_geo_location_json",post_id:CONSTRUKTED_AJAX.post_id,asset_geo_location_json:JSON.stringify(e)},success:function(e){t.prop("disabled",!1),!1!==JSON.parse(e).ret?alert("Successfully updated!"):alert("Passed values is the same as the values that is already in the database!")},error:function(e,i,n){t.prop("disabled",!1),alert("error")}})}function An(e){const t=e.tileset(),i=e.fpvController(),n=e.flyController();jQuery("#capture_thumbnail").click((function(){!function(e){let t=jQuery("#capture_thumbnail");e.scene.requestRender(),e.render();let i=e.canvas.toDataURL("image/jpeg",.5);t.prop("disabled",!0),jQuery.ajax({url:CONSTRUKTED_AJAX.ajaxurl,type:"post",data:{action:"post_set_thumbnail",post_id:CONSTRUKTED_AJAX.post_id,capturedJpegImage:i},success:function(e){t.prop("disabled",!1),alert(e)},error:function(){t.prop("disabled",!1),alert("error")}})}()})),jQuery("#save_current_view").click((function(){!function(){let e=jQuery("#save_current_view");e.prop("disabled",!0),jQuery.ajax({url:CONSTRUKTED_AJAX.ajaxurl,type:"post",data:{action:"post_set_current_view",post_id:CONSTRUKTED_AJAX.post_id,view_data:an()},success:function(t){e.prop("disabled",!1),alert(t)},error:function(t,i,n){e.prop("disabled",!1),alert("error")}})}()})),jQuery("#reset_camera_view").click((function(){!function(){let e=jQuery("#reset_camera_view");e.prop("disabled",!0),jQuery.ajax({url:CONSTRUKTED_AJAX.ajaxurl,type:"post",data:{action:"post_reset_current_view",post_id:CONSTRUKTED_AJAX.post_id},success:function(t){e.prop("disabled",!1),alert(t)},error:function(t,i,n){e.prop("disabled",!1),alert("error")}})}()})),jQuery("#maximum-screen-space-error-slider").change((function(){t&&(t.maximumScreenSpaceError=32-this.value)})),jQuery("#fpv-movement-speed-slider").change((function(){t&&i&&(i.setWorkingSpeed(parseFloat(this.value)),n.setMoveRateFactor(parseFloat(this.value)))})),jQuery("#show-hide-wireframe-checkbox").change((function(){t&&(t.debugWireframe=this.checked)})),jQuery("#show-hide-tiles-inspector-checkbox").change((function(){t&&sn(this.checked)}));const o=jQuery("#fxaa-enable-checkbox");e.cesiumViewer().scene.postProcessStages.fxaa.enabled=o.is(":checked"),o.change((function(){e.cesiumViewer().scene.postProcessStages.fxaa.enabled=this.checked}))}function In(e){let t=e.measure.viewModel,i=t._measurements[7],n=t._measurements[1],o=t._measurements[2],s=t._measurements[6];function a(t,a){let r=' <div class="form-check">\n                                    <input class="form-check-input" type="checkbox" id="'+t+'" checked>\n                                    <label class="form-check-label" for="'+t+'">\n'+a+"                                    </label>\n                                </div>";$("#measurement-list").append(r),$("[id="+t+"]").change((function(){let a=t.split("-"),r=a[0],l=parseInt(a[1]);"point"===r&&c(i.measurementResult[l],this.checked),"distance"===r&&h(n.measurementResult[l],this.checked),"polyline"===r&&d(o.measurementResult[l],this.checked),"area"===r&&u(s.measurementResult[l],this.checked),e.scene.requestRender()}))}function r(){$("*[id*=measurement-tool-button]").each((function(){this.classList.remove("active")}))}function l(){$("#end-measurement").removeClass("disabled")}function c(e,t){e.point.show=t,e.label.show=t}function h(e,t){e.startPoint.show=t,e.endPoint.show=t,e.polyline.show=t,e.xyPolyline.show=t,e.xyBox.show=t,e.label.show=t,e.xLabel.show=t,e.xAngleLabel.show=t,e.yLabel.show=t,e.yAngleLabel.show=t}function d(e,t){e.label.show=t;for(let i=0;i<e.segmentLabels.length;i++)e.segmentLabels[i].show=t;e.polyline.show=t;for(let i=0;i<e.points.length;i++)e.points[i].show=t}function u(e,t){e.label.show=t,e.polygon.show=t,e.polyline.show=t;for(let i=0;i<e.points.length;i++)e.points[i].show=t}i.newMeasurement.addEventListener((function(e){console.log(e);let t=i.measurementResult[e];console.log(t),a("point-"+e,"Point "+e)})),n.newMeasurement.addEventListener((function(e){console.log(e);let t=n.measurementResult[e];console.log(t),a("distance-"+e,"Distance "+e)})),o.newMeasurement.addEventListener((function(e){console.log(e);let t=o.measurementResult[e];console.log(t),a("polyline-"+e,"Polyline "+e)})),s.newMeasurement.addEventListener((function(e){console.log(e);let t=s.measurementResult[e];console.log(t),a("area-"+e,"Area "+e)})),jQuery("#measurement-tool-button-component-distance").click((function(){r(),this.classList.add("active"),l(),t._activate(),t.selectedMeasurement=n})),jQuery("#measurement-tool-button-polyline").click((function(){r(),this.classList.add("active"),l(),t._activate(),t.selectedMeasurement=o})),jQuery("#measurement-tool-button-area").click((function(){r(),this.classList.add("active"),l(),t._activate(),t.selectedMeasurement=s})),jQuery("#measurement-tool-button-point").click((function(){r(),this.classList.add("active"),l(),t._activate(),t.selectedMeasurement=i})),$("#end-measurement").click((function(){r(),t._deactivate()})),$("#show-hide-all-measurement-checkbox").change((function(){let t=this.checked;!function(t){let a=i.measurementResult;for(let e=0;e<a.length;e++)c(a[e],t);let r=n.measurementResult;for(let e=0;e<r.length;e++)h(r[e],t);let l=o.measurementResult;for(let e=0;e<l.length;e++)d(l[e],t);let p=s.measurementResult;for(let e=0;e<p.length;e++)u(p[e],t);e.scene.requestRender()}(t),$("*[id*=measurement-result]").each((function(){this.checked=t,console.log(this.id)}))})),$("#end-measurement").click((function(){r(),t._deactivate()}))}function Ln(e,t,i){let n=jQuery("#tileset_latitude"),o=jQuery("#tileset_longitude"),s=jQuery("#tileset_altitude"),a=jQuery("#tileset_estimate_altitude"),r=jQuery("#save_tileset_model_matrix_button"),l=new Cesium.Quaternion,c=new Cesium.Quaternion,h=new Cesium.Cartesian3,d=new Cesium.Cartesian3,u=new Cesium.Cartesian3,p=new Cesium.Matrix4,_=new Cesium.Matrix3;function m(e,i){let n=t.modelMatrix;n=Cesium.Matrix4.setTranslation(n,e,n),function(e,t){Cesium.Check.defined("transform",e),Cesium.Check.defined("headingPitchRoll",t);let i=Cesium.Quaternion.fromHeadingPitchRoll(t,l),n=Cesium.Matrix4.getTranslation(e,h),o=Cesium.Matrix4.getScale(e,d),s=Cesium.Matrix4.multiplyByPoint(e,Cesium.Cartesian3.ZERO,u),a=Cesium.Transforms.eastNorthUpToFixedFrame(s,void 0,p),r=Cesium.Matrix4.getMatrix3(a,_),m=Cesium.Quaternion.fromRotationMatrix(r,c),g=Cesium.Quaternion.multiply(m,i,r);Cesium.Matrix4.fromTranslationQuaternionRotationScale(n,g,o,e)}(n,i)}function g(i){t.asset.extras&&t.asset.extras.ion.georeferenced?function(e){let i=originalBoundingSphereCenterHeight-e;t.modelMatrix=Cesium.Matrix4.fromTranslation(new Cesium.Cartesian3(0,0,i))}(i):function(i){let n=t.modelMatrix,o=Cesium.Matrix4.getTranslation(n,new Cesium.Cartesian3),s=Cesium.Cartographic.fromCartesian(o);s.height=i;let a=e.scene.globe.ellipsoid.cartographicToCartesian(s),r=e.scene,l=Cesium.Transforms.fixedFrameToHeadingPitchRoll(n,r.mapProjection.ellipsoid,void 0,new Cesium.HeadingPitchRoll);m(a,l)}(i)}CONSTRUKTED_AJAX.asset_geo_location?(Sn=CONSTRUKTED_AJAX.asset_geo_location,Sn.longitude&&Sn.latitude&&Sn.height?(n.val(Sn.latitude),o.val(Sn.longitude),s.val(Sn.height),jQuery("#tileset_heading").val(Sn.heading)):(console.warn("invalid asset geo location!"),console.warn(CONSTRUKTED_AJAX.asset_geo_location))):(n.val(0),o.val(0),s.val(0),jQuery("#tileset_heading").val(0)),jQuery("#edit_asset_geo_location_button").click((function(){i&&i.viewModel.activate()})),r.click((function(){Pn()})),o.change((function(){let i=o.val();if(i=parseFloat(i),isNaN(i)||i>180||i<-180)return o.val(""),void alert("invalid longitude: "+i);rn(this._viewer,!0);let n=t.modelMatrix,s=Cesium.Matrix4.getTranslation(n,new Cesium.Cartesian3),a=Cesium.Cartographic.fromCartesian(s);a.longitude=i*Cesium.Math.RADIANS_PER_DEGREE;let r=e.scene.globe.ellipsoid.cartographicToCartesian(a),l=e.scene;m(r,Cesium.Transforms.fixedFrameToHeadingPitchRoll(n,l.mapProjection.ellipsoid,void 0,new Cesium.HeadingPitchRoll)),e.flyTo(t)})),n.change((function(){let i=n.val();if(i=parseFloat(i),isNaN(i)||i>90||i<-90)return n.val(""),void alert("invalid latitude: "+i);rn(e,!0);let o=t.modelMatrix,s=Cesium.Matrix4.getTranslation(o,new Cesium.Cartesian3),a=Cesium.Cartographic.fromCartesian(s);a.latitude=i*Cesium.Math.RADIANS_PER_DEGREE;let r=e.scene.globe.ellipsoid.cartographicToCartesian(a),l=e.scene;m(r,Cesium.Transforms.fixedFrameToHeadingPitchRoll(o,l.mapProjection.ellipsoid,void 0,new Cesium.HeadingPitchRoll)),e.flyTo(t)})),s.change((function(){let i=s.val();if(i=parseFloat(i),isNaN(i)||i>15e3||i<-1e3)return s.val(""),void alert("invalid altitude: "+i);rn(e,!0),g(i),e.zoomTo(t)})),jQuery("#tileset_heading").change((function(){let i=jQuery("#tileset_heading").val();if(i=parseFloat(i),isNaN(i)||i>180||i<-180)return jQuery("#tileset_heading").val(""),void alert("invalid heading: "+i);let n=t.modelMatrix,o=Cesium.Matrix4.getTranslation(n,new Cesium.Cartesian3),s=e.scene,a=Cesium.Transforms.fixedFrameToHeadingPitchRoll(n,s.mapProjection.ellipsoid,void 0,new Cesium.HeadingPitchRoll);a.heading=i*Cesium.Math.RADIANS_PER_DEGREE,m(o,a),e.zoomTo(t)})),jQuery("#tileset-transparency-slider").change((function(){let i=this.value;t.style=new Cesium.Cesium3DTileStyle({color:"rgba(255, 255, 255,"+i+")"}),e.scene.requestRender()})),a.click((function(){let i=o.val(),a=n.val();if(i=parseFloat(i),a=parseFloat(a),0===i&&0===a)return void alert("Please input valid Latitude and Longitude!");let r=e.scene.globe,l=new Cesium.Cartographic(Cesium.Math.toRadians(i),Cesium.Math.toRadians(a)),c=r.getHeight(l);void 0!==c?(s.val(c.toFixed(3)),g(c),e.zoomTo(t)):alert("failed to get height!")}))}const Dn={version:"1.2.4",testOnLocal:!1,testType:"AssetViewer",testSlug:"aucbzxw01n",release:!0};t(".construkted-viewer-controlbarContainer {\r\n    display: block;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 33px;\r\n    background-color: #384d68;\r\n\r\n    /*\r\n        override .airkit_single-post .featured-image, .page .featured-image\r\n        text-align center\r\n    */\r\n    text-align: left !important;\r\n}\r\n\r\n.construkted-viewer-controlbar-button {\r\n    background-color: rgba(60, 80, 105,.3);\r\n    border: 1px solid #fff;\r\n    color: #edffff;\r\n    border-radius: 5px;\r\n    padding: 3px 7px;\r\n    cursor: pointer;\r\n    -moz-user-select: none;\r\n    -webkit-user-select: none;\r\n    -ms-user-select: none;\r\n    user-select: none;\r\n    margin-top: 3px;\r\n    margin-left: 2px;\r\n    margin-right: 2px;\r\n}\r\n\r\n.construkted-viewer-controlbar-button:first-child {\r\n    margin-left: 20px;\r\n}");const Nn=Cesium.Event;class Un{constructor(e){this._fpvButtonClicked=new Nn,this._flyButtonClicked=new Nn,this._orbitButtonClicked=new Nn;const t=Vn("FPV","gwicon-user");t.addEventListener("click",(()=>{t.classList.add("active"),n.classList.remove("active"),i.classList.remove("active"),Dn.testOnLocal||document.getElementsByClassName("fly-navigation")[0].classList.add("hidden"),this._fpvButtonClicked.raiseEvent()})),e.appendChild(t);const i=Vn("FLY","gwicon-baloon");i.addEventListener("click",(()=>{t.classList.remove("active"),n.classList.remove("active"),i.classList.add("active"),Dn.testOnLocal||document.getElementsByClassName("fly-navigation")[0].classList.toggle("hidden"),this._flyButtonClicked.raiseEvent()})),e.appendChild(i);const n=Vn("ORBIT","gwicon-orbit");n.classList.add("active"),n.addEventListener("click",(()=>{Dn.testOnLocal||document.getElementsByClassName("fly-navigation")[0].classList.add("hidden"),t.classList.remove("active"),n.classList.add("active"),i.classList.remove("active"),this._orbitButtonClicked.raiseEvent()})),e.appendChild(n)}}function Vn(e,t){const i=document.createElement("button");let n;return""!=t&&(n=document.createElement("i"),n.className=t),i.type="button",i.innerHTML=n.outerHTML+e,i.className="construkted-viewer-controlbar-button",i}Object.defineProperties(Un.prototype,{fpvButtonClicked:{get:function(){return this._fpvButtonClicked}},flyButtonClicked:{get:function(){return this._flyButtonClicked}},orbitButtonClicked:{get:function(){return this._orbitButtonClicked}}});let zn,Fn,Bn={moveForward:!1,moveBackward:!1,moveUp:!1,moveDown:!1,moveLeft:!1,moveRight:!1};class jn extends En{constructor(e){super(e),this._started=!1,this._moveRateFactor=.1;const t=this;document.addEventListener("keydown",(function(e){e.shiftKey?t.speed=3:t.speed=1;const i=Hn(e.keyCode);void 0!==i&&(Bn[i]=!0)}),!1),document.addEventListener("keyup",(function(e){const t=Hn(e.keyCode);void 0!==t&&(Bn[t]=!1)}),!1),Dn.testOnLocal||(document.getElementById("fly-up").addEventListener("touchstart",(function(){Bn.moveUp=!0})),document.getElementById("fly-up").addEventListener("touchend",(function(){Bn.moveUp=!1})),document.getElementById("fly-down").addEventListener("touchstart",(function(){Bn.moveDown=!0})),document.getElementById("fly-down").addEventListener("touchend",(function(){Bn.moveDown=!1})),document.getElementById("fly-forward").addEventListener("touchstart",(function(){Bn.moveForward=!0})),document.getElementById("fly-forward").addEventListener("touchend",(function(){Bn.moveForward=!1})),document.getElementById("fly-back").addEventListener("touchstart",(function(){Bn.moveBackward=!0})),document.getElementById("fly-back").addEventListener("touchend",(function(){Bn.moveBackward=!1})),document.getElementById("fly-left").addEventListener("touchstart",(function(){Bn.moveLeft=!0})),document.getElementById("fly-left").addEventListener("touchend",(function(){Bn.moveLeft=!1})),document.getElementById("fly-right").addEventListener("touchstart",(function(){Bn.moveRight=!0})),document.getElementById("fly-right").addEventListener("touchend",(function(){Bn.moveRight=!1})));const i=this._cesiumViewer,n=i.canvas,o=i.scene.globe.ellipsoid;n.setAttribute("tabindex","0"),n.onclick=function(){n.focus()},i.clock.onTick.addEventListener((e=>{if(!this._started)return;let t=i.camera;const n=o.cartesianToCartographic(t.position);i.scene.globe.getHeight(n);let s=n.height;s<0&&(s=-s);let a=s/100;a=a*this._moveRateFactor*.5*this.speed,console.log("moveRate",a),Bn.moveForward&&t.moveForward(a),Bn.moveBackward&&t.moveBackward(a),Bn.moveUp&&t.moveUpEx(a),Bn.moveDown&&t.moveDownEx(a),Bn.moveLeft&&t.moveLeft(a),Bn.moveRight&&t.moveRight(a)}))}start(){ln(this._cesiumViewer.scene),this._started=!0,this._screenSpaceEventHandler.setInputAction(this._onMouseMove.bind(this),Cesium.ScreenSpaceEventType.MOUSE_MOVE)}stop(){cn(this._cesiumViewer.scene),this._started=!1,this._screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE)}started(){return this._started}setMoveRateFactor(e){this._moveRateFactor=e}}function Hn(e){switch(e){case"W".charCodeAt(0):return"moveForward";case"S".charCodeAt(0):return"moveBackward";case"R".charCodeAt(0):return"moveUp";case"F".charCodeAt(0):return"moveDown";case"D".charCodeAt(0):return"moveRight";case"A".charCodeAt(0):return"moveLeft";default:return}}let Qn=0,Xn=jQuery("#tileset_latitude"),Yn=jQuery("#tileset_longitude"),qn=jQuery("#tileset_altitude"),Zn=jQuery("#tileset_heading"),Kn=jQuery("#edit_asset_geo_location_button"),Jn=jQuery("#tileset_estimate_altitude"),Gn=null;class Wn{constructor(){this._viewer=null,this._tileset=null}start(){this._createCesiumViewer(),this._addTileset(),this._flyController=new jn({isMobile:tn(),cesiumViewer:this._viewer}),this._createControlbar(),Ln(this._viewer,this._tileset,Gn),In(this._viewer),this.initXR()}_createCesiumViewer(){Cesium.Ion.defaultAccessToken=CONSTRUKTED_AJAX.cesium_access_token,Cesium.Ion.defaultAccessToken||console.warn("default access token is null!");let e=new Cesium.Viewer("cesiumContainer",{terrainProvider:Cesium.createWorldTerrain(),animation:!1,homeButton:!1,baseLayerPicker:!1,geocoder:!1,sceneModePicker:!1,timeline:!1,fullscreenElement:"cesiumContainer",requestRenderMode:!0,navigationHelpButton:!1});this._viewer=e,e.resolutionScale=1,e.scene.globe.depthTestAgainstTerrain=!0,e.extend(Cesium.viewerMeasureMixin,{units:new Cesium.MeasureUnits({distanceUnits:Cesium.DistanceUnits.METERS,areaUnits:Cesium.AreaUnits.SQUARE_METERS,volumeUnits:Cesium.VolumeUnits.CUBIC_METERS})}),e.extend(Cesium.viewerCesium3DTilesInspectorMixin);e.cesium3DTilesInspector.viewModel.picking=!1,sn(!1),e.scene.screenSpaceCameraController.rotateEventTypes=Cesium.CameraEventType.LEFT_DRAG,e.scene.screenSpaceCameraController.zoomEventTypes=[Cesium.CameraEventType.MIDDLE_DRAG,Cesium.CameraEventType.WHEEL,Cesium.CameraEventType.PINCH],e.scene.screenSpaceCameraController.tiltEventTypes=[Cesium.CameraEventType.RIGHT_DRAG,Cesium.CameraEventType.PINCH,{eventType:Cesium.CameraEventType.RIGHT_DRAG,modifier:Cesium.KeyboardEventModifier.CTRL},{eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.CTRL}]}_addTileset(){let e="https://s3.us-east-2.wasabisys.com/construkted-assets/"+CONSTRUKTED_AJAX.post_slug+"/tileset.json",t=this._viewer.scene.primitives.add(new Cesium.Cesium3DTileset({url:e,immediatelyLoadDesiredLevelOfDetail:!1,skipLevelOfDetail:!0,loadSiblings:!0}));this._tileset=t,null!=t&&(t.maximumScreenSpaceError=8,t.maximumMemoryUsage=512,t.pointCloudShading.maximumAttenuation=1.2,t.pointCloudShading.baseResolution=.44,t.pointCloudShading.geometricErrorScale=.3,t.pointCloudShading.attenuation=!0,t.pointCloudShading.eyeDomeLighting=!0,t.pointCloudShading.eyeDomeLightingStrength=.5,t.pointCloudShading.eyeDomeLightingRadius=.5,t.readyPromise.then((()=>{this._onTilesetReady(t)})).otherwise((function(e){window.alert(e)})))}_onTilesetReady(e){const t=this._viewer;jQuery.fn.doubletap=jQuery.fn.doubletap||function(e,t){t=null==t?300:t,this.bind("touchend",(function(i){let n=(new Date).getTime(),o=n-($(this).data("lastTouch")||n+1);o<t&&0<o?($(this).data("lastTouch",null),null!==e&&"function"==typeof e&&e(i)):$(this).data("lastTouch",n)}))},jQuery(".cesium-widget > canvas").doubletap((function(e){if(e&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]){const t=e.originalEvent.changedTouches[0];Fn.onDoubleTaped({position:{x:t.clientX,y:t.clientY}})}else console.warn("can not get position")}));let i={cesiumViewer:t,main3dTileset:e,defaultCameraPositionOrientationJson:CONSTRUKTED_AJAX.default_camera_position_direction,isMobile:tn(),ignoreCollisionDetection:!1,immersiveArEnabled:zn.enabled};if(Fn=new Mn(i),this._fpvController=Fn,Fn.FPVStarted().addEventListener((function(){jQuery("body").addClass("fpv-mode-on"),jQuery(".fpv-navigation").show(),yn(),window.addEventListener("keydown",nn,!1)})),Fn.FPVFinished().addEventListener((function(){jQuery("body").removeClass("fpv-mode-on"),jQuery(".fpv-navigation").hide(),yn(),window.removeEventListener("keydown",nn,!1)})),function(e){let t=jQuery(".fpv-left"),i=jQuery(".fpv-right"),n=jQuery(".fpv-up"),o=jQuery(".fpv-down");t.on("mousedown",(function(){e.setDirectionLeft()})),t.on("mouseup",(function(){e.setDirectionNone()})),i.on("mousedown",(function(){e.setDirectionRight()})),i.on("mouseup",(function(){e.setDirectionNone()})),n.on("mousedown",(function(){e.setDirectionForward()})),n.on("mouseup",(function(){e.setDirectionNone()})),o.on("mousedown",(function(){e.setDirectionBackward()})),o.on("mouseup",(function(){e.setDirectionNone()})),t.on("touchstart",(function(){e.setDirectionLeft()})),t.on("touchend",(function(){e.setDirectionNone()})),i.on("touchstart",(function(){e.setDirectionRight()})),i.on("touchend",(function(){e.setDirectionNone()})),n.on("touchstart",(function(){e.setDirectionForward()})),n.on("touchend",(function(){e.setDirectionNone()})),o.on("touchstart",(function(){e.setDirectionBackward()})),o.on("touchend",(function(){e.setDirectionNone()}))}(Fn),An(this),on(e)){Xn.prop("disabled",!0),Yn.prop("disabled",!0),Zn.prop("disabled",!0),Kn.prop("disabled",!0),Jn.prop("disabled",!0);let t=e.boundingSphere.center,i=Cesium.Cartographic.fromCartesian(t);if(Qn=i.height,CONSTRUKTED_AJAX.asset_geo_location){let t=CONSTRUKTED_AJAX.asset_geo_location,i=Qn-parseFloat(t.height);e.modelMatrix=Cesium.Matrix4.fromTranslation(new Cesium.Cartesian3(0,0,i)),qn.val(t.height)}else Yn.val(Cesium.Math.toDegrees(i.longitude)),Xn.val(Cesium.Math.toDegrees(i.latitude)),qn.val(i.height)}else CONSTRUKTED_AJAX.asset_geo_location?(hn(e,CONSTRUKTED_AJAX.asset_geo_location),CONSTRUKTED_AJAX.is_owner&&(Gn=new Cesium.TransformEditor({container:t.container,scene:t.scene,transform:e.modelMatrix,boundingSphere:e.boundingSphere}),Gn.viewModel.deactivate())):(rn(this._viewer,!1),e.modelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(0,0))),CONSTRUKTED_AJAX.is_owner&&(Gn=new Cesium.TransformEditor({container:t.container,scene:t.scene,transform:e.modelMatrix,boundingSphere:e.boundingSphere}),Gn.viewModel.deactivate());!function(e,t){const i=CONSTRUKTED_AJAX.default_camera_position_direction,n=e.camera;if(void 0!==i&&""!==i){let o;try{o=JSON.parse(i)}catch(e){return console.error(e.message),void n.flyToBoundingSphere(t.boundingSphere)}if(!(o.offsetX&&o.offsetY&&o.offsetZ&&o.heading&&o.pitch&&o.roll))return console.warn("invalid default_camera_position_direction"),console.warn(CONSTRUKTED_AJAX.default_camera_position_direction),void n.flyToBoundingSphere(t.boundingSphere);let s=new Cesium.Cartesian3(o.offsetX,o.offsetY,o.offsetZ),a=Cesium.Cartesian3.add(t.boundingSphere.center,s,new Cesium.Cartesian3);e.camera.flyTo({destination:a,orientation:{heading:Cesium.Math.toRadians(o.heading),pitch:Cesium.Math.toRadians(o.pitch),roll:Cesium.Math.toRadians(o.roll)}})}else n.flyToBoundingSphere(t.boundingSphere)}(this._viewer,this._tileset)}_createControlbar(){const e=document.createElement("div");e.className="construkted-viewer-controlbarContainer",this._viewer.container.appendChild(e);const t=new Un(e);t.fpvButtonClicked.addEventListener(this.onFPV,this),t.flyButtonClicked.addEventListener(this.onFLY,this),t.orbitButtonClicked.addEventListener(this.onOrbit,this)}onFPV(){Fn.started()||(this._flyController.started()&&this._flyController.stop(),Fn.setCanStart(!0),alert("Double click on the model to start FPV mode"))}onFLY(){this._flyController.started()?console.warn("already started"):(Fn.started()&&Fn.exitFPV(),Fn.setCanStart(!1),this._flyController.start())}onOrbit(){Fn.started()?Fn.exitFPV():this._flyController.started()&&this._flyController.stop(),Fn.setCanStart(!1)}tryDeactivateTransformEditor(){Gn&&Gn.viewModel.deactivate()}initXR(){try{zn=new CONSTRUKTEDXR.WebXRButton({onRequestSession:fn,onEndSession:Cn,textEnterXRTitle:"START AR",textXRNotFoundTitle:"AR NOT FOUND",textExitXRTitle:"EXIT  AR"}),document.querySelector("#cesiumContainer").appendChild(zn.domElement),navigator.xr&&(navigator.xr.isSessionSupported("immersive-ar").then((e=>{zn.enabled=e})),navigator.xr.requestSession("inline").then(gn))}catch(e){alert(e.message)}}fpvController(){return this._fpvController}flyController(){return this._flyController}tileset(){return this._tileset}xrButton(){return zn}cesiumViewer(){return this._viewer}}function $n(e){jQuery((function(t){let i=t(".bst4-wrapper li.nav-item span.btn"),n=t(".popup-wrapper .close-btn");i.click((function(){if(jQuery(".popup-wrapper").hide(),jQuery("#end-measurement").trigger("click"),!jQuery(this).parent().hasClass("active")){let e=jQuery(this).attr("id").replace("-btn","");jQuery("#"+e).show()}t(this).parent().toggleClass("active").siblings().not(this).removeClass("active"),e.tryDeactivateTransformEditor()})),n.click((function(){jQuery(this).parents(".popup-wrapper").hide(),jQuery("#end-measurement").trigger("click"),e.tryDeactivateTransformEditor()}))})),jQuery("#scroll-down-btn").on("click",(function(){let e=jQuery(".post-meta").offset().top-jQuery(".featured-image").height()-jQuery("#header").height()+jQuery(".post-meta").height();$("html, body").animate({scrollTop:e},600)})),jQuery(window).on("scroll",(function(){jQuery(window).scrollTop()>200?jQuery("#scroll-down-btn").fadeOut(300):jQuery("#scroll-down-btn").fadeIn(300)})),jQuery(".embed-code-link").on("click",(function(){return jQuery(".embed-content").toggleClass("in"),!1})),jQuery(document).on("click",".letiation-action",(function(){let e=jQuery(this),t=jQuery(this).attr("data-value");jQuery(".letiations #disk_space").val(t).trigger("change"),e.parent().addClass("selected").siblings().removeClass("selected")})),jQuery(document).ready((function(){if(jQuery("table.letiations").length>0){let e=jQuery("#disk_space").val();jQuery('.letiation-action[data-value="'+e+'"]').trigger("click");let t=jQuery(".flex-row").data("current");t>0&&jQuery('.letiation-action[data-value="'+t+'"]').trigger("click")}}))}const eo=[{post_title:"110404",post_slug:"ages9v7tfzu",asset_geo_location:'{"longitude":"38.00000000","latitude":"10.00000000","height":"1000.00000000","heading":"0.00000000","pitch":"0.00000000","roll":"-0.00000000","scale":{"x":0.9999999999999997,"y":0.9999999999999993,"z":0.9999999999999993}}'},{post_title:"110403",post_slug:"au6e4iimyrr",asset_geo_location:""},{post_title:"110403",post_slug:"aew53sctm7n",asset_geo_location:""},{post_title:"110402",post_slug:"aazhfgick6c",asset_geo_location:""},{post_title:"110401",post_slug:"aa906d2ucd9",asset_geo_location:""},{post_title:"110302",post_slug:"ak0x7q3qj61",asset_geo_location:""},{post_title:"110301",post_slug:"azg9w4bod2n",asset_geo_location:""},{post_title:"0903001",post_slug:"as2f4lx2sl5",asset_geo_location:'{"longitude":"38.94102651","latitude":"0.00000000","height":"2360.00000000","heading":"-0.00000000","pitch":"-0.00000000","roll":"0.00000000","scale":{"x":0.9999999999999998,"y":1,"z":0.9999999999999998}}'},{post_title:"083107",post_slug:"a0izem7szq7",asset_geo_location:""},{post_title:"083106",post_slug:"ax0t7l4ixvj",asset_geo_location:""},{post_title:"083105",post_slug:"aggmmut7mv8",asset_geo_location:""},{post_title:"083104",post_slug:"ali26hndm98",asset_geo_location:""},{post_title:"083101",post_slug:"ajhq84110j6",asset_geo_location:""},{post_title:"083102",post_slug:"abt2ukl167w",asset_geo_location:""},{post_title:"083101",post_slug:"ag0oppuade1",asset_geo_location:""},{post_title:"082611",post_slug:"aoqw2dmyn2v",asset_geo_location:""},{post_title:"082610",post_slug:"aih5mbbvmao",asset_geo_location:""},{post_title:"082609",post_slug:"azfg05muuaa",asset_geo_location:""},{post_title:"082608",post_slug:"ar3yd8b149n",asset_geo_location:""},{post_title:"082607",post_slug:"a4rr3k8yrkl",asset_geo_location:""},{post_title:"082601",post_slug:"aqks5y06q3v",asset_geo_location:""},{post_title:"082606",post_slug:"a5rlca25y6u",asset_geo_location:""},{post_title:"082605",post_slug:"ae1sx4xu9y5",asset_geo_location:""},{post_title:"AssimpTest",post_slug:"ab53rdljw6h",asset_geo_location:""},{post_title:"081003",post_slug:"acq2ayoy24k",asset_geo_location:""},{post_title:"081002",post_slug:"a8z4dkq5rdv",asset_geo_location:""},{post_title:"081001",post_slug:"a5b4aemwjt9",asset_geo_location:""},{post_title:"080902",post_slug:"acy2xq27j0t",asset_geo_location:""},{post_title:"080901",post_slug:"aj6cn4lqs1p",asset_geo_location:""},{post_title:"080302",post_slug:"anu8ovfv02p",asset_geo_location:""},{post_title:"080301",post_slug:"ayrm6vcpnzo",asset_geo_location:""},{post_title:"test small",post_slug:"a5t42tl9ulq",asset_geo_location:""},{post_title:"Ojúbo Òsogbo",post_slug:"ahukncis7e2",asset_geo_location:""},{post_title:"Kuda Ziyaarat",post_slug:"a4safovaxhp",asset_geo_location:""},{post_title:"Kandhuvalu Miskiyy",post_slug:"acxsua8o4f0",asset_geo_location:""},{post_title:"061803",post_slug:"awrx2ns02cw",asset_geo_location:""},{post_title:"061802",post_slug:"anvcqra0gap",asset_geo_location:""},{post_title:"061801",post_slug:"arv7y6yllic",asset_geo_location:""},{post_title:"061703",post_slug:"a5zmwn3le4s",asset_geo_location:""},{post_title:"061701",post_slug:"axkx95dpkvi",asset_geo_location:""},{post_title:"061703",post_slug:"a6kv3us2p61",asset_geo_location:""},{post_title:"061702",post_slug:"a3kk52otoes",asset_geo_location:""},{post_title:"061701",post_slug:"ah9vewikqkf",asset_geo_location:""},{post_title:"061208",post_slug:"anx0p4kapyt",asset_geo_location:""},{post_title:"test",post_slug:"agk8u2tg5lk",asset_geo_location:""},{post_title:"0522801",post_slug:"axrej99h0kz",asset_geo_location:""},{post_title:"test77",post_slug:"a8jjd6xo6xf2",asset_geo_location:""},{post_title:"fdsffasdf",post_slug:"atafntf2llb",asset_geo_location:""},{post_title:"051101",post_slug:"a9ze4v9wywz",asset_geo_location:""},{post_title:"050801",post_slug:"a9x7yhn4qyg",asset_geo_location:""},{post_title:"test",post_slug:"anlxzikmhex",asset_geo_location:""},{post_title:"dsa",post_slug:"aquammqzt7e",asset_geo_location:""},{post_title:"42501",post_slug:"a9gnxwkhsqo",asset_geo_location:""},{post_title:"test laz",post_slug:"avk20ys6e6v",asset_geo_location:""},{post_title:"Pedra da Abelha",post_slug:"ar92spcv6j",asset_geo_location:""},{post_title:"Waitangi",post_slug:"azchwu7wg3",asset_geo_location:'{"longitude":"174.08198501","latitude":"-35.26547676","height":"62.29902388","heading":"27.89953389","pitch":"0.00000000","roll":"0.00000000","scale":{"x":0.9999999999999974,"y":0.9999999999999979,"z":0.9999999999999987}}'},{post_title:"Lukang Longshan Temple",post_slug:"79ovn96va1",asset_geo_location:'{"longitude":"120.43549050","latitude":"24.05040753","height":"4.14625536","heading":"-8.85260719","pitch":"-0.00000000","roll":"0.00000000","scale":{"x":0.9036938754873005,"y":0.9036938754872987,"z":0.9036938754872975}}'},{post_title:"Kuagannu Cemetery",post_slug:"lrxjfjysn5",asset_geo_location:'{"longitude":"73.22868406","latitude":"-0.58096406","height":"-87.80360575","heading":"0.25293237","pitch":"-0.00000000","roll":"-0.00000000","scale":{"x":0.7823893447389397,"y":0.7823893447389435,"z":0.7823893447389415}}'},{post_title:"Hume Street Bundamba",post_slug:"vlfrcz2iry",asset_geo_location:'{"longitude":0,"latitude":0,"height":"150","heading":0,"pitch":0,"roll":0,"scale":0}'},{post_title:"Temple of Apollo",post_slug:"3yx6yry34e",asset_geo_location:'{"longitude":"25.37245267","latitude":"37.10963577","height":"20.75670900","heading":"12.20029848","pitch":"-3.09786544","roll":"3.74621002","scale":{"x":1.000000000000004,"y":1.0000000000000075,"z":1.0000000000000042}}'},{post_title:"Mosque City of Bagerhat",post_slug:"aucbzxw01n",asset_geo_location:'{"longitude":"89.73218638","latitude":"22.67850457","height":"-58.02387200","heading":"6.09584104","pitch":"-0.00000000","roll":"0.00000000","scale":{"x":0.9999999999999869,"y":0.9999999999999952,"z":0.99999999999999}}'},{post_title:"Temple of Eshmun",post_slug:"za5dznzmgc",asset_geo_location:'{"longitude":"35.39794573","latitude":"33.58563127","height":"108.33459684","heading":"2.08083429","pitch":"6.10851702","roll":"0.44705259","scale":{"x":0.9786749018691109,"y":0.97867490186911,"z":0.9786749018691098}}'},{post_title:"GAUDI&#8217;S BENCH PARK GÜELL",post_slug:"64su9iqbso",asset_geo_location:'{"longitude":"0.00000000","latitude":"0.00045139","height":"57.53474137","heading":"0.00000000","pitch":"0.00000000","roll":"-0.00000000","scale":{"x":0.9999999999999959,"y":0.9999999999999958,"z":0.9999999999999958}}'},{post_title:"Al Azem Palace &#8211; LiDAR",post_slug:"73slnkc46h",asset_geo_location:'{"longitude":"36.30709993","latitude":"33.51029479","height":"683.06502289","heading":"-2.22677595","pitch":"-0.00000000","roll":"-0.00000000","scale":{"x":0.9801946612342748,"y":0.9801946612342781,"z":0.9801946612342785}}'},{post_title:"Thomas Jefferson Memorial",post_slug:"mtdg6tlzc1",asset_geo_location:'{"longitude":"-77.03648882","latitude":"38.88107758","height":"-35.15046347","heading":"0.00000000","pitch":"0.00000000","roll":"0.00000000","scale":{"x":0.9822974573761182,"y":0.9822974573761147,"z":0.9822974573761142}}'},{post_title:"Space Shuttle Discovery",post_slug:"5mh6ruk6u8",asset_geo_location:""},{post_title:"Kaunas State Musical Theater",post_slug:"gxsnzfsey0",asset_geo_location:'{"longitude":"23.90438353","latitude":"54.89586638","height":"38.23703956","heading":"0.00000000","pitch":"-0.00000000","roll":"-0.00000000","scale":{"x":0.9999999999999937,"y":0.9999999999999994,"z":0.9999999999999989}}'},{post_title:"Old Baldy Crag",post_slug:"s4jk5v3usd",asset_geo_location:'{"longitude":"-80.52362385","latitude":"44.38571791","height":"380.47364532","heading":"10.52682592","pitch":"0.00000000","roll":"-0.00000000","scale":{"x":1.0000000000000089,"y":1.0000000000000195,"z":1.0000000000000215}}'},{post_title:"Cidade Velha – Pillory",post_slug:"jiut8549uw",asset_geo_location:'{"longitude":"-23.60531152","latitude":"14.91459920","height":"3.56715544","heading":"0.00000000","pitch":"-0.00000000","roll":"-0.00000000","scale":{"x":0.9999999999999925,"y":0.9999999999999948,"z":0.999999999999991}}'},{post_title:"Cidade Velha – Cathedral",post_slug:"1ku5gjy9y9",asset_geo_location:'{"longitude":"-23.60387689","latitude":"14.91366146","height":"33.48335745","heading":"-2.26570823","pitch":"0.00000000","roll":"0.00000000","scale":{"x":0.9650188721000611,"y":0.965018872100061,"z":0.9650188721000613}}'},{post_title:"Cidade Velha – Church",post_slug:"vl8i0vbtxm",asset_geo_location:'{"longitude":"-23.60441338","latitude":"14.91799089","height":"-32.07336445","heading":"0.00000000","pitch":"0.00000000","roll":"-0.00000000","scale":{"x":0.9999999999999915,"y":0.9999999999999918,"z":0.9999999999999862}}'},{post_title:"Cidade Velha &#8211; Fort",post_slug:"u2yfp4icbc",asset_geo_location:'{"longitude":"-23.60181786","latitude":"14.91636442","height":"60.68402341","heading":"0.00000000","pitch":"0.00000000","roll":"-0.00000000","scale":{"x":0.9999999999999964,"y":0.9999999999999964,"z":0.9999999999999963}}'},{post_title:"Antarctic Expedition Huts &#8211; Scotts Terra Nova Hut",post_slug:"i6wa1qps54",asset_geo_location:""},{post_title:"Antarctic Expedition Huts &#8211; Scotts Discovery Huts",post_slug:"f4yci5nlim",asset_geo_location:'{"longitude":"166.65524900","latitude":"-77.84999300","height":"-53.20181623","heading":"0.00000000","pitch":"-0.00000000","roll":"-0.00000000","scale":{"x":0.9999999999999979,"y":0.9999999999999968,"z":0.9999999999999973}}'},{post_title:"Annaberg Plantation",post_slug:"ewcfbvpq79",asset_geo_location:'{"longitude":"-64.72764962","latitude":"18.36463817","height":"-53.99353537","heading":"-88.11300891","pitch":"0.00000000","roll":"-0.00000000","scale":{"x":0.9113603263582264,"y":0.9113603263582261,"z":0.9113603263582241}}'},{post_title:"Annaberg Plantation-Sugar Mill",post_slug:"3h5tqgigo1",asset_geo_location:'{"longitude":"-64.72972320","latitude":"18.36281932","height":"-40.40550178","heading":"-8.85676668","pitch":"-0.00000000","roll":"0.00000000","scale":{"x":1.0000000000000144,"y":1.0000000000000155,"z":1.0000000000000135}}'},{post_title:"Annaberg Plantation-Leinster Bay Factory",post_slug:"4337drz74q",asset_geo_location:'{"longitude":"-64.71924902","latitude":"18.36298799","height":"-37.83130003","heading":"-0.00000000","pitch":"0.00000000","roll":"-0.00000000","scale":{"x":0.9999999999999996,"y":0.999999999999999,"z":0.9999999999999981}}'},{post_title:"Annaberg Plantation- Great house",post_slug:"so6teb36vi",asset_geo_location:'{"longitude":"-64.71956760","latitude":"18.36541638","height":"8.49225585","heading":"-6.29081298","pitch":"0.00000000","roll":"0.00000000","scale":{"x":0.9999999999999982,"y":0.9999999999999959,"z":0.9999999999999983}}'},{post_title:"Famous Five Statues",post_slug:"4sll1iq7a8",asset_geo_location:'{"longitude":"-114.06003123","latitude":"51.04559718","height":"1029.33088519","heading":"0.00000000","pitch":"0.00000000","roll":"0.00000000","scale":{"x":0.9999999999999926,"y":0.9999999999999947,"z":0.9999999999999922}}'},{post_title:"Historic Falls Bridge, Lovers Leap State Park, New Milford, CT, USA",post_slug:"2qhahw34tq",asset_geo_location:""},{post_title:"Graffiti Alley, Toronto",post_slug:"aqpl4kuowx",asset_geo_location:'{"longitude":"-79.40038061","latitude":"43.64745095","height":"50.00000697","heading":"164.66669882","pitch":"-0.00000000","roll":"0.00000000","scale":{"x":0.9420058825170017,"y":0.9420058825170019,"z":0.9420058825170028}}'},{post_title:"Niagara Glen Bouldering",post_slug:"bf7a1a3ac3",asset_geo_location:'{"longitude":"-79.05731182","latitude":"43.12882125","height":"84.69360001","heading":"-160.79019145","pitch":"-0.00000000","roll":"-0.00000000","scale":{"x":0.9999999999999944,"y":0.9999999999999991,"z":0.9999999999999951}}'},{post_title:"Graffiti Alley",post_slug:"md4pp4xsyf",asset_geo_location:'{"longitude":"-79.40039251","latitude":"43.64752461","height":"47.97107377","heading":"-18.78241362","pitch":"0.00000000","roll":"0.00000000","scale":{"x":0.9750426236429981,"y":0.9750426236429992,"z":0.9750426236429984}}'},{post_title:"PX-80-sample-outdoor",post_slug:"2q94aqe7kh",asset_geo_location:""},{post_title:"PX-80-sample-indoor-1",post_slug:"9klty3qtxj",asset_geo_location:""},{post_title:"PX-80 Sample: Inside 2",post_slug:"rfely136b5",asset_geo_location:""},{post_title:"Brandenburg Gate",post_slug:"0tpomf179i",asset_geo_location:'{"longitude":"13.37759729","latitude":"52.51623145","height":"77.66503034","heading":"83.33234677","pitch":"-2.42720976","roll":"2.13166582","scale":{"x":0.999999999999976,"y":0.9999999999999732,"z":0.9999999999999758}}'},{post_title:"ODM_Result_Test_Dante_Statue",post_slug:"yblcg97yf8",asset_geo_location:""},{post_title:"Thomas Jefferson Memorial 02",post_slug:"qpnur8sroi",asset_geo_location:'{"longitude":"-77.03648737","latitude":"38.88097772","height":"-39.02142383","heading":"0.00000000","pitch":"-0.00000000","roll":"-0.00000000","scale":{"x":0.9999999999999974,"y":0.9999999999999981,"z":0.9999999999999982}}'},{post_title:"Tomb of Tu Duc &#8211; Complex of Hué Monuments",post_slug:"dm6fw7znkf",asset_geo_location:'{"longitude":"107.56520056","latitude":"16.43323571","height":"1.39173380","heading":"49.05844157","pitch":"-0.00000000","roll":"-0.00000000","scale":{"x":0.9999999999999739,"y":0.9999999999999716,"z":0.9999999999999696}}'},{post_title:"An Dinh Palace &#8211; Complex of Hue Monuments",post_slug:"dvb6qzy9id",asset_geo_location:'{"longitude":"107.59814956","latitude":"16.45698362","height":"-7.24542559","heading":"0.00000000","pitch":"-0.00000000","roll":"0.00000000","scale":{"x":0.9999999999999869,"y":0.9999999999999851,"z":0.9999999999999774}}'},{post_title:"Tomb of Tu Duc &#8211; Complex of Hué Monuments",post_slug:"9s17eve0bq",asset_geo_location:'{"longitude":"107.56540883","latitude":"16.43322187","height":"6.70219605","heading":"50.77351401","pitch":"-0.00000000","roll":"0.00000000","scale":{"x":1.0000000000000064,"y":1.0000000000000073,"z":1.0000000000000069}}'},{post_title:"Al Azem Palace",post_slug:"n3bnsrv621",asset_geo_location:'{"longitude":"36.30702121","latitude":"33.51016946","height":"714.23267941","heading":"-0.67195544","pitch":"-0.00000000","roll":"-0.00000000","scale":{"x":1.0000000000000078,"y":1.0000000000000058,"z":1.0000000000000053}}'},{post_title:"point cloud test2",post_slug:"ywmpl354th",asset_geo_location:""},{post_title:"point cloud 02",post_slug:"cpgvl2dz6m",asset_geo_location:""},{post_title:"Sir Adam Beck School",post_slug:"0gy35muf8i",asset_geo_location:'{"longitude":"-79.54844169","latitude":"43.60116585","height":"61.61384726","heading":"-0.00000000","pitch":"-0.00000000","roll":"0.00000000","scale":{"x":0.9999999999999992,"y":0.9999999999999993,"z":0.9999999999999996}}'},{post_title:"Ancient Corinth",post_slug:"4a195d11a",asset_geo_location:'{"longitude":"22.88059254","latitude":"37.90572960","height":"103.24801198","heading":"68.61270472","pitch":"-0.00000000","roll":"0.00000000","scale":{"x":0.9999999999999951,"y":0.9999999999999968,"z":0.9999999999999969}}'},{post_title:"Ayutthaya",post_slug:"e63mubnpmg",asset_geo_location:'{"longitude":"100.55868079","latitude":"14.35585656","height":"0.00001250","heading":"-6.15457981","pitch":"0.00000000","roll":"0.00000000","scale":{"x":0.9999999999999954,"y":0.9999999999999958,"z":0.9999999999999963}}'},{post_title:"Thomas Jefferson Memorial",post_slug:"pa3cecczc2",asset_geo_location:'{"longitude":"-77.03654120","latitude":"38.88096544","height":"-33.09332952","heading":"0.00000000","pitch":"0.00000000","roll":"-0.00000000","scale":{"x":0.9999999999999962,"y":0.9999999999999963,"z":0.9999999999999949}}'},{post_title:"Church Of St Sophia",post_slug:"l4sav2ekd8",asset_geo_location:'{"longitude":"20.79404372","latitude":"41.11216550","height":"748.50000000","heading":"-3.63453209","pitch":"0.00000000","roll":"0.00000000","scale":{"x":0.9999999999999827,"y":0.9999999999999868,"z":0.999999999999988}}'},{post_title:"Antarctic Expedition Huts – Shackletons Hut",post_slug:"q0ad498q0l",asset_geo_location:'{"longitude":"166.16838800","latitude":"-77.55293200","height":"-51.67760940","heading":"-0.00000000","pitch":"0.00000000","roll":"-0.00000000","scale":{"x":1.0000000000000002,"y":0.9999999999999999,"z":1}}'},{post_title:"Tomb Of Tu Duc",post_slug:"n3cpft9qy6",asset_geo_location:'{"longitude":"107.56510578","latitude":"16.43316858","height":"9.61508380","heading":"49.18481539","pitch":"0.00000000","roll":"-0.00000000","scale":{"x":0.9999999999999963,"y":0.9999999999999958,"z":0.9999999999999952}}'},{post_title:"Ananias Chapel, Syria",post_slug:"ej10sk5j3i",asset_geo_location:'{"longitude":"36.31728174","latitude":"33.51138585","height":"706.07579184","heading":"-24.95261607","pitch":"0.00000000","roll":"0.00000000","scale":{"x":1.000000000000048,"y":1.000000000000057,"z":1.0000000000000622}}'},{post_title:"Buffalo Crag",post_slug:"30ow09fgwc",asset_geo_location:'{"longitude":"-79.92472623","latitude":"43.47047322","height":"229.68819677","heading":"22.96868117","pitch":"-0.00000000","roll":"0.00000000","scale":{"x":1.000000000000003,"y":1.0000000000000007,"z":1.0000000000000042}}'}];class to{constructor(e){this._assets=e.assets,Cesium.Ion.defaultAccessToken=CONSTRUKTED_AJAX.cesium_access_token,Cesium.Ion.defaultAccessToken||console.warn("default access token is null!"),this._viewer=new Cesium.Viewer("cesiumContainer",{terrainProvider:Cesium.createWorldTerrain(),animation:!1,homeButton:!1,baseLayerPicker:!1,geocoder:!1,sceneModePicker:!1,timeline:!1,fullscreenElement:"cesiumContainer",requestRenderMode:!0,navigationHelpButton:!1}),this._viewer.scene.globe.depthTestAgainstTerrain=!0,this._assets.forEach((e=>{this._addAsset(e)}))}_addAsset(e){let t="https://s3.us-east-2.wasabisys.com/construkted-assets/"+e.post_slug+"/tileset.json",i=this._viewer.scene.primitives.add(new Cesium.Cesium3DTileset({url:t,immediatelyLoadDesiredLevelOfDetail:!1,skipLevelOfDetail:!0,loadSiblings:!0}));i.readyPromise.then((()=>{this._onTilesetReady(e,i)})).otherwise((function(e){console.error(e.response)}))}_onTilesetReady(e,t){this._applyGeoLocationData(e,t);const i=e.post_title;if(e.asset_geo_location){const t=e.asset_geo_location;this._addPolyline(t.longitude,t.latitude,i)}else if(on(t)){let e=t.boundingSphere.center,n=Cesium.Cartographic.fromCartesian(e);this._addPolyline(Cesium.Math.toDegrees(n.longitude),Cesium.Math.toDegrees(n.latitude),i)}}_addPolyline(e,t,i){const n=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}(1e5,5e6),o=Cesium.Cartesian3.fromDegrees(e,t,0),s=Cesium.Cartesian3.fromDegrees(e,t,n),a=new Cesium.PolylineGraphics;a.material=new Cesium.ColorMaterialProperty(Cesium.Color.fromRandom()),a.width=new Cesium.ConstantProperty(2),a.arcType=new Cesium.ConstantProperty(Cesium.ArcType.NONE),a.positions=new Cesium.ConstantProperty([o,s]);this._viewer.entities.add({polyline:a});this._viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(e,t,n),label:{text:i,scale:.8,pixelOffset:new Cesium.Cartesian2(0,-30),font:"32px Helvetica",fillColor:Cesium.Color.YELLOW,outlineColor:Cesium.Color.BLACK,outlineWidth:2,style:Cesium.LabelStyle.FILL_AND_OUTLINE}})}_applyGeoLocationData(e,t){if(on(t)){if(e.asset_geo_location){let i=t.boundingSphere.center,n=Cesium.Cartographic.fromCartesian(i).height-parseFloat(e.asset_geo_location.height);t.modelMatrix=Cesium.Matrix4.fromTranslation(new Cesium.Cartesian3(0,0,n))}}else e.asset_geo_location?hn(t,e.asset_geo_location):t.modelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(0,0))}}function io(){window.Cesium.MeasurementMouseHandler=jt,window.Cesium.DistanceMeasurement=ft,window.Cesium.PolylineMeasurement=si,window.Cesium.HorizontalMeasurement=Bt,window.Cesium.VerticalMeasurement=fi,window.Cesium.HeightMeasurement=wt,window.Cesium.AreaMeasurement=st,window.Cesium.PointMeasurement=Wt,window.Cesium.MeasureUnits=a,window.Cesium.DistanceUnits=i,window.Cesium.AreaUnits=n,window.Cesium.VolumeUnits=n,window.Cesium.TransformEditor=Le,window.Cesium.viewerMeasureMixin=yi,window.CONSTRUKTEDXR={},CONSTRUKTEDXR.WebXRButton=Ti,CONSTRUKTEDXR.InlineViewerHelper=ji,CONSTRUKTEDXR.eulerFromQuaternionDegree=en,CONSTRUKTEDXR.create$1=Qi,function(){const e=Cesium.Camera;let t=new Cesium.Cartesian3;e.prototype.moveUpEx=function(e){this.moveVertical(e)},e.prototype.moveDownEx=function(e){this.moveVertical(-e)},e.prototype.moveVertical=function(e){const i=this.position,n=Cesium.Cartesian3.normalize(i,t);this.move(n,e)}}(),function(){const e=jQuery(".ck-asset-modal");"y"==jQuery.cookie("ck-asset-modal")?e.addClass("is-closed hidden"):e.fadeIn(600),jQuery(document).on("click",".ck-asset-modal .icon-close, .ck-asset-modal-footer .gw3-button",(function(e){e.preventDefault(),jQuery(this).parents(".ck-asset-modal").addClass("hidden is-closed"),jQuery("#ck-asset-modal-close").is(":checked")&&jQuery.cookie("ck-asset-modal","y",{expires:31})})),jQuery(document).on("click",".ck-modal-toggler",(function(t){t.preventDefault(),e.removeClass("hidden is-closed"),e.fadeIn(300)})),jQuery(".fpv-nav-btn").on("click",(function(e){e.preventDefault()}))}(),CONSTRUKTED_AJAX.asset_geo_location&&""!==CONSTRUKTED_AJAX.asset_geo_location&&(CONSTRUKTED_AJAX.asset_geo_location=JSON.parse(CONSTRUKTED_AJAX.asset_geo_location)),CONSTRUKTED_AJAX.is_owner=Boolean(CONSTRUKTED_AJAX.is_owner);CONSTRUKTED_AJAX.bg_color_css_string&&""!==CONSTRUKTED_AJAX.bg_color_css_string||(CONSTRUKTED_AJAX.bg_color_css_string="#333333");const e=new Wn;window.construktedAssetViewer=e,e.start(),$n(e),tn()&&jQuery(".construkted-viewer-controlbarContainer").before('<button class="ck-view-mobile-selector"><i class="gwicon-orbit"></i>Orbit <i class="icon-down"></i></button>'),jQuery(document).on("click",".ck-view-mobile-selector",(function(){jQuery(".construkted-viewer-controlbarContainer").toggleClass("shown")})),jQuery(document).on("click",".construkted-viewer-controlbar-button",(function(){jQuery(".construkted-viewer-controlbarContainer").toggleClass("shown"),jQuery(".ck-view-mobile-selector").addClass("active").html(jQuery(this).html()+'<i class="icon-down"></i>')}))}jQuery(document).ready((function(){window.$=jQuery,console.log("ConstruktedJs version",Dn.version),Dn.testOnLocal&&(window.CONSTRUKTED_AJAX=function(e){if("AssetExplorer"===e.testType)return{ajax_type:"AssetExplorer",cesium_access_token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI2MzJlNDI2ZC1hMmE5LTQ4MjEtYmQwYS1iMDRlNTNjM2JiZTkiLCJpZCI6MjkyMSwiaWF0IjoxNTM1MjE4Mjk1fQ.jMg72t7Gnkk4-E9G7zhd_CoTJBUJ39hHALmxGBRL1ok",assets:eo};{const t=e.testSlug;let i=eo.filter((e=>e.post_slug===t))[0];return{ajax_type:"AssetViewer",ajaxurl:"https://construkted.com/wp-admin/admin-ajax.php",asset_geo_location:i.asset_geo_location,bg_color_css_string:i.bg_color_css_string,cesium_access_token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI2MzJlNDI2ZC1hMmE5LTQ4MjEtYmQwYS1iMDRlNTNjM2JiZTkiLCJpZCI6MjkyMSwiaWF0IjoxNTM1MjE4Mjk1fQ.jMg72t7Gnkk4-E9G7zhd_CoTJBUJ39hHALmxGBRL1ok",default_camera_position_direction:i.default_camera_position_direction,is_owner:"",post_id:i.post_id,post_slug:t}}}(Dn)),CONSTRUKTED_AJAX.ajax_type&&"AssetExplorer"===CONSTRUKTED_AJAX.ajax_type?function(){jQuery(".ck-asset-modal").hide();const e=CONSTRUKTED_AJAX.assets;for(let t=0;t<e.length;t++){const i=e[t];i.asset_geo_location&&""!==i.asset_geo_location?e[t].asset_geo_location=JSON.parse(i.asset_geo_location):e[t].asset_geo_location=void 0}window.assetExplorer=new to({assets:e})}():CONSTRUKTED_AJAX.ajax_type&&"AssetViewer"===CONSTRUKTED_AJAX.ajax_type?io():console.error("failed to get ajax_type")}))}));

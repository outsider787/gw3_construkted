!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("cesium")):"function"==typeof define&&define.amd?define(["cesium"],t):t((e=e||self).Cesium)}(this,(function(e){"use strict";function t(e,t){void 0===t&&(t={});var i=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===i&&n.firstChild?n.insertBefore(o,n.firstChild):n.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}t(".cesium-measure-toolbar {\r\n    width: 40px;\r\n    height: 32px;\r\n    overflow: hidden;\r\n    transition: width 0.8s;\r\n    white-space: nowrap;\r\n    background: #303336;\r\n    border: 1px solid #444;\r\n    color: #edffff;\r\n    stroke: #edffff;\r\n    stroke-width: 2;\r\n    fill: transparent;\r\n}\r\n.cesium-measure-toolbar.expanded {\r\n    width: 423px;\r\n}\r\n.cesium-measure-button {\r\n    vertical-align: top;\r\n    display: inline-block;\r\n    border-right: 1px solid #444;\r\n    cursor: pointer;\r\n    padding: 4px 8px;\r\n    height: 25px;\r\n    width: 25px;\r\n    margin-left: -4px /*removes space between buttons*/\r\n}\r\n.cesium-measure-button:first-child {\r\n    margin-left: 0;\r\n}\r\n.cesium-measure-button:hover {\r\n    background-color: #48b;\r\n}\r\n.cesium-measure-button:last-child {\r\n    border-right: none;\r\n}\r\n\r\n.cesium-measure-button.active {\r\n    background-color: #1a71cc;\r\n    cursor: default;\r\n}\r\n.cesium-measure-button-main {\r\n    stroke-width: 1.3;\r\n}\r\n.cesium-measure-help {\r\n    stroke-width: 0;\r\n    padding: 6px 8px;\r\n    fill: #edffff;\r\n}\r\n.cesium-measure-instructions {\r\n    position: absolute;\r\n    max-height: 500px;\r\n    width: 403px;\r\n    border: 1px solid #444;\r\n    overflow-y: auto;\r\n    border-radius: 0;\r\n    background-color: rgba(48,51,54,0.8);\r\n    color: #edffff;\r\n    padding: 10px;\r\n    stroke: #edffff;\r\n    stroke-width: 2;\r\n}\r\n.cesium-measure-icon {\r\n    margin-right: 10px;\r\n}\r\n.cesium-measure-instructions .bold {\r\n    margin-bottom: 3px;\r\n}\r\n.cesium-measure-instructions > ul {\r\n    padding-left: 20px;\r\n}\r\n");t(".transform-editor-menu {\r\n    position: absolute;\r\n    stroke: none;\r\n    fill: #edffff;\r\n}\r\n\r\n.transform-editor-button {\r\n    padding: 0;\r\n    width: 25px;\r\n    height: 25px;\r\n    border-radius: 13px;\r\n}\r\n\r\n.transform-editor-button > svg {\r\n    margin-top: 2px;\r\n    margin-left: 2px;\r\n}\r\n\r\n.transform-editor-options {\r\n    position: relative;\r\n    left: -16px;\r\n    background-color: #303336;\r\n    color: #edffff;\r\n}\r\n\r\n.transform-editor-button-row > div {\r\n    display: inline-block;\r\n    cursor: pointer;\r\n    padding-top: 4px;\r\n    padding-left: 4px;\r\n    width: 30px;\r\n    height: 30px;\r\n    border: 1px solid #444;\r\n}\r\n\r\n.transform-editor-button-row > div.selected {\r\n    background-color: #1E90FF;\r\n}\r\n\r\n.transform-editor-button-row > div:hover {\r\n    background-color: #48b;\r\n}\r\n");t(".cesium-viewer-measureContainer {\r\n    position: relative;\r\n    display: inline-block;\r\n    margin: 0 3px;\r\n    vertical-align: middle;\r\n}");var i=e.freezeObject({METERS:"METERS",CENTIMETERS:"CENTIMETERS",KILOMETERS:"KILOMETERS",FEET:"FEET",US_SURVEY_FEET:"US_SURVEY_FEET",INCHES:"INCHES",YARDS:"YARDS",MILES:"MILES"}),n=e.freezeObject({SQUARE_METERS:"SQUARE_METERS",SQUARE_CENTIMETERS:"SQUARE_CENTIMETERS",SQUARE_KILOMETERS:"SQUARE_KILOMETERS",SQUARE_FEET:"SQUARE_FEET",SQUARE_INCHES:"SQUARE_INCHES",SQUARE_YARDS:"SQUARE_YARDS",SQUARE_MILES:"SQUARE_MILES",ACRES:"ACRES",HECTARES:"HECTARES"}),o=e.freezeObject({CUBIC_METERS:"CUBIC_METERS",CUBIC_CENTIMETERS:"CUBIC_CENTIMETERS",CUBIC_KILOMETERS:"CUBIC_KILOMETERS",CUBIC_FEET:"CUBIC_FEET",CUBIC_INCHES:"CUBIC_INCHES",CUBIC_YARDS:"CUBIC_YARDS",CUBIC_MILES:"CUBIC_MILES"}),s=e.freezeObject({DEGREES:"DEGREES",RADIANS:"RADIANS",DEGREES_MINUTES_SECONDS:"DEGREES_MINUTES_SECONDS",GRADE:"GRADE",RATIO:"RATIO"});function r(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.distanceUnits=e.defaultValue(t.distanceUnits,i.METERS),this.areaUnits=e.defaultValue(t.areaUnits,n.SQUARE_METERS),this.volumeUnits=e.defaultValue(t.volumeUnits,o.CUBIC_METERS),this.angleUnits=e.defaultValue(t.angleUnits,s.DEGREES),this.slopeUnits=e.defaultValue(t.slopeUnits,s.DEGREES)}r.convertDistance=function(e,t,i){return t===i?e:e*l(t)*(1/l(i))},r.convertArea=function(e,t,i){return t===i?e:e*c(t)*(1/c(i))},r.convertVolume=function(e,t,i){return t===i?e:e*h(t)*(1/h(i))},r.convertAngle=function(t,i,n){return i===n?t:u(function(t,i){if(i===s.RADIANS)return t;if(i===s.DEGREES)return e.Math.toRadians(t);if(i===s.GRADE)return t===Number.POSITIVE_INFINITY?e.Math.PI_OVER_TWO:Math.atan(t/100);if(i===s.RATIO)return Math.atan(t);if(i===s.DEGREES_MINUTES_SECONDS){var n=d.exec(t);if(!e.defined(n))throw new e.RuntimeError("Could not convert angle to radians: "+t);var o=n[1].length>0?-1:1,r=parseInt(n[2]),a=parseInt(n[3]),l=parseFloat(n[4]),c=n[5];1===c.length&&("W"!==(c=c.toUpperCase())&&"S"!==c||(o*=-1));var h=o*(r+a/60+l/3600);return e.Math.toRadians(h)}throw new e.DeveloperError("Invalid angle units: "+i)}(t,i),n)},r.numberToString=function(e,t,i,n){return a(e,t,i,n)},r.distanceToString=function(e,t,n,o,s){return a(r.convertDistance(e,i.METERS,t),n,o,s)+r.getDistanceUnitSpacing(t)+r.getDistanceUnitSymbol(t)},r.areaToString=function(e,t,i,o,s){return a(r.convertArea(e,n.SQUARE_METERS,t),i,o,s)+r.getAreaUnitSpacing(t)+r.getAreaUnitSymbol(t)},r.volumeToString=function(e,t,i,n,s){return a(r.convertVolume(e,o.CUBIC_METERS,t),i,n,s)+r.getVolumeUnitSpacing(t)+r.getVolumeUnitSymbol(t)},r.angleToString=function(t,i,n,o,l){if(i===s.DEGREES||i===s.RADIANS||i===s.GRADE)return a(u(t,i),n,o,l)+r.getAngleUnitSpacing(i)+r.getAngleUnitSymbol(i);if(i===s.DEGREES_MINUTES_SECONDS){var c=e.Math.toDegrees(t),h=c<0?"-":"";c=Math.abs(c);var d=Math.floor(c),p=60*(c-d),m=Math.floor(p),_=60*(p-m);return h+d+"° "+m+"' "+(_=a(_,void 0,o,l))+'"'}return i===s.RATIO?"1:"+a(1/u(t,i),n,o,0):void 0},r.longitudeToString=function(e,t,i,n,o){return r.angleToString(Math.abs(e),t,i,n,o)+" "+(e<0?"W":"E")},r.latitudeToString=function(e,t,i,n,o){return r.angleToString(Math.abs(e),t,i,n,o)+" "+(e<0?"S":"N")},r.getDistanceUnitSymbol=function(t){if(e.Check.typeOf.string("distanceUnits",t),t===i.METERS)return"m";if(t===i.CENTIMETERS)return"cm";if(t===i.KILOMETERS)return"km";if(t===i.FEET||t===i.US_SURVEY_FEET)return"ft";if(t===i.INCHES)return"in";if(t===i.YARDS)return"yd";if(t===i.MILES)return"mi";throw new e.DeveloperError("Invalid distance units: "+t)},r.getDistanceUnitSpacing=function(t){return e.Check.typeOf.string("distanceUnits",t)," "},r.getAreaUnitSymbol=function(t){if(e.Check.typeOf.string("areaUnits",t),t===n.SQUARE_METERS)return"m²";if(t===n.SQUARE_CENTIMETERS)return"cm²";if(t===n.SQUARE_KILOMETERS)return"km²";if(t===n.SQUARE_FEET)return"sq ft";if(t===n.SQUARE_INCHES)return"sq in";if(t===n.SQUARE_YARDS)return"sq yd";if(t===n.SQUARE_MILES)return"sq mi";if(t===n.ACRES)return"ac";if(t===n.HECTARES)return"ha";throw new e.DeveloperError("Invalid area units: "+t)},r.getAreaUnitSpacing=function(t){return e.Check.typeOf.string("areaUnits",t)," "},r.getVolumeUnitSymbol=function(t){if(e.Check.typeOf.string("volumeUnits",t),t===o.CUBIC_METERS)return"m³";if(t===o.CUBIC_CENTIMETERS)return"cm³";if(t===o.CUBIC_KILOMETERS)return"km³";if(t===o.CUBIC_FEET)return"cu ft";if(t===o.CUBIC_INCHES)return"cu in";if(t===o.CUBIC_YARDS)return"cu yd";if(t===o.CUBIC_MILES)return"cu mi";throw new e.DeveloperError("Invalid volume units: "+t)},r.getVolumeUnitSpacing=function(t){return e.Check.typeOf.string("volumeUnits",t)," "},r.getAngleUnitSymbol=function(t){if(e.Check.typeOf.string("angleUnits",t),t===s.DEGREES)return"°";if(t===s.RADIANS)return"rad";if(t===s.GRADE)return"%";throw new e.DeveloperError("Invalid angle units: "+t)},r.getAngleUnitSpacing=function(t){return e.Check.typeOf.string("angleUnits",t),t===s.RADIANS?" ":""};function a(t,i,n,o){n=e.defaultValue(n,2);var s={minimumFractionDigits:o=e.defaultValue(o,n),maximumFractionDigits:n},r=t.toLocaleString(i,s);return r===(-0).toLocaleString(i,s)?(0).toLocaleString(i,s):r}function l(t){if(t===i.METERS)return 1;if(t===i.CENTIMETERS)return.01;if(t===i.KILOMETERS)return 1e3;if(t===i.FEET)return.3048;if(t===i.US_SURVEY_FEET)return 1200/3937;if(t===i.INCHES)return.0254;if(t===i.YARDS)return.9144;if(t===i.MILES)return 1609.344;throw new e.DeveloperError("Invalid distance units:"+t)}function c(t){if(t===n.SQUARE_METERS)return 1;if(t===n.SQUARE_CENTIMETERS)return 1e-4;if(t===n.SQUARE_KILOMETERS)return 1e6;if(t===n.SQUARE_FEET)return.09290304;if(t===n.SQUARE_INCHES)return 64516e-8;if(t===n.SQUARE_YARDS)return.83612736;if(t===n.SQUARE_MILES)return 2589988.110336;if(t===n.ACRES)return 4046.85642232;if(t===n.HECTARES)return 1e4;throw new e.DeveloperError("Invalid area units:"+t)}function h(t){if(t===o.CUBIC_METERS)return 1;if(t===o.CUBIC_CENTIMETERS)return 1e-6;if(t===o.CUBIC_KILOMETERS)return 1e9;if(t===o.CUBIC_FEET)return.09290304*.3048;if(t===o.CUBIC_INCHES)return 16387064e-12;if(t===o.CUBIC_YARDS)return.764554857984;if(t===o.CUBIC_MILES)return 4168181825.44058;throw new e.DeveloperError("Invalid volume units:"+t)}var d=/(-?)(\d+)\s*°\s*(\d+)\s*'\s*([\d.,]+)"\s*([WENS]?)/i;function u(t,i){if(i===s.RADIANS)return t;if(i===s.DEGREES)return e.Math.toDegrees(t);if(i===s.GRADE)return(t=e.Math.clamp(t,0,e.Math.PI_OVER_TWO))===e.Math.PI_OVER_TWO?Number.POSITIVE_INFINITY:100*Math.tan(t);if(i===s.RATIO)return Math.sin(t)/Math.cos(t);throw new e.DeveloperError("Invalid angle units: "+i)}var p=new e.Cartesian3(1,1,1),m=new e.Matrix4,_=new e.Cartesian3;function f(t,i,n){e.Check.defined("transform",t),e.Check.defined("originOffset",i),e.Check.defined("result",n);var o=e.Matrix4.getScale(t,_),s=e.Matrix4.setScale(t,p,m);return e.Matrix4.multiplyByPoint(s,e.Cartesian3.multiplyComponents(i,o,n),n)}function g(t){e.Check.defined("options",t),e.Check.defined("options.positions",t.positions),e.Check.defined("options.color",t.color),this.show=e.defaultValue(t.show,!0),this.id=t.id;var i=t.positions;t.loop&&(i=i.slice()).push(i[0]);var n=e.defaultValue(t.arrow,!1);this._width=e.defined(t.width)?t.width:n?25:8,this._color=t.color,this._depthFailColor=t.color.withAlpha(.3),this._positions=i,this._arrow=n,this._depthFail=e.defaultValue(t.depthFail,!0),this._primitive=void 0,this._boundingSphere=e.BoundingSphere.fromPoints(i),this._transformedBoundingSphere=e.BoundingSphere.clone(this._boundingSphere),this._modelMatrix=e.Matrix4.clone(e.Matrix4.IDENTITY),this._update=!0}e.defineProperties(g.prototype,{modelMatrix:{get:function(){return this._modelMatrix},set:function(t){e.Matrix4.equalsEpsilon(t,this._modelMatrix,e.Math.EPSILON10)||(this._modelMatrix=e.Matrix4.clone(t,this._modelMatrix),this._update=!0)}},positions:{get:function(){return this._positions},set:function(e){this._positions=e,this._update=!0}},color:{get:function(){return this._color}},width:{get:function(){return this._width}},boundingVolume:{get:function(){return this._transformedBoundingSphere}}}),g.prototype.update=function(t){if(this.show){if(this._update){this._update=!1,this._primitive=this._primitive&&this._primitive.destroy();var i,n,o=new e.PolylineGeometry({positions:this._positions,width:this._width,vertexFormat:e.PolylineMaterialAppearance.VERTEX_FORMAT,arcType:e.ArcType.NONE});this._arrow?(i=new e.PolylineMaterialAppearance({material:e.Material.fromType(e.Material.PolylineArrowType,{color:this._color})}),this._depthFail&&(n=new e.PolylineMaterialAppearance({material:e.Material.fromType(e.Material.PolylineArrowType,{color:this._depthFailColor})}))):(i=new e.PolylineColorAppearance({translucent:1!==this._color.alpha}),this._depthFail&&(n=new e.PolylineColorAppearance({translucent:1!==this._depthFailColor.alpha})));var s=this._modelMatrix;this._primitive=new e.Primitive({geometryInstances:new e.GeometryInstance({geometry:o,attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(this._color),depthFailColor:e.ColorGeometryInstanceAttribute.fromColor(this._depthFailColor)},id:this.id,modelMatrix:s}),appearance:i,depthFailAppearance:n,asynchronous:!1}),this._transformedBoundingSphere=e.BoundingSphere.transform(this._boundingSphere,s,this._transformedBoundingSphere)}this._primitive.update(t)}},g.prototype.isDestroyed=function(){return!1},g.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),e.destroyObject(this)};var C={X:"X",Y:"Y",Z:"Z",getValue:function(t){return t===C.X?e.Cartesian3.UNIT_X:t===C.Y?e.Cartesian3.UNIT_Y:e.Cartesian3.UNIT_Z},getColor:function(t){return t===C.X?e.Color.RED:t===C.Y?e.Color.GREEN:e.Color.BLUE}},v=e.freezeObject(C),y=new e.Cartesian3,w=new e.Cartesian2,b=new e.Cartesian3,E=new e.Cartesian3;function S(t,i,n,o,s){var r=function(t,i,n,o,s){var r,a,l=1,c=1;return t.x>0&&(a=t.x*n.x,l=Math.min(a,i.x)/o.x),t.y>0&&(a=t.y*n.y,c=Math.min(a,i.y)/o.y),r=(l+c)/2,e.Cartesian3.fromElements(l,c,r,s)}(t,i,function(t,i,n){var o=t.context,s=t.camera.positionWC,r=e.Cartesian3.distance(i,s),a=o.drawingBufferWidth,l=o.drawingBufferHeight;return t.camera.frustum.getPixelDimensions(a,l,r,t.pixelRatio,n)}(n,e.Matrix4.getTranslation(o,y),w),e.Matrix4.getScale(o,b),E);return e.Matrix4.multiplyByScale(o,r,s)}var M=new e.Cartesian3(1,1,1),T=new e.Cartesian3,x=new e.Cartesian3,P=new e.Cartesian3,k=new e.Matrix4,R=new e.Matrix4,O=new e.Cartesian3,A=new e.Cartesian3,I=new e.Cartesian2,D=new e.Cartesian2,L=new e.HeadingPitchRoll,U=new e.Ray,N=new e.Cartesian3,V=new e.Quaternion,F=new e.Matrix3,B=1/0;function z(t,i,n,o,s){var r=e.Matrix4.inverse(t,R),a=e.Matrix4.multiplyByPoint(r,o,O),l=e.Matrix4.multiplyByPoint(r,s,A);a=e.Cartesian3.subtract(a,i,a),l=e.Cartesian3.subtract(l,i,l);var c=I,h=D;n.x?(c.x=a.y,c.y=a.z,h.x=l.y,h.y=l.z):n.y?(c.x=-a.x,c.y=a.z,h.x=-l.x,h.y=l.z):(c.x=a.x,c.y=a.y,h.x=l.x,h.y=l.y);var d=c.x*h.y-c.y*h.x>=0,u=e.Cartesian2.angleBetween(c,h);return d||(u=-u),u}function H(e,t){return new g({positions:e,color:v.getColor(t),loop:!0,show:!1,id:t})}function j(t){var i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).scene;this._vectorLine1=i.primitives.add(new g({width:5,positions:[new e.Cartesian3,new e.Cartesian3],color:e.Color.YELLOW,show:!1})),this._vectorLine2=i.primitives.add(new g({width:5,positions:[new e.Cartesian3,new e.Cartesian3],color:e.Color.YELLOW,show:!1}));var n=function(){for(var t=[],i=[],n=[],o=0;o<360;o++){var s=e.Math.toRadians(o),r=Math.cos(s),a=Math.sin(s);t.push(new e.Cartesian3(0,r,a)),i.push(new e.Cartesian3(a,0,r)),n.push(new e.Cartesian3(r,a,0))}return{x:t,y:i,z:n}}();this._polylineX=i.primitives.add(H(n.x,v.X)),this._polylineY=i.primitives.add(H(n.y,v.Y)),this._polylineZ=i.primitives.add(H(n.z,v.Z)),this._modelMatrix=e.Matrix4.clone(e.Matrix4.IDENTITY),this.originOffset=t.originOffset,this._scene=i,this._setHPRCallback=t.setHeadingPitchRoll,this._setPositionCallback=t.setPosition,this._transform=t.transform,this._radius=t.radius,this._active=!1,this._dragging=!1,this._startTransform=new e.Matrix4,this._startRotation=new e.Matrix3,this._widgetOrigin=new e.Cartesian3,this._modelOrigin=new e.Cartesian3,this._rotationAxis=void 0,this._rotationPlane=new e.Plane(e.Cartesian3.UNIT_X,0),this._rotationStartPoint=new e.Cartesian3,this._pixelSize=e.defined(t.pixelSize)?new e.Cartesian2(t.pixelSize,t.pixelSize):new e.Cartesian2(100,100),this._maximumSizeInMeters=e.defined(t.maximumSizeInMeters)?new e.Cartesian2(t.maximumSizeInMeters,t.maximumSizeInMeters):new e.Cartesian2(B,B),this.update()}e.defineProperties(j.prototype,{active:{get:function(){return this._active},set:function(e){this._active=e,e?(this._polylineX.show=!0,this._polylineY.show=!0,this._polylineZ.show=!0):(this._polylineX.show=!1,this._polylineY.show=!1,this._polylineZ.show=!1,this._dragging=!1)}},pixelSize:{get:function(){return this._pixelSize.x}},maximumSizeInMeters:{get:function(){return this._maximumSizeInMeters.x}}}),j.prototype.update=function(){var t=this._transform,i=this._modelMatrix;i=e.Matrix4.setScale(t,M,i);var n=f(t,this.originOffset,x);i=e.Matrix4.setTranslation(i,n,i);var o=this._radius*e.Matrix4.getMaximumScale(this._transform)*1.25;i=e.Matrix4.multiplyByUniformScale(i,o,i),this._pixelSize.x>0&&(i=S(this._pixelSize,this._maximumSizeInMeters,this._scene.frameState,i,i)),this._polylineX.modelMatrix=i,this._polylineY.modelMatrix=i,this._polylineZ.modelMatrix=i},j.prototype.handleLeftDown=function(t){for(var i,n=this._scene,o=n.drillPick(t),s=0;s<o.length;s++){var r=o[s];if(e.defined(r.id)&&e.defined(v[r.id])){i=r.id;break}}if(e.defined(i)){var a=v.getValue(i),l=e.Matrix4.setScale(this._transform,M,this._startTransform);this._startRotation=e.Matrix4.getMatrix3(l,this._startRotation);var c=e.Matrix4.getTranslation(l,this._modelOrigin),h=f(this._transform,this.originOffset,this._widgetOrigin),d=e.Matrix4.multiplyByPoint(l,a,P),u=e.Cartesian3.subtract(d,c,d);u=e.Cartesian3.normalize(u,u);var p=e.Plane.fromPointNormal(h,u,this._rotationPlane),m=e.IntersectionTests.rayPlane(n.camera.getPickRay(t,U),p,this._rotationStartPoint);this._dragging=e.defined(m),this._rotationAxis=a,n.screenSpaceCameraController.enableInputs=!1}},j.prototype.handleMouseMove=function(t){if(this._dragging){var i=this._scene,n=i.camera.getPickRay(t,U),o=e.IntersectionTests.rayPlane(n,this._rotationPlane,N);if(e.defined(o)){var s=this._widgetOrigin,r=this._modelOrigin,a=this._rotationStartPoint,l=this._vectorLine1,c=l.positions,h=this._vectorLine2,d=h.positions,u=e.Cartesian3.subtract(a,s,I),p=e.Cartesian3.subtract(o,s,D);p=e.Cartesian3.normalize(p,p),p=e.Cartesian3.multiplyByScalar(p,e.Cartesian3.magnitude(u),p),o=e.Cartesian3.add(s,p,o),c[0]=s,c[1]=a,d[0]=s,d[1]=o,l.positions=c,h.positions=d,l.show=!0,h.show=!0;var m=e.Cartesian3.multiplyComponents(this.originOffset,e.Matrix4.getScale(this._transform,T),T),_=this._rotationAxis,f=z(this._startTransform,m,_,a,o),g=e.Matrix3.fromQuaternion(e.Quaternion.fromAxisAngle(_,f,V),F);g=e.Matrix3.multiply(this._startRotation,g,g);var C=e.Matrix4.fromRotationTranslation(g,r,k);this._setHPRCallback(e.Transforms.fixedFrameToHeadingPitchRoll(C,i.mapProjection.ellipsoid,void 0,L));var v=e.Cartesian3.negate(m,I);v=e.Matrix3.multiplyByVector(g,v,v),r=e.Cartesian3.add(v,s,r),this._setPositionCallback(r)}}},j.prototype.handleLeftUp=function(){this._dragging=!1,this._vectorLine1.show=!1,this._vectorLine2.show=!1,this._scene.screenSpaceCameraController.enableInputs=!0},j.prototype.isDestroyed=function(){return!1},j.prototype.destroy=function(){this.active=!1;var t=this._scene;t.primitives.remove(this._vectorLine1),t.primitives.remove(this._vectorLine2),t.primitives.remove(this._polylineX),t.primitives.remove(this._polylineY),t.primitives.remove(this._polylineZ),e.destroyObject(this)},j._getRotationAngle=z;var Q=new e.Cartesian3,X=new e.Cartesian3,Y=new e.Cartesian3,Z=new e.Cartesian3,q=new e.Cartesian3,K=new e.Cartesian3,W=new e.Cartesian3,J=new e.Ray,G=new e.Cartesian3(1,1,1),ee=new e.Cartesian3,te=1/0;function ie(e){return{position:v.getValue(e),show:!1,color:v.getColor(e),pixelSize:20,disableDepthTestDistance:Number.POSITIVE_INFINITY,id:e}}function ne(t){return new g({positions:[e.Cartesian3.ZERO,v.getValue(t)],color:v.getColor(t),id:t,show:!1})}function oe(t){var i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).scene,n=t.transform,o=i.primitives.add(new e.PointPrimitiveCollection);this.originOffset=t.originOffset,this._points=o,this._pointX=o.add(ie(v.X)),this._pointY=o.add(ie(v.Y)),this._pointZ=o.add(ie(v.Z)),this._polylineX=i.primitives.add(ne(v.X)),this._polylineY=i.primitives.add(ne(v.Y)),this._polylineZ=i.primitives.add(ne(v.Z)),this._scene=i,this._canvas=i.canvas,this._enableNonUniformScaling=t.enableNonUniformScaling,this._setPositionCallback=t.setPosition,this._setScaleCallback=t.setScale,this._modelMatrix=new e.Matrix4,this._pickedAxis=void 0,this._dragAlongVector=void 0,this._offsetVector=new e.Cartesian3,this._pickingPlane=new e.Plane(e.Cartesian3.UNIT_X,0),this._dragging=!1,this._startPosition=new e.Cartesian3,this._startScale=new e.Cartesian3,this._startOffset=new e.Cartesian3,this._startTransform=new e.Matrix4,this._active=!1,this._transform=n,this._lineLength=1.5*t.radius,this._pixelSize=e.defined(t.pixelSize)?new e.Cartesian2(t.pixelSize,t.pixelSize):new e.Cartesian2(100,100),this._maximumSizeInMeters=e.defined(t.maximumSizeInMeters)?new e.Cartesian2(t.maximumSizeInMeters,t.maximumSizeInMeters):new e.Cartesian2(te,te),this.update()}e.defineProperties(oe.prototype,{active:{get:function(){return this._active},set:function(e){this._active=e,e?(this._pointX.show=!0,this._pointY.show=!0,this._pointZ.show=!0,this._polylineX.show=!0,this._polylineY.show=!0,this._polylineZ.show=!0):(this._pointX.show=!1,this._pointY.show=!1,this._pointZ.show=!1,this._polylineX.show=!1,this._polylineY.show=!1,this._polylineZ.show=!1,this._dragging=!1)}},pixelSize:{get:function(){return this._pixelSize.x}},maximumSizeInMeters:{get:function(){return this._maximumSizeInMeters.x}}}),oe.prototype.handleLeftDown=function(t){for(var i,n=this._scene,o=this._transform,s=n.camera,r=n.drillPick(t),a=e.Matrix4.getTranslation(o,X),l=0;l<r.length;l++){var c=r[l];if(e.defined(c.id)&&e.defined(v[c.id])){i=c.id;break}}if(e.defined(i)){var h=v.getValue(i),d=e.Matrix4.multiplyByPointAsVector(this._modelMatrix,h,Y),u=Z;u=Math.abs(e.Cartesian3.dot(s.upWC,d))>.7?e.Cartesian3.cross(s.rightWC,d,u):e.Cartesian3.cross(s.upWC,d,u),e.Cartesian3.normalize(u,u);var p=e.Plane.fromPointNormal(a,u,this._pickingPlane),m=e.IntersectionTests.rayPlane(s.getPickRay(t,J),p,this._startPosition);if(e.defined(m)){this._offsetVector=e.Cartesian3.subtract(m,a,this._offsetVector),this._dragging=!0;var _,f=e.Matrix4.getScale(o,this._startScale);_=i===v.X?f.x:i===v.Y?f.y:f.z,this._startValue=_,this._startOffset=e.Cartesian3.multiplyComponents(this.originOffset,f,this._startOffset),this._dragAlongVector=h,this._pickedAxis=i,this._startTransform=e.Matrix4.setScale(o,G,this._startTransform),n.screenSpaceCameraController.enableInputs=!1}}},oe.prototype.handleMouseMove=function(t){if(this._dragging){var i=this._scene.camera,n=e.IntersectionTests.rayPlane(i.getPickRay(t,J),this._pickingPlane,q);if(e.defined(n)){var o=this._dragAlongVector,s=e.Matrix4.multiplyByPointAsVector(this._modelMatrix,o,Y),r=e.Cartesian3.subtract(n,this._startPosition,K);r=e.Cartesian3.projectVector(r,s,r);var a=e.Cartesian3.magnitude(r);if(e.Cartesian3.dot(r,this._offsetVector)<0&&(a=-a),a/=this._lineLength,!((a+=this._startValue)<=0)){var l=this._pickedAxis,c=this._startScale;this._enableNonUniformScaling()?l===v.X?c.x=a:l===v.Y?c.y=a:c.z=a:(c.x=a,c.y=a,c.z=a);var h=e.Cartesian3.multiplyComponents(this.originOffset,c,W);h=e.Cartesian3.subtract(this._startOffset,h,h),h=e.Matrix4.multiplyByPoint(this._startTransform,h,h),this._setScaleCallback(c),this._setPositionCallback(h)}}}},oe.prototype.handleLeftUp=function(){this._dragging=!1,this._scene.screenSpaceCameraController.enableInputs=!0},oe.prototype.update=function(){var t=this._modelMatrix,i=this._transform,n=f(i,this.originOffset,Q);t=e.Matrix4.multiplyByUniformScale(i,this._lineLength,t),t=e.Matrix4.setTranslation(this._modelMatrix,n,t);var o=0<this._pixelSize.x;o&&(t=S(this._pixelSize,this._maximumSizeInMeters,this._scene.frameState,t,t)),o&&this._enableNonUniformScaling&&((ee=e.Matrix4.getScale(t,ee)).x>=ee.y?(ee.y=ee.x,ee.z=ee.x):ee.y>=ee.x&&(ee.x=ee.y,ee.z=ee.y),t=e.Matrix4.setScale(t,ee,t)),this._polylineX.modelMatrix=t,this._polylineY.modelMatrix=t,this._polylineZ.modelMatrix=t,this._points.modelMatrix=t},oe.prototype.isDestroyed=function(){return!1},oe.prototype.destroy=function(){this.active=!1;var t=this._scene;this._points.removeAll(),t.primitives.remove(this._polylineX),t.primitives.remove(this._polylineY),t.primitives.remove(this._polylineZ),t.primitives.remove(this._points),e.destroyObject(this)};var se=new e.Cartesian3,re=new e.Cartesian3,ae=new e.Cartesian3,le=new e.Cartesian3,ce=new e.Cartesian3,he=new e.Cartesian3,de=new e.Cartesian3,ue=new e.Ray,pe=1/0;function me(t){return new g({positions:[e.Cartesian3.ZERO,v.getValue(t)],arrow:!0,color:v.getColor(t),id:t,show:!1})}function _e(t){var i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).scene;this.originOffset=t.originOffset,this._polylineX=i.primitives.add(me(v.X)),this._polylineY=i.primitives.add(me(v.Y)),this._polylineZ=i.primitives.add(me(v.Z)),this._scene=i,this._canvas=i.canvas,this._setPositionCallback=t.setPosition,this._modelMatrix=new e.Matrix4,this._fixedFrame=new e.Matrix4,this._hpr=new e.HeadingPitchRoll,this._dragAlongVector=void 0,this._offsetVector=new e.Cartesian3,this._pickingPlane=new e.Plane(e.Cartesian3.UNIT_X,0),this._dragging=!1,this._active=!1,this._transform=t.transform,this._radius=t.radius,this._pixelSize=e.defined(t.pixelSize)?new e.Cartesian2(t.pixelSize,t.pixelSize):new e.Cartesian2(100,100),this._maximumSizeInMeters=e.defined(t.maximumSizeInMeters)?new e.Cartesian2(t.maximumSizeInMeters,t.maximumSizeInMeters):new e.Cartesian2(pe,pe),this.update()}e.defineProperties(_e.prototype,{active:{get:function(){return this._active},set:function(e){this._active=e,e?(this._polylineX.show=!0,this._polylineY.show=!0,this._polylineZ.show=!0):(this._polylineX.show=!1,this._polylineY.show=!1,this._polylineZ.show=!1,this._dragging=!1)},pixelSize:{get:function(){return this._pixelSize.x}},maximumSizeInMeters:{get:function(){return this._maximumSizeInMeters.x}}}}),_e.prototype.update=function(){var t=this._transform,i=this._scene.mapProjection.ellipsoid,n=e.Matrix4.getTranslation(t,re),o=f(t,this.originOffset,se),s=this._radius*e.Matrix4.getMaximumScale(this._transform)*1.5,r=e.Transforms.fixedFrameToHeadingPitchRoll(this._transform,i,void 0,this._hpr);r.pitch=0,r.roll=0;var a=e.Transforms.headingPitchRollToFixedFrame(n,r,i,void 0,this._fixedFrame);a=e.Matrix4.setTranslation(a,o,a);var l=e.Matrix4.multiplyByUniformScale(a,s,this._modelMatrix);this._pixelSize.x>0&&(l=S(this._pixelSize,this._maximumSizeInMeters,this._scene.frameState,l,l)),this._polylineX.modelMatrix=l,this._polylineY.modelMatrix=l,this._polylineZ.modelMatrix=l},_e.prototype.handleLeftDown=function(t){for(var i,n=this._scene,o=n.camera,s=n.drillPick(t),r=0;r<s.length;r++){var a=s[r];if(e.defined(a.id)&&e.defined(v[a.id])){i=a.id;break}}if(e.defined(i)){var l=e.Matrix4.getTranslation(this._transform,re),c=v.getValue(i),h=e.Matrix4.multiplyByPointAsVector(this._fixedFrame,c,ae),d=le;d=Math.abs(e.Cartesian3.dot(o.upWC,h))>.7?e.Cartesian3.cross(o.rightWC,h,d):e.Cartesian3.cross(o.upWC,h,d),e.Cartesian3.normalize(d,d);var u=e.Plane.fromPointNormal(l,d,this._pickingPlane),p=e.IntersectionTests.rayPlane(o.getPickRay(t,ue),u,this._offsetVector);e.defined(p)&&(e.Cartesian3.subtract(p,l,p),this._dragging=!0,this._dragAlongVector=c,n.screenSpaceCameraController.enableInputs=!1)}},_e.prototype.handleMouseMove=function(t){if(this._dragging){var i=this._scene.camera,n=e.IntersectionTests.rayPlane(i.getPickRay(t,ue),this._pickingPlane,ce);if(e.defined(n)){var o=this._dragAlongVector,s=e.Matrix4.getTranslation(this._transform,re),r=e.Matrix4.multiplyByPointAsVector(this._fixedFrame,o,ae),a=e.Cartesian3.subtract(n,s,he);a=e.Cartesian3.projectVector(a,r,a);var l=e.Cartesian3.projectVector(this._offsetVector,r,de);a=e.Cartesian3.subtract(a,l,a),s=e.Cartesian3.add(s,a,s),this._setPositionCallback(s)}}},_e.prototype.handleLeftUp=function(){this._dragging=!1,this._scene.screenSpaceCameraController.enableInputs=!0},_e.prototype.isDestroyed=function(){return!1},_e.prototype.destroy=function(){this.active=!1;var t=this._scene;t.primitives.remove(this._polylineX),t.primitives.remove(this._polylineY),t.primitives.remove(this._polylineZ),e.destroyObject(this)};var fe=new e.Cartesian3,ge=new e.Cartesian2,Ce=new e.Cartesian3(1,1,1),ve=new e.Matrix4,ye=new e.Cartesian3,we=new e.Cartesian3,be={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale"},Ee=new e.Quaternion,Se=new e.Quaternion,Me=new e.Cartesian3,Te=new e.Cartesian3,xe=new e.Cartesian3,Pe=new e.Matrix4,ke=new e.Matrix3;function Re(t,i){e.Check.defined("transform",t),e.Check.defined("headingPitchRoll",i);var n=e.Quaternion.fromHeadingPitchRoll(i,Ee),o=e.Matrix4.getTranslation(t,Me),s=e.Matrix4.getScale(t,Te),r=e.Matrix4.multiplyByPoint(t,e.Cartesian3.ZERO,xe),a=e.Transforms.eastNorthUpToFixedFrame(r,void 0,Pe),l=e.Matrix4.getMatrix3(a,ke),c=e.Quaternion.fromRotationMatrix(l,Se),h=e.Quaternion.multiply(c,n,l);return e.Matrix4.fromTranslationQuaternionRotationScale(o,h,s,t)}function Oe(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),e.Check.defined("options.scene",t.scene),e.Check.defined("options.transform",t.transform),e.Check.defined("options.boundingSphere",t.boundingSphere);var i=t.scene,n=t.transform,o=t.boundingSphere.clone(),s=e.defaultValue(t.originOffset,e.Cartesian3.ZERO),r=e.Matrix4.getTranslation(n,new e.Cartesian3),a=e.Transforms.fixedFrameToHeadingPitchRoll(n,i.mapProjection.ellipsoid,void 0,new e.HeadingPitchRoll),l=e.Matrix4.getScale(n,new e.Cartesian3);e.Cartesian3.equalsEpsilon(r,e.Cartesian3.ZERO,e.Math.EPSILON10)&&(r=e.Cartesian3.fromDegrees(0,0,0,i.mapProjection.ellipsoid,r),Re(n=e.Matrix4.setTranslation(n,r,n),a));var c=!0;e.Math.equalsEpsilon(l.x,l.y,e.Math.EPSILON10)&&e.Math.equalsEpsilon(l.x,l.z,e.Math.EPSILON10)&&(c=!1,l.y=l.x,l.z=l.x);var h=o.radius/e.Cartesian3.maximumComponent(l);this.editorMode=void 0;var d=e.knockout.observable();e.knockout.defineProperty(this,"editorMode",{get:function(){return d()},set:function(t){var i;d(t),e.defined(this._activeEditor)&&(this._activeEditor.active=!1),t===be.ROTATION?i=this._rotationEditor:t===be.TRANSLATION?i=this._translationEditor:t===be.SCALE&&(i=this._scaleEditor),i.update(),i.active=!0,this._activeEditor=i}}),this.enableNonUniformScaling=c;var u=e.knockout.observable(this.enableNonUniformScaling);e.knockout.defineProperty(this,"enableNonUniformScaling",{get:function(){return u()},set:function(t){t!==u()&&(u(t),t||(this.scale=new e.Cartesian3(l.x,l.x,l.x),i.requestRenderMode&&i.requestRender()))}}),this.position=r;var p=e.knockout.observable(this.position);e.knockout.defineProperty(this,"position",{get:function(){return p()},set:function(t){if(!e.Cartesian3.equals(t,this.position)){var n=e.Cartesian3.clone(t,this.position);p(n);var o=this._transform;Re(o=e.Matrix4.setTranslation(o,n,o),this.headingPitchRoll),i.requestRenderMode&&i.requestRender();var s=Cesium.Cartographic.fromCartesian(t),r=Cesium.Math.toDegrees(s.longitude),a=Cesium.Math.toDegrees(s.latitude);$("#tileset_longitude").val(r),$("#tileset_latitude").val(a),$("#tileset_altitude").val(s.height)}}}),this.headingPitchRoll=a;var m=e.knockout.observable(this.headingPitchRoll);e.knockout.defineProperty(this,"headingPitchRoll",{get:function(){return m()},set:function(t){if(!e.HeadingPitchRoll.equals(t,this.headingPitchRoll)){var n=e.HeadingPitchRoll.clone(t,this.headingPitchRoll);m(n),Re(this._transform,n),i.requestRenderMode&&i.requestRender()}}}),this.scale=l;var _=e.knockout.observable(this.scale);e.knockout.defineProperty(this,"scale",{get:function(){return _()},set:function(t){if(!e.Cartesian3.equals(t,this.scale)){var n=e.Cartesian3.clone(t,this.scale);_(n),e.Matrix4.setScale(this._transform,n,this._transform),this._translationEditor.update(),this._rotationEditor.update(),i.requestRenderMode&&i.requestRender()}}}),this.menuExpanded=!1,this.left="0",this.top="0",this.active=!1,e.knockout.track(this,["menuExpanded","left","top","active"]);var f=this;this._rotationEditor=new j({scene:i,transform:n,radius:h,originOffset:s,setPosition:function(e){f.position=e},setHeadingPitchRoll:function(e){f.headingPitchRoll=e}}),this._translationEditor=new _e({scene:i,transform:n,radius:h,originOffset:s,setPosition:function(e){f.position=e}}),this._scaleEditor=new oe({scene:i,transform:n,enableNonUniformScaling:u,radius:h,originOffset:s,setScale:function(e){f.scale=e},setPosition:function(e){f.position=e}}),this._sseh=new e.ScreenSpaceEventHandler(i.canvas),this._scene=i,this._transform=n,this._boundingSphere=o,this._active=!1,this._activeEditor=void 0,this._originOffset=s,this.position=r,this.headingPitchRoll=a,this.scale=l,this._removePostUpdateEvent=this._scene.preUpdate.addEventListener(Oe.prototype._update,this)}function Ae(t){e.Check.typeOf.string("html",t);var i=document.createElement("div");return i.innerHTML=t,1===i.children.length?i.removeChild(i.firstChild):i}function Ie(t){if("string"==typeof t){var i=document.getElementById(t);if(null===i)throw new e.DeveloperError('Element with id "'+t+'" does not exist in the document.');t=i}return t}e.defineProperties(Oe.prototype,{originOffset:{get:function(){return this._originOffset},set:function(t){e.Check.defined("value",t),this._originOffset=t,this._translationEditor.originOffset=t,this._rotationEditor.originOffset=t,this._scaleEditor.originOffset=t}}}),Oe.prototype.setOriginPosition=function(t){e.Check.defined("position",t);var i=e.Matrix4.setScale(this._transform,Ce,ve),n=e.Matrix4.inverseTransformation(i,i),o=e.Matrix4.multiplyByPoint(n,t,ye),s=e.Cartesian3.divideComponents(o,e.Matrix4.getScale(this._transform,we),o);this.originOffset=s},Oe.prototype.activate=function(){var t=this._sseh,i=this._scene;t.setInputAction(this._leftDown.bind(this),e.ScreenSpaceEventType.LEFT_DOWN),t.setInputAction(this._leftUp.bind(this),e.ScreenSpaceEventType.LEFT_UP),t.setInputAction(this._mouseMove.bind(this),e.ScreenSpaceEventType.MOUSE_MOVE),this.active=!0,e.defined(this._activeEditor)?this._activeEditor.active=!0:this.setModeTranslation(),i.requestRenderMode&&i.requestRender()},Oe.prototype.deactivate=function(){var t=this._sseh,i=this._scene;t.removeInputAction(this._leftDown.bind(this),e.ScreenSpaceEventType.LEFT_DOWN),t.removeInputAction(this._leftUp.bind(this),e.ScreenSpaceEventType.LEFT_UP),t.removeInputAction(this._mouseMove.bind(this),e.ScreenSpaceEventType.MOUSE_MOVE),this.active=!1,e.defined(this._activeEditor)&&(this._activeEditor.active=!1),i.requestRenderMode&&i.requestRender()},Oe.prototype.expandMenu=function(){this.menuExpanded=!0},Oe.prototype.setModeTranslation=function(){this.editorMode=be.TRANSLATION,this.menuExpanded=!1},Oe.prototype.setModeRotation=function(){this.editorMode=be.ROTATION,this.menuExpanded=!1},Oe.prototype.setModeScale=function(){this.editorMode=be.SCALE,this.menuExpanded=!1},Oe.prototype.toggleNonUniformScaling=function(){this.enableNonUniformScaling=!this.enableNonUniformScaling},Oe.prototype._leftDown=function(e){this._activeEditor.handleLeftDown(e.position);var t=this._scene;t.requestRenderMode&&t.requestRender()},Oe.prototype._mouseMove=function(e){this._activeEditor.handleMouseMove(e.endPosition);var t=this._scene;t.requestRenderMode&&t.requestRender()},Oe.prototype._leftUp=function(e){this.menuExpanded=!1,this._activeEditor.handleLeftUp(e.position);var t=this._scene;t.requestRenderMode&&t.requestRender()},Oe.prototype._update=function(){if(this.active){this._activeEditor.update();var t=this._scene,i=f(this._transform,this._originOffset,fe),n=e.SceneTransforms.wgs84ToWindowCoordinates(t,i,ge);e.defined(n)&&(this.left=Math.floor(n.x-13)+"px",this.top=Math.floor(n.y)+"px")}},Oe.prototype.isDestroyed=function(){return!1},Oe.prototype.destroy=function(){this.deactivate(),this._sseh.destroy(),this._rotationEditor.destroy(),this._translationEditor.destroy(),this._scaleEditor.destroy(),this._removePostUpdateEvent(),e.destroyObject(this)},Oe.EditorMode=be;function De(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),e.Check.defined("options.container",t.container),e.Check.defined("options.scene",t.scene),e.Check.defined("options.transform",t.transform),e.Check.defined("options.boundingSphere",t.boundingSphere);var i=Ie(t.container),n=Ae('<div class="transform-editor-menu" data-bind="style: {left: left, top: top}, visible: active">        <div class="cesium-button transform-editor-button" data-bind="click: expandMenu, visible: !menuExpanded">            <svg width="20" height="20" viewBox="0 0 20 20">                <g>                    <circle cx="2" cy="10" r="2" />                    <circle cx="10" cy="10" r="2" />                    <circle cx="18" cy="10" r="2" />                </g>            </svg>        </div>        <div class="transform-editor-options" data-bind="visible: menuExpanded">            <div class="transform-editor-button-row">                <div title="Translation" data-bind="click: setModeTranslation, css: {selected: editorMode === \'translation\'}">                    <svg viewBox="0 0 25 25" height="25" width="25">                        <g>                            <circle r="3" cy="22" cx="3" />                            <path d="M 19.543379,4.59439 3.9750205,19.96158 5.3793174,21.3854 20.947676,6.01822 Z"/>                            <path d="m 14.699824,3.80366 10.231411,-3.34922 -3.215586,10.03096 z"/>                        </g>                    </svg>                </div                ><div title="Rotation" data-bind="click: setModeRotation, css: {selected: editorMode === \'rotation\'}">                    <svg viewBox="0 0 25 25" height="25" width="25">                        <g>                            <path d="M 13.033371,10.08295 2.6713568,7.16272 10.931013,0.62527 Z"/>                            <path d="m 13.741358,3.87055 c -0.747592,-0.006 -1.506137,0.0593 -2.263621,0.20287 l 0.484334,2.29127 c 4.712769,-0.89305 9.471467,2.11386 10.414021,6.57912 0.942553,4.46525 -2.229345,8.97402 -6.942115,9.86707 -4.71277,0.89305 -9.4731664,-2.11226 -10.4157205,-6.57752 l -2.4165696,0.45729 c 1.2119755,5.74161 7.2550484,9.55981 13.3149241,8.41149 6.059877,-1.14833 10.089725,-6.87562 8.87775,-12.61723 -1.060479,-5.02391 -5.819851,-8.57436 -11.053003,-8.61436 z"/>                        </g>                    </svg>               </div>            </div>            <div class="transform-editor-button-row">                <div title="Scale" data-bind="click: setModeScale, css: {selected: editorMode === \'scale\'}">                    <svg width="25" height="25" viewBox="0 0 25 25">                        <g>                            <path d="M 19.543379,4.59439 3.9750205,19.96158 5.3793174,21.3854 20.947676,6.01822 Z"/>                            <path d="m 14.699824,3.80366 10.231411,-3.34922 -3.215586,10.03096 z" />                            <path d="M 10.333866,21.9809 0.10245523,25.33012 3.3180412,15.29916 Z" />                        </g>                    </svg>                </div                ><div data-bind="click: toggleNonUniformScaling">                    <div title="Switch to non-uniform scaling" data-bind="visible: !enableNonUniformScaling">                        <svg width="25" height="25" viewBox="0 0 25 25">                            <g>                                <path d="m 0.5,1.38477 h 1.9960938 v -1 H 0.5 c 0,0.33333 0,0.66667 0,1 z m 2.9941406,0 h 1.9980469 v -1 H 3.4941406 Z m 2.9960938,0 h 1.9960937 v -1 H 6.4902344 Z m 2.9960937,0 h 1.9960939 v -1 H 9.4863281 Z m 2.9941409,0 h 1.998047 v -1 h -1.998047 z m 2.996093,0 h 1.996094 v -1 h -1.996094 z m 2.994141,0 h 1.998047 v -1 h -1.998047 z m 2.996094,0 h 1.998047 v -1 h -1.998047 z m 2.535156,-0.5 v 1.95898 H 25 v -1.95898 z M 0,4.0332 h 0.99804688 v -1.99609 H 0 Z m 24.001953,1.80469 H 25 V 3.8418 H 24.001953 Z M 0,7.0293 h 0.99804688 v -1.99805 H 0 Z m 24.001953,1.80468 H 25 v -1.99609 H 24.001953 Z M 0,10.02344 h 0.99804688 v -1.9961 H 0 Z m 24.001953,1.80664 H 25 v -1.99805 H 24.001953 Z M 0,13.01953 h 0.99804688 v -1.99609 H 0 Z m 24.001953,1.80469 H 25 v -1.9961 H 24.001953 Z M 0,16.01562 h 0.99804688 v -1.99804 H 0 Z m 24.001953,1.80469 H 25 v -1.99804 H 24.001953 Z M 0,19.00977 h 0.99804688 v -1.9961 H 0 Z m 24.001953,1.80664 H 25 v -1.99805 H 24.001953 Z M 0,22.00586 h 0.99804688 v -1.99609 H 0 Z m 24.001953,1.80469 H 25 v -1.9961 H 24.001953 Z M 0,24.88672 v 0.49805 h 0.5 0.11523438 v -0.49805 h 0.3828125 v -1.88281 H 0 Z m 1.6132812,0.49805 H 3.609375 v -0.99805 H 1.6132812 Z m 2.9941407,0 h 1.9980469 v -0.99805 H 4.6074219 Z m 2.9960937,0 h 1.9980469 v -0.99805 H 7.6035156 Z m 2.9960934,0 h 1.996094 v -0.99805 h -1.996094 z m 2.994141,0 h 1.998047 v -0.99805 H 13.59375 Z m 2.996094,0 h 1.996094 v -0.99805 h -1.996094 z m 2.996094,0 h 1.996093 v -0.99805 h -1.996093 z m 2.99414,0 H 24.5 25 v -0.49805 -0.0781 h -0.5 v -0.42187 h -1.919922 z" />                                <path d="m 0,10.38477 v 1.02343 13.97657 h 15 v -15 z m 2.0449219,2.04492 H 12.955078 V 23.3418 H 2.0449219 Z"/>                                <g>                                    <path d="m 21.158203,3.81836 0.355469,0.35156 0.351562,-0.35547 -0.353515,-0.35156 z m -0.703125,0.70898 0.355469,0.35157 0.351562,-0.35352 -0.355468,-0.35351 z m -0.705078,0.71094 0.355469,0.35156 0.351562,-0.35546 -0.353515,-0.35157 z m -0.703125,0.70899 0.355469,0.35351 0.351562,-0.35547 -0.355468,-0.35156 z m -0.705078,0.71093 0.355469,0.35157 0.353515,-0.35547 -0.355469,-0.35157 z m -0.703125,0.71094 0.355469,0.35156 0.351562,-0.35547 -0.355469,-0.35156 z m -0.703125,0.70898 0.353515,0.35157 0.353516,-0.35352 -0.355469,-0.35351 z m -0.705078,0.71094 0.355469,0.35156 0.351562,-0.35546 -0.355469,-0.35157 z m -0.703125,0.70899 0.353515,0.35351 0.353516,-0.35547 -0.355469,-0.35351 z m -0.705078,0.71093 0.355468,0.35157 0.351563,-0.35547 -0.355469,-0.35156 z"/>                                    <path d="m 23.382049,1.93037 -1.015775,3.8652 -2.840556,-2.81624 z"/>                                </g>                            </g>                        </svg>                    </div>                    <div title="Switch to uniform scaling" data-bind="visible: enableNonUniformScaling">                        <svg width="25" height="25" viewBox="0 0 25 25">                            <g>                                <path d="M 0.49414062,10.87891 H 0 v 1.95117 h 0.98828125 v -1.45703 H 2.4707031 v -0.98828 H 0.49414062 Z m 2.96289058,0.49414 h 1.9765626 v -0.98828 H 3.4570312 Z m 2.9648438,0 h 1.9765625 v -0.98828 H 6.421875 Z m 2.9628906,0 h 1.9765624 v -0.98828 H 9.3847656 Z m 2.9648434,0 h 1.976563 v -0.98828 h -1.976563 z m 2.964844,0 h 1.974609 v -0.98828 h -1.974609 z m 2.962891,0 h 1.976562 v -0.98828 h -1.976562 z m 2.964844,0 h 1.974609 v -0.98828 h -1.974609 z m 2.96289,-0.49414 h -0.193359 v 1.67578 H 25 v -1.67578 -0.49414 h -0.494141 -0.300781 z m -0.193359,4.63867 H 25 v -1.97461 H 24.011719 Z M 0,15.79297 h 0.98828125 v -1.97461 H 0 Z m 24.011719,2.68945 H 25 v -1.97656 H 24.011719 Z M 0,18.75781 h 0.98828125 v -1.97656 H 0 Z m 24.011719,2.6875 H 25 V 19.4707 H 24.011719 Z M 0,21.7207 h 0.98828125 v -1.97461 H 0 Z m 24.011719,2.68946 H 25 v -1.97657 H 24.011719 Z M 0,24.68555 h 0.98828125 v -1.97657 H 0 Z m 1.2753906,0.69922 h 1.9765625 v -0.98829 H 1.2753906 Z m 2.9648438,0 h 1.9765625 v -0.98829 H 4.2402344 Z m 2.9628906,0 h 1.9765625 v -0.98829 H 7.203125 Z m 2.964844,0 h 1.976562 v -0.98829 h -1.976562 z m 2.96289,0 h 1.976563 v -0.98829 h -1.976563 z m 2.964844,0 h 1.976563 v -0.98829 h -1.976563 z m 2.962891,0 h 1.976562 v -0.98829 h -1.976562 z m 2.964844,0 H 24 v -0.98829 h -1.976562 z"/>                                <path d="m 0,10.38477 v 1.02343 13.97657 h 15 v -15 z m 2.0449219,2.04492 H 12.955078 V 23.3418 H 2.0449219 Z"/>                                <g>                                    <path d="m 22.251953,18.26172 h 0.179688 l -0.0039,-0.5 h -0.179687 z m -1.003906,-0.49024 0.0039,0.5 0.5,-0.004 -0.0039,-0.5 z m -1,0.008 0.0039,0.5 0.5,-0.004 -0.0039,-0.5 z m -1,0.01 0.0039,0.5 0.5,-0.006 -0.0039,-0.5 z m -1,0.008 0.0039,0.5 0.5,-0.004 -0.0039,-0.5 z m -1,0.008 0.0039,0.5 0.5,-0.004 -0.0039,-0.5 z m -1,0.01 0.0039,0.5 0.5,-0.004 -0.0039,-0.5 z m -1,0.008 0.0039,0.5 0.5,-0.004 -0.0039,-0.5 z"/>                                    <path d="m 23.885095,18.00809 -2.030696,1.17348 -0.02037,-2.31243 z"/>                                </g>                            </g>                        </svg>                    </div>                </div>            </div>        </div>    </div>');i.appendChild(n);var o=new Oe(t);e.knockout.applyBindings(o,n),this._viewModel=o,this._element=n,this._container=i}function Le(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),e.Check.defined("options.scene",t.scene),e.Check.defined("options.units",t.units),e.Check.defined("options.points",t.points),e.Check.defined("options.labels",t.labels),e.Check.defined("options.primitives",t.primitives),this._labelCollection=t.labels,this._pointCollection=t.points,this._primitives=t.primitives,this._selectedUnits=t.units,this._selectedLocale=t.locale,this._scene=t.scene}e.defineProperties(De.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),De.prototype.isDestroyed=function(){return!1},De.prototype.destroy=function(){return e.knockout.cleanNode(this._element),this._container.removeChild(this._element),this._viewModel.destroy(),e.destroyObject(this)},e.defineProperties(Le.prototype,{icon:{value:""},thumbnail:{value:""},type:{value:""},instructions:{value:[]},id:{value:""}}),Le.prototype.handleDoubleClick=function(){},Le.prototype.handleClick=function(e){},Le.prototype.handleMouseMove=function(e){},Le.prototype.handleLeftDown=function(e){},Le.prototype.handleLeftUp=function(e){},Le.prototype.reset=e.DeveloperError.throwInstantiationError,Le.prototype.isDestroyed=function(){return!1},Le.prototype.destroy=e.DeveloperError.throwInstantiationError;var Ue=e.freezeObject({BeforeDraw:0,Drawing:1,AfterDraw:2});function Ne(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.show=e.defaultValue(t.show,!0);var i=e.Color.clone(e.defaultValue(t.color,e.Color.WHITE));this._id=e.createGuid(),this._color=i,this._depthFailColor=i,this._positions=[],this._boundingSphere=new e.BoundingSphere,this._primitive=void 0,this._update=!0}function Ve(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.show=e.defaultValue(t.show,!0),this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this._width=e.defaultValue(t.width,3),this._color=e.Color.clone(e.defaultValue(t.color,e.Color.WHITE)),this._id=e.createGuid(),this._positions=e.defaultValue(t.positions,[]),this._primitive=void 0,this._boundingSphere=new e.BoundingSphere,this._dashed=e.defaultValue(t.dashed,!1),this._loop=e.defaultValue(t.loop,!1),this._update=!0}function Fe(){this.states=new e.ManagedArray,this.count=0}e.defineProperties(Ne.prototype,{positions:{get:function(){return this._positions},set:function(e){this._positions=e,this._update=!0}},color:{get:function(){return this._color}},boundingVolume:{get:function(){return this._boundingSphere}}}),Ne.prototype.update=function(t){if(this.show){var i=this._positions;if(i.length<3)this._primitive=this._primitive&&this._primitive.destroy();else{if(this._update){this._update=!1,this._primitive=this._primitive&&this._primitive.destroy();var n=e.CoplanarPolygonGeometry.fromPositions({positions:i,vertexFormat:e.PerInstanceColorAppearance.FLAT_VERTEX_FORMAT});this._primitive=new e.Primitive({geometryInstances:new e.GeometryInstance({geometry:n,attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(this._color),depthFailColor:e.ColorGeometryInstanceAttribute.fromColor(this._depthFailColor)},id:this._id}),appearance:new e.PerInstanceColorAppearance({flat:!0,closed:!1,translucent:this._color.alpha<1}),depthFailAppearance:new e.PerInstanceColorAppearance({flat:!0,closed:!1,translucent:this._depthFailColor.alpha<1}),allowPicking:!1,asynchronous:!1}),this._boundingSphere=e.BoundingSphere.fromPoints(i,this._boundingSphere)}this._primitive.update(t)}}},Ne.prototype.isDestroyed=function(){return!1},Ne.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),e.destroyObject(this)},e.defineProperties(Ve.prototype,{positions:{get:function(){return this._positions},set:function(e){this._positions=e,this._update=!0}},color:{get:function(){return this._color}},boundingVolume:{get:function(){return this._boundingSphere}},width:{get:function(){return this._width}},ellipsoid:{get:function(){return this._ellipsoid}},dashed:{get:function(){return this._dashed}},loop:{get:function(){return this._loop}}}),Ve.prototype.update=function(t){if(this.show){var i=this._positions;if(!e.defined(i)||i.length<2)this._primitive=this._primitive&&this._primitive.destroy();else{if(this._update){this._update=!1,this._id=this.id,this._primitive=this._primitive&&this._primitive.destroy(),this._loop&&(i=i.slice()).push(i[0]);var n,o=new e.PolylineGeometry({positions:i,width:this.width,vertexFormat:e.PolylineMaterialAppearance.VERTEX_FORMAT,ellipsoid:this._ellipsoid,arcType:e.ArcType.NONE});n=this._dashed?new e.PolylineMaterialAppearance({material:e.Material.fromType(e.Material.PolylineDashType,{color:this._color})}):new e.PolylineColorAppearance,this._primitive=new e.Primitive({geometryInstances:new e.GeometryInstance({geometry:o,attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(this._color),depthFailColor:e.ColorGeometryInstanceAttribute.fromColor(this._color)},id:this.id}),appearance:n,depthFailAppearance:n,asynchronous:!1,allowPicking:!1}),this._boundingSphere=e.BoundingSphere.fromPoints(i,this._boundingSphere)}this._primitive.update(t)}}},Ve.prototype.isDestroyed=function(){return!1},Ve.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),e.destroyObject(this)},Fe.prototype.hidePrimitiveCollection=function(t){for(var i=t.length,n=0;n<i;++n){var o=t.get(n);o instanceof e.PrimitiveCollection?this.hidePrimitiveCollection(o):(this.states.push(o.show),o instanceof e.Cesium3DTileset||o instanceof e.Model||(o.show=!1))}},Fe.prototype.restorePrimitiveCollection=function(t){for(var i=t.length,n=0;n<i;++n){var o=t.get(n);o instanceof e.PrimitiveCollection?this.restorePrimitiveCollection(o):o.show=this.states.get(this.count++)}},Fe.prototype.hide=function(e){this.states.length=0,this.hidePrimitiveCollection(e.primitives),this.hidePrimitiveCollection(e.groundPrimitives)},Fe.prototype.restore=function(e){this.count=0,this.restorePrimitiveCollection(e.primitives),this.restorePrimitiveCollection(e.groundPrimitives)};var Be=new e.Cartesian3,ze=new e.Ray,He=new Fe;function je(t,i,n){var o;if(e.Check.defined("scene",t),e.Check.defined("mousePosition",i),e.Check.defined("result",n),t.pickPositionSupported){He.hide(t);var s=t.pick(i,1,1);if(He.restore(t),e.defined(s)&&(s instanceof e.Cesium3DTileFeature||s.primitive instanceof e.Cesium3DTileset||s.primitive instanceof e.Model)&&(o=t.pickPosition(i,Be),e.defined(o)))return e.Cartesian3.clone(o,n)}if(e.defined(t.globe)){var r=t.camera.getPickRay(i,ze);return o=t.globe.pick(r,t,Be),e.defined(o)?e.Cartesian3.clone(o,n):void 0}}var Qe=new e.Cartesian2,Xe=new e.Cartesian3;function Ye(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),e.Check.defined("options.scene",t.scene);var i=t.scene,n=e.defaultValue(t.primitives,i.primitives),o=!1,s=t.points;e.defined(s)||(s=n.add(new e.PointPrimitiveCollection),o=!0),this._polygon=n.add(new Ne(t.polygonOptions)),this._polyline=n.add(new Ve(e.combine({loop:!0},t.polylineOptions))),this._pointOptions=t.pointOptions,this._pointCollection=s,this._removePoints=o,this._scene=i,this._primitives=n,this._positions=[],this._points=[],this._tempNextPos=new e.Cartesian3,this._mode=Ue.BeforeDraw,this._lastClickPosition=new e.Cartesian2(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this._polygonOptions=t.polygonOptions,this._polylineOptions=t.polylineOptions}Ye.prototype.addPoint=function(e){var t=this._positions;t.push(e),this._polyline.positions=t,this._polygon.positions=t;var i=this._pointCollection.add(this._pointOptions);i.position=e,i.show=!0,this._points.push(i)},Ye.prototype.handleDoubleClick=function(){this._mode=Ue.AfterDraw;var e=this._positions;this._polyline.positions=e,this._polygon.positions=e},Ye.prototype.handleClick=function(t){if(e.Check.defined("clickPosition",t),this._mode!==Ue.AfterDraw){var i=this._lastClickPosition;if(!(e.Cartesian2.magnitude(e.Cartesian2.subtract(i,t,Qe))<10)){var n=Ye._getWorldPosition(this._scene,t,Xe);if(e.defined(n))return this.addPoint(e.Cartesian3.clone(n,new e.Cartesian3)),this._mode=Ue.Drawing,e.Cartesian2.clone(t,i),n}}},Ye.prototype.handleMouseMove=function(t){if(e.Check.defined("mousePosition",t),this._mode===Ue.Drawing){var i=this._scene,n=Ye._getWorldPosition(i,t,Xe);if(e.defined(n)){var o=this._positions.slice();return o.push(e.Cartesian3.clone(n,this._tempNextPos)),this._polyline.positions=o,this._polygon.positions=o,n}}},Ye.prototype.isDestroyed=function(){return!1},Ye.prototype.destroy=function(){var t=this._primitives;if(this._removePoints)t.remove(this._points);else for(var i=this._points,n=this._pointCollection,o=0;o<i.length;o++)n.remove(i[o]);return t.remove(this._polygon),t.remove(this._polyline),e.destroyObject(this)},Ye.prototype.newPolygon=function(){return this._primitives.add(new Ne(this._polygonOptions))},Ye.prototype.newPolyline=function(){return this._primitives.add(new Ve(e.combine({loop:!0},this._polylineOptions)))},Ye._getWorldPosition=je;var Ze=new e.Cartesian2(0,-9),qe={};qe.color=e.Color.YELLOW,qe.labelFont="16px Lucida Console",qe.textColor=e.Color.WHITE,qe.backgroundColor=new e.Color(.165,.165,.165,.8),qe.backgroundPadding=new e.Cartesian2(7,5),qe.getPolylineOptions=function(t){return{show:(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).show,ellipsoid:t.ellipsoid,width:e.defaultValue(t.width,3),color:e.defaultValue(t.color,qe.color),depthFailColor:e.defaultValue(e.defaultValue(t.depthFailColor,t.color),qe.color),id:t.id,positions:t.positions,materialType:t.materialType,depthFailMaterialType:t.depthFailMaterialType,loop:t.loop,clampToGround:t.clampToGround,classificationType:t.classificationType,allowPicking:e.defaultValue(t.allowPicking,!1)}},qe.getPolygonOptions=function(t){return{show:(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).show,ellipsoid:t.ellipsoid,color:e.defaultValue(t.color,qe.color),depthFailColor:e.defaultValue(e.defaultValue(t.depthFailColor,t.color),qe.color),id:t.id,positions:t.positions,clampToGround:t.clampToGround,classificationType:t.classificationType,allowPicking:e.defaultValue(t.allowPicking,!1)}},qe.getPointOptions=function(){return{pixelSize:10,color:qe.color,position:new e.Cartesian3,disableDepthTestDistance:Number.POSITIVE_INFINITY,show:!1}},qe.getLabelOptions=function(t){return t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),{show:!1,font:qe.labelFont,scale:e.defaultValue(t.scale,1),fillColor:e.defaultValue(t.fillColor,qe.textColor),showBackground:!0,backgroundColor:e.defaultValue(t.backgroundColor,qe.backgroundColor),backgroundPadding:e.defaultValue(t.backgroundPadding,qe.backgroundPadding),horizontalOrigin:e.defaultValue(t.horizontalOrigin,e.HorizontalOrigin.CENTER),verticalOrigin:e.defaultValue(t.verticalOrigin,e.VerticalOrigin.BOTTOM),pixelOffset:e.defined(t.pixelOffset)?t.pixelOffset:e.Cartesian2.clone(Ze),disableDepthTestDistance:Number.POSITIVE_INFINITY,position:new e.Cartesian3}};var Ke=new e.Cartesian2,We=new e.Cartesian2,Je=new e.Cartesian3,Ge=new e.Cartesian3,$e=new e.Cartesian3,et=new e.Cartesian3,tt=new e.Cartesian3;function it(t,i,n){var o=e.Cartesian3.subtract(t,i,et),s=e.Cartesian3.subtract(n,i,tt),r=e.Cartesian3.cross(o,s,o);return.5*e.Cartesian3.magnitude(r)}function nt(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),e.Check.defined("options.scene",t.scene),e.Check.defined("options.primitives",t.primitives),e.Check.defined("options.units",t.units),e.Check.defined("options.points",t.points),e.Check.defined("options.labels",t.labels),t.polylineOptions=qe.getPolylineOptions({ellipsoid:t.ellipsoid}),t.pointOptions=qe.getPointOptions(),t.polygonOptions={color:qe.color.withAlpha(.8)},Ye.call(this,t);var i=t.labels;this._labelCollection=i,this._label=i.add(qe.getLabelOptions()),this._selectedUnits=t.units,this._selectedLocale=t.locale,this._area=0;var n=this;this._removeEvent=this._scene.preRender.addEventListener((function(){n.updateLabel()})),this._measurementResult=[]}function ot(e){return'<svg viewBox="0 0 30 30" height="'+e+'px" width="'+e+'px">\n                 <g transform="translate(0,-267)">\n                   <circle r="2.0788691" cy="293.99896" cx="3.8532958"/>\n                   <circle r="2.0788691" cy="282.76791" cx="26.927404"/>\n                   <circle r="2.0788691" cy="270.20621" cx="4.0090437"/>\n                   <path d="m 26.326048,283.77014 -9.394396,5.02295 -9.3943948,5.02295 0.3471933,-10.64726 0.3471933,-10.64726 9.0472022,5.62431 z" transform="matrix(1.1625734,0,0,0.99297729,-4.6787891,1.2180486)"/>\n                 </g>\n               </svg>'}function st(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),Le.call(this,t),this._drawing=new nt(t),this._newMeasurement=new e.Event}nt.prototype=Object.create(Ye.prototype),nt.prototype.constructor=nt,e.defineProperties(nt.prototype,{area:{get:function(){return this._area}}}),nt.prototype.updateArea=function(t){var i=e.CoplanarPolygonGeometry.createGeometry(e.CoplanarPolygonGeometry.fromPositions({positions:t,vertexFormat:e.VertexFormat.POSITION_ONLY}));if(e.defined(i)){for(var n=i.attributes.position.values,o=i.indices,s=0,a=0;a<o.length;a+=3){var l=o[a],c=o[a+1],h=o[a+2];s+=it(e.Cartesian3.unpack(n,3*l,Je),e.Cartesian3.unpack(n,3*c,Ge),e.Cartesian3.unpack(n,3*h,$e))}this._area=s,this._label.text=r.areaToString(s,this._selectedUnits.areaUnits,this._selectedLocale)}else this._label.text=""},nt.prototype.updateLabel=function(){var t=this._positions;if(!(t.length<2)){for(var i=this._scene,n=t[0],o=e.SceneTransforms.wgs84ToWindowCoordinates(i,n,Ke),s=e.defined(o)?o.y:Number.POSITIVE_INFINITY,r=1;r<t.length;r++){var a=e.SceneTransforms.wgs84ToWindowCoordinates(i,t[r],We);e.defined(a)&&(a.y<s&&(s=a.y,n=t[r]))}this._label.position=n}},nt.prototype.addPoint=function(e){Ye.prototype.addPoint.call(this,e),this.updateArea(this._positions)},nt.prototype.handleClick=function(t){e.Check.defined("clickPosition",t),this._mode===Ue.AfterDraw&&this.reset();var i=Ye.prototype.handleClick.call(this,t);e.defined(i)&&(this._label.show=!0,this._polygon.show=!0,this._polyline.show=!0)},nt.prototype.handleMouseMove=function(t){e.Check.defined("mousePosition",t);var i=Ye.prototype.handleMouseMove.call(this,t);if(e.defined(i)){var n=this._positions.slice();n.push(i),this.updateArea(n)}},nt.prototype.reset=function(){this._label.show=!1,this._label.text="",this._positions=[],this._polyline.positions=[],this._polygon.positions=[],this._polyline.show=!1,this._polygon.show=!1,this._area=0;for(var e=this._points,t=this._pointCollection,i=0;i<e.length;i++)t.remove(e[i]);e.length=0,this._mode=Ue.BeforeDraw,this._lastClickPosition.x=Number.POSITIVE_INFINITY,this._lastClickPosition.y=Number.POSITIVE_INFINITY},nt.prototype.destroy=function(){this._removeEvent(),this._labelCollection.remove(this._label);for(var e=0;e<this._measurementResult.length;e++)this._labelCollection.remove(this._measurementResult[e].label),this._primitives.remove(this._measurementResult[e].polygon),this._primitives.remove(this._measurementResult[e].polyline);Ye.prototype.destroy.call(this)},nt.prototype._saveCurrentMeasurementAndPrepareNew=function(){this._measurementResult.push({label:this._label,polygon:this._polygon,polyline:this._polyline,points:this._points}),this._label=this._labelCollection.add(qe.getLabelOptions()),this._polygon=Ye.prototype.newPolygon.call(this),this._polyline=Ye.prototype.newPolyline.call(this),this._points=[]},nt.prototype.handleDoubleClick=function(){Ye.prototype.handleDoubleClick.call(this),this._saveCurrentMeasurementAndPrepareNew()},st.prototype=Object.create(Le.prototype),st.prototype.constructor=st,e.defineProperties(st.prototype,{area:{get:function(){return this._drawing.area}},icon:{value:ot(15)},thumbnail:{value:ot(25)},type:{value:"Area"},instructions:{value:["Click to start drawing a polygon","Keep clicking to add more points","Double click to finish drawing"]},id:{value:"areaMeasurement"},measurementResult:{get:function(){return this._drawing._measurementResult}},newMeasurement:{get:function(){return this._newMeasurement}}}),st.prototype.handleDoubleClick=function(){this._drawing.handleDoubleClick(),this._newMeasurement.raiseEvent(this._drawing._measurementResult.length-1)},st.prototype.handleClick=function(e){this._drawing.handleClick(e)},st.prototype.handleMouseMove=function(e){this._drawing.handleMouseMove(e)},st.prototype.reset=function(){this._drawing.reset()},st.prototype.isDestroyed=function(){return!1},st.prototype.destroy=function(){return this._drawing.destroy(),e.destroyObject(this)};var rt=0,at=1,lt=2,ct=new e.Cartesian2,ht=new e.Cartesian2,dt=new e.Cartographic,ut=new e.Cartesian3,pt=new e.Cartesian3,mt=new e.Cartesian3;function _t(e){return'<svg viewBox="0 0 30 30" height="'+e+'px" width="'+e+'px">\n                 <g transform="translate(0,-267)">\n                  <path d="m 4.934989,292.6549 20.67981,-20.80395"/>\n                   <circle r="2.0788691" cy="270.1637" cx="27.025297"/>\n                   <circle r="2.0788691" cy="294.07068" cx="3.1183045"/>\n                 </g>\n               </svg>\n'}function ft(e){return'<svg viewBox="0 0 30 30" height="'+e+'px" width="'+e+'px">\n                 <g transform="translate(0,-267)">\n                   <path d="m 4.934989,292.6549 20.67981,-20.80395" />\n                   <circle r="2.0788691" cy="270.1637" cx="27.025297" />\n                   <circle r="2.0788691" cy="294.07068" cx="3.1183045" />\n                   <path style="stroke-dasharray:2.00314951, 1.00157475;stroke-dashoffset:0;" d="m 3.3194019,292.73274 -0.046996,-22.53109 21.6420984,-0.0266" />\n                 </g>\n               </svg>\n'}function gt(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),Le.call(this,t);var i=this,n=this._pointCollection,o=this._labelCollection,s=this._primitives,r=this._scene,a=[new e.Cartesian3,new e.Cartesian3],l=[new e.Cartesian3,new e.Cartesian3,new e.Cartesian3],c=[new e.Cartesian3,new e.Cartesian3,new e.Cartesian3],h=new e.Cartesian2(-9,0),d=new e.Cartesian2(9,0),u=r.frameState.mapProjection.ellipsoid;this._startPoint=n.add(qe.getPointOptions()),this._endPoint=n.add(qe.getPointOptions()),this._positions=a,this._polyline=s.add(new Ve(qe.getPolylineOptions({ellipsoid:u,width:3,show:!1,positions:a}))),this._xyPolylinePositions=l,this._xyPolyline=s.add(new Ve(qe.getPolylineOptions({ellipsoid:u,width:2,positions:l,materialType:e.Material.PolylineDashType}))),this._xyBoxPositions=c,this._xyBox=s.add(new Ve(qe.getPolylineOptions({ellipsoid:u,width:1,positions:c}))),this._label=o.add(qe.getLabelOptions({horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.TOP,pixelOffset:new e.Cartesian2(10,10)})),this._xPixelOffset=d,this._xLabel=o.add(qe.getLabelOptions({scale:.6})),this._xAngleLabel=o.add(qe.getLabelOptions({scale:.6,horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.MIDDLE,pixelOffset:d})),this._yPixelOffset=h,this._yLabel=o.add(qe.getLabelOptions({scale:.6,horizontalOrigin:e.HorizontalOrigin.RIGHT,pixelOffset:h})),this._yAngleLabel=o.add(qe.getLabelOptions({scale:.6,verticalOrigin:e.VerticalOrigin.TOP,pixelOffset:new e.Cartesian2(0,9)})),this._distance=0,this._xDistance=0,this._yDistance=0,this._xAngle=0,this._yAngle=0,this._mode=rt,this._showComponentLines=e.defaultValue(t.showComponentLines,!1),this._removeEvent=r.preRender.addEventListener((function(){i._updateLabelPosition()})),this._measurementResult=[],this._newMeasurement=new e.Event}gt.prototype=Object.create(Le.prototype),gt.prototype.constructor=gt,e.defineProperties(gt.prototype,{distance:{get:function(){return this._distance}},horizontalDistance:{get:function(){return this._xDistance}},verticalDistance:{get:function(){return this._yDistance}},angleFromHorizontal:{get:function(){return this._xAngle}},angleFromVertical:{get:function(){return this._yAngle}},icon:{get:function(){return this._showComponentLines?ft(15):_t(15)}},thumbnail:{get:function(){return this._showComponentLines?ft(25):_t(25)}},type:{get:function(){return this._showComponentLines?"Component Distance":"Distance"}},instructions:{value:["Click on the point cloud or the globe to set the start point and end points","To make a new measurement, click to clear the previous measurement"]},id:{get:function(){return this._showComponentLines?"componentDistanceMeasurement":"distanceMeasurement"}},showComponentLines:{get:function(){return this._showComponentLines},set:function(e){this._showComponentLines=e,this._mode!==rt&&this._updateComponents()}},measurementResult:{get:function(){return this._measurementResult}},newMeasurement:{get:function(){return this._newMeasurement}}}),gt.prototype._updateComponents=function(){var t=this._showComponentLines,i=this._xLabel,n=this._yLabel,o=this._xAngleLabel,s=this._yAngleLabel,a=this._xyPolyline,l=this._xyBox;if(i.show=!1,n.show=!1,o.show=!1,s.show=!1,a.show=!1,l.show=!1,t){var c,h,d,u,p=this._scene.frameState.mapProjection.ellipsoid,m=this._positions,_=m[0],f=m[1],g=p.cartesianToCartographic(_,dt).height,C=p.cartesianToCartographic(f,dt).height;g<C?(c=_,h=f,d=C,u=g):(c=f,h=_,d=g,u=C);var v=this._xyPolylinePositions;v[0]=e.Cartesian3.clone(c,v[0]),v[2]=e.Cartesian3.clone(h,v[2]);var y=p.geodeticSurfaceNormal(c,ut);y=e.Cartesian3.multiplyByScalar(y,d-u,y);var w=e.Cartesian3.add(c,y,v[1]);if(a.positions=v,!e.Cartesian3.equalsEpsilon(w,h,e.Math.EPSILON10)&&!e.Cartesian3.equalsEpsilon(w,c,e.Math.EPSILON10)){n.show=!0,i.show=!0,s.show=!0,o.show=!0,a.show=!0,l.show=!0;var b=e.Cartesian3.subtract(h,w,ut),E=e.Cartesian3.subtract(c,w,pt),S=Math.min(e.Cartesian3.magnitude(b),e.Cartesian3.magnitude(E)),M=S>15?.15*S:.25*S;b=e.Cartesian3.normalize(b,b),E=e.Cartesian3.normalize(E,E),b=e.Cartesian3.multiplyByScalar(b,M,b),E=e.Cartesian3.multiplyByScalar(E,M,E);var T=this._xyBoxPositions;T[0]=e.Cartesian3.add(w,b,T[0]),T[1]=e.Cartesian3.add(T[0],E,T[1]),T[2]=e.Cartesian3.add(w,E,T[2]),l.positions=T,i.position=e.Cartesian3.midpoint(w,h,ut),n.position=e.Cartesian3.midpoint(c,w,ut),o.position=e.Cartesian3.clone(h,ut),s.position=e.Cartesian3.clone(c,ut);var x=e.Cartesian3.subtract(w,h,pt),P=e.Cartesian3.subtract(w,c,ut),k=e.Cartesian3.subtract(h,c,mt),R=e.Cartesian3.angleBetween(P,k);k=e.Cartesian3.negate(k,k);var O=e.Cartesian3.angleBetween(x,k),A=e.Cartesian3.magnitude(x),I=e.Cartesian3.magnitude(P),D=this._selectedUnits,L=this._selectedLocale;i.text=r.distanceToString(A,D.distanceUnits,L),n.text=r.distanceToString(I,D.distanceUnits,L),o.text=r.angleToString(O,D.slopeUnits,L),s.text=r.angleToString(R,D.slopeUnits,L),this._xDistance=A,this._yDistance=I,this._xAngle=O,this._yAngle=R}}},gt.prototype._updateLabelPosition=function(){var t=this._positions;if(this._mode!==rt){var i=this._scene,n=t[0],o=t[1],s=e.SceneTransforms.wgs84ToWindowCoordinates(i,n,ct),r=e.SceneTransforms.wgs84ToWindowCoordinates(i,o,ht);if(e.defined(s)&&e.defined(r)){var a=this._label,l=this._yLabel,c=this._xAngleLabel;(s.y-r.y)/(r.x-s.x)>0?(this._yPixelOffset.x=-9,this._xPixelOffset.x=12,l.pixelOffset=this._yPixelOffset,l.horizontalOrigin=e.HorizontalOrigin.RIGHT,c.pixelOffset=this._xPixelOffset,c.horizontalOrigin=e.HorizontalOrigin.LEFT,a.horizontalOrigin=e.HorizontalOrigin.LEFT):(this._yPixelOffset.x=9,this._xPixelOffset.x=-12,l.pixelOffset=this._yPixelOffset,l.horizontalOrigin=e.HorizontalOrigin.LEFT,c.pixelOffset=this._xPixelOffset,c.horizontalOrigin=e.HorizontalOrigin.RIGHT,a.horizontalOrigin=e.HorizontalOrigin.RIGHT)}}},gt.prototype.handleClick=function(t){e.Check.defined("clickPosition",t);var i=this._scene;this._mode===lt&&this.reset();var n=this._mode,o=this._positions;if(n===rt){var s=gt._getWorldPosition(i,t,o[0]);if(!e.defined(s))return;this._polyline.show=!0,o[0]=s.clone(o[0]),o[1]=s.clone(o[1]),this._startPoint.position=s,this._startPoint.show=!0,this._mode=at,this._polyline.positions=o}else n===at&&(this._endPoint.position=o[1],this._endPoint.show=!0,this._polyline.positions=o,this._mode=lt,this._saveCurrentMeasurementAndPrepareNew())},gt.prototype.handleMouseMove=function(t){if(e.Check.defined("mousePosition",t),this._mode===at){var i=this._scene,n=this._positions,o=gt._getWorldPosition(i,t,ut);if(e.defined(o)){var s=n[0],a=e.Cartesian3.clone(o,n[1]),l=e.Cartesian3.subtract(a,s,ut),c=e.Cartesian3.magnitude(l),h=this._label;h.position=e.Cartesian3.midpoint(s,a,ut),h.text=r.distanceToString(c,this._selectedUnits.distanceUnits,this._selectedLocale),h.show=!0,this._distance=c,this._polyline.positions=n,this._updateComponents()}}},gt.prototype.reset=function(){this._polyline.show=!1,this._xyPolyline.show=!1,this._xyBox.show=!1,this._label.show=!1,this._xLabel.show=!1,this._yLabel.show=!1,this._xAngleLabel.show=!1,this._yAngleLabel.show=!1,this._startPoint.show=!1,this._endPoint.show=!1,this._mode=rt,this._distance=0,this._xDistance=0,this._yDistance=0,this._xAngle=0,this._yAngle=0},gt.prototype.isDestroyed=function(){return!1},gt.prototype.destroy=function(){this._removeEvent();var t=this._primitives;t.remove(this._polyline),t.remove(this._xyPolyline),t.remove(this._xyBox);var i=this._pointCollection;i.remove(this._startPoint),i.remove(this._endPoint);var n=this._labelCollection;return n.remove(this._label),n.remove(this._xLabel),n.remove(this._yLabel),n.remove(this._xAngleLabel),n.remove(this._yAngleLabel),e.destroyObject(this)},gt.prototype._saveCurrentMeasurementAndPrepareNew=function(){this._measurementResult.push({startPoint:this._startPoint,endPoint:this._endPoint,polyline:this._polyline,xyPolyline:this._xyPolyline,xyBox:this._xyBox,label:this._label,xLabel:this._xLabel,xAngleLabel:this._xAngleLabel,yLabel:this._yLabel,yAngleLabel:this._yAngleLabel}),this._newMeasurement.raiseEvent(this._measurementResult.length-1);var t=this._pointCollection,i=this._labelCollection,n=this._primitives,o=[new e.Cartesian3,new e.Cartesian3,new e.Cartesian3],s=[new e.Cartesian3,new e.Cartesian3,new e.Cartesian3],r=new e.Cartesian2(9,0),a=new e.Cartesian2(-9,0),l=[new e.Cartesian3,new e.Cartesian3],c=this._scene.frameState.mapProjection.ellipsoid;this._startPoint=t.add(qe.getPointOptions()),this._endPoint=t.add(qe.getPointOptions()),this._positions=l,this._polyline=n.add(new Ve(qe.getPolylineOptions({ellipsoid:c,width:3,show:!1,positions:l}))),this._xyPolylinePositions=o,this._xyPolyline=n.add(new Ve(qe.getPolylineOptions({ellipsoid:c,width:2,positions:o,materialType:e.Material.PolylineDashType}))),this._xyBoxPositions=s,this._xyBox=n.add(new Ve(qe.getPolylineOptions({ellipsoid:c,width:1,positions:s}))),this._label=i.add(qe.getLabelOptions({horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.TOP,pixelOffset:new e.Cartesian2(10,10)})),this._xPixelOffset=r,this._xLabel=i.add(qe.getLabelOptions({scale:.6})),this._xAngleLabel=i.add(qe.getLabelOptions({scale:.6,horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.MIDDLE,pixelOffset:r})),this._yPixelOffset=a,this._yLabel=i.add(qe.getLabelOptions({scale:.6,horizontalOrigin:e.HorizontalOrigin.RIGHT,pixelOffset:a})),this._yAngleLabel=i.add(qe.getLabelOptions({scale:.6,verticalOrigin:e.VerticalOrigin.TOP,pixelOffset:new e.Cartesian2(0,9)}))},gt._getWorldPosition=je;var Ct=new e.Cartesian3,vt=new e.Cartographic;function yt(e){return'<svg viewBox="0 0 30 30" height="'+e+'px" width="'+e+'px">\n             <g transform="translate(0,-267)">\n               <path d="m 15.042838,272.34414 0.01712,19.60575"/>\n               <circle r="2.0788691" cy="270.01154" cx="15.078616"/>\n               <path d="m 0.64901081,296.20687 8.80039389,-6.01044 7.9375003,3.1183 12.347278,-3.34365"/>\n             </g>\n           </svg>'}function wt(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),Le.call(this,t);var i=[new e.Cartesian3,new e.Cartesian3],n=this._pointCollection;this._startPoint=n.add(qe.getPointOptions()),this._endPoint=n.add(qe.getPointOptions()),this._polyline=this._primitives.add(new Ve(qe.getPolylineOptions({ellipsoid:this._scene.frameState.mapProjection.ellipsoid,positions:i}))),this._label=this._labelCollection.add(qe.getLabelOptions({horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.TOP,pixelOffset:new e.Cartesian2(10,10)})),this._positions=i,this._distance=0}wt.prototype=Object.create(Le.prototype),wt.prototype.constructor=wt,e.defineProperties(wt.prototype,{distance:{get:function(){return this._distance}},icon:{value:yt(15)},thumbnail:{value:yt(25)},type:{value:"Height from terrain"},instructions:{value:["Click on the point cloud to get a distance from that point to terrain"]},id:{value:"heightMeasurement"}}),wt.prototype.handleClick=function(t){var i=this._scene;this.reset();var n=this._positions,o=wt._getWorldPosition(i,t,n[0]);if(e.defined(o)){var s=i.globe,a=i.frameState.mapProjection.ellipsoid,l=a.cartesianToCartographic(o,vt);e.defined(s)?l.height=e.defaultValue(s.getHeight(l),0):l.height=0;var c=a.cartographicToCartesian(l,n[1]),h=e.Cartesian3.subtract(c,o,Ct),d=e.Cartesian3.magnitude(h),u=this._label;u.position=o,u.show=!0,u.text=r.distanceToString(d,this._selectedUnits.distanceUnits,this._selectedLocale),this._polyline.positions=n,this._polyline.show=!0,this._startPoint.position=o,this._startPoint.show=!0,this._endPoint.position=c,this._endPoint.show=!0,this._distance=d}},wt.prototype.reset=function(){this._polyline.show=!1,this._label.show=!1,this._startPoint.show=!1,this._endPoint.show=!1,this._distance=0},wt.prototype.isDestroyed=function(){return!1},wt.prototype.destroy=function(){this._primitives.remove(this._polyline);var t=this._pointCollection;return t.remove(this._startPoint),t.remove(this._endPoint),this._labelCollection.remove(this._label),e.destroyObject(this)},wt._getWorldPosition=je;var bt=new e.Cartesian2,Et=new e.Cartesian3;function St(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),e.Check.defined("options.scene",t.scene);var i=t.scene,n=e.defaultValue(t.primitives,i.primitives),o=t.points,s=!1;e.defined(o)||(o=n.add(new e.PointPrimitiveCollection),s=!0),this._scene=i,this._pointCollection=o,this._removePoints=s,this._polyline=n.add(new Ve(t.polylineOptions)),this._primitives=n,this._pointOptions=t.pointOptions,this._positions=[],this._points=[],this._tempNextPos=new e.Cartesian3,this._mode=Ue.BeforeDraw,this._lastClickPosition=new e.Cartesian2(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this._polylineOptions=t.polylineOptions}St.prototype.addPoint=function(e){var t=this._positions;t.push(e),this._polyline.positions=t;var i=this._pointCollection.add(this._pointOptions);i.position=e,i.show=!0,this._points.push(i)},St.prototype.handleDoubleClick=function(){this._mode=Ue.AfterDraw,this._polyline.positions=this._positions},St.prototype.handleClick=function(t){if(e.Check.defined("clickPosition",t),this._mode!==Ue.AfterDraw){var i=this._lastClickPosition;if(!(e.Cartesian2.magnitude(e.Cartesian2.subtract(i,t,bt))<10)){var n=St._getWorldPosition(this._scene,t,Et);if(e.defined(n))return this.addPoint(e.Cartesian3.clone(n,new e.Cartesian3)),this._mode=Ue.Drawing,e.Cartesian2.clone(t,i),n}}},St.prototype.handleMouseMove=function(t){if(e.Check.defined("mousePosition",t),this._mode===Ue.Drawing){var i=this._scene,n=St._getWorldPosition(i,t,Et);if(e.defined(n)){var o=this._positions.slice();return o.push(e.Cartesian3.clone(n,this._tempNextPos)),this._polyline.positions=o,n}}},St.prototype.isDestroyed=function(){return!1},St.prototype.destroy=function(){if(this._removePoints)this._primitives.remove(this._points);else for(var t=this._points,i=this._pointCollection,n=0;n<t.length;n++)i.remove(t[n]);return this._primitives.remove(this._polyline),e.destroyObject(this)},St.prototype.newPolyline=function(){return this._primitives.add(new Ve(this._polylineOptions))},St._getWorldPosition=je;var Mt=new e.Cartesian2,Tt=new e.Cartesian3,xt=new e.Cartesian3,Pt=new e.Cartesian3,kt=new e.Ray,Rt=new e.Cartesian3,Ot=new e.Cartesian3,At=new e.Cartographic;function It(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),e.Check.defined("options.scene",t.scene),St.call(this,t);var i=e.defaultValue(t.polylineOptions,e.defaultValue.EMPTY_OBJECT),n={color:i.color,ellipsoid:i.ellipsoid,width:2,dashed:!0},o=this._primitives.add(new Ve(n));o.positions=[new e.Cartesian3,new e.Cartesian3],o.show=!1,this._dashLineOptions=n,this._dashedLines=[],this._moveDashLine=o,this._heightPlane=new e.Plane(e.Cartesian3.UNIT_X,0),this._heightPlaneCV=new e.Plane(e.Cartesian3.UNIT_X,0),this._firstMove=!1,this._height=0}It.prototype=Object.create(St.prototype),It.prototype.constructor=It,It.prototype._setDashLinePositions=function(t,i){var n=this._scene.globe,o=this._scene.frameState.mapProjection.ellipsoid,s=t.positions;s[0]=e.Cartesian3.clone(i,s[0]);var r=o.cartesianToCartographic(i,At);e.defined(n)?r.height=e.defaultValue(n.getHeight(r),0):r.height=0,s[1]=o.cartographicToCartesian(r,s[1]),t.positions=s},It.prototype.addPoint=function(t){St.prototype.addPoint.call(this,t);var i=this._primitives.add(new Ve(this._dashLineOptions));i.positions=[new e.Cartesian3,new e.Cartesian3],this._dashedLines.push(i),this._setDashLinePositions(i,t)},It.prototype.handleDoubleClick=function(){this._mode=Ue.AfterDraw,this._polyline.positions=this._positions,this._moveDashLine.show=!1},It.prototype.handleClick=function(t){var i;if(e.Check.defined("clickPosition",t),0===this._positions.length){var n=this._scene,o=n.frameState.mapProjection.ellipsoid;if(i=St.prototype.handleClick.call(this,t),!e.defined(i))return;this._heightPlane=e.Plane.fromPointNormal(i,o.geodeticSurfaceNormal(i,Pt),this._heightPlane);var s=o.cartesianToCartographic(i,At),r=n.mapProjection.project(s,xt),a=e.Cartesian3.fromElements(r.z,r.x,r.y,r);this._heightPlaneCV=e.Plane.fromPointNormal(a,e.Cartesian3.UNIT_X,this._heightPlaneCV),this._height=o.cartesianToCartographic(i,At).height,this._firstMove=!0}else{var l=this._lastClickPosition;if(e.Cartesian2.magnitude(e.Cartesian2.subtract(l,t,Mt))<10)return;e.Cartesian2.clone(t,l),i=e.Cartesian3.clone(this._tempNextPos),this.addPoint(i),this._firstMove=!0}return i},It.prototype.handleMouseMove=function(t,i){if(e.Check.defined("mousePosition",t),e.Check.defined("shift",i),this._mode===Ue.Drawing){var n,o=this._scene,s=o.frameState.mapProjection.ellipsoid,r=this._positions,a=o.camera.getPickRay(t,kt);if(o.mode===e.SceneMode.SCENE3D)n=e.IntersectionTests.rayPlane(a,this._heightPlane,Tt);else if(o.mode===e.SceneMode.COLUMBUS_VIEW){n=e.IntersectionTests.rayPlane(a,this._heightPlaneCV,Tt),n=e.Cartesian3.fromElements(n.y,n.z,n.x,n);var l=o.mapProjection.unproject(n,At);n=s.cartographicToCartesian(l,n)}else if(n=o.camera.pickEllipsoid(t,s,Tt),e.defined(n)){var c=s.cartesianToCartographic(n,At);c.height=this._height,n=s.cartographicToCartesian(c,n)}if(e.defined(n)){if(!this._firstMove&&i){var h=r[r.length-1],d=this._tempNextPos,u=e.Cartesian3.subtract(d,h,Rt),p=e.Cartesian3.subtract(n,h,Ot);p=e.Cartesian3.projectVector(p,u,p),n=e.Cartesian3.add(h,p,n)}return(r=r.slice()).push(e.Cartesian3.clone(n,this._tempNextPos)),this._polyline.positions=r,this._firstMove=!1,this._moveDashLine.show=!0,this._setDashLinePositions(this._moveDashLine,n),n}}},It.prototype.isDestroyed=function(){return!1},It.prototype.destroy=function(){for(var e=this._primitives,t=this._dashedLines,i=0;i<t.length;i++)e.remove(t[i]);e.remove(this._moveDashLine),St.prototype.destroy.call(this)};var Dt=new e.Cartesian3,Lt=new e.Cartesian2,Ut=new e.Cartesian2,Nt=new e.Cartesian2,Vt=new e.Cartesian3;function Ft(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),e.Check.defined("options.scene",t.scene),e.Check.defined("options.primitives",t.primitives),e.Check.defined("options.units",t.units),e.Check.defined("options.points",t.points),e.Check.defined("options.labels",t.labels),It.call(this,t);var i=t.labels;this._labelCollection=i,this._label=i.add(qe.getLabelOptions({horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.BOTTOM,pixelOffset:new e.Cartesian2(10,-10)})),this._segmentLabels=[],this._selectedUnits=t.units,this._selectedLocale=t.locale,this._previousDistance=0,this._distance=0;var n=this;this._removeEvent=this._scene.preRender.addEventListener((function(){n.updateLabels()}))}function Bt(e){return'<svg viewBox="0 0 30 30" height="'+e+'px" width="'+e+'px">\n                 <g transform="translate(0,-267)">\n                   <path d="m 5.5492003,281.78808 18.9375757,0.0497"/>\n                   <circle r="2.0788691" cy="281.63776" cx="3.0514872"/>\n                   <circle r="2.0788691" cy="281.71384" cx="26.985731"/>\n                 </g>\n               </svg>'}function zt(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),Le.call(this,t),this._drawing=new Ft(t)}function Ht(t){e.Check.defined("scene",t),this.selectedMeasurement=void 0,this._sseh=new e.ScreenSpaceEventHandler(t.canvas),this._scene=t}Ft.prototype=Object.create(It.prototype),Ft.prototype.constructor=Ft,e.defineProperties(Ft.prototype,{distance:{get:function(){return this._distance}}}),Ft.prototype.updateLabels=function(){var t=this._positions;if(!(t.length<2)){var i=this._scene,n=t[0],o=e.SceneTransforms.wgs84ToWindowCoordinates(i,n,Lt),s=e.defined(o)?e.Cartesian2.clone(o,Nt):e.Cartesian2.fromElements(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Nt),r=s.y,a=this._segmentLabels;a[0].show=this._polyline.positions.length>2;for(var l=1;l<t.length;l++){var c=e.SceneTransforms.wgs84ToWindowCoordinates(i,t[l],Ut);if(e.defined(c)){var h=(s.y-c.y)/(c.x-s.x),d=a[l-1];d.horizontalOrigin=h>0?e.HorizontalOrigin.LEFT:e.HorizontalOrigin.RIGHT,c.y<r&&(r=c.y,n=t[l]),s=e.Cartesian2.clone(c,s)}}this._mode===Ue.AfterDraw&&(this._label.position=n)}},Ft.prototype.addPoint=function(t){var i=this._positions;if(i.length>0){this._previousDistance=this._distance;var n=this._labelCollection.add(qe.getLabelOptions({scale:.8,horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.TOP,pixelOffset:new e.Cartesian2(5,5)})),o=i[i.length-1];n.position=e.Cartesian3.midpoint(o,t,new e.Cartesian3),n.text=r.distanceToString(e.Cartesian3.distance(o,t),this._selectedUnits.distanceUnits,this._selectedLocale),n.show=!0,this._segmentLabels.push(n)}It.prototype.addPoint.call(this,t)},Ft.prototype.handleClick=function(t){this._mode===Ue.AfterDraw&&this.reset();var i=It.prototype.handleClick.call(this,t);e.defined(i)&&(this._label.show=!0,this._polyline.show=!0)},Ft.prototype.handleMouseMove=function(t,i){e.Check.defined("mousePosition",t),e.Check.defined("shift",i);var n=It.prototype.handleMouseMove.call(this,t,i);if(e.defined(n)){var o=this._positions,s=o[o.length-1],a=e.Cartesian3.subtract(n,s,Vt),l=this._previousDistance+e.Cartesian3.magnitude(a),c=this._label;c.position=e.Cartesian3.midpoint(s,n,Dt),c.text=r.distanceToString(l,this._selectedUnits.distanceUnits,this._selectedLocale),c.show=!0,this._distance=l}},Ft.prototype.reset=function(){var e,t=this._primitives,i=this._dashedLines;for(e=0;e<i.length;e++)t.remove(i[e]);this._dashedLines=[],this._polyline.positions=[],this._polyline.show=!1,this._label.show=!1,this._label.text="",this._previousDistance=0,this._distance=0,this._positions=[];var n=this._points,o=this._pointCollection;for(e=0;e<n.length;e++)o.remove(n[e]);n.length=0;var s=this._labelCollection,r=this._segmentLabels;for(e=0;e<r.length;e++)s.remove(r[e]);r.length=0,this._moveDashLine.show=!1,this._mode=Ue.BeforeDraw,this._lastClickPosition.x=Number.POSITIVE_INFINITY,this._lastClickPosition.y=Number.POSITIVE_INFINITY},Ft.prototype.destroy=function(){var e;this._removeEvent();var t=this._labelCollection,i=this._segmentLabels;for(e=0;e<i.length;e++)t.remove(i[e]);var n=this._primitives,o=this._dashedLines;for(e=0;e<o.length;e++)n.remove(o[e]);this._labelCollection.remove(this._label),It.prototype.destroy.call(this)},zt.prototype=Object.create(Le.prototype),zt.prototype.constructor=zt,e.defineProperties(zt.prototype,{distance:{get:function(){return this._drawing.distance}},icon:{value:Bt(15)},thumbnail:{value:Bt(25)},type:{value:"Horizontal distance"},instructions:{value:["Click on the point cloud or the globe to set the start point","Move the mouse to drag the line","Press this shift key to clamp the direction of the line","Click again to set the end point","To make a new measurement, click to clear the previous measurement"]},id:{value:"horizontalMeasurement"}}),zt.prototype.handleDoubleClick=function(){this._drawing.handleDoubleClick()},zt.prototype.handleClick=function(t){e.Check.defined("clickPosition",t),this._drawing.handleClick(t)},zt.prototype.handleMouseMove=function(t,i){e.Check.defined("mousePosition",t),e.Check.defined("shift",i),this._drawing.handleMouseMove(t,i)},zt.prototype.reset=function(){this._drawing.reset()},zt.prototype.isDestroyed=function(){return!1},zt.prototype.destroy=function(){return this._drawing.destroy(),e.destroyObject(this)},e.defineProperties(Ht.prototype,{scene:{get:function(){return this._scene}}}),Ht.prototype.activate=function(){var t=this._sseh;t.setInputAction(this._click.bind(this),e.ScreenSpaceEventType.LEFT_CLICK),t.setInputAction(this._clickShift.bind(this),e.ScreenSpaceEventType.LEFT_CLICK,e.KeyboardEventModifier.SHIFT),t.setInputAction(this._mouseMove.bind(this),e.ScreenSpaceEventType.MOUSE_MOVE),t.setInputAction(this._mouseMoveShift.bind(this),e.ScreenSpaceEventType.MOUSE_MOVE,e.KeyboardEventModifier.SHIFT),t.setInputAction(this._handleLeftDown.bind(this),e.ScreenSpaceEventType.LEFT_DOWN),t.setInputAction(this._handleLeftUp.bind(this),e.ScreenSpaceEventType.LEFT_UP),t.setInputAction(this._handleDoubleClick.bind(this),e.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},Ht.prototype.deactivate=function(){var t=this._sseh;t.removeInputAction(e.ScreenSpaceEventType.LEFT_CLICK),t.removeInputAction(e.ScreenSpaceEventType.LEFT_CLICK,e.KeyboardEventModifier.SHIFT),t.removeInputAction(e.ScreenSpaceEventType.MOUSE_MOVE),t.removeInputAction(e.ScreenSpaceEventType.MOUSE_MOVE,e.KeyboardEventModifier.SHIFT),t.removeInputAction(e.ScreenSpaceEventType.LEFT_DOWN),t.removeInputAction(e.ScreenSpaceEventType.LEFT_UP),t.removeInputAction(e.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},Ht.prototype._handleDoubleClick=function(e){this.selectedMeasurement.handleDoubleClick(e.position);var t=this._scene;t.requestRenderMode&&t.requestRender()},Ht.prototype._handleClick=function(e,t){this.selectedMeasurement.handleClick(e.position,t);var i=this._scene;i.requestRenderMode&&i.requestRender()},Ht.prototype._clickShift=function(e){this._handleClick(e,!0)},Ht.prototype._click=function(e){this._handleClick(e,!1)},Ht.prototype._handleMouseMove=function(e,t){this.selectedMeasurement.handleMouseMove(e.endPosition,t);var i=this._scene;i.requestRenderMode&&i.requestRender()},Ht.prototype._mouseMove=function(e){this._handleMouseMove(e,!1)},Ht.prototype._mouseMoveShift=function(e){this._handleMouseMove(e,!0)},Ht.prototype._handleLeftDown=function(e){this.selectedMeasurement.handleLeftDown(e.position);var t=this._scene;t.requestRenderMode&&t.requestRender()},Ht.prototype._handleLeftUp=function(e){this.selectedMeasurement.handleLeftUp(e.position);var t=this._scene;t.requestRenderMode&&t.requestRender()},Ht.prototype.isDestroyed=function(){return!1},Ht.prototype.destroy=function(){return this.deactivate(),this._sseh.destroy(),e.destroyObject(this)};var jt=new e.Cartesian3,Qt=new e.Cartesian3,Xt=new e.Cartesian3,Yt=[new e.Cartesian2,new e.Cartesian2,new e.Cartesian2,new e.Cartesian2],Zt=[new e.Cartesian3,new e.Cartesian3,new e.Cartesian3,new e.Cartesian3,new e.Cartesian3];function qt(t,i){e.Check.defined("scene",t),e.Check.defined("windowCoordinates",i);var n=qt._getWorldPosition(t,i,jt);if(e.defined(n)){var o=.05,s=t.camera.position,r=e.Cartesian3.distance(n,s);if(!(r>1e4)){var a=Zt[0],l=Zt[1],c=Zt[2],h=Zt[3],d=t.frameState.mapProjection.ellipsoid.geodeticSurfaceNormal(n,Qt);d=e.Cartesian3.negate(d,d);var u=e.Cartesian2.clone(i,Yt[0]);u.x-=2,u.y-=2;var p=e.Cartesian2.clone(i,Yt[1]);p.x-=2,p.y+=2;var m=e.Cartesian2.clone(i,Yt[2]);m.x+=2,m.y+=2;var _=e.Cartesian2.clone(i,Yt[3]);_.x+=2,_.y-=2;var f,g,C,v,y=qt._getWorldPosition(t,u,a),w=qt._getWorldPosition(t,p,l),b=qt._getWorldPosition(t,m,c),E=qt._getWorldPosition(t,_,h);if(e.defined(y)){var S=e.Cartesian3.subtract(y,n,a);f=e.Cartesian3.magnitude(S)/r<=o?e.Cartesian3.normalize(S,a):void 0}if(e.defined(w)){var M=e.Cartesian3.subtract(w,n,l);g=e.Cartesian3.magnitude(M)/r<=o?e.Cartesian3.normalize(M,l):void 0}if(e.defined(b)){var T=e.Cartesian3.subtract(b,n,c);C=e.Cartesian3.magnitude(T)/r<=o?e.Cartesian3.normalize(T,c):void 0}if(e.defined(E)){var x=e.Cartesian3.subtract(E,n,h);v=e.Cartesian3.magnitude(x)/r<=o?e.Cartesian3.normalize(x,h):void 0}var P=e.Cartesian3.clone(e.Cartesian3.ZERO,Xt),k=Zt[4];if(e.defined(f)&&e.defined(g)&&(k=e.Cartesian3.normalize(e.Cartesian3.cross(f,g,k),k),P=e.Cartesian3.add(P,k,P)),e.defined(g)&&e.defined(C)&&(k=e.Cartesian3.normalize(e.Cartesian3.cross(g,C,k),k),P=e.Cartesian3.add(P,k,P)),e.defined(C)&&e.defined(v)&&(k=e.Cartesian3.normalize(e.Cartesian3.cross(C,v,k),k),P=e.Cartesian3.add(P,k,P)),e.defined(v)&&e.defined(f)&&(k=e.Cartesian3.normalize(e.Cartesian3.cross(v,f,k),k),P=e.Cartesian3.add(P,k,P)),!P.equals(e.Cartesian3.ZERO))return P=e.Cartesian3.normalize(P,P),e.Math.asinClamped(Math.abs(Math.sin(e.Cartesian3.angleBetween(P,d))))}}}qt._getWorldPosition=je;var Kt=new e.Cartesian3,Wt=new e.Cartographic;function Jt(e){return'<svg viewBox="0 0 30 30" height="'+e+'px" width="'+e+'px">\n                 <g transform="translate(0,-267)">\n                   <circle r="2.0788691" cy="281.90503" cx="15.212251"/>\n                 </g>\n               </svg>'}function Gt(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),Le.call(this,t),this._point=this._pointCollection.add(qe.getPointOptions()),this._label=this._labelCollection.add(qe.getLabelOptions({horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.CENTER,pixelOffset:new e.Cartesian2(10,0)})),this._position=new e.Cartesian3,this._height=0,this._slope=0,this._measurementResult=[],this._newMeasurement=new e.Event}Gt.prototype=Object.create(Le.prototype),Gt.prototype.constructor=Gt,e.defineProperties(Gt.prototype,{position:{get:function(){return this._position}},height:{get:function(){return this._height}},slope:{get:function(){return this._slope}},icon:{value:Jt(15)},thumbnail:{value:Jt(25)},type:{value:"Point coordinates"},instructions:{value:["Move the mouse to see the longitude, latitude and height of the point"]},id:{value:"pointMeasurement"},measurementResult:{get:function(){return this._measurementResult}},newMeasurement:{get:function(){return this._newMeasurement}}}),Gt.prototype._pickPositionSupported=function(){return this._scene.pickPositionSupported},Gt.prototype._saveCurrentMeasurementAndPrepareNew=function(){this._measurementResult.push({point:this._point,label:this._label}),this._newMeasurement.raiseEvent(this._measurementResult.length-1),this._point=this._pointCollection.add(qe.getPointOptions()),this._label=this._labelCollection.add(qe.getLabelOptions({horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.CENTER,pixelOffset:new e.Cartesian2(10,0)}))},Gt.prototype.handleClick=function(t){var i=this._scene;if(i.mode!==e.SceneMode.MORPHING){var n=Gt._getWorldPosition(i,t,Kt);if(e.defined(n)){this._label.show=!1,this._point.show=!1,this._point.position=n;var o,a=i.frameState.mapProjection.ellipsoid.cartesianToCartographic(n,Wt),l=0;e.defined(i.globe)&&(l=e.defaultValue(i.globe.getHeight(a),0)),l=a.height-l,e.Math.equalsEpsilon(l,0,e.Math.EPSILON3)&&(l=0),i.mode!==e.SceneMode.SCENE2D&&(o=Gt._getSlope(i,t,this._primitives)),this._point.show=!0;var c=this._label;c.position=n,c.show=!0,c.text="lon: "+r.angleToString(a.longitude,s.DEGREES_MINUTES_SECONDS,this._selectedLocale)+"\nlat: "+r.angleToString(a.latitude,s.DEGREES_MINUTES_SECONDS,this._selectedLocale),i.mode!==e.SceneMode.SCENE2D&&this._pickPositionSupported()&&(c.text+="\nheight: "+r.distanceToString(l,this._selectedUnits.distanceUnits,this._selectedLocale),e.defined(o)&&(c.text+="\nslope: "+r.angleToString(o,this._selectedUnits.slopeUnits,this._selectedLocale,3))),this._position=e.Cartesian3.clone(n,this._position),this._height=l,this._slope=o,this._saveCurrentMeasurementAndPrepareNew()}}},Gt.prototype.handleMouseMove=function(t){if(null!==this._point){var i=this._scene;if(this._label.show=!1,this._point.show=!1,i.mode!==e.SceneMode.MORPHING){this._point.show=!1;var n=Gt._getWorldPosition(i,t,Kt);if(e.defined(n)){this._point.position=n;var o,a=i.frameState.mapProjection.ellipsoid.cartesianToCartographic(n,Wt),l=0;e.defined(i.globe)&&(l=e.defaultValue(i.globe.getHeight(a),0)),l=a.height-l,e.Math.equalsEpsilon(l,0,e.Math.EPSILON3)&&(l=0),i.mode!==e.SceneMode.SCENE2D&&(o=Gt._getSlope(i,t,this._primitives)),this._point.show=!0;var c=this._label;c.position=n,c.show=!0,c.text="lon: "+r.angleToString(a.longitude,s.DEGREES_MINUTES_SECONDS,this._selectedLocale)+"\nlat: "+r.angleToString(a.latitude,s.DEGREES_MINUTES_SECONDS,this._selectedLocale),i.mode!==e.SceneMode.SCENE2D&&this._pickPositionSupported()&&(c.text+="\nheight: "+r.distanceToString(l,this._selectedUnits.distanceUnits,this._selectedLocale),e.defined(o)&&(c.text+="\nslope: "+r.angleToString(o,this._selectedUnits.slopeUnits,this._selectedLocale,3))),this._position=e.Cartesian3.clone(n,this._position),this._height=l,this._slope=o}}}},Gt.prototype.reset=function(){this._position=e.Cartesian3.clone(e.Cartesian3.ZERO,this._position)},Gt.prototype.isDestroyed=function(){return!1},Gt.prototype.destroy=function(){for(var t=0;t<this._measurementResult;t++)this._pointCollection.remove(this._measurementResult[t].point),this._labelCollection.remove(this._measurementResult[t].label);return e.destroyObject(this)},Gt._getSlope=qt,Gt._getWorldPosition=je;var $t=new e.Cartesian2,ei=new e.Cartesian2,ti=new e.Cartesian2,ii=new e.Cartesian3;function ni(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),e.Check.defined("options.scene",t.scene),e.Check.defined("options.primitives",t.primitives),e.Check.defined("options.units",t.units),e.Check.defined("options.points",t.points),e.Check.defined("options.labels",t.labels),t.polylineOptions=qe.getPolylineOptions({ellipsoid:t.ellipsoid}),t.pointOptions=qe.getPointOptions(),St.call(this,t);var i=this._scene,n=t.labels;this._labelCollection=n,this._label=n.add(qe.getLabelOptions()),this._segmentLabels=[],this._selectedUnits=t.units,this._selectedLocale=t.locale,this._previousDistance=0,this._distance=0;var o=this;this._removeEvent=i.preRender.addEventListener((function(){o.updateLabel()})),this._measurementResult=[]}function oi(e){return'<svg viewBox="0 0 30 30" height="'+e+'px" width="'+e+'px">\n                  <g transform="translate(0,-267)">\n                   <circle cx="3.8532958" cy="293.99896" r="2.0788691" />\n                   <circle cx="7.2651663" cy="276.26389" r="2.0788691" />\n                   <circle cx="24.571842" cy="285.56577" r="2.0788691" />\n                   <circle cx="26.916754" cy="270.38345" r="2.0788691" />\n                   <path d="m 3.7523356,294.14823 3.602242,-17.81109 17.3608064,9.35582 2.401494,-15.00934" />\n                 </g>\n               </svg>'}function si(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),Le.call(this,t),this._drawing=new ni(t),this._newMeasurement=new e.Event}ni.prototype=Object.create(St.prototype),ni.prototype.constructor=ni,e.defineProperties(ni.prototype,{distance:{get:function(){return this._distance}}}),ni.prototype.updateLabel=function(){var t=this._positions;if(!(t.length<2||this._segmentLabels.length<1)){var i=this._scene,n=t[0],o=e.SceneTransforms.wgs84ToWindowCoordinates(i,n,$t),s=e.defined(o)?e.Cartesian2.clone(o,ti):e.Cartesian2.fromElements(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,ti),r=s.y,a=this._segmentLabels;a[0].show=this._polyline.positions.length>2;for(var l=1;l<t.length;l++){var c=e.SceneTransforms.wgs84ToWindowCoordinates(i,t[l],ei);if(e.defined(c)){var h=(s.y-c.y)/(c.x-s.x),d=a[l-1];d.horizontalOrigin=h>0?e.HorizontalOrigin.LEFT:e.HorizontalOrigin.RIGHT,c.y<r&&(r=c.y,n=t[l]),s=e.Cartesian2.clone(c,s)}}this._mode===Ue.AfterDraw&&(this._label.position=n)}},ni.prototype.addPoint=function(t){var i=this._positions;if(i.length>0){this._previousDistance=this._distance;var n=this._labelCollection.add(qe.getLabelOptions({scale:.8,horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.TOP,pixelOffset:new e.Cartesian2(5,5)})),o=i[i.length-1];n.position=e.Cartesian3.midpoint(o,t,new e.Cartesian3),n.text=r.distanceToString(e.Cartesian3.distance(o,t),this._selectedUnits.distanceUnits,this._selectedLocale),n.show=!0,this._segmentLabels.push(n)}St.prototype.addPoint.call(this,t)},ni.prototype.handleClick=function(t){this._mode===Ue.AfterDraw&&this.reset();var i=St.prototype.handleClick.call(this,t);e.defined(i)&&(this._label.show=!0,this._polyline.show=!0)},ni.prototype.handleMouseMove=function(t){var i=St.prototype.handleMouseMove.call(this,t);if(e.defined(i)){var n=this._positions[this._positions.length-1],o=i,s=e.Cartesian3.subtract(o,n,ii),a=this._previousDistance+e.Cartesian3.magnitude(s),l=this._label;l.position=o,l.text=r.distanceToString(a,this._selectedUnits.distanceUnits,this._selectedLocale),l.show=!0,this._distance=a}},ni.prototype.reset=function(){var e;this._label.show=!1,this._label.text="",this._positions=[],this._polyline.positions=[],this._polyline.show=!1,this._previousDistance=0,this._distance=0;var t=this._points,i=this._pointCollection;for(e=0;e<t.length;e++)i.remove(t[e]);t.length=0;var n=this._labelCollection,o=this._segmentLabels;for(e=0;e<o.length;e++)n.remove(o[e]);o.length=0,this._mode=Ue.BeforeDraw,this._lastClickPosition.x=Number.POSITIVE_INFINITY,this._lastClickPosition.y=Number.POSITIVE_INFINITY},ni.prototype.destroy=function(){this._removeEvent();var e=this._labelCollection;e.remove(this._label);for(var t=this._segmentLabels,i=0;i<t.length;i++)e.remove(t[i]);St.prototype.destroy.call(this)},ni.prototype.handleDoubleClick=function(){St.prototype.handleDoubleClick.call(this),this._saveCurrentMeasurementAndPrepareNew()},ni.prototype._saveCurrentMeasurementAndPrepareNew=function(){this._measurementResult.push({label:this._label,segmentLabels:this._segmentLabels,polyline:this._polyline,points:this._points}),this._label=this._labelCollection.add(qe.getLabelOptions()),this._segmentLabels=[],this._polyline=St.prototype.newPolyline.call(this),this._points=[]},si.prototype=Object.create(Le.prototype),si.prototype.constructor=si,e.defineProperties(si.prototype,{distance:{get:function(){return this._drawing.distance}},icon:{value:oi(15)},thumbnail:{value:oi(25)},type:{value:"Polyline Distance"},instructions:{value:["Click to start drawing a polyline","Keep clicking to add more points","Double click to finish drawing"]},id:{value:"polylineMeasurement"},measurementResult:{get:function(){return this._drawing._measurementResult}},newMeasurement:{get:function(){return this._newMeasurement}}}),si.prototype.handleDoubleClick=function(){this._drawing.handleDoubleClick(),this._newMeasurement.raiseEvent(this._drawing._measurementResult.length-1)},si.prototype.handleClick=function(e){this._drawing.handleClick(e)},si.prototype.handleMouseMove=function(e){this._drawing.handleMouseMove(e)},si.prototype.reset=function(){this._drawing.reset()},si.prototype.isDestroyed=function(){return!1},si.prototype.destroy=function(){return this._drawing.destroy(),e.destroyObject(this)};var ri=0,ai=1,li=2,ci=new e.Cartesian3,hi=new e.Cartesian2,di=new e.Cartesian3,ui=new e.Cartesian3,pi=new e.Ray,mi=new e.Cartesian3,_i=new e.Cartographic;function fi(e){return'<svg viewBox="0 0 30 30" height="'+e+'px" width="'+e+'px">\n                 <g transform="translate(0,-267)">\n                   <path d="m 15.042838,272.34414 -0.0497,18.93758"/>\n                   <circle r="2.0788691" cy="270.01154" cx="15.078616"/>\n                   <circle r="2.0788691" cy="293.97095" cx="15.092237"/>\n                 </g>\n               </svg>'}function gi(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),Le.call(this,t);var i=this._pointCollection,n=[new e.Cartesian3,new e.Cartesian3];this._startPoint=i.add(qe.getPointOptions()),this._endPoint=i.add(qe.getPointOptions()),this._positions=n,this._polyline=this._primitives.add(new Ve(qe.getPolylineOptions({ellipsoid:this._scene.frameState.mapProjection.ellipsoid,positions:n}))),this._label=this._labelCollection.add(qe.getLabelOptions({horizontalOrigin:e.HorizontalOrigin.LEFT,verticalOrigin:e.VerticalOrigin.TOP,pixelOffset:new e.Cartesian2(10,10)})),this._mode=ri,this._draggingPlane=new e.Plane(e.Cartesian3.UNIT_X,0),this._surfaceNormal=new e.Cartesian3,this._distance=0}function Ci(t){var i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).scene;e.Check.defined("options.scene",i);var n=e.defined(t.units)?t.units:new r,o=e.defined(t.primitives)?t.primitives:i.primitives.add(new e.PrimitiveCollection),s=o.add(new e.PointPrimitiveCollection),a=o.add(new e.LabelCollection),l=new Ht(i),c={scene:i,units:n,locale:t.locale,points:s,labels:a,primitives:o},h=e.clone(c);h.showComponentLines=!0;var d=[new gt(c),new gt(h),new si(c),new zt(c),new gi(c),new wt(c),new st(c),new Gt(c)];this.expanded=!1,this.instructionsVisible=!1,this.selectedMeasurement=void 0;var u=e.knockout.observable();e.knockout.defineProperty(this,"selectedMeasurement",{get:function(){return u()},set:function(t){var n=u();e.defined(n)&&n.reset(),u(t),l.selectedMeasurement=t,i.requestRenderMode&&i.requestRender()}}),e.knockout.track(this,["expanded","instructionsVisible"]),this._measurements=d,this._units=n,this._mouseHandler=l,this._primitives=o,this._scene=i,this._removeListener=i.morphStart.addEventListener(Ci.prototype.onMorph,this)}gi.prototype=Object.create(Le.prototype),gi.prototype.constructor=gi,e.defineProperties(gi.prototype,{distance:{get:function(){return this._distance}},type:{value:"Vertical distance"},icon:{value:fi(15)},thumbnail:{value:fi(25)},instructions:{value:["Click on the point cloud or the globe to set the start point","Move the mouse to drag the line","Click again to set the end point","To make a new measurement, click to clear the previous measurement"]},id:{value:"verticalMeasurement"}}),gi.prototype.handleClick=function(t){e.Check.defined("clickPosition",t);var i=this._scene,n=i.frameState.mapProjection.ellipsoid;this._mode===li&&this.reset();var o=this._mode,s=this._positions;if(o===ri){var r=gi._getWorldPosition(i,t,s[0]);if(!e.defined(r))return;this._polyline.show=!0,s[0]=e.Cartesian3.clone(r,s[0]),s[1]=e.Cartesian3.clone(r,s[1]),this._startPoint.position=r,this._startPoint.show=!0,this._mode=ai,this._polyline.positions=s,this._surfaceNormal=n.geodeticSurfaceNormal(r,this._surfaceNormal)}else o===ai&&(this._endPoint.position=s[1],this._endPoint.show=!0,this._mode=li)},gi.prototype.handleMouseMove=function(t){if(e.Check.defined("mousePosition",t),this._mode===ai){var i=this._label;if(this._scene.mode===e.SceneMode.SCENE2D)return i.position=this._positions[0],i.text=r.distanceToString(0,this._selectedUnits.distanceUnits,this._selectedLocale),i.show=!0,void(this._mode=li);var n=gi._getHeightPosition(this,t);if(e.defined(n)){var o=this._positions,s=o[0],a=o[1],l=e.Cartesian3.subtract(a,s,ci),c=e.Cartesian3.magnitude(l);i.position=e.Cartesian3.midpoint(s,a,mi),i.text=r.distanceToString(c,this._selectedUnits.distanceUnits,this._selectedLocale),i.show=!0,this._polyline.positions=o,this._distance=c}}},gi.prototype.reset=function(){this._polyline.show=!1,this._label.show=!1,this._startPoint.show=!1,this._endPoint.show=!1,this._mode=ri,this._distance=0},gi.prototype.isDestroyed=function(){return!1},gi.prototype.destroy=function(){this._primitives.remove(this._polyline);var t=this._pointCollection;return t.remove(this._startPoint),t.remove(this._endPoint),this._labelCollection.remove(this._label),e.destroyObject(this)},gi._getWorldPosition=je,gi._getHeightPosition=function(t,i){var n=t._positions,o=n[0],s=n[1],r=t._draggingPlane,a=t._surfaceNormal,l=t._scene,c=l.camera,h=c.direction,d=l.frameState.mapProjection.ellipsoid,u=o,p=a;if(l.mode===e.SceneMode.COLUMBUS_VIEW){p=e.Cartesian3.UNIT_X;var m=d.cartesianToCartographic(o,_i);u=l.mapProjection.project(m,ci),e.Cartesian3.fromElements(u.z,u.x,u.y,u)}var _=e.Cartesian3.cross(p,h,di);_=e.Cartesian3.cross(p,_,_),_=e.Cartesian3.normalize(_,_),r=e.Plane.fromPointNormal(u,_,r);var f=c.getPickRay(i,pi);if(s=e.IntersectionTests.rayPlane(f,r,s),e.defined(s)){if(l.mode===e.SceneMode.COLUMBUS_VIEW){s=e.Cartesian3.fromElements(s.y,s.z,s.x,s);var g=l.mapProjection.unproject(s,_i);s=d.cartographicToCartesian(g,s)}return e.SceneTransforms.wgs84ToWindowCoordinates(l,n[0],hi).y<i.y&&(a=e.Cartesian3.negate(a,di)),ui=e.Cartesian3.subtract(s,o,ui),ui=e.Cartesian3.projectVector(ui,a,ui),s=e.Cartesian3.add(o,ui,s)}},e.defineProperties(Ci.prototype,{scene:{get:function(){return this._scene}},measurements:{get:function(){return this._measurements}},units:{get:function(){return this._units}}}),Ci.prototype.toggleActive=function(){var e=this.expanded;e?this._deactivate():this._activate(),this.expanded=!e},Ci.prototype.toggleInstructions=function(){this.instructionsVisible=!this.instructionsVisible},Ci.prototype._activate=function(){this._mouseHandler.activate(),this.selectedMeasurement=this._measurements[0]},Ci.prototype._deactivate=function(){this._mouseHandler.deactivate(),this.selectedMeasurement=void 0,this.reset()},Ci.prototype.onMorph=function(e,t,i,n){this.reset()},Ci.prototype.reset=function(){this.instructionsVisible=!1,this._measurements.forEach((function(e){e.reset()}))},Ci.prototype.isDestroyed=function(){return!1},Ci.prototype.destroy=function(){return this._deactivate(),this._mouseHandler.destroy(),this._measurements.forEach((function(e){e.destroy()})),this._scene.primitives.remove(this._primitives),e.destroyObject(this)};function vi(t){var i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).container;e.Check.defined("options.container",i),e.Check.defined("options.scene",t.scene);var n=Ae('<div class="cesium-measure-toolbar" data-bind="css: {expanded: expanded}">\n                   <div class="cesium-measure-button cesium-measure-button-main" data-bind="click: toggleActive, attr: {title: expanded ? \'Collapse\' : \'Expand\'}">\n                       <svg width="25px" height="25px" viewBox="0 0 30 30">                          <path d="M 14.851122,11.545456 25.578177,0.95157924 29.306163,4.6249483 18.537701,15.246448 M 15.097088,18.640104 4.1531358,29.434698 0.62547531,25.653101 11.515909,14.853004"/>                          <path d="M 22.983411,26.662767 0.8350882,3.9632787 4.2110211,0.77972226 26.222602,23.217308 Z"/>                          <path d="m 23.126668,26.856584 5.906658,2.311965 -2.630951,-5.79394"/>                          <path d="M 3.8120758,6.6472825 7.2277612,3.4338416"/>                          <path d="M 5.2416124,27.76234 3.6377555,26.08552"/>                          <path d="M 7.0148521,26.015847 5.4109952,24.339027"/>                          <path d="M 8.9787697,24.078675 7.3749129,22.401855"/>                          <path d="M 10.974467,22.173284 9.3706099,20.496464"/>                          <path d="m 12.990856,20.120081 -1.603857,-1.67682"/>                          <path d="m 19.676091,13.638423 -1.603857,-1.67682"/>                          <path d="M 21.449331,11.89193 19.845474,10.21511"/>                          <path d="M 23.413248,9.9547586 21.809392,8.2779376"/>                          <path d="M 25.448671,7.9858073 23.805089,6.3725466"/>                          <path d="M 27.425335,5.9961636 25.765864,4.3670131"/>                    </svg>               </div>\n                   \x3c!-- ko foreach: measurements --\x3e\n                   <div class="cesium-measure-button" data-bind="click: function($data) { $parent.selectedMeasurement = $data; }, attr: {title: type}, css: {active: $data === $parent.selectedMeasurement}, html: thumbnail"></div>\n                   \x3c!-- /ko --\x3e\n                   <div class="cesium-measure-button cesium-measure-help" title="Settings and Help" data-bind="click: toggleInstructions, css: {active: instructionsVisible}">\n                       <svg width="20px" height="20px" viewBox="0 0 30 30">                            <g transform="translate(0,-267)">                            <g>                            <path d="M 16.891904,289.31984 H 11.7387 q -0.02021,-1.11147 -0.02021,-1.35398 0,-2.50587 0.828554,-4.12256 0.828555,-1.61669 3.314218,-3.63756 2.485663,-2.02086 2.970671,-2.64733 0.747719,-0.99022 0.747719,-2.18253 0,-1.65711 -1.33377,-2.82921 -1.313562,-1.19231 -3.556721,-1.19231 -2.162325,0 -3.617348,1.23273 -1.4550219,1.23272 -2.0006553,3.7588 l -5.2138301,-0.64667 q 0.2222951,-3.61735 3.0717138,-6.14343 2.8696274,-2.52608 7.5176156,-2.52608 4.890492,0 7.780328,2.5665 2.889836,2.54629 2.889836,5.94134 0,1.8794 -1.071058,3.55672 -1.05085,1.67732 -4.526737,4.56715 -1.798569,1.49544 -2.243159,2.40483 -0.424381,0.90939 -0.383964,3.25359 z m -5.153204,7.63887 v -5.67863 h 5.678629 v 5.67863 z" />                            </g>                            </g>                        </svg>                   </div>\n               </div>\n               <div class="cesium-measure-instructions" data-bind="visible: instructionsVisible">\n                   \x3c!-- ko foreach: measurements --\x3e\n                   <div><div class="cesium-measure-icon" data-bind="html: icon" style="display: inline"></div><span data-bind="text: type"></span></div>\n                   <ul data-bind="foreach: instructions">\n                       <li data-bind="text: $data"></li>\n                   </ul>\n                   <hr>\n                   \x3c!-- /ko --\x3e\n               </div>');n=(i=Ie(i)).appendChild(n);var o=new Ci(t);e.knockout.applyBindings(o,i),this._viewModel=o,this._container=i,this._element=n,this._dropdown=n.getElementsByClassName("cesium-measure-instructions")[0]}function yi(t,i){if(!e.defined(t))throw new e.DeveloperError("viewer is required.");i=e.defaultValue(i,{});var n=t.scene,o=document.createElement("div");o.className="cesium-viewer-measureContainer",t._toolbar.insertBefore(o,t._toolbar.firstChild),(i=e.clone(i)).container=o,i.scene=n;var s=new vi(i),r=n.postUpdate.addEventListener((function(){var e=t._container.clientHeight-125;s._dropdown.style.maxHeight=e+"px"}));t.destroy=e.wrapFunction(t,t.destroy,(function(){r(),s.destroy()})),e.defineProperties(t,{measure:{get:function(){return s}}})}e.defineProperties(vi.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}},tilesetMeasurementSupported:{get:function(){return this._scene.pickPositionSupported}}}),vi.prototype.isDestroyed=function(){return!1},vi.prototype.destroy=function(){return this._viewModel.destroy(),e.knockout.cleanNode(this._container),this._container.removeChild(this._element),e.destroyObject(this)};let wi={};const bi=e=>{const t=e.height/3;e.injectCSS&&(wi[e.cssprefix]||((e=>{const t=document.createElement("style");t.innerHTML=e;let i=document.getElementsByTagName("head")[0];i.insertBefore(t,i.firstChild)})(Mi(e,t)),wi[e.cssprefix]=!0));const i=document.createElement("div");return i.innerHTML=((e,t)=>{const i=.8*t;return`<button class="${e}-button">\n          <div class="${e}-title"></div>\n          <div class="${e}-logo" >${Ei(e,i)+Si(e,i)}</div>\n        </button>`})(e.cssprefix,t),i.firstChild},Ei=(e,t)=>`<svg class="${e}-svg" version="1.1" x="0px" y="0px"\n        width="${28/18*t}px" height="${t}px" viewBox="0 0 28 18" xml:space="preserve">\n        <path d="M26.8,1.1C26.1,0.4,25.1,0,24.2,0H3.4c-1,0-1.7,0.4-2.4,1.1C0.3,1.7,0,2.7,0,3.6v10.7\n        c0,1,0.3,1.9,0.9,2.6C1.6,17.6,2.4,18,3.4,18h5c0.7,0,1.3-0.2,1.8-0.5c0.6-0.3,1-0.8,1.3-1.4l\n        1.5-2.6C13.2,13.1,13,13,14,13v0h-0.2 h0c0.3,0,0.7,0.1,0.8,0.5l1.4,2.6c0.3,0.6,0.8,1.1,1.3,\n        1.4c0.6,0.3,1.2,0.5,1.8,0.5h5c1,0,2-0.4,2.7-1.1c0.7-0.7,1.2-1.6,1.2-2.6 V3.6C28,2.7,27.5,\n        1.7,26.8,1.1z M7.4,11.8c-1.6,0-2.8-1.3-2.8-2.8c0-1.6,1.3-2.8,2.8-2.8c1.6,0,2.8,1.3,2.8,2.8\n        C10.2,10.5,8.9,11.8,7.4,11.8z M20.1,11.8c-1.6,0-2.8-1.3-2.8-2.8c0-1.6,1.3-2.8,2.8-2.8C21.7\n        ,6.2,23,7.4,23,9 C23,10.5,21.7,11.8,20.1,11.8z"/>\n    </svg>`,Si=(e,t)=>{let i=28/18;return`<svg class="${e}-svg-error" x="0px" y="0px"\n        width="${i*t}px" height="${i*t}px" viewBox="0 0 28 28" xml:space="preserve">\n        <path d="M17.6,13.4c0-0.2-0.1-0.4-0.1-0.6c0-1.6,1.3-2.8,2.8-2.8s2.8,1.3,2.8,2.8s-1.3,2.8-2.8,2.8\n        c-0.2,0-0.4,0-0.6-0.1l5.9,5.9c0.5-0.2,0.9-0.4,1.3-0.8\n        c0.7-0.7,1.1-1.6,1.1-2.5V7.4c0-1-0.4-1.9-1.1-2.5c-0.7-0.7-1.6-1-2.5-1\n        H8.1 L17.6,13.4z"/>\n        <path d="M10.1,14.2c-0.5,0.9-1.4,1.4-2.4,1.4c-1.6,0-2.8-1.3-2.8-2.8c0-1.1,0.6-2,1.4-2.5\n        L0.9,5.1 C0.3,5.7,0,6.6,0,7.5v10.7c0,1,0.4,1.8,1.1,2.5c0.7,0.7,1.6,1,2.5,1\n        h5c0.7,0,1.3-0.1,1.8-0.5c0.6-0.3,1-0.8,1.3-1.4l1.3-2.6 L10.1,14.2z"/>\n        <path d="M25.5,27.5l-25-25C-0.1,2-0.1,1,0.5,0.4l0,0C1-0.1,2-0.1,2.6,0.4l25,25c0.6,0.6,0.6,1.5\n        ,0,2.1l0,0 C27,28.1,26,28.1,25.5,27.5z"/>\n    </svg>`},Mi=(e,t=18)=>{const i=e.height,n=e.background?e.background:e.color,o=e.cssprefix;let s;return s="round"==e.corners?e.height/2:"square"==e.corners?2:e.corners,`\n    @font-face {\n        font-family: 'Karla';\n        font-style: normal;\n        font-weight: 400;\n        src: local('Karla'), local('Karla-Regular'),\n             url(https://fonts.gstatic.com/s/karla/v5/31P4mP32i98D9CEnGyeX9Q.woff2) format('woff2');\n        unicode-range: U+0100-024F, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF;\n    }\n    @font-face {\n        font-family: 'Karla';\n        font-style: normal;\n        font-weight: 400;\n        src: local('Karla'), local('Karla-Regular'),\n             url(https://fonts.gstatic.com/s/karla/v5/Zi_e6rBgGqv33BWF8WTq8g.woff2) format('woff2');\n        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074,\n                       U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;\n    }\n\n    button.${o}-button {\n        font-family: 'Karla', sans-serif;\n\n        border: ${n} 2px solid;\n        border-radius: ${s}px;\n        box-sizing: border-box;\n        background: ${e.background?e.background:"none"};\n\n        height: ${i}px;\n        min-width: ${9.6*t}px;\n        display: inline-block;\n        position: relative;\n\n        cursor: pointer;\n        transition: border 0.5s;\n    }\n\n    button.${o}-button:focus {\n      outline: none;\n    }\n\n    /*\n    * Logo\n    */\n\n    .${o}-logo {\n        width: ${i}px;\n        height: ${i}px;\n        position: absolute;\n        top:0px;\n        left:0px;\n        width: ${i-4}px;\n        height: ${i-4}px;\n    }\n    .${o}-svg {\n        fill: ${e.color};\n        margin-top: ${(i-.8*t)/2-2}px;\n        margin-left: ${i/3}px;\n    }\n    .${o}-svg-error {\n        fill: ${e.color};\n        display:none;\n        margin-top: ${(i-28/18*t*.8)/2-2}px;\n        margin-left: ${i/3}px;\n    }\n\n\n    /*\n    * Title\n    */\n\n    .${o}-title {\n        color: ${e.color};\n        position: relative;\n        font-size: ${t}px;\n        padding-left: ${1.05*i}px;\n        padding-right: ${s-10<5?i/3:s-10}px;\n        transition: color 0.5s;\n    }\n\n    /*\n    * disabled\n    */\n\n    button.${o}-button[disabled=true] {\n        opacity: ${e.disabledOpacity};\n    }\n\n    button.${o}-button[disabled=true] > .${o}-logo > .${o}-svg {\n        display:none;\n    }\n\n    button.${o}-button[disabled=true] > .${o}-logo > .${o}-svg-error {\n        display:initial;\n    }\n\n    /*\n    * error\n    */\n\n    button.${o}-button[error=true] {\n        animation: errorShake 0.4s;\n    }\n\n    @keyframes errorShake {\n      0% { transform: translate(1px, 0) }\n      10% { transform: translate(-2px, 0) }\n      20% { transform: translate(2px, 0) }\n      30% { transform: translate(-2px, 0) }\n      40% { transform: translate(2px, 0) }\n      50% { transform: translate(-2px, 0) }\n      60% { transform: translate(2px, 0) }\n      70% { transform: translate(-2px, 0) }\n      80% { transform: translate(2px, 0) }\n      90% { transform: translate(-1px, 0) }\n      100% { transform: translate(0px, 0) }\n    }\n  `};class Ti{constructor(e){(e=e||{}).color=e.color||"rgb(80,168,252)",e.background=e.background||!1,e.disabledOpacity=e.disabledOpacity||.5,e.height=e.height||55,e.corners=e.corners||"square",e.cssprefix=e.cssprefix||"webvr-ui",e.textEnterXRTitle=e.textEnterXRTitle||"ENTER VR",e.textXRNotFoundTitle=e.textXRNotFoundTitle||"VR NOT FOUND",e.textExitXRTitle=e.textExitXRTitle||"EXIT VR",e.onRequestSession=e.onRequestSession||function(){},e.onEndSession=e.onEndSession||function(){},e.injectCSS=!1!==e.injectCSS,this.options=e,this._enabled=!1,this.session=null,this.domElement=e.domElement||bi(e),this.__defaultDisplayStyle=this.domElement.style.display||"initial",this.domElement.addEventListener("click",(()=>this.__onXRButtonClick())),this.__forceDisabled=!1,this.__setDisabledAttribute(!0),this.setTitle(this.options.textXRNotFoundTitle)}set enabled(e){return this._enabled=e,this.__updateButtonState(),this}get enabled(){return this._enabled}setSession(e){return this.session=e,this.__updateButtonState(),this}setTitle(e){return this.domElement.title=e,xi(this.domElement,this.options.cssprefix,"title",(t=>{e?(t.innerText=e,t.style.display="initial"):t.style.display="none"})),this}setTooltip(e){return this.domElement.title=e,this}show(){return this.domElement.style.display=this.__defaultDisplayStyle,this}hide(){return this.domElement.style.display="none",this}enable(){return this.__setDisabledAttribute(!1),this.__forceDisabled=!1,this}disable(){return this.__setDisabledAttribute(!0),this.__forceDisabled=!0,this}remove(){this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement)}__setDisabledAttribute(e){e||this.__forceDisabled?this.domElement.setAttribute("disabled","true"):this.domElement.removeAttribute("disabled")}__onXRButtonClick(){if(this.session)this.options.onEndSession(this.session);else if(this._enabled){let e=this.options.onRequestSession();e&&e.catch((e=>{let t=`XRSession creation failed: ${e.message}`;this.setTooltip(t),console.error(t),this.__setDisabledAttribute(!0),this.domElement.setAttribute("error","true"),setTimeout((()=>{this.__setDisabledAttribute(!1),this.domElement.setAttribute("error","false")}),1e3)}))}}__updateButtonState(){this.session?(this.setTitle(this.options.textExitXRTitle),this.setTooltip("Exit XR presentation"),this.__setDisabledAttribute(!1)):this._enabled?(this.setTitle(this.options.textEnterXRTitle),this.setTooltip("Enter XR"),this.__setDisabledAttribute(!1)):(this.setTitle(this.options.textXRNotFoundTitle),this.setTooltip("No XR headset found."),this.__setDisabledAttribute(!0))}}const xi=(e,t,i,n)=>{const o=e.querySelector("."+t+"-"+i);o&&n(o)},Pi=1e-6;let ki="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function Ri(){let e=new ki(3);return ki!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Oi(e,t,i){let n=new ki(3);return n[0]=e,n[1]=t,n[2]=i,n}function Ai(e,t){let i=t[0],n=t[1],o=t[2],s=i*i+n*n+o*o;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e}function Ii(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Di(e,t,i){let n=t[0],o=t[1],s=t[2],r=i[0],a=i[1],l=i[2];return e[0]=o*l-s*a,e[1]=s*r-n*l,e[2]=n*a-o*r,e}const Li=function(e){let t=e[0],i=e[1],n=e[2];return Math.sqrt(t*t+i*i+n*n)};!function(){let e=Ri()}();!function(){let e=function(){let e=new ki(4);return ki!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}()}();function Ui(){let e=new ki(4);return ki!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Ni(e,t,i){i*=.5;let n=t[0],o=t[1],s=t[2],r=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=n*l+r*a,e[1]=o*l+s*a,e[2]=s*l-o*a,e[3]=r*l-n*a,e}function Vi(e,t,i){i*=.5;let n=t[0],o=t[1],s=t[2],r=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=n*l-s*a,e[1]=o*l+r*a,e[2]=s*l+n*a,e[3]=r*l-o*a,e}function Fi(e,t,i,n){let o,s,r,a,l,c=t[0],h=t[1],d=t[2],u=t[3],p=i[0],m=i[1],_=i[2],f=i[3];return s=c*p+h*m+d*_+u*f,s<0&&(s=-s,p=-p,m=-m,_=-_,f=-f),1-s>Pi?(o=Math.acos(s),r=Math.sin(o),a=Math.sin((1-n)*o)/r,l=Math.sin(n*o)/r):(a=1-n,l=n),e[0]=a*c+l*p,e[1]=a*h+l*m,e[2]=a*d+l*_,e[3]=a*u+l*f,e}const Bi=function(e,t){let i=t[0],n=t[1],o=t[2],s=t[3],r=i*i+n*n+o*o+s*s;return r>0&&(r=1/Math.sqrt(r),e[0]=i*r,e[1]=n*r,e[2]=o*r,e[3]=s*r),e};(function(){let e=Ri(),t=Oi(1,0,0),i=Oi(0,1,0)})(),function(){let e=Ui(),t=Ui()}(),function(){let e=function(){let e=new ki(9);return ki!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}()}();!function(){let e=function(){let e=new ki(2);return ki!=Float32Array&&(e[0]=0,e[1]=0),e}()}();const zi=.0025;class Hi{constructor(e,t){let i,n,o;this.lookYaw=0,this.lookPitch=0,this.viewerHeight=0,this.canvas=e,this.baseRefSpace=t,this.refSpace=t,this.dirty=!1,e.style.cursor="grab",e.addEventListener("mousemove",(e=>{1&e.buttons&&this.rotateView(e.movementX,e.movementY)})),e.addEventListener("touchstart",(e=>{if(null==i){let t=e.changedTouches[0];i=t.identifier,n=t.pageX,o=t.pageY}})),e.addEventListener("touchend",(e=>{for(let t of e.changedTouches)i==t.identifier&&(i=void 0,this.rotateView(t.pageX-n,t.pageY-o))})),e.addEventListener("touchcancel",(e=>{for(let t of e.changedTouches)i==t.identifier&&(i=void 0)})),e.addEventListener("touchmove",(e=>{for(let t of e.changedTouches)i==t.identifier&&(this.rotateView(t.pageX-n,t.pageY-o),n=t.pageX,o=t.pageY)}))}setHeight(e){this.viewerHeight!=e&&(this.viewerHeight=e),this.dirty=!0}rotateView(e,t){this.lookYaw+=e*zi,this.lookPitch+=t*zi,this.lookPitch<.5*-Math.PI&&(this.lookPitch=.5*-Math.PI),this.lookPitch>.5*Math.PI&&(this.lookPitch=.5*Math.PI),this.dirty=!0}reset(){this.lookYaw=0,this.lookPitch=0,this.refSpace=this.baseRefSpace,this.dirty=!1}get referenceSpace(){if(this.dirty){let e=Ui();Ni(e,e,-this.lookPitch),Vi(e,e,-this.lookYaw);let t=new XRRigidTransform({},{x:e[0],y:e[1],z:e[2],w:e[3]});this.refSpace=this.baseRefSpace.getOffsetReferenceSpace(t),t=new XRRigidTransform({y:-this.viewerHeight}),this.refSpace=this.refSpace.getOffsetReferenceSpace(t),this.dirty=!1}return this.refSpace}}let ji="undefined"!=typeof Float32Array?Float32Array:Array;Math.PI;function Qi(){let e=new ji(3);return ji!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Xi(e,t,i){let n=new ji(3);return n[0]=e,n[1]=t,n[2]=i,n}function Yi(e,t){let i=t[0],n=t[1],o=t[2],s=i*i+n*n+o*o;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e}function Zi(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function qi(e,t,i){let n=t[0],o=t[1],s=t[2],r=i[0],a=i[1],l=i[2];return e[0]=o*l-s*a,e[1]=s*r-n*l,e[2]=n*a-o*r,e}const Ki=function(e){let t=e[0],i=e[1],n=e[2];return Math.sqrt(t*t+i*i+n*n)};!function(){let e=Qi()}();!function(){let e=function(){let e=new ji(4);return ji!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}()}();function Wi(){let e=new ji(4);return ji!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Ji(e,t,i,n){let o,s,r,a,l,c=t[0],h=t[1],d=t[2],u=t[3],p=i[0],m=i[1],_=i[2],f=i[3];return s=c*p+h*m+d*_+u*f,s<0&&(s=-s,p=-p,m=-m,_=-_,f=-f),1-s>1e-6?(o=Math.acos(s),r=Math.sin(o),a=Math.sin((1-n)*o)/r,l=Math.sin(n*o)/r):(a=1-n,l=n),e[0]=a*c+l*p,e[1]=a*h+l*m,e[2]=a*d+l*_,e[3]=a*u+l*f,e}const Gi=function(e,t){let i=t[0],n=t[1],o=t[2],s=t[3],r=i*i+n*n+o*o+s*s;return r>0&&(r=1/Math.sqrt(r),e[0]=i*r,e[1]=n*r,e[2]=o*r,e[3]=s*r),e},$i=(function(){let e=Qi(),t=Xi(1,0,0),i=Xi(0,1,0)}(),function(){let e=Wi(),t=Wi()}(),function(){let e=function(){let e=new ji(9);return ji!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}()}(),Xi(.155,-.465,-.15),Xi(-.155,-.465,-.15),Xi(0,0,-.25),Xi(0,0,.05),Xi(-.08,.14,.08),180/Math.PI);function en(e,t,i){!function(e,t,i){function n(e,t,i){return e<t?t:e>i?i:e}var o=t[0]*t[0],s=t[1]*t[1],r=t[2]*t[2],a=t[3]*t[3];if("XYZ"===i)e[0]=Math.atan2(2*(t[0]*t[3]-t[1]*t[2]),a-o-s+r),e[1]=Math.asin(n(2*(t[0]*t[2]+t[1]*t[3]),-1,1)),e[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),a+o-s-r);else if("YXZ"===i)e[0]=Math.asin(n(2*(t[0]*t[3]-t[1]*t[2]),-1,1)),e[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),a-o-s+r),e[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),a-o+s-r);else if("ZXY"===i)e[0]=Math.asin(n(2*(t[0]*t[3]+t[1]*t[2]),-1,1)),e[1]=Math.atan2(2*(t[1]*t[3]-t[2]*t[0]),a-o-s+r),e[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),a-o+s-r);else if("ZYX"===i)e[0]=Math.atan2(2*(t[0]*t[3]+t[2]*t[1]),a-o-s+r),e[1]=Math.asin(n(2*(t[1]*t[3]-t[0]*t[2]),-1,1)),e[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),a+o-s-r);else if("YZX"===i)e[0]=Math.atan2(2*(t[0]*t[3]-t[2]*t[1]),a-o+s-r),e[1]=Math.atan2(2*(t[1]*t[3]-t[0]*t[2]),a+o-s-r),e[2]=Math.asin(n(2*(t[0]*t[1]+t[2]*t[3]),-1,1));else{if("XZY"!==i)return void console.log("No order given for quaternion to euler conversion.");e[0]=Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),a-o+s-r),e[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),a+o-s-r),e[2]=Math.asin(n(2*(t[2]*t[3]-t[0]*t[1]),-1,1))}}(e,t,i),e[0]*=$i,e[1]*=$i,e[2]*=$i}function tn(){let e=!1;var t;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e}function nn(e){switch(e.keyCode){case 37:case 39:case 38:case 40:e.preventDefault()}}function on(e){let t=document.querySelector(".cesium-viewer-cesium3DTilesInspectorContainer");t.style.display=e?"block":"none"}function sn(e,t){let i=e.camera,n={};return n.offsetX=i.position.x-t.boundingSphere.center.x,n.offsetY=i.position.y-t.boundingSphere.center.y,n.offsetZ=i.position.z-t.boundingSphere.center.z,n.heading=Cesium.Math.toDegrees(i.heading),n.pitch=Cesium.Math.toDegrees(i.pitch),n.roll=Cesium.Math.toDegrees(i.roll),JSON.stringify(n)}function rn(e,t){e.scene.globe.show=t,e.scene.skyAtmosphere.show=t,e.scene.skyBox.show=t,e.scene.moon.show=t,e.scene.sun.show=t,e.scene.backgroundColor=t?Cesium.Color.BLACK.clone():Cesium.Color.fromCssColorString(CONSTRUKTED_AJAX.bg_color_css_string)}function an(e){e.screenSpaceCameraController.enableRotate=!1,e.screenSpaceCameraController.enableTranslate=!1,e.screenSpaceCameraController.enableZoom=!1,e.screenSpaceCameraController.enableTilt=!1,e.screenSpaceCameraController.enableLook=!1}function ln(e){e.screenSpaceCameraController.enableRotate=!0,e.screenSpaceCameraController.enableTranslate=!0,e.screenSpaceCameraController.enableZoom=!0,e.screenSpaceCameraController.enableTilt=!0,e.screenSpaceCameraController.enableLook=!0}let cn,hn=null;const dn=tn();function un(e,t){let i=t.session,n=i.isImmersive?xrImmersiveRefSpace:cn.referenceSpace,o=t.getViewerPose(n);if(o){let e=CONSTRUKTEDXR.create$1(),t=o.transform.orientation;CONSTRUKTEDXR.eulerFromQuaternionDegree(e,[t.x,t.y,t.z,t.w],"YXZ");new CustomEvent("viewerPoseUpdatedEvent",{detail:{posX:o.transform.position.x,posY:o.transform.position.y,posZ:o.transform.position.z,rotX:-e[1],rotY:e[0],rotZ:e[2]}});dn&&changeCesiumCamera(o.transform.position.x,o.transform.position.y,o.transform.position.z,-e[1],e[0],e[2])}i.requestAnimationFrame(un);let s=i.renderState.baseLayer;hn.bindFramebuffer(hn.FRAMEBUFFER,s.framebuffer)}function pn(e){if(e.addEventListener("end",fn),e.isImmersive&&!cesiumFPVCameraController.started()){if(null==cesiumFPVCameraController.startFPVPositionMobile())return alert("Please tap on 3d tile to start FPV!"),void cesiumFPVCameraController.setAllowStartPositionTap(!0);cesiumFPVCameraController.startFPVMobile()}hn=function(e){e=e||{alpha:!1};let t=document.getElementById("xr-canvas"),i=e.webgl2?["webgl2"]:["webgl","experimental-webgl"],n=null;for(let o of i)if(n=t.getContext(o,e),n)break;if(!n){let t=e.webgl2?"WebGL 2":"WebGL";return console.error("This browser does not support "+t+"."),null}return n}({xrCompatible:!0}),e.updateRenderState({baseLayer:new XRWebGLLayer(e,hn)});let t=e.isImmersive?"local":"viewer";e.requestReferenceSpace(t).then((t=>{e.isImmersive?xrImmersiveRefSpace=t:cn=new CONSTRUKTEDXR.InlineViewerHelper(hn.canvas,t),e.requestAnimationFrame(un)}))}function mn(){let e=document.getElementById("overlay-content");return navigator.xr.requestSession("immersive-ar",{optionalFeatures:["dom-overlay","dom-overlay-for-handheld-ar"],domOverlay:{root:e}}).then((e=>{xrButton.setSession(e),e.isImmersive=!0,pn(e)}))}function _n(e){e.end(),cesiumFPVCameraController.setAllowStartPositionTap(!0),cesiumFPVCameraController.exitFPV()}function fn(e){e.session.isImmersive&&xrButton.setSession(null)}function gn(){jQuery(".webvr-ui-button, #xr-canvas").toggle(),jQuery("#overlay-content").toggleClass("full-overlay")}const Cn=88;class vn{constructor(e){this._isMobile=e.isMobile,this._enabled=!1,this._cesiumViewer=e.cesiumViewer,this._canvas=this._cesiumViewer.canvas,this._camera=this._cesiumViewer.camera,this._leftButtonPressed=!1,this._cameraHeadingWhenLbuttonPressed=this._camera.heading,this._cameraPitchWhenLbuttonPressed=this._camera.pitch,this._startMousePosition=null,this._screenSpaceEventHandler=new Cesium.ScreenSpaceEventHandler(this._canvas),this._screenSpaceEventHandler.setInputAction(this._onMouseLButtonDoubleClicked.bind(this),Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this._screenSpaceEventHandler.setInputAction(this._onMouseLButtonClicked.bind(this),Cesium.ScreenSpaceEventType.LEFT_DOWN),this._screenSpaceEventHandler.setInputAction(this._onMouseUp.bind(this),Cesium.ScreenSpaceEventType.LEFT_UP)}_onMouseLButtonDoubleClicked(e){}_onMouseLButtonClicked(e){this._isMobile&&(this._lastTapedPosition=e.position),null==this._startFPVPositionMobile&&this._allowStartPositionTap&&(this._startFPVPositionMobile=e.position.clone()),this._leftButtonPressed=!0,this._cameraHeadingWhenLbuttonPressed=this._camera.heading,this._cameraPitchWhenLbuttonPressed=this._camera.pitch,this._startMousePosition=e.position.clone()}_onMouseUp(e){this._leftButtonPressed=!1}_onMouseMove(e){this._leftButtonPressed&&this._changeCameraHeadingPitch(e.endPosition)}_changeCameraHeadingPitch(e){const t=this._canvas.clientWidth,i=this._canvas.clientHeight,n=-60*((e.x-this._startMousePosition.x)/t),o=-35*(-(e.y-this._startMousePosition.y)/i);var s;this._camera.setView({orientation:{heading:this._cameraHeadingWhenLbuttonPressed+Cesium.Math.toRadians(n),pitch:(s=this._cameraPitchWhenLbuttonPressed+Cesium.Math.toRadians(o),s>176&&s<272?s=272:s>Cn&&s<272&&(s=Cn),s),roll:this._camera.roll}})}}const yn=1.65;let wn,bn=new Cesium.Cartesian3;class En extends vn{constructor(e){super(e),this._FPVStarted=new Cesium.Event,this._FPVFinished=new Cesium.Event,this._direction=-1,this._main3dTileset=e.main3dTileset,this._defaultCameraPositionOrientationJson=e.defaultCameraPositionOrientationJson,this._ignoreCollisionDetection=!!Cesium.defined(e.ignoreCollisionDetection)&&e.ignoreCollisionDetection,this._frameMonitor=Cesium.FrameRateMonitor.fromScene(this._cesiumViewer.scene),this._screenSpaceEventHandler=new Cesium.ScreenSpaceEventHandler(this._canvas),this._screenSpaceEventHandler.setInputAction(this._onMouseLButtonDoubleClicked.bind(this),Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this._screenSpaceEventHandler.setInputAction(this._onMouseLButtonClicked.bind(this),Cesium.ScreenSpaceEventType.LEFT_DOWN),this._screenSpaceEventHandler.setInputAction(this._onMouseUp.bind(this),Cesium.ScreenSpaceEventType.LEFT_UP),this._startFPVPositionMobile=null,this._lastTranslationX=0,this._lastTranslationY=0,this._lastTranslationZ=0,this._lastRotationX=0,this._lastRotationY=0,this._lastRotaionZ=0,this._allowStartPositionTap=!1,this._walkingSpeed=.5,this._immersiveArEnabled=e.immersiveArEnabled,this._canStart=!1}setAllowStartPositionTap(e){this._allowStartPositionTap=e}_connectEventHandlers(){const e=this._cesiumViewer.canvas;this._screenSpaceEventHandler.setInputAction(this._onMouseMove.bind(this),Cesium.ScreenSpaceEventType.MOUSE_MOVE),e.setAttribute("tabindex","0"),e.onclick=function(){e.focus()};const t=this;this._onKeyDownCallback=function(e){t._onKeyDown(e)},this._onKeyUpCallback=function(e){t._onKeyUp(e)},document.addEventListener("keydown",this._onKeyDownCallback),document.addEventListener("keyup",this._onKeyUpCallback),this._disconectOnClockTick=this._cesiumViewer.clock.onTick.addEventListener(En.prototype._onClockTick,this)}_disconnectEventHandlers(){this._screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),document.removeEventListener("keydown",this._onKeyDownCallback),document.removeEventListener("keyup",this._onKeyUpCallback),this._disconectOnClockTick()}_doStartFPV(e){this._canStart=!1;const t=this._cesiumViewer.scene.globe,i=this;this._camera.flyTo({destination:t.ellipsoid.cartographicToCartesian(e),orientation:{heading:this._camera.heading,pitch:0,roll:0},complete:function(){an(i._cesiumViewer.scene),i._connectEventHandlers(),i._cameraDirectionAtArStartedMoment=i._camera.direction.clone(),i._cameraRightAtArStartedMoment=i._camera.right.clone(),i._cameraUpAtArStartedMoment=i._camera.up.clone(),i._cameraPositionAtArStartedMoment=i._camera.position.clone(new Cesium.Cartesian3),i._cameraHeadingAtArStartedMoment=i._camera.heading,i._cameraPitchAtArStartedMoment=i._camera.pitch,i._FPVStarted.raiseEvent(),i._enabled=!0}})}exitFPV(){ln(this._cesiumViewer.scene),this._disconnectEventHandlers(),this._startFPVPositionMobile=null,this._allowStartPositionTap=!1,this._FPVFinished.raiseEvent(),this._enabled=!1}_onKeyDown(e){const t=e.keyCode;switch(this._direction=-1,t){case"W".charCodeAt(0):case 38:return void(this._direction=0);case"S".charCodeAt(0):case 40:return void(this._direction=1);case"D".charCodeAt(0):case 39:return void(this._direction=3);case"A".charCodeAt(0):case 37:return void(this._direction=2);case 90:return void(this._main3dTileset&&(this._main3dTileset.show=!this._main3dTileset.show));default:return}}_onKeyUp(){this._direction=-1}_getPickedCartographic(e){this._isMobile&&(e=this._lastTapedPosition);const t=this._cesiumViewer.scene;let i=t.globe;i.depthTestAgainstTerrain=!0;const n=t.camera.getPickRay(e),o=t.pickFromRay(n);if(!o)return console.warn("pickFromRay failed!"),null;const s=i.ellipsoid.cartesianToCartographic(o.position);if(i.show){const e=i.getHeight(s);if(void 0===e)return console.warn("globe.getHeight(cartographic) failed!"),null;if(Cesium.Math.equalsEpsilon(s.height,e,Cesium.Math.EPSILON4,Cesium.Math.EPSILON1))return console.warn("out of 3d tile!"),null}return s.height<0&&console.warn("height is negative"),s.height=s.height+yn,s}_onMouseLButtonDoubleClicked(e){const t=this._getPickedCartographic(e.position);if(this._enabled){if(!t)return;const e=this._cesiumViewer.scene.globe;this._camera.flyTo({destination:e.ellipsoid.cartographicToCartesian(t),orientation:{heading:this._camera.heading,pitch:0,roll:0}})}else this._canStart&&(t?this._doStartFPV(t):alert("Unfortunately failed to enter FPV!"))}_getCurrentCameraPositionAtCollisionHeight(){const e=this._camera.position,t=Cesium.Cartesian3.magnitude(e),i=(t-yn+.5)/t;return Cesium.Cartesian3.multiplyByScalar(e,i,new Cesium.Cartesian3)}_getRayPosition(){let e=this._camera.position,t=Cesium.Cartesian3.magnitude(e),i=(t-yn+.5)/t,n=new Cesium.Cartesian3;return Cesium.Cartesian3.multiplyByScalar(e,i,n)}_changeCameraPosition(e){0===this._direction?Cesium.Cartesian3.multiplyByScalar(this._camera.direction,1,bn):1===this._direction?Cesium.Cartesian3.multiplyByScalar(this._camera.direction,-1,bn):2===this._direction?Cesium.Cartesian3.multiplyByScalar(this._camera.right,-1,bn):3===this._direction&&Cesium.Cartesian3.multiplyByScalar(this._camera.right,1,bn);let t=this._fpsConsideredWalkingSpeed()*e,i=Cesium.Cartesian3.multiplyByScalar(bn,t,new Cesium.Cartesian3),n=this._getRayPosition(),o=Cesium.Cartesian3.add(n,i,new Cesium.Cartesian3),s=Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(o,n,new Cesium.Cartesian3),new Cesium.Cartesian3),r=new Cesium.Ray(n,s),a=this._cesiumViewer.scene.pickFromRay(r);if(Cesium.defined(a)){return Cesium.Cartesian3.distanceSquared(n,a.position)>t?void this._setCameraPosition(o):void 0}this._setCameraPosition(o)}_setCameraPosition(e){let t=this._cesiumViewer.scene.globe.ellipsoid,i=t.cartesianToCartographic(e);i.height=0;let n=this._cesiumViewer.scene.sampleHeight(i),o=t.cartesianToCartographic(this._camera.position);void 0!==n?(n<0&&console.warn("sampled height is negative"),n>o.height?i.height=o.height:i.height=n+yn,this._camera.setView({destination:t.cartographicToCartesian(i),orientation:new Cesium.HeadingPitchRoll(this._camera.heading,this._camera.pitch,this._camera.roll),endTransform:Cesium.Matrix4.IDENTITY})):console.warn("sampled height is undefined")}_canMove(e,t,i){if(this._ignoreCollisionDetection)return!0;const n=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3);let o=new Cesium.Ray(e,n);const s=this._cesiumViewer.scene.pickFromRay(o);if(Cesium.defined(s)){return Cesium.Cartesian3.distanceSquared(e,s.position)>=i}return!0}_getRevisedCameraPosition(e){const t=this._cesiumViewer.scene,i=t.globe.ellipsoid,n=i.cartesianToCartographic(e),o=t.sampleHeight(n),s=i.cartesianToCartographic(this._camera.position);return void 0===o?(console.warn("heightAtTargetPosition is undefined"),n.height=s.height,i.cartographicToCartesian(n)):o<0?(console.warn("heightAtTargetPosition is negative"),n.height=s.height,i.cartographicToCartesian(n)):(o>s.height?n.height=s.height:n.height=o+yn,i.cartographicToCartesian(n))}_onClockTick(e){const t=e._clockStep;-1!==this._direction&&this._changeCameraPosition(t)}started(){return this._enabled}getViewData(){const e=this._cesiumViewer.camera,t=this._cesiumViewer.scene.globe.ellipsoid.cartesianToCartographic(e.position),i={};return i.longitude=t.longitude,i.latitude=t.latitude,i.height=t.height,i.heading=e.heading,i.pitch=e.pitch,i.roll=e.roll,JSON.stringify(i)}_fpsConsideredWalkingSpeed(){const e=this._frameMonitor.lastFramesPerSecond,t=this._walkingSpeed;if(void 0===e)return t;return 30*t/e}FPVStarted(){return this._FPVStarted}FPVFinished(){return this._FPVFinished}startFPVMobile(){this._doStartFPV(this._startFPVPositionMobile)}_getModifiedCurrentCameraPositionMobile(){const e=this._cameraPositionAtArStartedMoment,t=Cesium.Cartesian3.magnitude(e),i=(t-yn+.5)/t;return Cesium.Cartesian3.multiplyByScalar(e,i,new Cesium.Cartesian3)}setView(e,t,i,n,o,s){if(e==this._lastTranslationX&&i==this._lastTranslationZ&&n==this._lastRotationX&&o==this._lastRotationY)return;let r;const a=Cesium.Cartesian3.multiplyByScalar(this._cameraRightAtArStartedMoment,e,new Cesium.Cartesian3),l=Cesium.Cartesian3.multiplyByScalar(this._cameraDirectionAtArStartedMoment,-i,new Cesium.Cartesian3);Cesium.Cartesian3.multiplyByScalar(this._cameraUpAtArStartedMoment,t,new Cesium.Cartesian3);let c=Cesium.Cartesian3.add(a,l,new Cesium.Cartesian3);if(c.equals(Cesium.Cartesian3.ZERO))r=this._cameraPositionAtArStartedMoment.clone();else{const e=this._getModifiedCurrentCameraPositionMobile(),t=Cesium.Cartesian3.add(e,c,new Cesium.Cartesian3);this._canMove(e,t,Cesium.Cartesian3.magnitude(c))?r=this._getRevisedCameraPosition(t):(console.warn("collision detected. can not move!"),r=this._cameraPositionAtArStartedMoment.clone())}const h=Cesium.Math.toDegrees(this._cameraHeadingAtArStartedMoment)+n;let d=Cesium.Math.toDegrees(this._cameraPitchAtArStartedMoment)+o;d=this._validPitch(d),this._camera.setView({destination:r,orientation:{heading:Cesium.Math.toRadians(h),pitch:Cesium.Math.toRadians(d),roll:this._camera.roll},endTransform:Cesium.Matrix4.IDENTITY}),this._lastTranslationX=e,this._lastTranslationY=t,this._lastTranslationZ=i,this._lastRotationX=n,this._lastRotationY=o,this._lastRotationZ=s}startFPVPositionMobile(){return this._startFPVPositionMobile}setDirectionLeft(){this._direction=2}setDirectionRight(){this._direction=3}setDirectionForward(){this._direction=0}setDirectionBackward(){this._direction=1}setDirectionNone(){this._direction=-1}onDoubleTaped(e){this._onMouseLButtonDoubleClicked(e)}setWorkingSpeed(e){this._walkingSpeed=e}setImmersiveArEnabled(e){this._immersiveArEnabled=e}setCanStart(e){this._canStart=e}}function Sn(e){e.asset.extras&&e.asset.extras.ion.georeferenced?xn({longitude:0,latitude:0,height:jQuery("#tileset_altitude").val(),heading:0,pitch:0,roll:0,scale:0}):Mn()}function Mn(){if(transformEditor&&transformEditor.active){Tn(transformEditor.viewModel.position,transformEditor.viewModel.headingPitchRoll,transformEditor.viewModel.scale)}else{let e=tileset.modelMatrix,t=Cesium.Matrix4.getTranslation(e,new Cesium.Cartesian3),i=viewer.scene;Tn(t,Cesium.Transforms.fixedFrameToHeadingPitchRoll(e,i.mapProjection.ellipsoid,void 0,new Cesium.HeadingPitchRoll),Cesium.Matrix4.getScale(e,new Cesium.Cartesian3))}}function Tn(e,t,i){let n=Cesium.Cartographic.fromCartesian(e);xn({longitude:Cesium.Math.toDegrees(n.longitude).toFixed(8),latitude:Cesium.Math.toDegrees(n.latitude).toFixed(8),height:n.height.toFixed(8),heading:Cesium.Math.toDegrees(t.heading).toFixed(8),pitch:Cesium.Math.toDegrees(t.pitch).toFixed(8),roll:Cesium.Math.toDegrees(t.roll).toFixed(8),scale:i})}function xn(e){let t=jQuery("#save_tileset_model_matrix_button");t.prop("disabled",!0),jQuery.ajax({url:CONSTRUKTED_AJAX.ajaxurl,type:"post",data:{action:"set_asset_geo_location_json",post_id:CONSTRUKTED_AJAX.post_id,asset_geo_location_json:JSON.stringify(e)},success:function(e){t.prop("disabled",!1),!1!==JSON.parse(e).ret?alert("Successfully updated!"):alert("Passed values is the same as the values that is already in the database!")},error:function(e,i,n){t.prop("disabled",!1),alert("error")}})}function Pn(e,t,i){let n=jQuery("#capture_thumbnail"),o=jQuery("#save_current_view"),s=jQuery("#reset_camera_view"),r=jQuery("#show-hide-wireframe-checkbox"),a=jQuery("#show-hide-tiles-inspector-checkbox");n.click((function(){!function(e){let t=jQuery("#capture_thumbnail");e.scene.requestRender(),e.render();let i=e.canvas.toDataURL("image/jpeg",.5);t.prop("disabled",!0),jQuery.ajax({url:CONSTRUKTED_AJAX.ajaxurl,type:"post",data:{action:"post_set_thumbnail",post_id:CONSTRUKTED_AJAX.post_id,capturedJpegImage:i},success:function(e){t.prop("disabled",!1),alert(e)},error:function(){t.prop("disabled",!1),alert("error")}})}()})),o.click((function(){!function(){let e=jQuery("#save_current_view");e.prop("disabled",!0),jQuery.ajax({url:CONSTRUKTED_AJAX.ajaxurl,type:"post",data:{action:"post_set_current_view",post_id:CONSTRUKTED_AJAX.post_id,view_data:sn()},success:function(t){e.prop("disabled",!1),alert(t)},error:function(t,i,n){e.prop("disabled",!1),alert("error")}})}()})),s.click((function(){!function(){let e=jQuery("#reset_camera_view");e.prop("disabled",!0),jQuery.ajax({url:CONSTRUKTED_AJAX.ajaxurl,type:"post",data:{action:"post_reset_current_view",post_id:CONSTRUKTED_AJAX.post_id},success:function(t){e.prop("disabled",!1),alert(t)},error:function(t,i,n){e.prop("disabled",!1),alert("error")}})}()})),jQuery("#maximum-screen-space-error-slider").change((function(){e&&(e.maximumScreenSpaceError=32-this.value)})),jQuery("#fpv-movement-speed-slider").change((function(){e&&t&&(t.setWorkingSpeed(parseFloat(this.value)),i.setMoveRateFactor(parseFloat(this.value)))})),r.change((function(){e&&(e.debugWireframe=this.checked)})),a.change((function(){e&&on(this.checked)}))}function kn(e){let t=e.measure.viewModel,i=t._measurements[7],n=t._measurements[1],o=t._measurements[2],s=t._measurements[6];function r(t,r){let a=' <div class="form-check">\n                                    <input class="form-check-input" type="checkbox" id="'+t+'" checked>\n                                    <label class="form-check-label" for="'+t+'">\n'+r+"                                    </label>\n                                </div>";$("#measurement-list").append(a),$("[id="+t+"]").change((function(){let r=t.split("-"),a=r[0],l=parseInt(r[1]);"point"===a&&c(i.measurementResult[l],this.checked),"distance"===a&&h(n.measurementResult[l],this.checked),"polyline"===a&&d(o.measurementResult[l],this.checked),"area"===a&&u(s.measurementResult[l],this.checked),e.scene.requestRender()}))}function a(){$("*[id*=measurement-tool-button]").each((function(){this.classList.remove("active")}))}function l(){$("#end-measurement").removeClass("disabled")}function c(e,t){e.point.show=t,e.label.show=t}function h(e,t){e.startPoint.show=t,e.endPoint.show=t,e.polyline.show=t,e.xyPolyline.show=t,e.xyBox.show=t,e.label.show=t,e.xLabel.show=t,e.xAngleLabel.show=t,e.yLabel.show=t,e.yAngleLabel.show=t}function d(e,t){e.label.show=t;for(let i=0;i<e.segmentLabels.length;i++)e.segmentLabels[i].show=t;e.polyline.show=t;for(let i=0;i<e.points.length;i++)e.points[i].show=t}function u(e,t){e.label.show=t,e.polygon.show=t,e.polyline.show=t;for(let i=0;i<e.points.length;i++)e.points[i].show=t}i.newMeasurement.addEventListener((function(e){console.log(e);let t=i.measurementResult[e];console.log(t),r("point-"+e,"Point "+e)})),n.newMeasurement.addEventListener((function(e){console.log(e);let t=n.measurementResult[e];console.log(t),r("distance-"+e,"Distance "+e)})),o.newMeasurement.addEventListener((function(e){console.log(e);let t=o.measurementResult[e];console.log(t),r("polyline-"+e,"Polyline "+e)})),s.newMeasurement.addEventListener((function(e){console.log(e);let t=s.measurementResult[e];console.log(t),r("area-"+e,"Area "+e)})),jQuery("#measurement-tool-button-component-distance").click((function(){a(),this.classList.add("active"),l(),t._activate(),t.selectedMeasurement=n})),jQuery("#measurement-tool-button-polyline").click((function(){a(),this.classList.add("active"),l(),t._activate(),t.selectedMeasurement=o})),jQuery("#measurement-tool-button-area").click((function(){a(),this.classList.add("active"),l(),t._activate(),t.selectedMeasurement=s})),jQuery("#measurement-tool-button-point").click((function(){a(),this.classList.add("active"),l(),t._activate(),t.selectedMeasurement=i})),$("#end-measurement").click((function(){a(),t._deactivate()})),$("#show-hide-all-measurement-checkbox").change((function(){let t=this.checked;!function(t){let r=i.measurementResult;for(let e=0;e<r.length;e++)c(r[e],t);let a=n.measurementResult;for(let e=0;e<a.length;e++)h(a[e],t);let l=o.measurementResult;for(let e=0;e<l.length;e++)d(l[e],t);let p=s.measurementResult;for(let e=0;e<p.length;e++)u(p[e],t);e.scene.requestRender()}(t),$("*[id*=measurement-result]").each((function(){this.checked=t,console.log(this.id)}))})),$("#end-measurement").click((function(){a(),t._deactivate()}))}function Rn(e,t,i){let n=jQuery("#tileset_latitude"),o=jQuery("#tileset_longitude"),s=jQuery("#tileset_altitude"),r=jQuery("#tileset_estimate_altitude"),a=jQuery("#save_tileset_model_matrix_button"),l=null;if(CONSTRUKTED_AJAX.asset_geo_location)if(wn=CONSTRUKTED_AJAX.asset_geo_location,wn.longitude&&wn.latitude&&wn.height){wn.longitude=parseFloat(wn.longitude),wn.latitude=parseFloat(wn.latitude),wn.height=parseFloat(wn.height),wn.heading=parseFloat(wn.heading),wn.pitch=parseFloat(wn.pitch),wn.roll=parseFloat(wn.roll);let t=new Cesium.Cartographic(Cesium.Math.toRadians(wn.longitude),Cesium.Math.toRadians(wn.latitude),wn.height);l={position:e.scene.globe.ellipsoid.cartographicToCartesian(t),headingPitchRoll:{heading:Cesium.Math.toRadians(wn.heading),pitch:Cesium.Math.toRadians(wn.pitch),roll:Cesium.Math.toRadians(wn.roll)},scale:wn.scale}}else console.warn("invalid asset geo location!"),console.warn(CONSTRUKTED_AJAX.asset_geo_location);let c=new Cesium.Quaternion,h=new Cesium.Quaternion,d=new Cesium.Cartesian3,u=new Cesium.Cartesian3,p=new Cesium.Cartesian3,m=new Cesium.Matrix4,_=new Cesium.Matrix3;function f(e,i){let n=t.modelMatrix;n=Cesium.Matrix4.setTranslation(n,e,n),function(e,t){Cesium.Check.defined("transform",e),Cesium.Check.defined("headingPitchRoll",t);let i=Cesium.Quaternion.fromHeadingPitchRoll(t,c),n=Cesium.Matrix4.getTranslation(e,d),o=Cesium.Matrix4.getScale(e,u),s=Cesium.Matrix4.multiplyByPoint(e,Cesium.Cartesian3.ZERO,p),r=Cesium.Transforms.eastNorthUpToFixedFrame(s,void 0,m),a=Cesium.Matrix4.getMatrix3(r,_),l=Cesium.Quaternion.fromRotationMatrix(a,h),f=Cesium.Quaternion.multiply(l,i,a);Cesium.Matrix4.fromTranslationQuaternionRotationScale(n,f,o,e)}(n,i)}function g(i){t.asset.extras&&t.asset.extras.ion.georeferenced?function(e){let i=originalBoundingSphereCenterHeight-e;t.modelMatrix=Cesium.Matrix4.fromTranslation(new Cesium.Cartesian3(0,0,i))}(i):function(i){let n=t.modelMatrix,o=Cesium.Matrix4.getTranslation(n,new Cesium.Cartesian3),s=Cesium.Cartographic.fromCartesian(o);s.height=i;let r=e.scene.globe.ellipsoid.cartographicToCartesian(s),a=e.scene,l=Cesium.Transforms.fixedFrameToHeadingPitchRoll(n,a.mapProjection.ellipsoid,void 0,new Cesium.HeadingPitchRoll);f(r,l)}(i)}return l?(n.val(wn.latitude),o.val(wn.longitude),s.val(wn.height),jQuery("#tileset_heading").val(wn.heading)):(n.val(0),o.val(0),s.val(0),jQuery("#tileset_heading").val(0)),jQuery("#edit_asset_geo_location_button").click((function(){i&&i.viewModel.activate()})),a.click((function(){Sn()})),o.change((function(){let i=o.val();if(i=parseFloat(i),isNaN(i)||i>180||i<-180)return o.val(""),void alert("invalid longitude: "+i);rn(this._viewer,!0);let n=t.modelMatrix,s=Cesium.Matrix4.getTranslation(n,new Cesium.Cartesian3),r=Cesium.Cartographic.fromCartesian(s);r.longitude=i*Cesium.Math.RADIANS_PER_DEGREE;let a=e.scene.globe.ellipsoid.cartographicToCartesian(r),l=e.scene;f(a,Cesium.Transforms.fixedFrameToHeadingPitchRoll(n,l.mapProjection.ellipsoid,void 0,new Cesium.HeadingPitchRoll)),e.flyTo(t)})),n.change((function(){let i=n.val();if(i=parseFloat(i),isNaN(i)||i>90||i<-90)return n.val(""),void alert("invalid latitude: "+i);rn(!0);let o=t.modelMatrix,s=Cesium.Matrix4.getTranslation(o,new Cesium.Cartesian3),r=Cesium.Cartographic.fromCartesian(s);r.latitude=i*Cesium.Math.RADIANS_PER_DEGREE;let a=e.scene.globe.ellipsoid.cartographicToCartesian(r),l=e.scene;f(a,Cesium.Transforms.fixedFrameToHeadingPitchRoll(o,l.mapProjection.ellipsoid,void 0,new Cesium.HeadingPitchRoll)),e.flyTo(t)})),s.change((function(){let i=s.val();if(i=parseFloat(i),isNaN(i)||i>15e3||i<-1e3)return s.val(""),void alert("invalid altitude: "+i);rn(!0),g(i),e.zoomTo(t)})),jQuery("#tileset_heading").change((function(){let i=jQuery("#tileset_heading").val();if(i=parseFloat(i),isNaN(i)||i>180||i<-180)return jQuery("#tileset_heading").val(""),void alert("invalid heading: "+i);let n=t.modelMatrix,o=Cesium.Matrix4.getTranslation(n,new Cesium.Cartesian3),s=e.scene,r=Cesium.Transforms.fixedFrameToHeadingPitchRoll(n,s.mapProjection.ellipsoid,void 0,new Cesium.HeadingPitchRoll);r.heading=i*Cesium.Math.RADIANS_PER_DEGREE,f(o,r),e.zoomTo(t)})),jQuery("#tileset-transparency-slider").change((function(){let i=this.value;t.style=new Cesium.Cesium3DTileStyle({color:"rgba(255, 255, 255,"+i+")"}),e.scene.requestRender()})),r.click((function(){let i=o.val(),r=n.val();if(i=parseFloat(i),r=parseFloat(r),0===i&&0===r)return void alert("Please input valid Latitude and Longitude!");let a=e.scene.globe,l=new Cesium.Cartographic(Cesium.Math.toRadians(i),Cesium.Math.toRadians(r)),c=a.getHeight(l);void 0!==c?(s.val(c.toFixed(3)),g(c),e.zoomTo(t)):alert("failed to get height!")})),l}t(".construkted-viewer-controlbarContainer {\r\n    display: block;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 33px;\r\n    background-color: #384d68;\r\n\r\n    /*\r\n        override .airkit_single-post .featured-image, .page .featured-image\r\n        text-align center\r\n    */\r\n    text-align: left !important;\r\n}\r\n\r\n.construkted-viewer-controlbar-button {\r\n    background-color: rgba(60, 80, 105,.3);\r\n    border: 1px solid #fff;\r\n    color: #edffff;\r\n    border-radius: 5px;\r\n    padding: 3px 7px;\r\n    cursor: pointer;\r\n    -moz-user-select: none;\r\n    -webkit-user-select: none;\r\n    -ms-user-select: none;\r\n    user-select: none;\r\n    margin-top: 3px;\r\n    margin-left: 2px;\r\n    margin-right: 2px;\r\n}\r\n\r\n.construkted-viewer-controlbar-button:first-child {\r\n    margin-left: 20px;\r\n}");const On=Cesium.Event;class An{constructor(e){this._fpvButtonClicked=new On,this._flyButtonClicked=new On,this._orbitButtonClicked=new On;const t=In("FPV");t.addEventListener("click",(()=>{this._fpvButtonClicked.raiseEvent()})),e.appendChild(t);const i=In("FLY");i.addEventListener("click",(()=>{this._flyButtonClicked.raiseEvent()})),e.appendChild(i);const n=In("ORBIT");n.addEventListener("click",(()=>{this._orbitButtonClicked.raiseEvent()})),e.appendChild(n)}}function In(e){const t=document.createElement("button");return t.type="button",t.textContent=e,t.className="construkted-viewer-controlbar-button",t}Object.defineProperties(An.prototype,{fpvButtonClicked:{get:function(){return this._fpvButtonClicked}},flyButtonClicked:{get:function(){return this._flyButtonClicked}},orbitButtonClicked:{get:function(){return this._orbitButtonClicked}}});let Dn,Ln,Un={moveForward:!1,moveBackward:!1,moveUp:!1,moveDown:!1,moveLeft:!1,moveRight:!1};class Nn extends vn{constructor(e){super(e),this._started=!1,this._moveRateFactor=.1,document.addEventListener("keydown",(function(e){const t=Vn(e.keyCode);void 0!==t&&(Un[t]=!0)}),!1),document.addEventListener("keyup",(function(e){const t=Vn(e.keyCode);void 0!==t&&(Un[t]=!1)}),!1);const t=this._cesiumViewer,i=t.canvas,n=t.scene.globe.ellipsoid;i.setAttribute("tabindex","0"),i.onclick=function(){i.focus()},t.clock.onTick.addEventListener((e=>{if(!this._started)return;let i=t.camera;let o=n.cartesianToCartographic(i.position).height/100;o=o*this._moveRateFactor*.5,console.log("moveRate",o),Un.moveForward&&i.moveForward(o),Un.moveBackward&&i.moveBackward(o),Un.moveUp&&i.moveUpEx(o),Un.moveDown&&i.moveDownEx(o),Un.moveLeft&&i.moveLeft(o),Un.moveRight&&i.moveRight(o)}))}start(){an(this._cesiumViewer.scene),this._started=!0,this._screenSpaceEventHandler.setInputAction(this._onMouseMove.bind(this),Cesium.ScreenSpaceEventType.MOUSE_MOVE)}stop(){ln(this._cesiumViewer.scene),this._started=!1,this._screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE)}started(){return this._started}setMoveRateFactor(e){this._moveRateFactor=e}}function Vn(e){switch(e){case"W".charCodeAt(0):return"moveForward";case"S".charCodeAt(0):return"moveBackward";case"R".charCodeAt(0):return"moveUp";case"F".charCodeAt(0):return"moveDown";case"D".charCodeAt(0):return"moveRight";case"A".charCodeAt(0):return"moveLeft";default:return}}let Fn=null,Bn=0,zn=jQuery("#tileset_latitude"),Hn=jQuery("#tileset_longitude"),jn=jQuery("#tileset_altitude"),Qn=jQuery("#tileset_heading"),Xn=jQuery("#edit_asset_geo_location_button"),Yn=jQuery("#tileset_estimate_altitude"),Zn=null;class qn{constructor(){this._viewer=null,this._tileset=null}start(){this._createCesiumViewer(),this._addTileset(),this._flyController=new Nn({isMobile:tn(),cesiumViewer:this._viewer}),this._createControlbar(),Fn=Rn(this._viewer,this._tileset,Zn),kn(this._viewer),this.initXR()}_createCesiumViewer(){Cesium.Ion.defaultAccessToken=CONSTRUKTED_AJAX.cesium_access_token,Cesium.Ion.defaultAccessToken||console.warn("default access token is null!");let e=new Cesium.Viewer("cesiumContainer",{terrainProvider:Cesium.createWorldTerrain(),animation:!1,homeButton:!1,baseLayerPicker:!1,geocoder:!1,sceneModePicker:!1,timeline:!1,fullscreenElement:"cesiumContainer",requestRenderMode:!0,navigationHelpButton:!1});this._viewer=e,e.resolutionScale=1,e.scene.globe.depthTestAgainstTerrain=!0,e.extend(Cesium.viewerMeasureMixin,{units:new Cesium.MeasureUnits({distanceUnits:Cesium.DistanceUnits.METERS,areaUnits:Cesium.AreaUnits.SQUARE_METERS,volumeUnits:Cesium.VolumeUnits.CUBIC_METERS})}),e.extend(Cesium.viewerCesium3DTilesInspectorMixin);e.cesium3DTilesInspector.viewModel.picking=!1,on(!1),e.scene.screenSpaceCameraController.rotateEventTypes=Cesium.CameraEventType.LEFT_DRAG,e.scene.screenSpaceCameraController.zoomEventTypes=[Cesium.CameraEventType.MIDDLE_DRAG,Cesium.CameraEventType.WHEEL,Cesium.CameraEventType.PINCH],e.scene.screenSpaceCameraController.tiltEventTypes=[Cesium.CameraEventType.RIGHT_DRAG,Cesium.CameraEventType.PINCH,{eventType:Cesium.CameraEventType.RIGHT_DRAG,modifier:Cesium.KeyboardEventModifier.CTRL},{eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.CTRL}]}_addTileset(){let e="https://s3.us-east-2.wasabisys.com/construkted-assets/"+CONSTRUKTED_AJAX.post_slug+"/tileset.json",t=this._viewer.scene.primitives.add(new Cesium.Cesium3DTileset({url:e,immediatelyLoadDesiredLevelOfDetail:!1,skipLevelOfDetail:!0,loadSiblings:!0}));this._tileset=t,null!=t&&(t.maximumScreenSpaceError=8,t.maximumMemoryUsage=512,t.pointCloudShading.maximumAttenuation=1.2,t.pointCloudShading.baseResolution=.44,t.pointCloudShading.geometricErrorScale=.3,t.pointCloudShading.attenuation=!0,t.pointCloudShading.eyeDomeLighting=!0,t.pointCloudShading.eyeDomeLightingStrength=.5,t.pointCloudShading.eyeDomeLightingRadius=.5,t.readyPromise.then((()=>{this._onTilesetReady(t)})).otherwise((function(e){window.alert(e)})))}_onTilesetReady(e){const t=this._viewer;jQuery.fn.doubletap=jQuery.fn.doubletap||function(e,t){t=null==t?300:t,this.bind("touchend",(function(i){let n=(new Date).getTime(),o=n-($(this).data("lastTouch")||n+1);o<t&&0<o?($(this).data("lastTouch",null),null!==e&&"function"==typeof e&&e(i)):$(this).data("lastTouch",n)}))},jQuery(".cesium-widget > canvas").doubletap((function(e){if(e&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]){const t=e.originalEvent.changedTouches[0];Ln.onDoubleTaped({position:{x:t.clientX,y:t.clientY}})}else console.warn("can not get position")}));let i={cesiumViewer:t,main3dTileset:e,defaultCameraPositionOrientationJson:CONSTRUKTED_AJAX.default_camera_position_direction,isMobile:tn(),ignoreCollisionDetection:!1,immersiveArEnabled:Dn.enabled};if(Ln=new En(i),Ln.FPVStarted().addEventListener((function(){jQuery("body").addClass("fpv-mode-on"),jQuery(".fpv-navigation").show(),gn(),window.addEventListener("keydown",nn,!1)})),Ln.FPVFinished().addEventListener((function(){jQuery("body").removeClass("fpv-mode-on"),jQuery(".fpv-navigation").hide(),gn(),window.removeEventListener("keydown",nn,!1)})),function(e){let t=jQuery(".fpv-left"),i=jQuery(".fpv-right"),n=jQuery(".fpv-up"),o=jQuery(".fpv-down");t.on("mousedown",(function(){e.setDirectionLeft()})),t.on("mouseup",(function(){e.setDirectionNone()})),i.on("mousedown",(function(){e.setDirectionRight()})),i.on("mouseup",(function(){e.setDirectionNone()})),n.on("mousedown",(function(){e.setDirectionForward()})),n.on("mouseup",(function(){e.setDirectionNone()})),o.on("mousedown",(function(){e.setDirectionBackward()})),o.on("mouseup",(function(){e.setDirectionNone()})),t.on("touchstart",(function(){e.setDirectionLeft()})),t.on("touchend",(function(){e.setDirectionNone()})),i.on("touchstart",(function(){e.setDirectionRight()})),i.on("touchend",(function(){e.setDirectionNone()})),n.on("touchstart",(function(){e.setDirectionForward()})),n.on("touchend",(function(){e.setDirectionNone()})),o.on("touchstart",(function(){e.setDirectionBackward()})),o.on("touchend",(function(){e.setDirectionNone()}))}(Ln),Pn(this._tileset,Ln,this._flyController),function(e){return void 0!==e.asset.extras&&(null===e.asset.extras||!0===e.asset.extras.ion.georeferenced)}(e)){zn.prop("disabled",!0),Hn.prop("disabled",!0),Qn.prop("disabled",!0),Xn.prop("disabled",!0),Yn.prop("disabled",!0);let t=e.boundingSphere.center,i=Cesium.Cartographic.fromCartesian(t);if(Bn=i.height,CONSTRUKTED_AJAX.asset_geo_location){let t=CONSTRUKTED_AJAX.asset_geo_location,i=Bn-parseFloat(t.height);e.modelMatrix=Cesium.Matrix4.fromTranslation(new Cesium.Cartesian3(0,0,i)),jn.val(t.height)}else Hn.val(Cesium.Math.toDegrees(i.longitude)),zn.val(Cesium.Math.toDegrees(i.latitude)),jn.val(i.height)}else Fn?(!function(e,t){let i=t.position,n=new Cesium.Cartesian3(i.x,i.y,i.z),o=t.headingPitchRoll,s=new Cesium.HeadingPitchRoll(o.heading,o.pitch,o.roll),r=t.scale,a=new Cesium.Cartesian3(r.x,r.y,r.z),l=Cesium.Transforms.headingPitchRollToFixedFrame(n,s);e.modelMatrix=Cesium.Matrix4.setScale(l,a,new Cesium.Matrix4)}(e,Fn),CONSTRUKTED_AJAX.is_owner&&(Zn=new Cesium.TransformEditor({container:t.container,scene:t.scene,transform:e.modelMatrix,boundingSphere:e.boundingSphere}),Zn.viewModel.deactivate())):(rn(!1),e.modelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(0,0))),CONSTRUKTED_AJAX.is_owner&&(Zn=new Cesium.TransformEditor({container:t.container,scene:t.scene,transform:e.modelMatrix,boundingSphere:e.boundingSphere}),Zn.viewModel.deactivate());!function(e,t){const i=CONSTRUKTED_AJAX.default_camera_position_direction,n=e.camera;if(void 0!==i&&""!==i){let o;try{o=JSON.parse(i)}catch(e){return console.error(e.message),void n.flyToBoundingSphere(t.boundingSphere)}if(!(o.offsetX&&o.offsetY&&o.offsetZ&&o.heading&&o.pitch&&o.roll))return console.warn("invalid default_camera_position_direction"),console.warn(CONSTRUKTED_AJAX.default_camera_position_direction),void n.flyToBoundingSphere(t.boundingSphere);let s=new Cesium.Cartesian3(o.offsetX,o.offsetY,o.offsetZ),r=Cesium.Cartesian3.add(t.boundingSphere.center,s,new Cesium.Cartesian3);e.camera.flyTo({destination:r,orientation:{heading:Cesium.Math.toRadians(o.heading),pitch:Cesium.Math.toRadians(o.pitch),roll:Cesium.Math.toRadians(o.roll)}})}else n.flyToBoundingSphere(t.boundingSphere)}(this._viewer,this._tileset)}_createControlbar(){const e=document.createElement("div");e.className="construkted-viewer-controlbarContainer",this._viewer.container.appendChild(e);const t=new An(e);t.fpvButtonClicked.addEventListener(this.onFPV,this),t.flyButtonClicked.addEventListener(this.onFLY,this),t.orbitButtonClicked.addEventListener(this.onOrbit,this)}onFPV(){Ln.started()||(this._flyController.started()&&this._flyController.stop(),Ln.setCanStart(!0),alert("Double click on the model to start FPV mode"))}onFLY(){this._flyController.started()?console.warn("already started"):(Ln.started()&&Ln.exitFPV(),Ln.setCanStart(!1),this._flyController.start())}onOrbit(){Ln.started()?Ln.exitFPV():this._flyController.started()&&this._flyController.stop(),Ln.setCanStart(!1)}tryDeactivateTransformEditor(){Zn&&Zn.viewModel.deactivate()}initXR(){try{Dn=new CONSTRUKTEDXR.WebXRButton({onRequestSession:mn,onEndSession:_n,textEnterXRTitle:"START AR",textXRNotFoundTitle:"AR NOT FOUND",textExitXRTitle:"EXIT  AR"}),document.querySelector("#cesiumContainer").appendChild(Dn.domElement),navigator.xr&&(navigator.xr.isSessionSupported("immersive-ar").then((e=>{Dn.enabled=e})),navigator.xr.requestSession("inline").then(pn))}catch(e){alert(e.message)}}}function Kn(){jQuery((function(e){let t=e(".bst4-wrapper li.nav-item span.btn"),i=e(".popup-wrapper .close-btn");t.click((function(){if(jQuery(".popup-wrapper").hide(),jQuery("#end-measurement").trigger("click"),!jQuery(this).parent().hasClass("active")){let e=jQuery(this).attr("id").replace("-btn","");jQuery("#"+e).show()}e(this).parent().toggleClass("active").siblings().not(this).removeClass("active"),construktedViewer.tryDeactivateTransformEditor()})),i.click((function(){jQuery(this).parents(".popup-wrapper").hide(),jQuery("#end-measurement").trigger("click"),construktedViewer.tryDeactivateTransformEditor()}))})),jQuery("#scroll-down-btn").on("click",(function(){let e=jQuery(".post-meta").offset().top-jQuery(".featured-image").height()-jQuery("#header").height()+jQuery(".post-meta").height();$("html, body").animate({scrollTop:e},600)})),jQuery(window).on("scroll",(function(){jQuery(window).scrollTop()>200?jQuery("#scroll-down-btn").fadeOut(300):jQuery("#scroll-down-btn").fadeIn(300)})),jQuery(".embed-code-link").on("click",(function(){return jQuery(".embed-content").toggleClass("in"),!1})),jQuery(document).on("click",".letiation-action",(function(){let e=jQuery(this),t=jQuery(this).attr("data-value");jQuery(".letiations #disk_space").val(t).trigger("change"),e.parent().addClass("selected").siblings().removeClass("selected")})),jQuery(document).ready((function(){if(jQuery("table.letiations").length>0){let e=jQuery("#disk_space").val();jQuery('.letiation-action[data-value="'+e+'"]').trigger("click");let t=jQuery(".flex-row").data("current");t>0&&jQuery('.letiation-action[data-value="'+t+'"]').trigger("click")}}))}const Wn=1.11,Jn=!1,Gn="arkcnfuk9fw";console.log("ConstruktedJs version",Wn),window.Cesium.MeasurementMouseHandler=Ht,window.Cesium.DistanceMeasurement=gt,window.Cesium.PolylineMeasurement=si,window.Cesium.HorizontalMeasurement=zt,window.Cesium.VerticalMeasurement=gi,window.Cesium.HeightMeasurement=wt,window.Cesium.AreaMeasurement=st,window.Cesium.PointMeasurement=Gt,window.Cesium.MeasureUnits=r,window.Cesium.DistanceUnits=i,window.Cesium.AreaUnits=n,window.Cesium.VolumeUnits=n,window.Cesium.TransformEditor=De,window.Cesium.viewerMeasureMixin=yi,window.CONSTRUKTEDXR={},CONSTRUKTEDXR.WebXRButton=Ti,CONSTRUKTEDXR.InlineViewerHelper=Hi,CONSTRUKTEDXR.eulerFromQuaternionDegree=en,CONSTRUKTEDXR.create$1=Qi,function(){const e=Cesium.Camera;let t=new Cesium.Cartesian3;e.prototype.moveUpEx=function(e){this.moveVertical(e)},e.prototype.moveDownEx=function(e){this.moveVertical(-e)},e.prototype.moveVertical=function(e){const i=this.position,n=Cesium.Cartesian3.normalize(i,t);this.move(n,e)}}(),jQuery(document).ready((function(){window.$=jQuery,function(){const e=jQuery(".ck-asset-modal");"y"==jQuery.cookie("ck-asset-modal")?e.addClass("is-closed hidden"):e.fadeIn(600),jQuery(document).on("click",".ck-asset-modal .icon-close, .ck-asset-modal-footer .gw3-button",(function(e){e.preventDefault(),jQuery(this).parents(".ck-asset-modal").addClass("hidden is-closed"),jQuery("#ck-asset-modal-close").is(":checked")&&jQuery.cookie("ck-asset-modal","y",{expires:31})})),jQuery(document).on("click",".ck-modal-toggler",(function(t){t.preventDefault(),e.removeClass("hidden is-closed"),e.fadeIn(300)})),jQuery(".fpv-nav-btn").on("click",(function(e){e.preventDefault()}))}(),Jn&&(window.CONSTRUKTED_AJAX={ajaxurl:"https://construkted.com/wp-admin/admin-ajax.php",asset_geo_location:'{"longitude":"-99.13299675","latitude":"19.43416307","height":"2219.46115038","heading":"99.80678649","pitch":"0.00000000","roll":"-0.00000000","scale":{"x":0.9999999999999519,"y":0.9999999999999523,"z":0.9999999999999408}}',bg_color_css_string:"",cesium_access_token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI2MzJlNDI2ZC1hMmE5LTQ4MjEtYmQwYS1iMDRlNTNjM2JiZTkiLCJpZCI6MjkyMSwiaWF0IjoxNTM1MjE4Mjk1fQ.jMg72t7Gnkk4-E9G7zhd_CoTJBUJ39hHALmxGBRL1ok",default_camera_position_direction:'{"offsetX":-123.05745039600879,"offsetY":-54.40936731733382,"offsetZ":-72.37648316612467,"heading":55.70190003039015,"pitch":-15.907714727235403,"roll":0.10348905269346916}',is_owner:"",post_id:"3446",post_slug:Gn}),CONSTRUKTED_AJAX.asset_geo_location&&""!==CONSTRUKTED_AJAX.asset_geo_location&&(CONSTRUKTED_AJAX.asset_geo_location=JSON.parse(CONSTRUKTED_AJAX.asset_geo_location)),CONSTRUKTED_AJAX.is_owner=Boolean(CONSTRUKTED_AJAX.is_owner);CONSTRUKTED_AJAX.bg_color_css_string&&""!==CONSTRUKTED_AJAX.bg_color_css_string||(CONSTRUKTED_AJAX.bg_color_css_string="#333333"),window.construktedViewer=new qn,construktedViewer.start(),Kn()}))}));
